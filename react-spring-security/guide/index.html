<!DOCTYPE html>
<html>
  <head>
    <meta name='google-site-verification' content='REYQ1_I6HGowAE7LOLVqfQbnKaB4IfFpMlGzMbJj55Q' />
    <meta name='viewport' content='width=device-width, initial-scale=1' />
    <link rel='icon' href='/images/favicon.ico' />
    <link rel='mask-icon' href='//images/grails-pinned-icon.svg' color='feb672' />
    <meta charset='UTF-8' />
    <title>Creating a React app with Spring Security | Grails Guides | Grails Framework</title>
    <meta name='description' content='Creating a React app with Spring Security. Learn how to add Spring Security to your React app' />
    <link rel='stylesheet' href='../css/main.css' />
    <link rel='stylesheet' href='../css/screen.css' />
    <script src='https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/1.7.1/clipboard.min.js'></script>
  </head>
  <body class='guide'><header class='mainheader'>
  <div class='content'>
    <a href='https://grails.org/index.html'><img class='grailslogo' src='/images/grails_logo.svg' alt='Grails Logo' /></a>
    <a href='javascript:show(&apos;topmenus&apos;, &apos;showNavigationLink&apos;)' id='showNavigationLink' class='mobile align-center'>Show Navigation</a>
    <div id='topmenus'>
      <nav class='secondarymenu' id='secondarymenu'><ul>
  <li>
    <a href='https://grails.org/learning.html'>Learning</a>
  </li>
  <li>
    <a href='https://grails.org/community.html'>Community</a>
  </li>
  <li>
    <a href='https://grails.org/search.html'>Search</a>
  </li>
</ul></nav>
      <nav class='mainmenu' id='mainmenu'><ul>
  <li>
    <a href='https://grails.org/documentation.html'>Documentation</a>
  </li>
  <li>
    <a href='https://grails.org/download.html'>Download</a>
  </li>
  <li>
    <a href='https://plugins.grails.org'>Plugins</a>
  </li>
  <li>
    <a href='https://guides.grails.org/index.html'>Guides</a>
  </li>
  <li>
    <a href='https://grails.org/faq.html'>FAQ</a>
  </li>
  <li>
    <a href='https://grails.org/support.html'>Support</a>
  </li>
</ul></nav>
    </div>
  </div>
</header><div class='fullwidth'><article class="guide">
    <aside>
        <a href="https://travis-ci.org/grails-guides/react-spring-security"><img src="https://travis-ci.org/grails-guides/react-spring-security.svg?branch=master"></a>

        <button type="button" class="btn btn-large" onclick="window.location.href=&quot;https://github.com/grails-guides/react-spring-security&quot;"><img height="15" src="../img/github_white.svg" alt="Github"/><span>&nbsp;Get the Code</span></button>


        <ul class="githublinks">
            <li><button type="button" class="btn btn-default" href="#" onclick="document.getElementById('github-url').value='git@github.com:grails-guides/react-spring-security.git'" class="codeButton">SSH</button></li>
            <li><button type="button" class="btn btn-default" onclick="document.getElementById('github-url').value='https://github.com/grails-guides/react-spring-security.git'" class="codeButton">HTTPS</button></li>
        </ul>
        <div class="input-group">
            <!-- Target -->
            <input id="github-url" value="git@github.com:grails-guides/react-spring-security.git" type="text" />
            <!-- Trigger -->
            <button type="button" class="clippy btn btn-default" type="button" data-clipboard-target="#github-url">
                <img width="13" src="../img/clippy.svg" alt="Copy to clipboard">
            </button>
        </div>
        <script>var clipboard = new Clipboard('.clippy');</script>
        <button type="button" class="btn btn-large" onclick="window.location.href=&quot;https://github.com/grails-guides/react-spring-security/archive/master.zip&quot;">Download ZIP</button>
        
        <div id="table-of-content">
            <h3>Table of Contents</h3>
            
            <div class="toc-item" style="margin-left:0px"><a href="#training"><strong>1</strong><span>Grails Training</span></a></div>
            
            <div class="toc-item" style="margin-left:0px"><a href="#gettingStarted"><strong>2</strong><span>Getting Started</span></a></div>
            
            <div class="toc-item" style="margin-left:10px"><a href="#requirements"><strong>2.1</strong><span>What you will need</span></a></div>
            
            <div class="toc-item" style="margin-left:10px"><a href="#howto"><strong>2.2</strong><span>How to complete the guide</span></a></div>
            
            <div class="toc-item" style="margin-left:0px"><a href="#writingTheApp"><strong>3</strong><span>Writing the Application</span></a></div>
            
            <div class="toc-item" style="margin-left:0px"><a href="#runningTheApp"><strong>4</strong><span>Running the Application</span></a></div>
            
            <div class="toc-item" style="margin-left:0px"><a href="#server"><strong>5</strong><span>Building the Server</span></a></div>
            
            <div class="toc-item" style="margin-left:10px"><a href="#serverDependencies"><strong>5.1</strong><span>Installing Spring Security</span></a></div>
            
            <div class="toc-item" style="margin-left:10px"><a href="#springSecurityConfig"><strong>5.2</strong><span>Configuring Spring Security</span></a></div>
            
            <div class="toc-item" style="margin-left:10px"><a href="#appSecurityConfig"><strong>5.3</strong><span>Securing our API</span></a></div>
            
            <div class="toc-item" style="margin-left:10px"><a href="#bootstrapData"><strong>5.4</strong><span>Updating our Initial Data</span></a></div>
            
            <div class="toc-item" style="margin-left:10px"><a href="#runningTheSecuredApp"><strong>5.5</strong><span>Test-driving our Secured API</span></a></div>
            
            <div class="toc-item" style="margin-left:0px"><a href="#client"><strong>6</strong><span>Building the Client</span></a></div>
            
            <div class="toc-item" style="margin-left:10px"><a href="#loginScreen"><strong>6.1</strong><span>Stateless Login Component</span></a></div>
            
            <div class="toc-item" style="margin-left:0px"><a href="#writingTheSecurity"><strong>7</strong><span>Adding Client security</span></a></div>
            
            <div class="toc-item" style="margin-left:10px"><a href="#clientSecurityConfig"><strong>7.1</strong><span>Creating our Configuration</span></a></div>
            
            <div class="toc-item" style="margin-left:10px"><a href="#writingAuth"><strong>7.2</strong><span>Handling Authentication</span></a></div>
            
            <div class="toc-item" style="margin-left:10px"><a href="#writingHandlers"><strong>7.3</strong><span>Writing the Response Handlers</span></a></div>
            
            <div class="toc-item" style="margin-left:10px"><a href="#writingResponseHandlers"><strong>7.4</strong><span>Creating our Response Handlers</span></a></div>
            
            <div class="toc-item" style="margin-left:10px"><a href="#writingErrorHandlers"><strong>7.5</strong><span>Creating a Default Error Handler</span></a></div>
            
            <div class="toc-item" style="margin-left:0px"><a href="#puttingItAllTogether"><strong>8</strong><span>Putting it all together</span></a></div>
            
            <div class="toc-item" style="margin-left:10px"><a href="#appState"><strong>8.1</strong><span>Creating our state</span></a></div>
            
            <div class="toc-item" style="margin-left:10px"><a href="#lifecycle"><strong>8.2</strong><span>React Lifecycle Methods</span></a></div>
            
            <div class="toc-item" style="margin-left:10px"><a href="#inputChangeHandler"><strong>8.3</strong><span>Login Form Change Handler</span></a></div>
            
            <div class="toc-item" style="margin-left:10px"><a href="#login"><strong>8.4</strong><span>Handling Login</span></a></div>
            
            <div class="toc-item" style="margin-left:10px"><a href="#logout"><strong>8.5</strong><span>Handling Logout</span></a></div>
            
            <div class="toc-item" style="margin-left:10px"><a href="#routing"><strong>8.6</strong><span>Routing</span></a></div>
            
            <div class="toc-item" style="margin-left:10px"><a href="#garage"><strong>8.7</strong><span>Authenticating our REST Calls</span></a></div>
            
            <div class="toc-item" style="margin-left:0px"><a href="#helpWithGrails"><strong>9</strong><span>Do you need help with Grails?</span></a></div>
            
            <div style="clear:both" ></div>
        </div>
        
    </aside>
    <header>
        <h1>Creating a React app with Spring Security</h1>
        <p>Learn how to add Spring Security to your React app</p>
        <p><strong>Authors:</strong> Ben Rhine, Zachary Klein</p>
        <p><strong>Grails Version:</strong> 3.3.2</p>
    </header>
    

<h1 id="training">1 Grails Training</h1>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails-guides/react-spring-security/edit/master/src/main/docs/guide/training.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p><strong>Grails Training</strong> - Developed and delivered by the folks who created and actively maintain the Grails framework!.</p>
</div>
<div id="ocitraining"></div>
<script type="text/javascript">
var getJSON = function(url, callback) {
    var xhr = new XMLHttpRequest();
    xhr.open('GET', url, true);
    xhr.responseType = 'json';
    xhr.onload = function() {
      var status = xhr.status;
      if (status == 200) {
        callback(null, xhr.response);
      } else {
        callback(status);
      }
    };
    xhr.send();
};
getJSON('https://training.grails.org/training', function(err, data) {
  var msg = '';
  if (err != null) {
      msg = 'Something went wrong while retrieving OCI training offerings';

  } else {
      if ( data.length == 0 ) {
         msg = '<p><b>Nothing scheduled at the moment - please check back again soon!</b></p>.';

      } else {
        msg += '<table>';
        msg += '<thead>';
        msg += '<tr><th>Course</th><th>Date(s)</th><th>Instructor(s)</th><th>Hour(s)</th></tr>';
        msg += '</thead>';
        msg += '<tbody>';

        var hrefs = new Array();
        for (var i = 0; i < data.length; i++) {
            var href = data[i].enrollmentLink;
            if (hrefs.indexOf(href) == -1) {
                msg += '<tr><td><a href="'+ href + '">'+ data[i].course + '</a></td><td>'+ data[i].dates + '</td><td>'+ data[i].instructors + '</td><td>'+ data[i].hours + '</td></tr>';
                hrefs.push(href);
            }

        }
        msg += '</tbody>';
        msg += '</table>';
      }
  }
  var ociTraining = document.getElementById("ocitraining");
  ociTraining.innerHTML = msg;
});
</script>


<h1 id="gettingStarted">2 Getting Started</h1>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails-guides/react-spring-security/edit/master/src/main/docs/guide/gettingStarted.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>In this guide you will learn how to secure your React/Grails application with Spring Security REST (using the default JWT Token authentication).</p>
</div>
<div class="paragraph">
<p>In many React apps, libraries like <a href="https://reacttraining.com/react-router/">React Router</a> are used to handle client-side routing, including login/logout redirects. In this guide we will not use any dedicated routing solution, in order to focus the learning experience on the authentication functionality.</p>
</div>


<h2 id="requirements">2.1 What you will need</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails-guides/react-spring-security/edit/master/src/main/docs/guide/requirements.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>To complete this guide, you will need the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Some time on your hands</p>
</li>
<li>
<p>A decent text editor or IDE</p>
</li>
<li>
<p>JDK 1.8 or greater installed with <code>JAVA_HOME</code> configured appropriately</p>
</li>
</ul>
</div>


<h2 id="howto">2.2 How to complete the guide</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails-guides/react-spring-security/edit/master/src/main/docs/guide/howto.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>To get started do the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://github.com/grails-guides/react-spring-security/archive/master.zip">Download</a> and unzip the source</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>or</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Clone the <a href="https://git-scm.com/">Git</a> repository:<br>
<code>git clone <a href="https://github.com/grails-guides/react-spring-security.git" class="bare">https://github.com/grails-guides/react-spring-security.git</a></code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The Grails guides repositories contain two folders:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>initial</code>  Initial project. Often a simple Grails app with some additional code to give you a head-start.</p>
</li>
<li>
<p><code>complete</code> A completed example. It is the result of working through the steps presented by the guide and applying those changes to the <code>initial</code> folder.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>To complete the guide, go to the <code>initial</code> folder</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>cd</code> into <code>grails-guides/react-spring-security/initial</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>and follow the instructions in the next sections.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
You can go right to the <strong>completed example</strong> if you <code>cd</code> into <code>grails-guides/react-spring-security/complete</code>
</td>
</tr>
</table>
</div>


<h1 id="writingTheApp">3 Writing the Application</h1>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails-guides/react-spring-security/edit/master/src/main/docs/guide/writingTheApp.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>For this guide, you should use the <code>initial</code> project included in the guide&#8217;s repo to get started. This project contains a working Grails/React app which provides basic CRUD functionality and a simple (unsecured) RESTful API. Feel free to start up the app and play around with it, and look at the existing code.</p>
</div>


<h1 id="runningTheApp">4 Running the Application</h1>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails-guides/react-spring-security/edit/master/src/main/docs/guide/runningTheApp.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>The app in this guide uses the <code>react</code> profile, which provides a multiproject client/server build. This means you must start both the server (Grails) and client (React) apps independently.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">~ cd initial/</code></pre>
</div>
</div>
<div class="paragraph">
<p>To launch the server application, run the following command.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">~ ./gradlew server:bootRun</code></pre>
</div>
</div>
<div class="paragraph">
<p>This will start up the Grails application, which will be running on <code><a href="http://localhost:8080" class="bare">http://localhost:8080</a></code></p>
</div>
<div class="paragraph">
<p>To start the client app, open a second terminal session (in the same directory), and run the following command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">~ ./gradlew client:start</code></pre>
</div>
</div>
<div class="paragraph">
<p>The React app will be available at <code><a href="http://localhost:3000" class="bare">http://localhost:3000</a></code>. Browse to that URL and you should see the home page of the app.</p>
</div>


<h1 id="server">5 Building the Server</h1>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails-guides/react-spring-security/edit/master/src/main/docs/guide/server.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The <code>initial</code> project is based on the completed project from the <a href="http://guides.grails.org/building-a-react-app/guide/index.html">Building a React App</a> Guide. Please refer to that guide for details on the provided code.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Our first step in adding security to this project is to install the Spring Security plugin/s in our Grails app, and secure our API endpoints. The Spring Security REST plugin supports a stateless, token-based authentication model that is ideal for securing APIs and Single Page Applications. See the diagram below for an overview of the security model.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../img/rest.png" alt="Stateless Authentication Model">
</div>
</div>


<h2 id="serverDependencies">5.1 Installing Spring Security</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails-guides/react-spring-security/edit/master/src/main/docs/guide/serverDependencies.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>To secure our application, we will use the Spring Security Core plugin as well as the Spring Security REST plugin. Install these plugins in the project by adding these lines to <code>server/build.gradle</code> (under the <code>dependencies</code> section):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">compile <span class="string"><span class="delimiter">&quot;</span><span class="content">org.grails.plugins:spring-security-core:3.2.0</span><span class="delimiter">&quot;</span></span>
compile <span class="string"><span class="delimiter">&quot;</span><span class="content">org.grails.plugins:spring-security-rest:2.0.0.M2</span><span class="delimiter">&quot;</span></span></code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Please see the documentation for more information on the <a href="https://grails-plugins.github.io/grails-spring-security-core/v3/index.html">Spring Security Core plugin</a> and <a href="https://alvarosanchez.github.io/grails-spring-security-rest/latest/docs/">Spring Security REST plugin</a>.
</td>
</tr>
</table>
</div>


<h2 id="springSecurityConfig">5.2 Configuring Spring Security</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails-guides/react-spring-security/edit/master/src/main/docs/guide/springSecurityConfig.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Now that Spring Security has been added to our application, we can generate the default Spring Security
configuration. The plugin provides a <code>s2-quickstart</code> command that will generate a set of domain classes and configuration to get us started.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">cd initial/server</code></pre>
</div>
</div>
<div class="paragraph">
<p>Then execute the following</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">grails s2-quickstart demo User Role</code></pre>
</div>
</div>
<div class="paragraph">
<p>This should generate the following domain classes:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>/server/grails-app/domain/demo/User.groovy
/server/grails-app/domain/demo/Role.groovy
/server/grails-app/domain/demo/UserRole.groovy</code></pre>
</div>
</div>
<div class="paragraph">
<p>In addition, the <code>s2-quickstart</code> has added an extra configuration file at <code>server/grails-app/conf/application.groovy</code>. Grails projects support both YML and Groovy configuration, but YML is preferred. Let&#8217;s remove the <code>application.groovy</code> file and add the following snippet at the end of <code>application.yml</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yml"><span class="head"><span class="head">---</span></span>
<span class="key">grails</span>:
    <span class="key">plugin</span>:
        <span class="key">springsecurity</span>:
            <span class="key">userLookup</span>:
                <span class="key">userDomainClassName</span>: <span class="string"><span class="content">demo.User</span></span>
                <span class="key">authorityJoinClassName</span>: <span class="string"><span class="content">demo.UserRole</span></span>
            <span class="key">authority</span>:
                <span class="key">className</span>: <span class="string"><span class="content">demo.Role</span></span>
            <span class="key">filterChain</span>:
                <span class="key">chainMap</span>:
                    -
                        <span class="key">pattern</span>: <span class="string"><span class="content">/assets/**</span></span>
                        <span class="key">filters</span>: <span class="string"><span class="content">none</span></span>
                    -
                        <span class="key">pattern</span>: <span class="string"><span class="content">/**/js/**</span></span>
                        <span class="key">filters</span>: <span class="string"><span class="content">none</span></span>
                    -
                        <span class="key">pattern</span>: <span class="string"><span class="content">/**/css/**</span></span>
                        <span class="key">filters</span>: <span class="string"><span class="content">none</span></span>
                    -
                        <span class="key">pattern</span>: <span class="string"><span class="content">/**/images/**</span></span>
                        <span class="key">filters</span>: <span class="string"><span class="content">none</span></span>
                    - <span class="comment"># Stateless chain</span>
                        <span class="key">pattern</span>: <span class="string"><span class="content">/api/**</span></span>
                        <span class="key">filters</span>: <span class="string"><span class="content">JOINED_FILTERS,-anonymousAuthenticationFilter,-exceptionTranslationFilter,-authenticationProcessingFilter,-securityContextPersistenceFilter,-rememberMeAuthenticationFilter</span></span>
                    - <span class="comment"># Traditional Chain</span>
                        <span class="key">pattern</span>: <span class="string"><span class="content">/**</span></span>
                        <span class="key">filters</span>: <span class="string"><span class="content">JOINED_FILTERS,-restTokenValidationFilter,-restExceptionTranslationFilter</span></span>
                <span class="key">controllerAnnotations</span>:
                    <span class="key">staticRules</span>:
                        -
                            <span class="key">pattern</span>: <span class="string"><span class="content">/</span></span>
                            <span class="key">access</span>:
                                - <span class="string"><span class="content">permitAll</span></span>
                        -
                            <span class="key">pattern</span>: <span class="string"><span class="content">/error</span></span>
                            <span class="key">access</span>:
                                - <span class="string"><span class="content">permitAll</span></span>
                        -
                            <span class="key">pattern</span>: <span class="string"><span class="content">/index</span></span>
                            <span class="key">access</span>:
                                - <span class="string"><span class="content">permitAll</span></span>
                        -
                            <span class="key">pattern</span>: <span class="string"><span class="content">/index.gsp</span></span>
                            <span class="key">access</span>:
                                - <span class="string"><span class="content">permitAll</span></span>
                        -
                            <span class="key">pattern</span>: <span class="string"><span class="content">/shutdown</span></span>
                            <span class="key">access</span>:
                                - <span class="string"><span class="content">permitAll</span></span>
                        -
                            <span class="key">pattern</span>: <span class="string"><span class="content">/assets/**</span></span>
                            <span class="key">access</span>:
                                - <span class="string"><span class="content">permitAll</span></span>
                        -
                            <span class="key">pattern</span>: <span class="string"><span class="content">/**/js/**</span></span>
                            <span class="key">access</span>:
                                - <span class="string"><span class="content">permitAll</span></span>
                        -
                            <span class="key">pattern</span>: <span class="string"><span class="content">/**/css/**</span></span>
                            <span class="key">access</span>:
                                - <span class="string"><span class="content">permitAll</span></span>
                        -
                            <span class="key">pattern</span>: <span class="string"><span class="content">/**/images/**</span></span>
                            <span class="key">access</span>:
                                - <span class="string"><span class="content">permitAll</span></span>
                        -
                            <span class="key">pattern</span>: <span class="string"><span class="content">/**/favicon.ico/**</span></span>
                            <span class="key">access</span>:
                                - <span class="string"><span class="content">permitAll</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Please refer to the <a href="http://alvarosanchez.github.io/grails-spring-security-rest/latest/docs/">Spring Security REST documentation</a> and <a href="https://grails-plugins.github.io/grails-spring-security-core/latest/">Spring Security Core Documentation</a> for more details.</p>
</div>


<h2 id="appSecurityConfig">5.3 Securing our API</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails-guides/react-spring-security/edit/master/src/main/docs/guide/appSecurityConfig.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Our first step in securing our API is to update our <code>Driver</code> Domain Class. In our app, <code>Driver</code> would be a "user", however Spring Security has generated a <code>User</code> class for authentication purposes. We could modify the configuration to use <code>Driver</code> instead, however we&#8217;ll take another approach and make <code>Driver</code> a subclass of <code>User</code>.</p>
</div>
<div class="paragraph">
<p>Edit <code>server/grails-app/domain/demo/Driver.groovy</code>:</p>
</div>
<div class="listingblock">
<div class="title">server/grails-app/domain/demo/Driver.groovy</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">package</span> demo

<span class="keyword">import</span> <span class="include">grails.compiler.GrailsCompileStatic</span>
<span class="keyword">import</span> <span class="include">grails.plugin.springsecurity.annotation.Secured</span>
<span class="keyword">import</span> <span class="include">grails.rest.Resource</span>

<span class="annotation">@GrailsCompileStatic</span>
<span class="annotation">@Secured</span>([<span class="string"><span class="delimiter">'</span><span class="content">ROLE_DRIVER</span><span class="delimiter">'</span></span>])
<span class="annotation">@Resource</span>(uri = <span class="string"><span class="delimiter">'</span><span class="content">/api/driver</span><span class="delimiter">'</span></span>)
<span class="type">class</span> <span class="class">Driver</span> <span class="directive">extends</span> User {

    <span class="predefined-type">String</span> name

    <span class="directive">static</span> hasMany = [ <span class="key">vehicles</span>: Vehicle ]

    <span class="directive">static</span> constraints = {
        vehicles <span class="key">nullable</span>: <span class="predefined-constant">true</span>
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In addition to extending the <code>User</code> class, we have also restricted access to this domain resource to users with the <code>ROLE_DRIVER</code> role, using the <code>@Secured</code> annotation. We haven&#8217;t created this role yet, but we&#8217;ll fix that shortly.</p>
</div>
<div class="paragraph">
<p>If you were now to run the server application, you would get a 401 response to any attempt to access <code>/api/driver</code>.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s secure the remaining domain resources, as shown below:</p>
</div>
<div class="listingblock">
<div class="title">server/grails-app/domain/demo/Make.groovy</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">package</span> demo

<span class="keyword">import</span> <span class="include">grails.plugin.springsecurity.annotation.Secured</span>
<span class="keyword">import</span> <span class="include">grails.rest.Resource</span>
<span class="keyword">import</span> <span class="include">groovy.transform.CompileStatic</span>

<span class="annotation">@CompileStatic</span>
<span class="annotation">@Secured</span>([<span class="string"><span class="delimiter">'</span><span class="content">ROLE_DRIVER</span><span class="delimiter">'</span></span>])
<span class="annotation">@Resource</span>(uri = <span class="string"><span class="delimiter">'</span><span class="content">/api/make</span><span class="delimiter">'</span></span>)
<span class="type">class</span> <span class="class">Make</span> {

    <span class="predefined-type">String</span> name

    <span class="directive">static</span> constraints = {
    }
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">server/grails-app/domain/demo/Model.groovy</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">package</span> demo

<span class="keyword">import</span> <span class="include">grails.plugin.springsecurity.annotation.Secured</span>
<span class="keyword">import</span> <span class="include">grails.rest.Resource</span>
<span class="keyword">import</span> <span class="include">groovy.transform.CompileStatic</span>

<span class="annotation">@CompileStatic</span>
<span class="annotation">@Secured</span>([<span class="string"><span class="delimiter">'</span><span class="content">ROLE_DRIVER</span><span class="delimiter">'</span></span>])
<span class="annotation">@Resource</span>(uri = <span class="string"><span class="delimiter">'</span><span class="content">/api/model</span><span class="delimiter">'</span></span>)
<span class="type">class</span> <span class="class">Model</span> {

    <span class="predefined-type">String</span> name

    <span class="directive">static</span> constraints = {
    }
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">server/grails-app/domain/demo/Vehicle.groovy</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">package</span> demo

<span class="keyword">import</span> <span class="include">grails.plugin.springsecurity.annotation.Secured</span>
<span class="keyword">import</span> <span class="include">grails.rest.Resource</span>
<span class="keyword">import</span> <span class="include">groovy.transform.CompileStatic</span>

<span class="annotation">@CompileStatic</span>
<span class="annotation">@Secured</span>([<span class="string"><span class="delimiter">'</span><span class="content">ROLE_DRIVER</span><span class="delimiter">'</span></span>])
<span class="annotation">@Resource</span>(uri = <span class="string"><span class="delimiter">'</span><span class="content">/api/vehicle</span><span class="delimiter">'</span></span>)
<span class="type">class</span> <span class="class">Vehicle</span> {

    <span class="predefined-type">String</span> name

    Make make
    Model model

    <span class="directive">static</span> belongsTo = [<span class="key">driver</span>: <span class="predefined-type">Driver</span>]

    <span class="directive">static</span> constraints = {
    }
}</code></pre>
</div>
</div>


<h2 id="bootstrapData">5.4 Updating our Initial Data</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails-guides/react-spring-security/edit/master/src/main/docs/guide/bootstrapData.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Believe it or not, we&#8217;re done with the server-side security portion of our application! The last thing we need to do is to create the <code>ROLE_DRIVER</code> role that we mentioned earlier. We also should prepopulate our database with some user/passwords that we can use to login.</p>
</div>
<div class="paragraph">
<p>Edit <code>server/grails-app/init/demo/BootStrap.groovy</code>:</p>
</div>
<div class="listingblock">
<div class="title">server/grails-app/init/demo/BootStrap.groovy</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="annotation">@Slf4j</span>
<span class="type">class</span> <span class="class">BootStrap</span> {

    <span class="keyword">def</span> init = { servletContext -&gt;
        log.info <span class="string"><span class="delimiter">&quot;</span><span class="content">Loading database...</span><span class="delimiter">&quot;</span></span>
        <span class="keyword">def</span> driver1 = <span class="keyword">new</span> <span class="predefined-type">Driver</span>(<span class="key">name</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">Susan</span><span class="delimiter">&quot;</span></span>, <span class="key">username</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">susan</span><span class="delimiter">&quot;</span></span>, <span class="key">password</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">password1</span><span class="delimiter">&quot;</span></span>).save() <i class="conum" data-value="1"></i><b>(1)</b>
        <span class="keyword">def</span> driver2 = <span class="keyword">new</span> <span class="predefined-type">Driver</span>(<span class="key">name</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">Pedro</span><span class="delimiter">&quot;</span></span>, <span class="key">username</span>:  <span class="string"><span class="delimiter">&quot;</span><span class="content">pedro</span><span class="delimiter">&quot;</span></span>, <span class="key">password</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">password2</span><span class="delimiter">&quot;</span></span>).save()

        <span class="predefined-type">Role</span> role = <span class="keyword">new</span> <span class="predefined-type">Role</span>(<span class="key">authority</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">ROLE_DRIVER</span><span class="delimiter">&quot;</span></span>).save()  <i class="conum" data-value="2"></i><b>(2)</b>

        UserRole.create(driver1, role, <span class="predefined-constant">true</span>)  <i class="conum" data-value="3"></i><b>(3)</b>
        UserRole.create(driver2, role, <span class="predefined-constant">true</span>)

        <span class="keyword">def</span> nissan = <span class="keyword">new</span> Make(<span class="key">name</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">Nissan</span><span class="delimiter">&quot;</span></span>).save()
        <span class="keyword">def</span> ford = <span class="keyword">new</span> Make(<span class="key">name</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">Ford</span><span class="delimiter">&quot;</span></span>).save()

        <span class="keyword">def</span> titan = <span class="keyword">new</span> Model(<span class="key">name</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">Titan</span><span class="delimiter">&quot;</span></span>).save()
        <span class="keyword">def</span> leaf = <span class="keyword">new</span> Model(<span class="key">name</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">Leaf</span><span class="delimiter">&quot;</span></span>).save()
        <span class="keyword">def</span> windstar = <span class="keyword">new</span> Model(<span class="key">name</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">Windstar</span><span class="delimiter">&quot;</span></span>).save()

        <span class="keyword">new</span> Vehicle(<span class="key">name</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">Pickup</span><span class="delimiter">&quot;</span></span>, <span class="key">driver</span>: driver1, <span class="key">make</span>: nissan, <span class="key">model</span>: titan).save()</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Since we&#8217;ve extended the <code>User</code> class, we can now set a <code>username</code> and <code>password</code> property on our <code>Driver</code> domain objects. The <code>password</code> will be encrypted prior to persistence.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Here we&#8217;re creating our <code>ROLE_DRIVER</code> role - we can create as many roles as we need, and even create role hierarchies to support complex access controls.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td><code>UserRole</code> represents the join table between <code>User</code> and <code>Role</code>. The class includes a <code>create</code> method which we can use to quickly associate our <code>User</code> and <code>Role</code> objects.</td>
</tr>
</table>
</div>


<h2 id="runningTheSecuredApp">5.5 Test-driving our Secured API</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails-guides/react-spring-security/edit/master/src/main/docs/guide/runningTheSecuredApp.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Start up the server app (if it&#8217;s not already running):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">~ ./gradlew server:bootRun</code></pre>
</div>
</div>
<div class="paragraph">
<p>In another terminal session, if you make a <code>curl</code> request to one of our resources, you&#8217;ll get a 401 response.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="javascript">~ curl -i <span class="integer">0</span>:<span class="integer">8080</span>/api/vehicle
HTTP/<span class="float">1.1</span> <span class="integer">401</span>
WWW-Authenticate: Bearer
Content-Type: application/json;charset=UTF-<span class="integer">8</span>
Transfer-Encoding: chunked
Date: Thu, <span class="integer">08</span> Jun <span class="integer">2017</span> <span class="octal">05</span>:<span class="integer">42</span>:<span class="octal">05</span> GMT

{<span class="key"><span class="delimiter">&quot;</span><span class="content">timestamp</span><span class="delimiter">&quot;</span></span>:<span class="integer">1496900525475</span>,<span class="key"><span class="delimiter">&quot;</span><span class="content">status</span><span class="delimiter">&quot;</span></span>:<span class="integer">401</span>,<span class="key"><span class="delimiter">&quot;</span><span class="content">error</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">Unauthorized</span><span class="delimiter">&quot;</span></span>,<span class="key"><span class="delimiter">&quot;</span><span class="content">message</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">No message available</span><span class="delimiter">&quot;</span></span>,<span class="key"><span class="delimiter">&quot;</span><span class="content">path</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">/api/vehicle</span><span class="delimiter">&quot;</span></span>}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In order to make a secure request, we need to first authenticate with the server using valid user credentials. By default, we can use the <code>/api/login</code> endpoint for this purpose.</p>
</div>
<div class="paragraph">
<p>Make a request to <code>/api/login</code> using the credentials for one of our <code>Driver</code> objects in <code>BootStrap.groovy</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="javascript">curl -i -H <span class="string"><span class="delimiter">&quot;</span><span class="content">Content-Type: application/json</span><span class="delimiter">&quot;</span></span> --data <span class="string"><span class="delimiter">'</span><span class="content">{&quot;username&quot;:&quot;susan&quot;,&quot;password&quot;:&quot;password1&quot;}</span><span class="delimiter">'</span></span> <span class="integer">0</span>:<span class="integer">8080</span>/api/login
HTTP/<span class="float">1.1</span> <span class="integer">200</span>
Cache-Control: no-store
Pragma: no-cache
Content-Type: application/json;charset=UTF-<span class="integer">8</span>
Content-Length: <span class="integer">2157</span>
Date: Thu, <span class="integer">08</span> Jun <span class="integer">2017</span> <span class="octal">05</span>:<span class="integer">45</span>:<span class="integer">44</span> GMT

{<span class="key"><span class="delimiter">&quot;</span><span class="content">username</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">susan</span><span class="delimiter">&quot;</span></span>,<span class="key"><span class="delimiter">&quot;</span><span class="content">roles</span><span class="delimiter">&quot;</span></span>:[<span class="string"><span class="delimiter">&quot;</span><span class="content">ROLE_DRIVER</span><span class="delimiter">&quot;</span></span>],<span class="key"><span class="delimiter">&quot;</span><span class="content">token_type</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">Bearer</span><span class="delimiter">&quot;</span></span>,<span class="key"><span class="delimiter">&quot;</span><span class="content">access_token</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">eyJhbGciOiJIUzI1NiJ9...</span><span class="delimiter">&quot;</span></span>,<span class="key"><span class="delimiter">&quot;</span><span class="content">expires_in</span><span class="delimiter">&quot;</span></span>:<span class="integer">3600</span>,<span class="key"><span class="delimiter">&quot;</span><span class="content">refresh_token</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">eyJhbGciOiJIUzI1NiJ9...</span><span class="delimiter">&quot;</span></span>}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Notice that in the response, in addition to user details/granted roles, we received an <code>access_token</code> - this is what we need to provide to our server in order to authenticate our request. We do this by setting the <code>Authorization</code> header with our token. Let&#8217;s try our <code>/api/vehicle</code> request again, using this <code>access_token</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="javascript">curl -i -H <span class="string"><span class="delimiter">&quot;</span><span class="content">Authorization: Bearer eyJhbGciOiJIUzI1NiJ9...</span><span class="delimiter">&quot;</span></span> <span class="integer">0</span>:<span class="integer">8080</span>/api/vehicle
HTTP/<span class="float">1.1</span> <span class="integer">200</span>
X-Application-Context: application:development
Content-Type: application/json;charset=UTF-<span class="integer">8</span>
Transfer-Encoding: chunked
Date: Thu, <span class="integer">08</span> Jun <span class="integer">2017</span> <span class="octal">05</span>:<span class="integer">49</span>:<span class="octal">01</span> GMT

[{<span class="key"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>:<span class="integer">1</span>,<span class="key"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">Pickup</span><span class="delimiter">&quot;</span></span>,<span class="key"><span class="delimiter">&quot;</span><span class="content">make</span><span class="delimiter">&quot;</span></span>:{<span class="key"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">Nissan</span><span class="delimiter">&quot;</span></span>,<span class="key"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>:<span class="integer">1</span>},<span class="key"><span class="delimiter">&quot;</span><span class="content">model</span><span class="delimiter">&quot;</span></span>:{<span class="key"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">Titan</span><span class="delimiter">&quot;</span></span>,<span class="key"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>:<span class="integer">1</span>},<span class="key"><span class="delimiter">&quot;</span><span class="content">driver</span><span class="delimiter">&quot;</span></span>:{<span class="key"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">Susan</span><span class="delimiter">&quot;</span></span>,<span class="key"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>:<span class="integer">1</span>}},{<span class="key"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>:<span class="integer">2</span>,<span class="key"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">Economy</span><span class="delimiter">&quot;</span></span>,<span class="key"><span class="delimiter">&quot;</span><span class="content">make</span><span class="delimiter">&quot;</span></span>:{<span class="key"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">Nissan</span><span class="delimiter">&quot;</span></span>,<span class="key"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>:<span class="integer">1</span>},<span class="key"><span class="delimiter">&quot;</span><span class="content">model</span><span class="delimiter">&quot;</span></span>:{<span class="key"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">Leaf</span><span class="delimiter">&quot;</span></span>,<span class="key"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>:<span class="integer">2</span>},<span class="key"><span class="delimiter">&quot;</span><span class="content">driver</span><span class="delimiter">&quot;</span></span>:{<span class="key"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">Susan</span><span class="delimiter">&quot;</span></span>,<span class="key"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>:<span class="integer">1</span>}},{<span class="key"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>:<span class="integer">3</span>,<span class="key"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">Minivan</span><span class="delimiter">&quot;</span></span>,<span class="key"><span class="delimiter">&quot;</span><span class="content">make</span><span class="delimiter">&quot;</span></span>:{<span class="key"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">Ford</span><span class="delimiter">&quot;</span></span>,<span class="key"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>:<span class="integer">2</span>},<span class="key"><span class="delimiter">&quot;</span><span class="content">model</span><span class="delimiter">&quot;</span></span>:{<span class="key"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">Windstar</span><span class="delimiter">&quot;</span></span>,<span class="key"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>:<span class="integer">3</span>},<span class="key"><span class="delimiter">&quot;</span><span class="content">driver</span><span class="delimiter">&quot;</span></span>:{<span class="key"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">Pedro</span><span class="delimiter">&quot;</span></span>,<span class="key"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>:<span class="integer">2</span>}}]</code></pre>
</div>
</div>
<div class="paragraph">
<p>Congratulations, your API is now secured! Now we can move on to supporting authentication in our React client app.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Notice there&#8217;s actually another token in the <code>/api/login</code> response: <code>refresh_token</code>. When the <code>access_token</code> expires, you can use the <code>refresh_token</code> to obtain a new <code>access_token</code>. We&#8217;ll see how that works later on in this guide.
</td>
</tr>
</table>
</div>


<h1 id="client">6 Building the Client</h1>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails-guides/react-spring-security/edit/master/src/main/docs/guide/client.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Now that the API is secured, we need to provide the user a means to authenticate with the server from the React app. Once the user logs in, we need to use their credentials to make requests to the API, as well as give the user the ability to logout and invalidate their token.</p>
</div>


<h2 id="loginScreen">6.1 Stateless Login Component</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails-guides/react-spring-security/edit/master/src/main/docs/guide/loginScreen.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Let&#8217;s start by creating the login component. We will pass 4 props to this component: <code>userDetails</code> and <code>error</code> variables (to represent the form input and possible error message), and <code>changeHandler</code> and <code>onSubmit</code> functions.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
If you&#8217;re familiar with React, you may recognize this is a "stateless functional component". This style of React component is literally a simple function, with no internal state. This component gets its state and dynamic functionality via props only, which are passed in from the parent component, in this case, <code>App</code>.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">client/src/Login.js</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="javascript"><span class="reserved">import</span> React from <span class="string"><span class="delimiter">'</span><span class="content">react</span><span class="delimiter">'</span></span>;
<span class="reserved">import</span> {Jumbotron, Row, Col, Form, FormGroup, ControlLabel, FormControl, Button} from <span class="string"><span class="delimiter">'</span><span class="content">react-bootstrap</span><span class="delimiter">'</span></span>;

const Login = ({userDetails, error, inputChangeHandler, onSubmit}) =&gt; {

  <span class="keyword">return</span> (
    <span class="tag">&lt;Row&gt;</span>
      <span class="tag">&lt;Jumbotron&gt;</span>
        <span class="tag">&lt;h1&gt;</span>Welcome to the Garage<span class="tag">&lt;/h1&gt;</span>
      <span class="tag">&lt;/Jumbotron&gt;</span>
      <span class="tag">&lt;Row&gt;</span>
        <span class="tag">&lt;Col</span> <span class="attribute-name">sm</span>=<span class="error">{</span><span class="attribute-value">4</span><span class="error">}</span> <span class="attribute-name">smOffset</span>=<span class="error">{</span><span class="attribute-value">4</span><span class="error">}</span><span class="tag">&gt;</span>

          {error ? <span class="tag">&lt;p</span> <span class="attribute-name">className</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">alert alert-danger</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>{error} <span class="tag">&lt;/p&gt;</span> : null} <i class="conum" data-value="1"></i><b>(1)</b>

          <span class="tag">&lt;Form</span> <span class="attribute-name">onSubmit</span>=<span class="error">{</span><span class="attribute-value">onSubmit</span><span class="error">}</span><span class="tag">&gt;</span> <i class="conum" data-value="2"></i><b>(2)</b>
            <span class="tag">&lt;FormGroup&gt;</span>
              <span class="tag">&lt;ControlLabel&gt;</span>Login<span class="tag">&lt;/ControlLabel</span> <span class="error">&gt;</span>
              <span class="tag">&lt;FormControl</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">'</span><span class="content">text</span><span class="delimiter">'</span></span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">'</span><span class="content">username</span><span class="delimiter">'</span></span> <span class="attribute-name">placeholder</span>=<span class="string"><span class="delimiter">'</span><span class="content">Username</span><span class="delimiter">'</span></span>
                           <span class="attribute-name">value</span>=<span class="error">{</span><span class="attribute-value">userDetails.username</span><span class="error">}</span> <i class="conum" data-value="3"></i><b>(3)</b>
                           <span class="attribute-name">onChange</span>=<span class="error">{</span><span class="attribute-value">inputChangeHandler</span><span class="error">}</span><span class="tag">/&gt;</span>  <i class="conum" data-value="4"></i><b>(4)</b>
              <span class="tag">&lt;FormControl</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">'</span><span class="content">password</span><span class="delimiter">'</span></span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">'</span><span class="content">password</span><span class="delimiter">'</span></span> <span class="attribute-name">placeholder</span>=<span class="string"><span class="delimiter">'</span><span class="content">Password</span><span class="delimiter">'</span></span>
                           <span class="attribute-name">value</span>=<span class="error">{</span><span class="attribute-value">userDetails.password</span><span class="error">}</span> <i class="conum" data-value="3"></i><b>(3)</b>
                           <span class="attribute-name">onChange</span>=<span class="error">{</span><span class="attribute-value">inputChangeHandler</span><span class="error">}</span><span class="tag">/&gt;</span>  <i class="conum" data-value="4"></i><b>(4)</b>
            <span class="tag">&lt;/FormGroup&gt;</span>
            <span class="tag">&lt;FormGroup&gt;</span>
              <span class="tag">&lt;Button</span> <span class="attribute-name">bsStyle</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">success</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">submit</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>Login<span class="tag">&lt;/Button&gt;</span>
            <span class="tag">&lt;/FormGroup&gt;</span>
          <span class="tag">&lt;/Form&gt;</span>
        <span class="tag">&lt;/Col&gt;</span>
      <span class="tag">&lt;/Row&gt;</span>
    &lt;<span class="regexp"><span class="delimiter">/</span><span class="content">Row&gt;
  );
};

export default Login;</span></span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>If we have an <code>error</code>, render the error message - otherwise render nothing.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The <code>onSubmit</code> function will be called when the login form is submitted.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The <code>userDetails</code> prop contains the username and password that the user has typed so far.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>The <code>inputChangeHandler</code> function will fire every time the user types character into the form fields. We&#8217;ll see what it does in the next section.</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
This style of form is an example of a <a href="https://facebook.github.io/react/docs/forms.html">"controlled component"</a>. This means that the value of the inputs is set "upstream" (in this case, in the <code>userDetails</code> prop) and is updated only when that upstream value is changed. That change will take place when our <code>inputChangeHandler</code> function is called. This is also referred to as "one-way data-binding".
</td>
</tr>
</table>
</div>


<h1 id="writingTheSecurity">7 Adding Client security</h1>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails-guides/react-spring-security/edit/master/src/main/docs/guide/writingTheSecurity.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>





<h2 id="clientSecurityConfig">7.1 Creating our Configuration</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails-guides/react-spring-security/edit/master/src/main/docs/guide/clientSecurityConfig.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>At this point we will begin adding the security configuration to the React app. Let&#8217;s begin by creating a <code>security</code> directory underneath <code>client/src</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">~ cd client/src
~ mkdir security</code></pre>
</div>
</div>
<div class="paragraph">
<p>Create a file named <code>auth.js</code> in your new <code>security</code> directory</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">~ cd security
~ touch auth.js</code></pre>
</div>
</div>


<h2 id="writingAuth">7.2 Handling Authentication</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails-guides/react-spring-security/edit/master/src/main/docs/guide/writingAuth.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Let&#8217;s continue by editing <code>auth.js</code>. This file is a "plain" JavaScript file (not a React component), and will contain four core authentication-related functions (<code>logIn</code>, <code>logOut</code>, <code>`refreshToken</code>, and <code>isLoggedIn</code>). These functions will be exported as a <a href="http://2ality.com/2014/09/es6-modules-final.html"><strong>module</strong></a>, so they can be imported and used in any React component (or JavaScript file).  We will be making use of HTML5&#8217;s <code>localStorage</code> object to store the user&#8217;s token after a successful login.</p>
</div>
<div class="listingblock">
<div class="title">client/src/security/auth.js</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="javascript"><span class="reserved">import</span> {SERVER_URL} from <span class="string"><span class="delimiter">'</span><span class="content">./../config</span><span class="delimiter">'</span></span>;
<span class="reserved">import</span> {checkResponseStatus} from <span class="string"><span class="delimiter">'</span><span class="content">./../handlers/responseHandlers</span><span class="delimiter">'</span></span>;
<span class="reserved">import</span> headers from <span class="string"><span class="delimiter">'</span><span class="content">./../security/headers</span><span class="delimiter">'</span></span>;
<span class="reserved">import</span> <span class="string"><span class="delimiter">'</span><span class="content">whatwg-fetch</span><span class="delimiter">'</span></span>;
<span class="reserved">import</span> qs from <span class="string"><span class="delimiter">'</span><span class="content">qs</span><span class="delimiter">'</span></span>;

<i class="conum" data-value="1"></i><b>(1)</b>
<span class="reserved">export</span> <span class="keyword">default</span> {
  logIn(auth) { <i class="conum" data-value="2"></i><b>(2)</b>
    localStorage.auth = JSON.stringify(auth);
  },

  logOut() { <i class="conum" data-value="3"></i><b>(3)</b>
    <span class="keyword">delete</span> localStorage.auth;
  },

  refreshToken() { <i class="conum" data-value="4"></i><b>(4)</b>
    <span class="keyword">return</span> fetch(
      <span class="error">`</span><span class="predefined">$</span>{SERVER_URL}/oauth/access_token<span class="error">`</span>,
      { <span class="key">method</span>: <span class="string"><span class="delimiter">'</span><span class="content">POST</span><span class="delimiter">'</span></span>,
        <span class="key">headers</span>: {
          <span class="key"><span class="delimiter">'</span><span class="content">Content-Type</span><span class="delimiter">'</span></span>: <span class="string"><span class="delimiter">'</span><span class="content">application/x-www-form-urlencoded;charset=UTF-8</span><span class="delimiter">'</span></span>
        },
        <span class="key">body</span>: qs.stringify({ <i class="conum" data-value="5"></i><b>(5)</b>
          <span class="key">grant_type</span>: <span class="string"><span class="delimiter">'</span><span class="content">refresh_token</span><span class="delimiter">'</span></span>,
          <span class="key">refresh_token</span>: JSON.parse(localStorage.auth).refresh_token
        })
      })
      .then(checkResponseStatus)
      .then((a) =&gt; localStorage.auth = JSON.stringify(a))
      .<span class="keyword">catch</span>(() =&gt; { <span class="keyword">throw</span> <span class="keyword">new</span> Error(<span class="string"><span class="delimiter">&quot;</span><span class="content">Unable to refresh!</span><span class="delimiter">&quot;</span></span>)})
  },

  loggedIn() {  <i class="conum" data-value="6"></i><b>(6)</b>
    <span class="keyword">return</span> localStorage.auth &amp;&amp; fetch(
        <span class="error">`</span><span class="predefined">$</span>{SERVER_URL}/api/vehicle<span class="error">`</span>, <i class="conum" data-value="7"></i><b>(7)</b>
        {<span class="key">headers</span>: headers()})
        .then(checkResponseStatus)
        .then(() =&gt; { <span class="keyword">return</span> <span class="predefined-constant">true</span> })
        .<span class="keyword">catch</span>(<span class="local-variable">this</span>.refreshToken)
        .<span class="keyword">catch</span>(() =&gt; { <span class="keyword">return</span> <span class="predefined-constant">false</span> });
  }
};</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The <code>export</code> keyword indicates that this is a JavaScript <strong>module</strong>, which can be imported using the <strong>import</strong> keyword. A single JavaScript file can export multiple modules, so the <code>default</code> indicates which module is imported by default (without specifying a particular module).</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td><code>logIn</code> takes in an auth object, converts it into a JSON string, and stores it in our <code>localStorage</code> for later use.
use.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td><code>logOut</code> is  even simpler - we simply remove the object that was stored at <code>localStorage.auth</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td><code>refreshToken</code> is the most complex function. It makes a <code>POST</code> request against the <code>/oauth/access_token</code> endpoint (which is set up by default by Spring Security REST), including the <code>refresh_token</code> as a URL parameter. If successful, it will receive the same JWT token response that a normal login would have - in which case we store the new token in our <code>localStorage</code> as before (overwriting the earlier one).</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Because the refresh endpoint expects <code>form-urlencoded</code> body, we&#8217;re using the <code>stringify</code> function from the <a href="https://www.npmjs.com/package/qs"><code>qs</code></a> package to convert our JavaScript object into the correct format.</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td><code>isLoggedIn</code> returns whether we have an <code>auth</code> object in <code>localStorage</code>, and in addition verifies that our token is still valid by making a <code>fetch</code> request against the secured API and checking the response (in a real-world app, you would probably have a special endpoint for this purpose). If the <code>checkResponseStatus</code> function throws an error, the first <code>catch</code> statement is called, which will call the <code>refreshToken</code> function described above. If <strong>that</strong> function throws another error, the final <code>catch</code> statement will fire and the authentication will fail.</td>
</tr>
<tr>
<td><i class="conum" data-value="7"></i><b>7</b></td>
<td>We are using backticks instead of quotes to denote our strings. This is an ES6 syntax called <a href="https://developers.google.com/web/updates/2015/01/ES6-Template-Strings">"template strings"</a>, and they allow us to write multi-line strings as well as use expressions in our strings with the <code>${expression}</code> syntax.</td>
</tr>
</table>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
The server&#8217;s <code>api/login</code> endpoint responds us with an <code>access_token</code> which will expire and a refresh token which never expires and which allows us to refresh the <code>access_token</code> via the <code>oauth/access_token</code> endpoint. Checkout the <a href="http://alvarosanchez.github.io/grails-spring-security-rest/latest/docs/#_token_storage">plugin documentation</a> to learn more about access token expiration and refresh options.
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="_write_the_headers_function">Write the headers() function</h3>
<div class="paragraph">
<p>Notice that in our <code>fetch</code> call in <code>isLoggedIn</code>, we are calling a <code>headers()</code> function (imported from <code>headers.js</code>). This function will return an object containing our request headers, including the token from <code>localStorage</code>. Let&#8217;s create this function now.</p>
</div>
<div class="paragraph">
<p>Create a new JavaScript file under <code>client/src/security</code>, called <code>headers.js</code>.</p>
</div>
<div class="listingblock">
<div class="title">client/src/security/headers.js</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="javascript"><span class="reserved">export</span> <span class="keyword">default</span> () =&gt; { <i class="conum" data-value="1"></i><b>(1)</b>
  <span class="keyword">return</span> {
    <span class="key"><span class="delimiter">'</span><span class="content">Content-Type</span><span class="delimiter">'</span></span>: <span class="string"><span class="delimiter">'</span><span class="content">application/json</span><span class="delimiter">'</span></span>,
    <span class="key"><span class="delimiter">'</span><span class="content">Authorization</span><span class="delimiter">'</span></span>: <span class="error">`</span>Bearer <span class="predefined">$</span>{localStorage.auth ? JSON.parse(localStorage.auth).access_token : <span class="predefined-constant">null</span>}<span class="error">`</span>
  }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Again we&#8217;re exporting a module, but this time the module is itself a function (using the ES6 <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Functions/Arrow_functions">"arrow function"</a> syntax, which is analogous to a Groovy closure). The function is anonymous, so the name will be whatever variable is used to <code>import</code> the module (e.g, <code>import headers from './headers'</code>).</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The function from the <code>headers.js</code> module returns an object with an "Authorization" header, and adds the <code>access_token</code> (which is obtained by parsing the <code>localStorage.auth</code> JSON object). We will use this function later on when it&#8217;s time to authenticate our API calls.</p>
</div>
</div>
<div class="sect2">
<h3 id="_install_the_qs_package">Install the qs package</h3>
<div class="paragraph">
<p>Remember that we used the <a href="https://www.npmjs.com/package/qs"><code>qs</code> package</a> in our <code>refreshToken()</code> function above. This is a useful utility package that performs many types of conversions. In <code>refreshToken</code> we are using this package to convert our request body to <code>form-urlencoded</code> format. Now we need to add that package to our <code>package.json</code>:</p>
</div>
<div class="listingblock">
<div class="title">client/package.json</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="javascript">{
  <span class="key"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">client</span><span class="delimiter">&quot;</span></span>,
  <span class="key"><span class="delimiter">&quot;</span><span class="content">version</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">0.1.0</span><span class="delimiter">&quot;</span></span>,
  <span class="key"><span class="delimiter">&quot;</span><span class="content">private</span><span class="delimiter">&quot;</span></span>: <span class="predefined-constant">true</span>,
  <span class="key"><span class="delimiter">&quot;</span><span class="content">dependencies</span><span class="delimiter">&quot;</span></span>: {
    <span class="key"><span class="delimiter">&quot;</span><span class="content">react</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">16.1.1</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">react-bootstrap</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">0.31.5</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">react-dom</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">16.1.1</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">react-scripts</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">1.0.17</span><span class="delimiter">&quot;</span></span>
  },
  <span class="key"><span class="delimiter">&quot;</span><span class="content">scripts</span><span class="delimiter">&quot;</span></span>: {
    <span class="key"><span class="delimiter">&quot;</span><span class="content">start</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">react-scripts start</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">build</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">react-scripts build</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">test</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">react-scripts test --env=jsdom</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">eject</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">react-scripts eject</span><span class="delimiter">&quot;</span></span>
  }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Add this line to add the <code>qs</code> dependency to our project.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If you have <code>yarn</code> or <code>npm</code> installed locally, you may run the <code>install</code> command to install the new package.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">~ yarn install</code></pre>
</div>
</div>
<div class="paragraph">
<p>However, the Gradle tasks for running the <code>client</code> app will perform the install automatically, so you are not required to perform the above step.</p>
</div>
</div>


<h2 id="writingHandlers">7.3 Writing the Response Handlers</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails-guides/react-spring-security/edit/master/src/main/docs/guide/writingHandlers.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>In order to implement our authentication we will write several "handler" functions that we can import and reuse throughout our app.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s begin by creating a <code>handlers</code> directory under <code>client/src</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">~ cd client/src
~ mkdir handlers</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now we are ready to write our first handlers. Create the following two files:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">~ touch responseHandlers.js
~ touch errorHandlers.js</code></pre>
</div>
</div>


<h2 id="writingResponseHandlers">7.4 Creating our Response Handlers</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails-guides/react-spring-security/edit/master/src/main/docs/guide/writingResponseHandlers.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Our first handler will be <code>checkResponseStatus</code>. This function will check the HTTP status of a response, and either return the JSON of the response or throw an error. We can chain this function with our REST calls using the <code>fetch</code> API.</p>
</div>
<div class="listingblock">
<div class="title">client/src/handlers/responseHandlers.js</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="javascript"><span class="reserved">import</span> Auth from <span class="string"><span class="delimiter">'</span><span class="content">../security/auth</span><span class="delimiter">'</span></span>;

<i class="conum" data-value="1"></i><b>(1)</b>
<span class="reserved">export</span> const checkResponseStatus = (response) =&gt; {
    <span class="keyword">if</span>(response.status &gt;= <span class="integer">200</span> &amp;&amp; response.status &lt; <span class="integer">300</span>) {
        <span class="keyword">return</span> response.json()
    } <span class="keyword">else</span> {
        let error = <span class="keyword">new</span> Error(response.statusText);
        error.response = response;
        <span class="keyword">throw</span> error;
    }
};

<span class="reserved">export</span> const loginResponseHandler = (response, handler) =&gt; {
    Auth.logIn(response);

    <span class="keyword">if</span>(handler) {
        handler.call();
    }
};</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The <code>export</code> keyword makes this function available to any JavaScript file that imports this file.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The <code>checkResponseStatus</code> function takes an HTTP response and checks that the status code is in the successful range, then returns the JSON body of the response. If the HTTP status code is outside that range then an error will be thrown.</p>
</div>
<div class="paragraph">
<p><code>loginResponseHandler</code> uses the <code>Auth.login(response)</code> function that we wrote previously. If an additional function is passed in as the second argument, it will then execute that function.</p>
</div>


<h2 id="writingErrorHandlers">7.5 Creating a Default Error Handler</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails-guides/react-spring-security/edit/master/src/main/docs/guide/writingErrorHandlers.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Along the same lines as the <code>checkStatusResponse</code> function, we&#8217;ll write a <code>defaultErrorHandler</code> which will take a JavaScript error object along with an custom handler (to be called after the default error handling).</p>
</div>
<div class="listingblock">
<div class="title">client/src/handlers/errorHandlers.js</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="javascript"><span class="reserved">export</span> const defaultErrorHandler = (error, handler) =&gt; {
    console.error(error);

    <span class="keyword">if</span>(handler) {
        handler.call();
    }
};</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>defaultErrorHandler</code> function is quite simple: it logs the error to the console. If an additional handler was passed in the second argument,
it will then call that function.</p>
</div>


<h1 id="puttingItAllTogether">8 Putting it all together</h1>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails-guides/react-spring-security/edit/master/src/main/docs/guide/puttingItAllTogether.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Now we can finally wire these pieces together in order to get our client-side security functioning. Here&#8217;s the steps we need to take:</p>
</div>
<div class="ulist checklist">
<ul class="checklist">
<li>
<p><i class="fa fa-square-o"></i> Update our <code>App</code> component&#8217;s state to include the user details for the <code>Login</code> form.</p>
</li>
<li>
<p><i class="fa fa-square-o"></i> Check whether we&#8217;re logged in, and display the <code>Login</code> component if the user is not authenticated.</p>
</li>
<li>
<p><i class="fa fa-square-o"></i> Submit the <code>Login</code> form details to the server and obtain (and store) the resulting token</p>
</li>
<li>
<p><i class="fa fa-square-o"></i> Provide a way to logout (delete the token from <code>localStorage</code>)</p>
</li>
<li>
<p><i class="fa fa-square-o"></i> Use the token in our REST calls to the API</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For your reference the full <code>App.js</code> file is shown below - in the remaining sections  we will go piece by piece through this component (going from top to bottom) and show how to complete the above steps.</p>
</div>
<div class="listingblock">
<div class="title">client/src/App.js</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="javascript"><span class="reserved">import</span> React, {Component} from <span class="string"><span class="delimiter">'</span><span class="content">react</span><span class="delimiter">'</span></span>;
<span class="reserved">import</span> Garage from <span class="string"><span class="delimiter">'</span><span class="content">./Garage</span><span class="delimiter">'</span></span>;
<span class="reserved">import</span> Auth from <span class="string"><span class="delimiter">'</span><span class="content">./security/auth</span><span class="delimiter">'</span></span>;
<span class="reserved">import</span> Login from <span class="string"><span class="delimiter">'</span><span class="content">./Login</span><span class="delimiter">'</span></span>;
<span class="reserved">import</span> {Grid} from <span class="string"><span class="delimiter">'</span><span class="content">react-bootstrap</span><span class="delimiter">'</span></span>;
<span class="reserved">import</span> {SERVER_URL} from <span class="string"><span class="delimiter">'</span><span class="content">./config</span><span class="delimiter">'</span></span>;
<span class="reserved">import</span> {defaultErrorHandler} from <span class="string"><span class="delimiter">'</span><span class="content">./handlers/errorHandlers</span><span class="delimiter">'</span></span>;
<span class="reserved">import</span> {checkResponseStatus, loginResponseHandler} from <span class="string"><span class="delimiter">'</span><span class="content">./handlers/responseHandlers</span><span class="delimiter">'</span></span>;

<span class="reserved">class</span> App <span class="reserved">extends</span> Component {

  <span class="comment">//tag::state[]</span>
  constructor() {
    <span class="reserved">super</span>();

    <span class="local-variable">this</span>.state = {
      <span class="key">userDetails</span>: {
        <span class="key">username</span>: <span class="string"><span class="delimiter">'</span><span class="delimiter">'</span></span>,
        <span class="key">password</span>: <span class="string"><span class="delimiter">'</span><span class="delimiter">'</span></span>
      },
      <span class="key">route</span>: <span class="string"><span class="delimiter">'</span><span class="delimiter">'</span></span>,
      <span class="key">error</span>: <span class="predefined-constant">null</span>
    }
  }

  reset = () =&gt; { <i class="conum" data-value="1"></i><b>(1)</b>
    <span class="local-variable">this</span>.setState({
      <span class="key">userDetails</span>: {
        <span class="key">username</span>: <span class="string"><span class="delimiter">'</span><span class="delimiter">'</span></span>,
        <span class="key">password</span>: <span class="string"><span class="delimiter">'</span><span class="delimiter">'</span></span>
      },
      <span class="key">route</span>: <span class="string"><span class="delimiter">'</span><span class="content">login</span><span class="delimiter">'</span></span>,
      <span class="key">error</span>: <span class="predefined-constant">null</span>
    });
  };
  <span class="comment">//end::state[]</span>

  <span class="comment">//tag::lifecycle[]</span>
  componentDidMount() {
    console.log(<span class="string"><span class="delimiter">'</span><span class="content">app mounting...</span><span class="delimiter">'</span></span>);

    (async () =&gt; {
      <span class="keyword">if</span> (await Auth.loggedIn()) {
        <span class="local-variable">this</span>.setState({<span class="key">route</span>: <span class="string"><span class="delimiter">'</span><span class="content">garage</span><span class="delimiter">'</span></span>})
      } <span class="keyword">else</span> {
        <span class="local-variable">this</span>.setState({<span class="key">route</span>: <span class="string"><span class="delimiter">'</span><span class="content">login</span><span class="delimiter">'</span></span>});
      }
    })();
  }

  componentDidUpdate() {
    <span class="keyword">if</span> (<span class="local-variable">this</span>.state.route !== <span class="string"><span class="delimiter">'</span><span class="content">login</span><span class="delimiter">'</span></span> &amp;&amp; !Auth.loggedIn()) {
      <span class="local-variable">this</span>.setState({<span class="key">route</span>: <span class="string"><span class="delimiter">'</span><span class="content">login</span><span class="delimiter">'</span></span>})
    }
  }
  <span class="comment">//end::lifecycle[]</span>

  <span class="comment">//tag::inputChangeHandler[]</span>
  inputChangeHandler = (event) =&gt; {
    let {userDetails} = <span class="local-variable">this</span>.state;
    const target = event.target;

    userDetails[target.name] = target.value; <i class="conum" data-value="1"></i><b>(1)</b>

    <span class="local-variable">this</span>.setState({userDetails});
  };
  <span class="comment">//end::inputChangeHandler[]</span>

  <span class="comment">//tag::login[]</span>
  login = (e) =&gt; {
    console.log(<span class="string"><span class="delimiter">'</span><span class="content">login</span><span class="delimiter">'</span></span>);
    e.preventDefault(); <i class="conum" data-value="1"></i><b>(1)</b>

    fetch(<span class="error">`</span><span class="predefined">$</span>{SERVER_URL}/api/login<span class="error">`</span>, { <i class="conum" data-value="2"></i><b>(2)</b>
      <span class="key">method</span>: <span class="string"><span class="delimiter">'</span><span class="content">POST</span><span class="delimiter">'</span></span>,
      <span class="key">headers</span>: {
        <span class="key"><span class="delimiter">'</span><span class="content">Accept</span><span class="delimiter">'</span></span>: <span class="string"><span class="delimiter">'</span><span class="content">application/json</span><span class="delimiter">'</span></span>,
        <span class="key"><span class="delimiter">'</span><span class="content">Content-Type</span><span class="delimiter">'</span></span>: <span class="string"><span class="delimiter">'</span><span class="content">application/json</span><span class="delimiter">'</span></span>
      },
      <span class="key">body</span>: JSON.stringify(<span class="local-variable">this</span>.state.userDetails)
    }).then(checkResponseStatus) <i class="conum" data-value="3"></i><b>(3)</b>
      .then(response =&gt; loginResponseHandler(response, <span class="local-variable">this</span>.customLoginHandler)) <i class="conum" data-value="4"></i><b>(4)</b>
      .<span class="keyword">catch</span>(error =&gt; defaultErrorHandler(error, <span class="local-variable">this</span>.customErrorHandler)); <i class="conum" data-value="5"></i><b>(5)</b>
  };
  <span class="comment">//end::login[]</span>

  <span class="comment">//tag::handler[]</span>
  customLoginHandler = () =&gt; { <i class="conum" data-value="1"></i><b>(1)</b>
    <span class="local-variable">this</span>.setState({<span class="key">route</span>: <span class="string"><span class="delimiter">'</span><span class="content">garage</span><span class="delimiter">'</span></span>});
  };

  customErrorHandler = (error) =&gt; { <i class="conum" data-value="2"></i><b>(2)</b>
    <span class="local-variable">this</span>.reset();
    <span class="local-variable">this</span>.setState({<span class="key">error</span>: error.message});
  };
  <span class="comment">//end::handler[]</span>


  <span class="comment">//tag::logout[]</span>
  logoutHandler = () =&gt; {
    Auth.logOut();
    <span class="local-variable">this</span>.reset();
  };
  <span class="comment">//end::logout[]</span>


  <span class="comment">//tag::routing[]</span>
  contentForRoute() { <i class="conum" data-value="1"></i><b>(1)</b>
    const {error, userDetails, route} = <span class="local-variable">this</span>.state;

    const loginContent = <span class="tag">&lt;Login</span> <span class="attribute-name">error</span>=<span class="error">{</span><span class="attribute-value">error</span><span class="error">}</span> <i class="conum" data-value="2"></i><b>(2)</b>
                                <span class="attribute-name">userDetails</span>=<span class="error">{</span><span class="attribute-value">userDetails</span><span class="error">}</span>
                                <span class="attribute-name">inputChangeHandler</span>=<span class="error">{</span><span class="attribute-value">this.inputChangeHandler</span><span class="error">}</span>
                                <span class="attribute-name">onSubmit</span>=<span class="error">{</span><span class="attribute-value">this.login</span><span class="error">}</span><span class="tag">/&gt;</span>;

    const garageContent = <span class="tag">&lt;Garage</span> <span class="attribute-name">logoutHandler</span>=<span class="error">{</span><span class="attribute-value">this.logoutHandler</span><span class="error">}</span><span class="tag">/&gt;</span>;

    <span class="keyword">switch</span> (route) {
      <span class="keyword">case</span> <span class="string"><span class="delimiter">'</span><span class="content">login</span><span class="delimiter">'</span></span>:
        <span class="keyword">return</span> loginContent;
      <span class="keyword">case</span> <span class="string"><span class="delimiter">'</span><span class="content">garage</span><span class="delimiter">'</span></span>:
        <span class="keyword">return</span> garageContent;
      <span class="keyword">default</span>:
        <span class="keyword">return</span> <span class="tag">&lt;p&gt;</span>Loading...<span class="tag">&lt;/p&gt;</span>;
    }
  };

  render() { <i class="conum" data-value="3"></i><b>(3)</b>
    const content = <span class="local-variable">this</span>.contentForRoute();

    <span class="keyword">return</span> (
      <span class="tag">&lt;Grid&gt;</span>
        {content}
      <span class="tag">&lt;/Grid&gt;</span>
    );
  };
  <span class="comment">//end::routing[]</span>
}

<span class="reserved">export</span> <span class="keyword">default</span> App;</code></pre>
</div>
</div>


<h2 id="appState">8.1 Creating our state</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails-guides/react-spring-security/edit/master/src/main/docs/guide/appState.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>First thing, let&#8217;s build our <code>App</code> state object. This is done in the component constructor. You should recognize our user and error fields in our state as
we have used them already in some of our functions. In addition, we&#8217;ll add a <code>route</code> variable for use later on.</p>
</div>
<div class="listingblock">
<div class="title">client/src/App.js</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="javascript">constructor() {
  <span class="reserved">super</span>();

  <span class="local-variable">this</span>.state = {
    <span class="key">userDetails</span>: {
      <span class="key">username</span>: <span class="string"><span class="delimiter">'</span><span class="delimiter">'</span></span>,
      <span class="key">password</span>: <span class="string"><span class="delimiter">'</span><span class="delimiter">'</span></span>
    },
    <span class="key">route</span>: <span class="string"><span class="delimiter">'</span><span class="delimiter">'</span></span>,
    <span class="key">error</span>: <span class="predefined-constant">null</span>
  }
}

reset = () =&gt; { <i class="conum" data-value="1"></i><b>(1)</b>
  <span class="local-variable">this</span>.setState({
    <span class="key">userDetails</span>: {
      <span class="key">username</span>: <span class="string"><span class="delimiter">'</span><span class="delimiter">'</span></span>,
      <span class="key">password</span>: <span class="string"><span class="delimiter">'</span><span class="delimiter">'</span></span>
    },
    <span class="key">route</span>: <span class="string"><span class="delimiter">'</span><span class="content">login</span><span class="delimiter">'</span></span>,
    <span class="key">error</span>: <span class="predefined-constant">null</span>
  });
};</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>We&#8217;ve added a <code>reset</code> function so that we can easily return
to our initial state when needed:</td>
</tr>
</table>
</div>


<h2 id="lifecycle">8.2 React Lifecycle Methods</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails-guides/react-spring-security/edit/master/src/main/docs/guide/lifecycle.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Next in our <code>App</code> component, we need to implement two of React&#8217;s "lifecycle" methods, which will check whether we are logged in or not.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
See the <a href="https://facebook.github.io/react/docs/react-component.html">React documentation</a> for more information on the component lifecycle.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">client/src/App.js</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="javascript">componentDidMount() {
  console.log(<span class="string"><span class="delimiter">'</span><span class="content">app mounting...</span><span class="delimiter">'</span></span>);

  (async () =&gt; {
    <span class="keyword">if</span> (await Auth.loggedIn()) {
      <span class="local-variable">this</span>.setState({<span class="key">route</span>: <span class="string"><span class="delimiter">'</span><span class="content">garage</span><span class="delimiter">'</span></span>})
    } <span class="keyword">else</span> {
      <span class="local-variable">this</span>.setState({<span class="key">route</span>: <span class="string"><span class="delimiter">'</span><span class="content">login</span><span class="delimiter">'</span></span>});
    }
  })();
}

componentDidUpdate() {
  <span class="keyword">if</span> (<span class="local-variable">this</span>.state.route !== <span class="string"><span class="delimiter">'</span><span class="content">login</span><span class="delimiter">'</span></span> &amp;&amp; !Auth.loggedIn()) {
    <span class="local-variable">this</span>.setState({<span class="key">route</span>: <span class="string"><span class="delimiter">'</span><span class="content">login</span><span class="delimiter">'</span></span>})
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In <code>componentDidMount</code>, we are using the <code>Auth.isLoggedIn()</code> function to see whether we&#8217;re logged in. Because <code>isLoggedIn</code> uses a <code>fetch</code> call, which is asynchronous, we&#8217;re using the <code>async</code>/<code>await</code> keywords to prevent our check from returning before the <code>fetch</code> call completes. Assuming that <code>isLoggedIn</code> returns true, we set our <code>route</code> state variable to 'garage' - otherwise, set it <code>login</code>.</p>
</div>
<div class="paragraph">
<p>We perform a similar check in <code>componentDidUpdate</code>, redirecting to the <code>login</code> route if we are no longer logged in.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
For more information on <code>async</code>/<code>await</code>, see the documentation at <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/await">https://developer.mozilla.org</a>
</td>
</tr>
</table>
</div>


<h2 id="inputChangeHandler">8.3 Login Form Change Handler</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails-guides/react-spring-security/edit/master/src/main/docs/guide/inputChangeHandler.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>As we discussed while we were creating the <code>Login</code> component (see <a href="#loginScreen">[loginScreen]</a>), we need to define a handler function to update our <code>userDetails</code> state object when the username/password values are changed.</p>
</div>
<div class="listingblock">
<div class="title">client/src/App.js</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="javascript">inputChangeHandler = (event) =&gt; {
  let {userDetails} = <span class="local-variable">this</span>.state;
  const target = event.target;

  userDetails[target.name] = target.value; <i class="conum" data-value="1"></i><b>(1)</b>

  <span class="local-variable">this</span>.setState({userDetails});
};</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Note that we will use the same handler for both username and password, as the <code>name</code> attributes set on each form input can be used to assign the correct variable.</td>
</tr>
</table>
</div>


<h2 id="login">8.4 Handling Login</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails-guides/react-spring-security/edit/master/src/main/docs/guide/login.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="listingblock">
<div class="title">client/src/App.js</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="javascript">login = (e) =&gt; {
  console.log(<span class="string"><span class="delimiter">'</span><span class="content">login</span><span class="delimiter">'</span></span>);
  e.preventDefault(); <i class="conum" data-value="1"></i><b>(1)</b>

  fetch(<span class="error">`</span><span class="predefined">$</span>{SERVER_URL}/api/login<span class="error">`</span>, { <i class="conum" data-value="2"></i><b>(2)</b>
    <span class="key">method</span>: <span class="string"><span class="delimiter">'</span><span class="content">POST</span><span class="delimiter">'</span></span>,
    <span class="key">headers</span>: {
      <span class="key"><span class="delimiter">'</span><span class="content">Accept</span><span class="delimiter">'</span></span>: <span class="string"><span class="delimiter">'</span><span class="content">application/json</span><span class="delimiter">'</span></span>,
      <span class="key"><span class="delimiter">'</span><span class="content">Content-Type</span><span class="delimiter">'</span></span>: <span class="string"><span class="delimiter">'</span><span class="content">application/json</span><span class="delimiter">'</span></span>
    },
    <span class="key">body</span>: JSON.stringify(<span class="local-variable">this</span>.state.userDetails)
  }).then(checkResponseStatus) <i class="conum" data-value="3"></i><b>(3)</b>
    .then(response =&gt; loginResponseHandler(response, <span class="local-variable">this</span>.customLoginHandler)) <i class="conum" data-value="4"></i><b>(4)</b>
    .<span class="keyword">catch</span>(error =&gt; defaultErrorHandler(error, <span class="local-variable">this</span>.customErrorHandler)); <i class="conum" data-value="5"></i><b>(5)</b>
};</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>We call <code>e.preventDefault();</code> to disable the <code>Login</code> form&#8217;s default submit event.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Using <code>fetch</code>, we make a POST request containing the credentials entered by the user via the <code>Login</code> form.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>We chain the <code>checkResponseStatus</code> to our <code>fetch</code> call to validate that the request was successful.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Assuming success, we add <code>loginResponseHandler</code> to the chain to complete the login process.</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Any errors are passed to the <code>defaultErrorHandler</code> function, along with our <code>customErrorHandler</code>.</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">client/src/App.js</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="javascript">customLoginHandler = () =&gt; { <i class="conum" data-value="1"></i><b>(1)</b>
  <span class="local-variable">this</span>.setState({<span class="key">route</span>: <span class="string"><span class="delimiter">'</span><span class="content">garage</span><span class="delimiter">'</span></span>});
};

customErrorHandler = (error) =&gt; { <i class="conum" data-value="2"></i><b>(2)</b>
  <span class="local-variable">this</span>.reset();
  <span class="local-variable">this</span>.setState({<span class="key">error</span>: error.message});
};</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note the use of the "custom" handler functions:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><code>customLoginHandler</code> updates <code>this.state.route</code> upon a successful login.</p>
</li>
<li>
<p><code>customErrorHandler`clears the `userDetails</code> state variable, and sets an error message.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>At this point you should be able to successfully login to the application but there are a few more things
to do before we are done.</p>
</div>


<h2 id="logout">8.5 Handling Logout</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails-guides/react-spring-security/edit/master/src/main/docs/guide/logout.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>The logout handler simply calls the <code>Auth.logOut()</code> function we wrote earlier.  We then call <code>reset()</code>, which gets us back our initial state.</p>
</div>
<div class="listingblock">
<div class="title">client/src/App.js</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="javascript">logoutHandler = () =&gt; {
  Auth.logOut();
  <span class="local-variable">this</span>.reset();
};</code></pre>
</div>
</div>


<h2 id="routing">8.6 Routing</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails-guides/react-spring-security/edit/master/src/main/docs/guide/routing.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Routing, in Single Page Applications, gives the user the ability to navigate through your application as though it were made of multiple "pages". In many React apps, the <a href="https://reacttraining.com/react-router/">React Router</a> library is used to handle this requirement. However, we will take a simplistic approach for this guide by storing our current "route" in our state, and choosing which component to render based on that variable.</p>
</div>
<div class="listingblock">
<div class="title">client/src/App.js</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="javascript">contentForRoute() { <i class="conum" data-value="1"></i><b>(1)</b>
  const {error, userDetails, route} = <span class="local-variable">this</span>.state;

  const loginContent = <span class="tag">&lt;Login</span> <span class="attribute-name">error</span>=<span class="error">{</span><span class="attribute-value">error</span><span class="error">}</span> <i class="conum" data-value="2"></i><b>(2)</b>
                              <span class="attribute-name">userDetails</span>=<span class="error">{</span><span class="attribute-value">userDetails</span><span class="error">}</span>
                              <span class="attribute-name">inputChangeHandler</span>=<span class="error">{</span><span class="attribute-value">this.inputChangeHandler</span><span class="error">}</span>
                              <span class="attribute-name">onSubmit</span>=<span class="error">{</span><span class="attribute-value">this.login</span><span class="error">}</span><span class="tag">/&gt;</span>;

  const garageContent = <span class="tag">&lt;Garage</span> <span class="attribute-name">logoutHandler</span>=<span class="error">{</span><span class="attribute-value">this.logoutHandler</span><span class="error">}</span><span class="tag">/&gt;</span>;

  <span class="keyword">switch</span> (route) {
    <span class="keyword">case</span> <span class="string"><span class="delimiter">'</span><span class="content">login</span><span class="delimiter">'</span></span>:
      <span class="keyword">return</span> loginContent;
    <span class="keyword">case</span> <span class="string"><span class="delimiter">'</span><span class="content">garage</span><span class="delimiter">'</span></span>:
      <span class="keyword">return</span> garageContent;
    <span class="keyword">default</span>:
      <span class="keyword">return</span> <span class="tag">&lt;p&gt;</span>Loading...<span class="tag">&lt;/p&gt;</span>;
  }
};

render() { <i class="conum" data-value="3"></i><b>(3)</b>
  const content = <span class="local-variable">this</span>.contentForRoute();

  <span class="keyword">return</span> (
    <span class="tag">&lt;Grid&gt;</span>
      {content}
    <span class="tag">&lt;/Grid&gt;</span>
  );
};</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>We&#8217;ve created a <code>contentForRoute</code> function, which will select the proper component to render based on <code>this.state.route</code>. If there is no route set yet, we display a "Loading&#8230;&#8203;" message.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Note that this is where we are passing in our <code>inputChangeHandler</code>, <code>login</code>, and <code>logoutHandler</code> handlers into those components as props.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Finally, in our <code>render</code> function, we render out the content that we calculated earlier based on our route.</td>
</tr>
</table>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
Note how we pass our handler functions as <strong>references</strong> (<code>onSubmit={this.login}</code>), not function calls (<code>onSubmit={this.login()}</code>). This is because we want our child components to have access to these functions and call them later - we don&#8217;t want to call them when the component is rendered!
</td>
</tr>
</table>
</div>


<h2 id="garage">8.7 Authenticating our REST Calls</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails-guides/react-spring-security/edit/master/src/main/docs/guide/garage.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>At this point our login and logout functionality is complete. The last step is to authenticate our REST calls back to our API. This takes place in the <code>Garage</code> component, which is shown below.</p>
</div>
<div class="listingblock">
<div class="title">client/src/Garage.js</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="javascript"><span class="reserved">import</span> React from <span class="string"><span class="delimiter">'</span><span class="content">react</span><span class="delimiter">'</span></span>;
<span class="reserved">import</span> Vehicles from <span class="string"><span class="delimiter">'</span><span class="content">./Vehicles</span><span class="delimiter">'</span></span>;
<span class="reserved">import</span> AddVehicleForm from <span class="string"><span class="delimiter">'</span><span class="content">./AddVehicleForm</span><span class="delimiter">'</span></span>;
<span class="reserved">import</span> { Row, Jumbotron, Button } from <span class="string"><span class="delimiter">'</span><span class="content">react-bootstrap</span><span class="delimiter">'</span></span>;
<span class="reserved">import</span> { SERVER_URL } from <span class="string"><span class="delimiter">'</span><span class="content">./config</span><span class="delimiter">'</span></span>;
<span class="reserved">import</span> headers from <span class="string"><span class="delimiter">'</span><span class="content">./security/headers</span><span class="delimiter">'</span></span>;
<span class="reserved">import</span> <span class="string"><span class="delimiter">'</span><span class="content">whatwg-fetch</span><span class="delimiter">'</span></span>;

<span class="reserved">class</span> Garage <span class="reserved">extends</span> React.Component {

  constructor() {
    <span class="reserved">super</span>();

    <span class="local-variable">this</span>.state = {
      <span class="key">vehicles</span>: [],
      <span class="key">makes</span>: [],
      <span class="key">models</span>: [],
      <span class="key">drivers</span>: []
    }
  }

  componentDidMount() {
      fetch(<span class="error">`</span><span class="predefined">$</span>{SERVER_URL}/api/vehicle<span class="error">`</span>, {
        <span class="key">method</span>: <span class="string"><span class="delimiter">'</span><span class="content">GET</span><span class="delimiter">'</span></span>,
        <span class="key">headers</span>: headers(), <i class="conum" data-value="1"></i><b>(1)</b>
      })
      .then(r =&gt; r.json())
      .then(json =&gt; <span class="local-variable">this</span>.setState({<span class="key">vehicles</span>: json}))
      .<span class="keyword">catch</span>(error =&gt; console.error(<span class="string"><span class="delimiter">'</span><span class="content">Error retrieving vehicles: </span><span class="delimiter">'</span></span> + error));

      fetch(<span class="error">`</span><span class="predefined">$</span>{SERVER_URL}/api/make<span class="error">`</span>, {
        <span class="key">method</span>: <span class="string"><span class="delimiter">'</span><span class="content">GET</span><span class="delimiter">'</span></span>,
        <span class="key">headers</span>: headers() <i class="conum" data-value="1"></i><b>(1)</b>
      })
      .then(r =&gt; r.json())
      .then(json =&gt; <span class="local-variable">this</span>.setState({<span class="key">makes</span>: json}))
      .<span class="keyword">catch</span>(error =&gt; console.error(<span class="string"><span class="delimiter">'</span><span class="content">Error retrieving makes: </span><span class="delimiter">'</span></span> + error));

      fetch(<span class="error">`</span><span class="predefined">$</span>{SERVER_URL}/api/model<span class="error">`</span>, {
        <span class="key">method</span>: <span class="string"><span class="delimiter">'</span><span class="content">GET</span><span class="delimiter">'</span></span>,
        <span class="key">headers</span>: headers() <i class="conum" data-value="1"></i><b>(1)</b>
    })
      .then(r =&gt; r.json())
      .then(json =&gt; <span class="local-variable">this</span>.setState({<span class="key">models</span>: json}))
      .<span class="keyword">catch</span>(error =&gt; console.error(<span class="string"><span class="delimiter">'</span><span class="content">Error retrieving models </span><span class="delimiter">'</span></span> + error));

    fetch(<span class="error">`</span><span class="predefined">$</span>{SERVER_URL}/api/driver<span class="error">`</span>, {
        <span class="key">method</span>: <span class="string"><span class="delimiter">'</span><span class="content">GET</span><span class="delimiter">'</span></span>,
        <span class="key">headers</span>: headers() <i class="conum" data-value="1"></i><b>(1)</b>
    })
      .then(r =&gt; r.json())
      .then(json =&gt; <span class="local-variable">this</span>.setState({<span class="key">drivers</span>: json}))
      .<span class="keyword">catch</span>(error =&gt; console.error(<span class="string"><span class="delimiter">'</span><span class="content">Error retrieving drivers: </span><span class="delimiter">'</span></span> + error));
  }

  submitNewVehicle = (vehicle) =&gt; {
    fetch(<span class="error">`</span><span class="predefined">$</span>{SERVER_URL}/api/vehicle<span class="error">`</span>, {
      <span class="key">method</span>: <span class="string"><span class="delimiter">'</span><span class="content">POST</span><span class="delimiter">'</span></span>,
      <span class="key">headers</span>: headers(), <i class="conum" data-value="1"></i><b>(1)</b>
      <span class="key">body</span>: JSON.stringify(vehicle)
    }).then(r =&gt; r.json())
      .then(json =&gt; {
        let vehicles = <span class="local-variable">this</span>.state.vehicles;
        vehicles.push({<span class="key">id</span>: json.id, <span class="key">name</span>: json.name, <span class="key">make</span>: json.make, <span class="key">model</span>: json.model, <span class="key">driver</span>: json.driver});
        <span class="local-variable">this</span>.setState({vehicles});
      })
      .<span class="keyword">catch</span>(ex =&gt; console.error(<span class="string"><span class="delimiter">'</span><span class="content">Unable to save vehicle</span><span class="delimiter">'</span></span>, ex));
  };

  render() {
    const {vehicles, makes, models, drivers} = <span class="local-variable">this</span>.state;
    <i class="conum" data-value="2"></i><b>(2)</b>
    const logoutButton = <span class="tag">&lt;Button</span> <span class="attribute-name">bsStyle</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">warning</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">className</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">pull-right</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">onClick</span>=<span class="error">{</span><span class="attribute-value">this.props.logoutHandler</span><span class="error">}</span> <span class="tag">&gt;</span>Log Out<span class="tag">&lt;/Button&gt;</span>;

    <span class="keyword">return</span> <span class="tag">&lt;Row&gt;</span>
      <span class="tag">&lt;Jumbotron&gt;</span>
        <span class="tag">&lt;h1&gt;</span>Welcome to the Garage<span class="tag">&lt;/h1&gt;</span>
        {logoutButton}
      <span class="tag">&lt;/Jumbotron&gt;</span>
      <span class="tag">&lt;Row&gt;</span>
        <span class="tag">&lt;AddVehicleForm</span> <span class="attribute-name">onSubmit</span>=<span class="error">{</span><span class="attribute-value">this.submitNewVehicle</span><span class="error">}</span> <span class="attribute-name">makes</span>=<span class="error">{</span><span class="attribute-value">makes</span><span class="error">}</span> <span class="attribute-name">models</span>=<span class="error">{</span><span class="attribute-value">models</span><span class="error">}</span> <span class="attribute-name">drivers</span>=<span class="error">{</span><span class="attribute-value">drivers</span><span class="error">}</span><span class="tag">/&gt;</span>
      <span class="tag">&lt;/Row&gt;</span>
      <span class="tag">&lt;Row&gt;</span>
        <span class="tag">&lt;Vehicles</span> <span class="attribute-name">vehicles</span>=<span class="error">{</span><span class="attribute-value">vehicles</span><span class="error">}</span> <span class="tag">/&gt;</span>
      <span class="tag">&lt;/Row&gt;</span>
    &lt;<span class="regexp"><span class="delimiter">/</span><span class="content">Row&gt;;
  }
}

export default Garage;</span></span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Note the use of the <code>headers()</code> function again to return our token-bearing request headers for all of our API calls.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The logout button will execute the <code>logoutHandler</code> function when clicked.
Start up the app and verify that you can login and authenticate successfully. Congratulations! You have secured your React app with Grails and Spring Security!</td>
</tr>
</table>
</div>


<h1 id="helpWithGrails">9 Do you need help with Grails?</h1>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails-guides/react-spring-security/edit/master/src/main/docs/guide/helpWithGrails.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<h3 style="color: #333; margin-bottom:25px;"><a href="https://objectcomputing.com/" target="_blank">Object Computing, Inc.</a> (OCI) sponsored the creation of this Guide. A variety of consulting and support services are available.</h3>

<!-- BEGIN HubSpot Consultation Form -->

<!--[if lte IE 8]>
<script charset="utf-8" type="text/javascript" src="//js.hsforms.net/forms/v2-legacy.js"></script>
<![endif]-->
<script charset="utf-8" type="text/javascript" src="//js.hsforms.net/forms/v2.js"></script>
<script>
  hbspt.forms.create({
	portalId: "4547412",
	formId: "f8bc9b16-d5f6-4226-a24e-da0eb8b73363"
});
</script>

<!-- END HubSpot Consultation Form -->

<h3 style="color: #333;">OCI is Home to Grails</h3>

<p><a href="https://objectcomputing.com/products/2gm-team" target="_blank">Meet the Team</a></p>

</article></div><footer>
  <div class='content'>
    <div class='ocihometograils'>
      <span>Sponsored by</span>
      <a href='https://objectcomputing.com/products/grails/'><img class='' src='/images/oci_home_to_grails.svg' alt='Object Computing - Home to Grails' width='300px' /></a>
    </div>
    <nav class='socialmedianav'><ul>
  <li>
    <a href='https://slack.grails.org'><img class='' src='/images/slack.svg' alt='Slack Icon' /></a>
  </li>
  <li>
    <a href='https://www.youtube.com/watch?v=XnRNfDGkBVg&amp;list=PLI74De5M9T73uH3WilDCePP2qfSDpMaGu'><img class='' src='/images/youtube.svg' alt='Youtube Icon' /></a>
  </li>
  <li>
    <a href='https://www.linkedin.com/groups/39757'><img class='' src='/images/linkedin.svg' alt='LinkedIn Icon' /></a>
  </li>
  <li>
    <a href='https://github.com/grails/'><img class='' src='/images/github.svg' alt='Github Icon' /></a>
  </li>
  <li>
    <a href='https://twitter.com/grailsframework'><img class='' src='/images/twitter.svg' alt='Twitter Icon' /></a>
  </li>
</ul></nav>
    <nav class='partnersnav'><ul>
  <li>Grails' repositories are hosted by
    <a href='https://repo.grails.org/'>Artifactory</a>
  </li>
  <li>Website hosting provided by
    <a href='https://aws.amazon.com/'>AWS</a>
  </li>
  <li>JetBrains supports Grails with its 
    <a href='https://www.jetbrains.com/idea/'>IntelliJ IDEA IDE</a>
  </li>
  <li>YourKit supports Grails with its 
    <a href='https://www.yourkit.com/java/profiler/index.jsp'>Java Profiler</a>
  </li>
  <li>Grails is Open Source
    <a href='http://www.apache.org/licenses/LICENSE-2.0.html'>Apache 2 License</a>
  </li>
  <li>
    <a href='https://grails.org/buildstatus.html'>Build Status</a>
  </li>
</ul></nav>
  </div>
</footer><div>
  <script type='text/javascript'>
              (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
              (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
              m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
              })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

              ga('create', 'UA-82213539-2', 'auto');
              ga('send', 'pageview');
</script>
  <script type='text/javascript'>
adroll_adv_id = "HBWJH4CQCJGS5DJRSB4Z4D";
adroll_pix_id = "IVEQYFOZXZAPZMDVQH7BFE";
/* OPTIONAL: provide email to improve user identification */
/* adroll_email = "username@example.com"; */
(function () {
    var _onload = function(){
        if (document.readyState && !/loaded|complete/.test(document.readyState)){setTimeout(_onload, 10);return}
        if (!window.__adroll_loaded){__adroll_loaded=true;setTimeout(_onload, 50);return}
        var scr = document.createElement("script");
        var host = (("https:" == document.location.protocol) ? "https://s.adroll.com" : "http://a.adroll.com");
        scr.setAttribute('async', 'true');
        scr.type = "text/javascript";
        scr.src = host + "/j/roundtrip.js";
        ((document.getElementsByTagName('head') || [null])[0] ||
            document.getElementsByTagName('script')[0].parentNode).appendChild(scr);
    };
    if (window.addEventListener) {window.addEventListener('load', _onload, false);}
    else {window.attachEvent('onload', _onload)}
}());            
</script>
</div></body>
</html>
