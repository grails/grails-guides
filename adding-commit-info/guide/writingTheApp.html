<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
                      "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
    <title>4 Writing the Application</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <link rel="stylesheet" href="../css/main.css" type="text/css" media="screen, print" title="Style" charset="utf-8"/>
    <link rel="stylesheet" href="../css/guide.css" type="text/css" media="screen, print" title="Style" charset="utf-8" />            
    <link rel="stylesheet" href="../css/pdf.css" type="text/css" media="print" title="PDF" charset="utf-8"/>
    <script type="text/javascript">
function addJsClass() {
    var classes = document.body.className.split(" ");
    classes.push("js");
    document.body.className = classes.join(" ");
}
    </script>
</head>

<body class="body" onload="addJsClass();">
<div id="navigation">
    <div class="navTitle">
        
        Grails Framework Guide 
    </div>
    <div class="navLinks">
        <ul>
            <li>
                <div id="nav-summary" onmouseover="toggleNavSummary(false)" onmouseout="toggleNavSummary(true)">
                    <a href="../guide/index.html" class="button">Table of contents</a>

                    <div id="nav-summary-childs" style="display:none;">
                        
                        <div class="toc-item" style="margin-left:0"><a href="../guide/training.html"><strong>1</strong><span>Grails Training</span></a>
                        </div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="../guide/gettingStarted.html"><strong>2</strong><span>Getting Started</span></a>
                        </div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="../guide/history.html"><strong>3</strong><span>History</span></a>
                        </div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="../guide/writingTheApp.html"><strong>4</strong><span>Writing the Application</span></a>
                        </div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="../guide/runningTheApp.html"><strong>5</strong><span>Running the Application</span></a>
                        </div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="../guide/configuration.html"><strong>6</strong><span>Configuration</span></a>
                        </div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="../guide/tldr.html"><strong>7</strong><span>tl;dr (Too long; didn't read)</span></a>
                        </div>
                        
                    </div>
                </div>
            </li>
        </ul>
    </div>


</div>

<table id="colset" border="0" cellpadding="0" cellspacing="0">
    <tr>
        <td id="col1">
            <div id="main" class="corner-all">

                
                    <div class="toc-item prev-left"><a href="../guide/history.html">&lt;&lt; <strong>3</strong><span>History</span></a></div>
                

                
                    <div class="toc-item next-right"><a href="../guide/runningTheApp.html"><strong>5</strong><span>Running the Application</span> >></a></div>
                


                
                <div id="table-of-content">
                    <h2>Table of Contents</h2>
                    
                    <div class="toc-item" style="margin-left:0px"><a href="#gradlePlugin"><strong>4.1</strong><span>Gradle Plugin</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0px"><a href="#actuator"><strong>4.2</strong><span>Spring Boot Actuator endpoints</span></a>
                    </div>
                    
                </div>
                

                

<h1 id="writingTheApp">4 Writing the Application</h1>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails-guides/adding-commit-info/edit/master/src/main/docs/guide/writingTheApp.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>There are two basic steps</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Adding the <a href="#gradlePlugin">gradle-git-properties plugin</a></p>
</li>
<li>
<p>Enabling the <a href="#actuator"><code>/info</code> endpoint</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Let&#8217;s get started!</p>
</div>


<h2 id="gradlePlugin">4.1 Gradle Plugin</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails-guides/adding-commit-info/edit/master/src/main/docs/guide/gradlePlugin.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>One of the features of Grails 3.x is that the applications come packaged with Gradle as a build tool.</p>
</div>
<div class="paragraph">
<p>Rather than implementing our own mechanism to capture git commit information we can leverage the <a href="https://plugins.gradle.org/plugin/com.gorylenko.gradle-git-properties">gradle-git-properties</a> plugin.
The goal of this plugin is to capture the commit information and store it in a file called <code>git.properties</code></p>
</div>
<div class="paragraph">
<p>Adding a Gradle plugin is fairly straight forward.  This involves a few steps.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Adding the dependency to the <code>buildscript { &#8230;&#8203; }</code> block in <code>build.gradle</code>. This means that you are adding the dependency to the build and not your deliverable application.</p>
</li>
<li>
<p>Ensuring the build script dependency will be resolved via the appropriate maven repositories</p>
</li>
<li>
<p>Applying the plugin</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="title">/complete/build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">buildscript {
    repositories {
        maven { url <span class="string"><span class="delimiter">&quot;</span><span class="content">https://plugins.gradle.org/m2/</span><span class="delimiter">&quot;</span></span> }
    }
    dependencies {
        classpath <span class="string"><span class="delimiter">&quot;</span><span class="content">gradle.plugin.com.gorylenko.gradle-git-properties:gradle-git-properties:1.4.17</span><span class="delimiter">&quot;</span></span>
    }
}
apply <span class="key">plugin</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">com.gorylenko.gradle-git-properties</span><span class="delimiter">&quot;</span></span></code></pre>
</div>
</div>
<hr>
<div class="paragraph">
<p>Now every time the application is compiled or run (specifically the <a href="https://github.com/n0mer/gradle-git-properties/blob/master/src/main/groovy/com/gorylenko/GitPropertiesPlugin.groovy#L55">JavaPlugin&#8217;s <code>classes</code> task</a>), you&#8217;ll find that git.properties has been generated.
When running the app locally, this file may be found at <code>/build/resources/main/git.properties</code>.
When packaged as a war or standalone jar you&#8217;ll find <code>git.properties</code> included in <code>WEB-INF/classes</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ unzip -l ./build/libs/complete-0.1.war | grep git.properties
      276  2017-02-02 11:53   WEB-INF/classes/git.properties</code></pre>
</div>
</div>
<hr>
<div class="paragraph">
<p>Inspecting <code>git.properties</code> reveals the commit information that was captured</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="properties">git.branch=master
git.commit.id=777d70650bb055862436fc59071072aae8cd0ddd
git.commit.id.abbrev=777d706
git.commit.user.name=Colin Harrington
git.commit.user.email=colin.harrington@gmail.com
git.commit.message.short=Adding gradle-git-properties plugin
git.commit.message.full=Adding gradle-git-properties plugin

git.commit.time=1487262171</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>It is possible to configure/influence how git.properties is generated by configuring the gradle task (in <code>build.gradle</code>).</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">gitProperties {
    dateFormat = <span class="string"><span class="delimiter">&quot;</span><span class="content">yyyy-MM-dd'T'HH:mmZ</span><span class="delimiter">&quot;</span></span>
    dateFormatTimeZone = <span class="string"><span class="delimiter">&quot;</span><span class="content">CST</span><span class="delimiter">&quot;</span></span>
}</code></pre>
</div>
</div>
</td>
</tr>
</table>
</div>


<h2 id="actuator">4.2 Spring Boot Actuator endpoints</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails-guides/adding-commit-info/edit/master/src/main/docs/guide/actuator.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Now that we have the git commit info captured and included in our application via a <code>git.properties</code> file, it is time to utilize it.</p>
</div>
<div class="paragraph">
<p>Grails 3.x is based on Spring Boot and we can leverage some of the underlying tools already included in the application.</p>
</div>
<div class="quoteblock">
<blockquote>
Spring Boot includes a number of additional features to help you monitor and manage your application when itâ€™s pushed to production. You can choose to manage and monitor your application using HTTP endpoints, with JMX or even by remote shell (SSH or Telnet). Auditing, health and metrics gathering can be automatically applied to your application.
that has some production ready features already built into it.
</blockquote>
<div class="attribution">
&#8212; Documentation for Spring Boot Actuator<br>
<cite><a href="http://docs.spring.io/spring-boot/docs/current/reference/html/production-ready.html" class="bare">http://docs.spring.io/spring-boot/docs/current/reference/html/production-ready.html</a></cite>
</div>
</div>
<div class="paragraph">
<p>Built into Spring boot is a module called <code>spring-boot-actuator</code> that provides these endpoints.
The endpoints are disabled by default so the first step is to enabled them.</p>
</div>
<hr>
<div class="paragraph">
<p>If you open up <code>grails-app/conf/application.yml</code> you will find a block of configuration that looks like this:</p>
</div>
<div class="listingblock">
<div class="title">grails-app/conf/application.yml</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="comment"># Spring Actuator Endpoints are Disabled by Default</span>
<span class="key">endpoints</span>:
    <span class="key">enabled</span>: <span class="string"><span class="content">false</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>You simply have to enable the actuator endpoints by setting <strong><code>enabled: true</code></strong></p>
</div>
<div class="listingblock">
<div class="title">/grails-app/conf/application.yml</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">endpoints</span>:
    <span class="key">enabled</span>: <span class="string"><span class="content">true</span></span></code></pre>
</div>
</div>


                <div style="clear:both;margin-top:15px;"></div>
                
                    <div class="toc-item prev-left"><a href="../guide/history.html">&lt;&lt; <strong>3</strong><span>History</span></a></div>
                
                    <div class="toc-item next-right"><a href="../guide/runningTheApp.html"><strong>5</strong><span>Running the Application</span> >></a></div>
                
                <div style="clear:both"></div>
            </div>
        </td>
        <td id="col2">
            <div class="local clearfix">
                <div class="local-title" style="text-align: right"><a href="https://travis-ci.org/grails-guides/adding-commit-info"><img src="https://travis-ci.org/grails-guides/adding-commit-info.svg?branch=master" /></a></div>            
                 <div class="local-title">
                    <a href="https://github.com/grails-guides/adding-commit-info">
                    <svg height="35" class="octicon octicon-mark-github" viewBox="0 0 16 16" version="1.1" width="35" aria-hidden="true"><path fill-rule="evenodd" d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0 0 16 8c0-4.42-3.58-8-8-8z"/></svg></a> &nbsp;&nbsp;Get the Code
                </div>
                <div class="menu">
                    <div class="input-group">                        
                        <button href="#" onclick="document.getElementById('github-url').value='git@github.com:grails-guides/adding-commit-info.git'" class="codeButton">SSH</button>
                        <button onclick="document.getElementById('github-url').value='https://github.com/grails-guides/adding-commit-info.git'" class="codeButton">HTTPS</button>
                        <button onclick="document.getElementById('github-url').value='https://github.com/grails-guides/adding-commit-info'" class="codeButton">Subversion</button>
                    </div>
       
                    <div class="input-group">                    
                        <!-- Target -->
                        <input id="github-url" value="git@github.com:grails-guides/adding-commit-info.git" type="text" />

                        <!-- Trigger -->
                        <button class="clipbtn" type="button" data-clipboard-target="#github-url">

                            <img width="13" src="../img/clippy.svg" alt="Copy to clipboard">
                        </button>       

                    </div>
                    <div class="input-group">
                      <a href="https://github.com/grails-guides/adding-commit-info/archive/master.zip" class="downloadButton">Download ZIP</a>
                    </div>
                </div>
            </div>
        </td>
    </tr>
</table>

<div id="footer">
    Copies of this document may be made for your own use and for distribution to others, provided that you do not charge any fee for such copies and further provided that each copy contains this Copyright Notice, whether distributed in print or electronically. All guides are released with an ASLv2 license for the code, and Creative Commons license for the writing. 
    
</div>

<script type="text/javascript" src="../js/docs.js"></script>

</body>
</html>
