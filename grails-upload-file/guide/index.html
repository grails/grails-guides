<!DOCTYPE html>
<html>
  <head>
    <meta name='google-site-verification' content='REYQ1_I6HGowAE7LOLVqfQbnKaB4IfFpMlGzMbJj55Q' />
    <meta name='viewport' content='width=device-width, initial-scale=1' />
    <link rel='icon' href='/images/favicon.ico' />
    <link rel='mask-icon' href='//images/grails-pinned-icon.svg' color='feb672' />
    <meta charset='UTF-8' />
    <title>How to upload a file with Grails 4 | Grails Guides | Grails Framework</title>
    <meta name='description' content='How to upload a file with Grails 4. Learn how to upload files with Grails 4; transfer them to a folder, save them as byte[] in the database or upload them to AWS S3.' />
    <link rel='stylesheet' href='../css/main.css' />
    <link rel='stylesheet' href='../css/screen.css' />
    <script src='https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/1.7.1/clipboard.min.js'></script>
  </head>
  <body class='guide'><header class='mainheader'>
  <div class='content'>
    <a href='https://grails.org/index.html'><img class='grailslogo' src='/images/grails_logo.svg' alt='Grails Logo' /></a>
    <a href='javascript:show(&apos;topmenus&apos;, &apos;showNavigationLink&apos;)' id='showNavigationLink' class='mobile align-center'>Show Navigation</a>
    <div id='topmenus'>
      <nav class='secondarymenu' id='secondarymenu'><ul>
  <li>
    <a href='https://grails.org/learning.html'>Learning</a>
  </li>
  <li>
    <a href='https://grails.org/community.html'>Community</a>
  </li>
  <li>
    <a href='https://grails.org/search.html'>Search</a>
  </li>
</ul></nav>
      <nav class='mainmenu' id='mainmenu'><ul>
  <li>
    <a href='https://grails.org/documentation.html'>Documentation</a>
  </li>
  <li>
    <a href='https://grails.org/download.html'>Download</a>
  </li>
  <li>
    <a href='https://plugins.grails.org'>Plugins</a>
  </li>
  <li>
    <a href='https://guides.grails.org/index.html'>Guides</a>
  </li>
  <li>
    <a href='https://grails.org/faq.html'>FAQ</a>
  </li>
  <li>
    <a href='https://grails.org/support.html'>Support</a>
  </li>
</ul></nav>
    </div>
  </div>
</header><div class='fullwidth'><article class="guide">
    <aside>
        <a href="https://travis-ci.org/grails-guides/grails-upload-file"><img src="https://travis-ci.org/grails-guides/grails-upload-file.svg?branch=master"></a>

        <button type="button" class="btn btn-large" onclick="window.location.href=&quot;https://github.com/grails-guides/grails-upload-file&quot;"><img height="15" src="../img/github_white.svg" alt="Github"/><span>&nbsp;Get the Code</span></button>


        <ul class="githublinks">
            <li><button type="button" class="btn btn-default" href="#" onclick="document.getElementById('github-url').value='git@github.com:grails-guides/grails-upload-file.git'" class="codeButton">SSH</button></li>
            <li><button type="button" class="btn btn-default" onclick="document.getElementById('github-url').value='https://github.com/grails-guides/grails-upload-file.git'" class="codeButton">HTTPS</button></li>
        </ul>
        <div class="input-group">
            <!-- Target -->
            <input id="github-url" value="git@github.com:grails-guides/grails-upload-file.git" type="text" />
            <!-- Trigger -->
            <button type="button" class="clippy btn btn-default" type="button" data-clipboard-target="#github-url">
                <img width="13" src="../img/clippy.svg" alt="Copy to clipboard">
            </button>
        </div>
        <script>var clipboard = new Clipboard('.clippy');</script>
        <button type="button" class="btn btn-large" onclick="window.location.href=&quot;https://github.com/grails-guides/grails-upload-file/archive/master.zip&quot;">Download ZIP</button>
        
        <div id="table-of-content">
            <h3>Table of Contents</h3>
            
            <div class="toc-item" style="margin-left:0px"><a href="#training"><strong>1</strong><span>Grails Training</span></a></div>
            
            <div class="toc-item" style="margin-left:0px"><a href="#gettingStarted"><strong>2</strong><span>Getting Started</span></a></div>
            
            <div class="toc-item" style="margin-left:10px"><a href="#requirements"><strong>2.1</strong><span>What you will need</span></a></div>
            
            <div class="toc-item" style="margin-left:10px"><a href="#howto"><strong>2.2</strong><span>How to complete the guide</span></a></div>
            
            <div class="toc-item" style="margin-left:0px"><a href="#writingTheApp"><strong>3</strong><span>Writing the Application</span></a></div>
            
            <div class="toc-item" style="margin-left:10px"><a href="#featuredImageCommand"><strong>3.1</strong><span>Featured Image Command Object</span></a></div>
            
            <div class="toc-item" style="margin-left:10px"><a href="#increaseFileSize"><strong>3.2</strong><span>Increase allowed file size</span></a></div>
            
            <div class="toc-item" style="margin-left:0px"><a href="#restaurant"><strong>4</strong><span>Restaurant - Upload and save as byte[]</span></a></div>
            
            <div class="toc-item" style="margin-left:10px"><a href="#restaurantDomainClass"><strong>4.1</strong><span>Restaurant Domain Class</span></a></div>
            
            <div class="toc-item" style="margin-left:10px"><a href="#restaurantView"><strong>4.2</strong><span>Restaurant Views</span></a></div>
            
            <div class="toc-item" style="margin-left:10px"><a href="#restaurantUploadFeaturedImageService"><strong>4.3</strong><span>Upload Featured Image Service</span></a></div>
            
            <div class="toc-item" style="margin-left:10px"><a href="#loadByteArrayImage"><strong>4.4</strong><span>Load byte array Image</span></a></div>
            
            <div class="toc-item" style="margin-left:0px"><a href="#pointOfInterest"><strong>5</strong><span>Point of Interest - Upload and transfer</span></a></div>
            
            <div class="toc-item" style="margin-left:10px"><a href="#pointOfInterestDomainClass"><strong>5.1</strong><span>Point of Interest Domain Class</span></a></div>
            
            <div class="toc-item" style="margin-left:10px"><a href="#pointOfInterestView"><strong>5.2</strong><span>Point of Interest  Views</span></a></div>
            
            <div class="toc-item" style="margin-left:10px"><a href="#pointOfInterestUploadFeaturedImageService"><strong>5.3</strong><span>Upload Featured Image Service</span></a></div>
            
            <div class="toc-item" style="margin-left:0px"><a href="#awsS3"><strong>6</strong><span>Hotel - Upload to AWS S3</span></a></div>
            
            <div class="toc-item" style="margin-left:10px"><a href="#hotelDomainClass"><strong>6.1</strong><span>Hotel Domain Class</span></a></div>
            
            <div class="toc-item" style="margin-left:10px"><a href="#hotelView"><strong>6.2</strong><span>Hotel Views</span></a></div>
            
            <div class="toc-item" style="margin-left:10px"><a href="#hotelUploadFeaturedImageService"><strong>6.3</strong><span>Upload image to S3</span></a></div>
            
            <div class="toc-item" style="margin-left:10px"><a href="#awsAccessAndSecret"><strong>6.4</strong><span>Run the App with AWS Access and Secret</span></a></div>
            
            <div class="toc-item" style="margin-left:0px"><a href="#helpWithGrails"><strong>7</strong><span>Do you need help with Grails?</span></a></div>
            
            <div style="clear:both" ></div>
        </div>
        
    </aside>
    <header>
        <h1>How to upload a file with Grails 4</h1>
        <p>Learn how to upload files with Grails 4; transfer them to a folder, save them as byte[] in the database or upload them to AWS S3.</p>
        <p><strong>Authors:</strong> Sergio del Amo</p>
        <p><strong>Grails Version:</strong> 4.0.1</p>
    </header>
    

<h1 id="training">1 Grails Training</h1>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails-guides/grails-upload-file/edit/master/src/main/docs/guide/training.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p><strong>Grails Training</strong> - Developed and delivered by the folks who created and actively maintain the Grails framework!.</p>
</div>
<div id="ocitraining"></div>
<script type="text/javascript">
var getJSON = function(url, callback) {
    var xhr = new XMLHttpRequest();
    xhr.open('GET', url, true);
    xhr.responseType = 'json';
    xhr.onload = function() {
      var status = xhr.status;
      if (status == 200) {
        callback(null, xhr.response);
      } else {
        callback(status);
      }
    };
    xhr.send();
};
getJSON('https://training.grails.org/training', function(err, data) {
  var msg = '';
  if (err != null) {
      msg = 'Something went wrong while retrieving OCI training offerings';

  } else {
      if ( data.length == 0 ) {
         msg = '<p><b>Nothing scheduled at the moment - please check back again soon!</b></p>.';

      } else {
        msg += '<table>';
        msg += '<thead>';
        msg += '<tr><th>Course</th><th>Date(s)</th><th>Instructor(s)</th><th>Hour(s)</th></tr>';
        msg += '</thead>';
        msg += '<tbody>';

        var hrefs = new Array();
        for (var i = 0; i < data.length; i++) {
            var href = data[i].enrollmentLink;
            if (hrefs.indexOf(href) == -1) {
                msg += '<tr><td><a href="'+ href + '">'+ data[i].course + '</a></td><td>'+ data[i].dates + '</td><td>'+ data[i].instructors + '</td><td>'+ data[i].hours + '</td></tr>';
                hrefs.push(href);
            }

        }
        msg += '</tbody>';
        msg += '</table>';
      }
  }
  var ociTraining = document.getElementById("ocitraining");
  ociTraining.innerHTML = msg;
});
</script>


<h1 id="gettingStarted">2 Getting Started</h1>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails-guides/grails-upload-file/edit/master/src/main/docs/guide/gettingStarted.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>In this guide, you are going to write three different domain classes. Moreover, you are going to write controllers, services, and views associated with them.</p>
</div>
<div class="paragraph">
<p>We are going to explore different ways to save the uploaded files; byte[] in the database, local folder or remote server (AWS S3).</p>
</div>
<div class="paragraph">
<p>We are going to use a Command Object to allow only images ( JPG or PNG ) uploads.</p>
</div>


<h2 id="requirements">2.1 What you will need</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails-guides/grails-upload-file/edit/master/src/main/docs/guide/requirements.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>To complete this guide, you will need the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Some time on your hands</p>
</li>
<li>
<p>A decent text editor or IDE</p>
</li>
<li>
<p>JDK 1.8 or greater installed with <code>JAVA_HOME</code> configured appropriately</p>
</li>
</ul>
</div>


<h2 id="howto">2.2 How to complete the guide</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails-guides/grails-upload-file/edit/master/src/main/docs/guide/howto.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>To get started do the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://github.com/grails-guides/grails-upload-file/archive/master.zip">Download</a> and unzip the source</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>or</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Clone the <a href="https://git-scm.com/">Git</a> repository:<br>
<code>git clone <a href="https://github.com/grails-guides/grails-upload-file.git" class="bare">https://github.com/grails-guides/grails-upload-file.git</a></code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The Grails guides repositories contain two folders:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>initial</code>  Initial project. Often a simple Grails app with some additional code to give you a head-start.</p>
</li>
<li>
<p><code>complete</code> A completed example. It is the result of working through the steps presented by the guide and applying those changes to the <code>initial</code> folder.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>To complete the guide, go to the <code>initial</code> folder</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>cd</code> into <code>grails-guides/grails-upload-file/initial</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>and follow the instructions in the next sections.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
You can go right to the <strong>completed example</strong> if you <code>cd</code> into <code>grails-guides/grails-upload-file/complete</code>
</td>
</tr>
</table>
</div>


<h1 id="writingTheApp">3 Writing the Application</h1>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails-guides/grails-upload-file/edit/master/src/main/docs/guide/writingTheApp.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>The <code>initial</code> folder contains a Grails 4 application created with the <code>web</code> profile.
It has several Controllers, GORM Data Services, Domain classes and a simple CRUD interface built with <a href="http://gsp.grails.org">GSP</a>s.
It is an app to list tourism resources; hotels, restaurants, and points of interest.</p>
</div>
<div class="paragraph">
<p>In the next sections, you are going to add a feature to the app. Each of those resources may include a
 featured image.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>For restaurants, we are going to store the image bytes directly in the domain class.</p>
</li>
<li>
<p>For points of interest, we transfer the file to a folder.</p>
</li>
<li>
<p>For hotels, we upload the file to AWS S3.</p>
</li>
</ul>
</div>


<h2 id="featuredImageCommand">3.1 Featured Image Command Object</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails-guides/grails-upload-file/edit/master/src/main/docs/guide/featuredImageCommand.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Each of our application entities ( hotels, restaurants and point of interest )  will have a featured image.</p>
</div>
<div class="paragraph">
<p>To encapsulate the validation of the file being uploaded; we use a <a href="http://guides.grails.org/command-objects-and-forms/guide/index.html">Grails Command Object</a></p>
</div>
<div class="listingblock">
<div class="title">/grails-app/controllers/example/grails/FeaturedImageCommand.groovy</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">package</span> example.grails

<span class="keyword">import</span> <span class="include">grails.validation.Validateable</span>
<span class="keyword">import</span> <span class="include">org.springframework.web.multipart.MultipartFile</span>

<span class="type">class</span> <span class="class">FeaturedImageCommand</span> <span class="directive">implements</span> Validateable {
    MultipartFile featuredImageFile
    <span class="predefined-type">Long</span> id
    <span class="predefined-type">Integer</span> version

    <span class="directive">static</span> constraints = {
        id <span class="key">nullable</span>: <span class="predefined-constant">false</span>
        version <span class="key">nullable</span>: <span class="predefined-constant">false</span>
        featuredImageFile  <span class="key">validator</span>: { val, obj -&gt;
            <span class="keyword">if</span> ( val == <span class="predefined-constant">null</span> ) {
                <span class="keyword">return</span> <span class="predefined-constant">false</span>
            }
            <span class="keyword">if</span> ( val.empty ) {
                <span class="keyword">return</span> <span class="predefined-constant">false</span>
            }

            [<span class="string"><span class="delimiter">'</span><span class="content">jpeg</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">jpg</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">png</span><span class="delimiter">'</span></span>].any { extension -&gt; <i class="conum" data-value="1"></i><b>(1)</b>
                 val.originalFilename?.toLowerCase()?.endsWith(extension)
            }
        }
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Only files ending with JPG or PNG are allowed</td>
</tr>
</table>
</div>


<h2 id="increaseFileSize">3.2 Increase allowed file size</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails-guides/grails-upload-file/edit/master/src/main/docs/guide/increaseFileSize.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Grails 4&#8217;s default file size is 128000 (~128KB).</p>
</div>
<div class="paragraph">
<p>We are going to allow 25MB files uploads.</p>
</div>
<div class="paragraph">
<p>25 * 1024 * 1024 = 26.214.400 bytes</p>
</div>
<div class="listingblock">
<div class="title">/grails-app/conf/application.yml</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="key">grails</span>:
 <span class="key">controllers</span>:
  <span class="key">upload</span>:
    <span class="key">maxFileSize</span>: <span class="integer">26214400</span>
    <span class="key">maxRequestSize</span>: <span class="integer">26214400</span></code></pre>
</div>
</div>


<h1 id="restaurant">4 Restaurant - Upload and save as byte[]</h1>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails-guides/grails-upload-file/edit/master/src/main/docs/guide/restaurant.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>This part of the Guide illustrates how to upload a file to a Grails server
app and store the file&#8217;s bytes in the database.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../img/bytearray.png" alt="bytearray">
</div>
</div>


<h2 id="restaurantDomainClass">4.1 Restaurant Domain Class</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails-guides/grails-upload-file/edit/master/src/main/docs/guide/restaurantDomainClass.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Modify <code>Restaurant</code> domain class. Add two properties <code>featuredImageBytes</code> and
<code>featuredImageContentType</code>.</p>
</div>
<div class="listingblock">
<div class="title">/grails-app/domain/example/grails/Restaurant.groovy</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">package</span> example.grails

<span class="type">class</span> <span class="class">Restaurant</span> {
    <span class="predefined-type">String</span> name
    <span class="type">byte</span><span class="type">[]</span> featuredImageBytes <i class="conum" data-value="1"></i><b>(1)</b>
    <span class="predefined-type">String</span> featuredImageContentType <i class="conum" data-value="2"></i><b>(2)</b>

    <span class="directive">static</span> constraints = {
        featuredImageBytes <span class="key">nullable</span>: <span class="predefined-constant">true</span>
        featuredImageContentType <span class="key">nullable</span>: <span class="predefined-constant">true</span>
    }

    <span class="directive">static</span> mapping = {
        featuredImageBytes <span class="key">column</span>: <span class="string"><span class="delimiter">'</span><span class="content">featured_image_bytes</span><span class="delimiter">'</span></span>, <span class="key">sqlType</span>: <span class="string"><span class="delimiter">'</span><span class="content">longblob</span><span class="delimiter">'</span></span> <i class="conum" data-value="3"></i><b>(3)</b>
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Use a domain class property to store the bytes of the image in the database</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Content-Type of the image. E.g. 'image/jpeg'</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Images may be big files; we use the mapping closure to configure the sqlType</td>
</tr>
</table>
</div>


<h2 id="restaurantView">4.2 Restaurant Views</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails-guides/grails-upload-file/edit/master/src/main/docs/guide/restaurantView.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>We are going to modify the views slightly to include functionality which enables to upload a featured image.</p>
</div>
<div class="paragraph">
<p>In the restaurant&#8217;s listing, display only the restaurant&#8217;s name in the table. Checkout the <a href="http://grails3-plugins.github.io/fields/snapshot/ref/Tags/table.html">Fields Plugin f:table</a> documentation.</p>
</div>
<div class="listingblock">
<div class="title">/grails-app/views/restaurant/index.gsp</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">&lt;<span class="key">f</span>:table collection=<span class="string"><span class="delimiter">&quot;</span><span class="inline"><span class="inline-delimiter">${</span>restaurantList<span class="inline-delimiter">}</span></span><span class="delimiter">&quot;</span></span> properties=<span class="string"><span class="delimiter">&quot;</span><span class="content">['name']</span><span class="delimiter">&quot;</span></span>/&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Edit and create form will not allow users to set featured image&#8217;s content type or byte[]</p>
</div>
<div class="listingblock">
<div class="title">/grails-app/views/restaurant/create.gsp</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">&lt;<span class="key">f</span>:all bean=<span class="string"><span class="delimiter">&quot;</span><span class="content">restaurant</span><span class="delimiter">&quot;</span></span> except=<span class="string"><span class="delimiter">&quot;</span><span class="content">featuredImageBytes,featuredImageContentType</span><span class="delimiter">&quot;</span></span>/&gt;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">/grails-app/views/restaurant/edit.gsp</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">&lt;<span class="key">f</span>:all bean=<span class="string"><span class="delimiter">&quot;</span><span class="content">restaurant</span><span class="delimiter">&quot;</span></span> except=<span class="string"><span class="delimiter">&quot;</span><span class="content">featuredImageBytes,featuredImageContentType</span><span class="delimiter">&quot;</span></span>/&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the show restaurant page, add a button which takes the user to a featured image edit page.</p>
</div>
<div class="listingblock">
<div class="title">/grails-app/views/restaurant/show.gsp</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">&lt;<span class="key">g</span>:link <span class="type">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">edit</span><span class="delimiter">&quot;</span></span> <span class="class">action</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">editFeaturedImage</span><span class="delimiter">&quot;</span></span> resource=<span class="string"><span class="delimiter">&quot;</span><span class="inline"><span class="inline-delimiter">${</span><span class="local-variable">this</span>.restaurant<span class="inline-delimiter">}</span></span><span class="delimiter">&quot;</span></span>&gt;&lt;<span class="key">g</span>:message code=<span class="string"><span class="delimiter">&quot;</span><span class="content">restaurant.featuredImageUrl.edit.label</span><span class="delimiter">&quot;</span></span> <span class="keyword">default</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Edit Featured Image</span><span class="delimiter">&quot;</span></span> /&gt;&lt;<span class="regexp"><span class="delimiter">/</span><span class="content">g:link&gt;</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Modify <code>RestaurantController</code>. Add <code>editFeaturedImage</code> controller&#8217;s action:</p>
</div>
<div class="listingblock">
<div class="title">/grails-app/controllers/example/grails/RestaurantController.groovy</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">def</span> <span class="function">editFeaturedImage</span>(<span class="predefined-type">Long</span> id) {
    Restaurant restaurant = restaurantDataService.get(id)
    <span class="keyword">if</span> (!restaurant) {
        notFound()
    }
    [<span class="key">restaurant</span>: restaurant]
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>editFeaturedImage</code> GSP is identical to <code>edit</code> GSP but it uses an <code>g:uploadForm</code> instead of a <code>g:form</code></p>
</div>
<div class="listingblock">
<div class="title">/grails-app/views/restaurant/editFeaturedImage.gsp</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">&lt;<span class="key">g</span>:uploadForm name=<span class="string"><span class="delimiter">&quot;</span><span class="content">uploadFeaturedImage</span><span class="delimiter">&quot;</span></span> action=<span class="string"><span class="delimiter">&quot;</span><span class="content">uploadFeaturedImage</span><span class="delimiter">&quot;</span></span>&gt;
    &lt;<span class="key">g</span>:hiddenField name=<span class="string"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span> value=<span class="string"><span class="delimiter">&quot;</span><span class="inline"><span class="inline-delimiter">${</span><span class="local-variable">this</span>.restaurant?.id<span class="inline-delimiter">}</span></span><span class="delimiter">&quot;</span></span> /&gt;
    &lt;<span class="key">g</span>:hiddenField name=<span class="string"><span class="delimiter">&quot;</span><span class="content">version</span><span class="delimiter">&quot;</span></span> value=<span class="string"><span class="delimiter">&quot;</span><span class="inline"><span class="inline-delimiter">${</span><span class="local-variable">this</span>.restaurant?.version<span class="inline-delimiter">}</span></span><span class="delimiter">&quot;</span></span> /&gt;
    &lt;input type=<span class="string"><span class="delimiter">&quot;</span><span class="content">file</span><span class="delimiter">&quot;</span></span> name=<span class="string"><span class="delimiter">&quot;</span><span class="content">featuredImageFile</span><span class="delimiter">&quot;</span></span> /&gt;
    &lt;fieldset <span class="type">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">buttons</span><span class="delimiter">&quot;</span></span>&gt;
        &lt;<span class="class">input</span> <span class="type">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">save</span><span class="delimiter">&quot;</span></span> <span class="class">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">submit</span><span class="delimiter">&quot;</span></span> value=<span class="string"><span class="delimiter">&quot;</span><span class="inline"><span class="inline-delimiter">${</span>message(<span class="key">code</span>: <span class="string"><span class="delimiter">'</span><span class="content">restaurant.featuredImage.upload.label</span><span class="delimiter">'</span></span>, <span class="keyword">default</span>: <span class="string"><span class="delimiter">'</span><span class="content">Upload</span><span class="delimiter">'</span></span>)<span class="inline-delimiter">}</span></span><span class="delimiter">&quot;</span></span> /&gt;
    &lt;<span class="regexp"><span class="delimiter">/</span><span class="content">fieldset&gt;</span></span><span class="error">
</span>&lt;<span class="regexp"><span class="delimiter">/</span><span class="content">g:uploadForm&gt;</span></span></code></pre>
</div>
</div>


<h2 id="restaurantUploadFeaturedImageService">4.3 Upload Featured Image Service</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails-guides/grails-upload-file/edit/master/src/main/docs/guide/restaurantUploadFeaturedImageService.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>The <code>uploadFeatureImage</code> controller&#8217;s action uses the previously described command
object to validate the upload form submission. If it does not find validation errors, it invokes a <a href="http://gorm.grails.org/6.1.x/hibernate/manual/#dataServices">Gorm Data Service</a>.</p>
</div>
<div class="listingblock">
<div class="title">/grails-app/controllers/example/grails/RestaurantController.groovy</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">    <span class="keyword">def</span> <span class="function">uploadFeaturedImage</span>(FeaturedImageCommand cmd) {
        <span class="keyword">if</span> (cmd == <span class="predefined-constant">null</span>) {
            notFound()
            <span class="keyword">return</span>
        }

        <span class="keyword">if</span> (cmd.hasErrors()) {
            respond(cmd.errors, <span class="key">model</span>: [<span class="key">restaurant</span>: cmd], <span class="key">view</span>: <span class="string"><span class="delimiter">'</span><span class="content">editFeaturedImage</span><span class="delimiter">'</span></span>)
            <span class="keyword">return</span>
        }

        Restaurant restaurant = restaurantDataService.update(cmd.id,
                cmd.version,
                cmd.featuredImageFile.bytes,
                cmd.featuredImageFile.contentType)

        <span class="keyword">if</span> (restaurant == <span class="predefined-constant">null</span>) {
            notFound()
            <span class="keyword">return</span>
        }

        <span class="keyword">if</span> (restaurant.hasErrors()) {
            respond(restaurant.errors, <span class="key">model</span>: [<span class="key">restaurant</span>: restaurant], <span class="key">view</span>: <span class="string"><span class="delimiter">'</span><span class="content">editFeaturedImage</span><span class="delimiter">'</span></span>)
            <span class="keyword">return</span>
        }

        <span class="predefined-type">Locale</span> locale = request.locale
        flash.message = crudMessageService.message(CRUD.UPDATE, domainName(locale), cmd.id, locale)
        redirect restaurant
    }</code></pre>
</div>
</div>
<div class="paragraph">
<p>The complete GORM Data Service is shown in the following code snippet:</p>
</div>
<div class="listingblock">
<div class="title">/grails-app/services/example/grails/RestaurantDataService.groovy</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">package</span> example.grails

<span class="keyword">import</span> <span class="include">grails.gorm.services.Service</span>

<span class="annotation">@Service</span>(Restaurant)
<span class="type">interface</span> RestaurantDataService {
    Restaurant get(<span class="predefined-type">Long</span> id)
    <span class="predefined-type">List</span>&lt;Restaurant&gt; list(<span class="predefined-type">Map</span> args)
    <span class="predefined-type">Number</span> count()
    <span class="type">void</span> delete(<span class="predefined-type">Serializable</span> id)
    Restaurant update(<span class="predefined-type">Serializable</span> id, <span class="predefined-type">Long</span> version, <span class="predefined-type">String</span> name)
    Restaurant update(<span class="predefined-type">Serializable</span> id, <span class="predefined-type">Long</span> version, <span class="type">byte</span><span class="type">[]</span> featuredImageBytes, <span class="predefined-type">String</span> featuredImageContentType) <i class="conum" data-value="1"></i><b>(1)</b>
    Restaurant save(<span class="predefined-type">String</span> name)
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The first argument should be the id of the object to update. If any of the parameters donâ€™t match up to a property on the domain class then a compilation error will occur.</td>
</tr>
</table>
</div>


<h2 id="loadByteArrayImage">4.4 Load byte array Image</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails-guides/grails-upload-file/edit/master/src/main/docs/guide/loadByteArrayImage.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Create an action in <code>RestaurantController</code> which renders the restaurant&#8217;s featured image:</p>
</div>
<div class="listingblock">
<div class="title">/grails-app/controllers/example/grails/RestaurantController.groovy</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">def</span> <span class="function">featuredImage</span>(<span class="predefined-type">Long</span> id) {
    Restaurant restaurant = restaurantDataService.get(id)
    <span class="keyword">if</span> (!restaurant || restaurant.featuredImageBytes == <span class="predefined-constant">null</span>) {
        notFound()
        <span class="keyword">return</span>
    }
    render <span class="key">file</span>: restaurant.featuredImageBytes,
        <span class="key">contentType</span>: restaurant.featuredImageContentType
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Use the <code>g:createLink</code> GSP tag to reference the previous controller action in the <em>img</em> <em>src</em> attribute.</p>
</div>
<div class="listingblock">
<div class="title">/grails-app/views/restaurant/show.gsp</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">&lt;h1&gt;&lt;<span class="key">f</span>:display bean=<span class="string"><span class="delimiter">&quot;</span><span class="content">restaurant</span><span class="delimiter">&quot;</span></span> property=<span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span> /&gt;&lt;<span class="regexp"><span class="delimiter">/</span><span class="content">h1&gt;</span></span><span class="error">
</span>&lt;<span class="key">g</span>:<span class="keyword">if</span> test=<span class="string"><span class="delimiter">&quot;</span><span class="inline"><span class="inline-delimiter">${</span><span class="local-variable">this</span>.restaurant.featuredImageBytes<span class="inline-delimiter">}</span></span><span class="delimiter">&quot;</span></span>&gt;
    &lt;img src=<span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;g:createLink controller=</span><span class="delimiter">&quot;</span></span>restaurant<span class="string"><span class="delimiter">&quot;</span><span class="content"> action=</span><span class="delimiter">&quot;</span></span>featuredImage<span class="string"><span class="delimiter">&quot;</span><span class="content"> id=</span><span class="delimiter">&quot;</span></span><span class="error">$</span>{<span class="local-variable">this</span>.restaurant.id}<span class="string"><span class="delimiter">&quot;</span><span class="content">/&gt;</span><span class="delimiter">&quot;</span></span> width=<span class="string"><span class="delimiter">&quot;</span><span class="content">400</span><span class="delimiter">&quot;</span></span>/&gt;
&lt;<span class="regexp"><span class="delimiter">/</span><span class="content">g:if&gt;</span></span></code></pre>
</div>
</div>


<h1 id="pointOfInterest">5 Point of Interest - Upload and transfer</h1>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails-guides/grails-upload-file/edit/master/src/main/docs/guide/pointOfInterest.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>In this part of this guide, we have separated the Grails application from the uploaded images.
We use <a href="https://www.mamp.info">MAMP</a> to run a local apache server at port 8888 pointing to the folder data.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../img/transfer.png" alt="transfer">
</div>
</div>


<h2 id="pointOfInterestDomainClass">5.1 Point of Interest Domain Class</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails-guides/grails-upload-file/edit/master/src/main/docs/guide/pointOfInterestDomainClass.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Modify <code>PointOfInterest</code> domain class. Add a property <code>featuredImageUrl</code></p>
</div>
<div class="listingblock">
<div class="title">/grails-app/domain/example/grails/PointOfInterest.groovy</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">package</span> example.grails

<span class="type">class</span> <span class="class">PointOfInterest</span> {
    <span class="predefined-type">String</span> name
    <span class="predefined-type">String</span> featuredImageUrl <i class="conum" data-value="1"></i><b>(1)</b>

    <span class="directive">static</span> constraints = {
        featuredImageUrl <span class="key">nullable</span>: <span class="predefined-constant">true</span>
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Use this property to save the url where the image can be retrieved.</td>
</tr>
</table>
</div>


<h2 id="pointOfInterestView">5.2 Point of Interest  Views</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails-guides/grails-upload-file/edit/master/src/main/docs/guide/pointOfInterestView.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>We are going to modify the GSP views slightly to include functionality which enables to upload a featured image.</p>
</div>
<div class="paragraph">
<p>In Point of Interest&#8217;s listing, display only the hotel&#8217;s name in the table. Checkout the <a href="http://grails3-plugins.github.io/fields/snapshot/ref/Tags/table.html">Fields Plugin f:table</a> documentation.</p>
</div>
<div class="listingblock">
<div class="title">/grails-app/views/pointOfInterest/index.gsp</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">&lt;<span class="key">f</span>:table collection=<span class="string"><span class="delimiter">&quot;</span><span class="inline"><span class="inline-delimiter">${</span>pointOfInterestList<span class="inline-delimiter">}</span></span><span class="delimiter">&quot;</span></span> properties=<span class="string"><span class="delimiter">&quot;</span><span class="content">['name']</span><span class="delimiter">&quot;</span></span>/&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Edit and create form will not allow users to set featured image&#8217;s url</p>
</div>
<div class="listingblock">
<div class="title">/grails-app/views/pointOfInterest/create.gsp</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">&lt;<span class="key">f</span>:all bean=<span class="string"><span class="delimiter">&quot;</span><span class="content">pointOfInterest</span><span class="delimiter">&quot;</span></span> except=<span class="string"><span class="delimiter">&quot;</span><span class="content">featuredImageUrl</span><span class="delimiter">&quot;</span></span>/&gt;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">/grails-app/views/pointOfInterest/edit.gsp</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">&lt;<span class="key">f</span>:all bean=<span class="string"><span class="delimiter">&quot;</span><span class="content">pointOfInterest</span><span class="delimiter">&quot;</span></span> except=<span class="string"><span class="delimiter">&quot;</span><span class="content">featuredImageUrl</span><span class="delimiter">&quot;</span></span>/&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Instead we add a button which takes the user to a featured image edit page.</p>
</div>
<div class="listingblock">
<div class="title">/grails-app/views/pointOfInterest/show.gsp</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">&lt;<span class="key">g</span>:link <span class="type">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">edit</span><span class="delimiter">&quot;</span></span> <span class="class">action</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">editFeaturedImage</span><span class="delimiter">&quot;</span></span> resource=<span class="string"><span class="delimiter">&quot;</span><span class="inline"><span class="inline-delimiter">${</span><span class="local-variable">this</span>.pointOfInterest<span class="inline-delimiter">}</span></span><span class="delimiter">&quot;</span></span>&gt;&lt;<span class="key">g</span>:message code=<span class="string"><span class="delimiter">&quot;</span><span class="content">pointOfInterest.featuredImageUrl.edit.label</span><span class="delimiter">&quot;</span></span> <span class="keyword">default</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Edit Featured Image</span><span class="delimiter">&quot;</span></span> /&gt;&lt;<span class="regexp"><span class="delimiter">/</span><span class="content">g:link&gt;</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Modify <code>PointOfInterestController</code>. Add a controller&#8217;s action named <code>editFeaturedImage</code>:</p>
</div>
<div class="listingblock">
<div class="title">/grails-app/controllers/example/grails/PointOfInterestController.groovy</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">def</span> <span class="function">editFeaturedImage</span>(<span class="predefined-type">Long</span> id) {
    PointOfInterest pointOfInterest = pointOfInterestDataService.get(id)
    <span class="keyword">if</span> (!pointOfInterest) {
        notFound()
        <span class="keyword">return</span>
    }
    [<span class="key">pointOfInterest</span>: pointOfInterest]
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>editFeaturedImage</code> GSP is identical to <code>edit</code> GSP but it uses an <code>g:uploadForm</code> instead of a <code>g:form</code></p>
</div>
<div class="listingblock">
<div class="title">/grails-app/views/pointOfInterest/editFeaturedImage.gsp</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">&lt;<span class="key">g</span>:uploadForm name=<span class="string"><span class="delimiter">&quot;</span><span class="content">uploadFeaturedImage</span><span class="delimiter">&quot;</span></span> action=<span class="string"><span class="delimiter">&quot;</span><span class="content">uploadFeaturedImage</span><span class="delimiter">&quot;</span></span>&gt;
    &lt;<span class="key">g</span>:hiddenField name=<span class="string"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span> value=<span class="string"><span class="delimiter">&quot;</span><span class="inline"><span class="inline-delimiter">${</span><span class="local-variable">this</span>.pointOfInterest?.id<span class="inline-delimiter">}</span></span><span class="delimiter">&quot;</span></span> /&gt;
    &lt;<span class="key">g</span>:hiddenField name=<span class="string"><span class="delimiter">&quot;</span><span class="content">version</span><span class="delimiter">&quot;</span></span> value=<span class="string"><span class="delimiter">&quot;</span><span class="inline"><span class="inline-delimiter">${</span><span class="local-variable">this</span>.pointOfInterest?.version<span class="inline-delimiter">}</span></span><span class="delimiter">&quot;</span></span> /&gt;
    &lt;input type=<span class="string"><span class="delimiter">&quot;</span><span class="content">file</span><span class="delimiter">&quot;</span></span> name=<span class="string"><span class="delimiter">&quot;</span><span class="content">featuredImageFile</span><span class="delimiter">&quot;</span></span> /&gt;
    &lt;fieldset <span class="type">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">buttons</span><span class="delimiter">&quot;</span></span>&gt;
        &lt;<span class="class">input</span> <span class="type">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">save</span><span class="delimiter">&quot;</span></span> <span class="class">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">submit</span><span class="delimiter">&quot;</span></span> value=<span class="string"><span class="delimiter">&quot;</span><span class="inline"><span class="inline-delimiter">${</span>message(<span class="key">code</span>: <span class="string"><span class="delimiter">'</span><span class="content">pointOfInterest.featuredImage.upload.label</span><span class="delimiter">'</span></span>, <span class="keyword">default</span>: <span class="string"><span class="delimiter">'</span><span class="content">Upload</span><span class="delimiter">'</span></span>)<span class="inline-delimiter">}</span></span><span class="delimiter">&quot;</span></span> /&gt;
    &lt;<span class="regexp"><span class="delimiter">/</span><span class="content">fieldset&gt;</span></span><span class="error">
</span>&lt;<span class="regexp"><span class="delimiter">/</span><span class="content">g:uploadForm&gt;</span></span></code></pre>
</div>
</div>


<h2 id="pointOfInterestUploadFeaturedImageService">5.3 Upload Featured Image Service</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails-guides/grails-upload-file/edit/master/src/main/docs/guide/pointOfInterestUploadFeaturedImageService.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>The <code>uploadFeatureImage</code> controller&#8217;s action uses the previously described command
object to validate the upload form submission. If it does not find validation errors, it invokes a service.</p>
</div>
<div class="listingblock">
<div class="title">/grails-app/controllers/example/grails/PointOfInterestController.groovy</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">def</span> <span class="function">uploadFeaturedImage</span>(FeaturedImageCommand cmd) {

    <span class="keyword">if</span> (cmd.hasErrors()) {
        respond(cmd, <span class="key">model</span>: [<span class="key">pointOfInterest</span>: cmd], <span class="key">view</span>: <span class="string"><span class="delimiter">'</span><span class="content">editFeaturedImage</span><span class="delimiter">'</span></span>)
        <span class="keyword">return</span>
    }

    PointOfInterest pointOfInterest = uploadPointOfInterestFeaturedImageService.uploadFeatureImage(cmd)

    <span class="keyword">if</span> (pointOfInterest == <span class="predefined-constant">null</span>) {
        notFound()
        <span class="keyword">return</span>
    }

    <span class="keyword">if</span> (pointOfInterest.hasErrors()) {
        respond(pointOfInterest, <span class="key">model</span>: [<span class="key">pointOfInterest</span>: pointOfInterest], <span class="key">view</span>: <span class="string"><span class="delimiter">'</span><span class="content">editFeaturedImage</span><span class="delimiter">'</span></span>)
        <span class="keyword">return</span>
    }

    <span class="predefined-type">Locale</span> locale = request.locale
    flash.message = crudMessageService.message(CRUD.UPDATE, domainName(locale), pointOfInterest.id, locale)
    redirect pointOfInterest
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>We configure the local server url which will host the uploaded images and the local
folder path where we are going to save the images to.</p>
</div>
<div class="listingblock">
<div class="title">/grails-app/conf/application.yml</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="key">grails</span>:
    <span class="key">guides</span>:
        <span class="key">cdnFolder</span>: <span class="regexp"><span class="delimiter">/</span><span class="content">Users</span><span class="delimiter">/</span></span>sdelamo/Sites/GrailsGuides/UploadFiles
        <span class="key">cdnRootUrl</span>: <span class="key">http</span>:<span class="comment">//localhost:8888</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Service uses the <code>transferTo</code> method to transfer the file to a local file path.
In case of error, the service deletes the file it has previously transfered</p>
</div>
<div class="listingblock">
<div class="title">/grails-app/services/example/grails/UploadPointOfInterestFeaturedImageService.groovy</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">package</span> example.grails

<span class="keyword">import</span> <span class="include">grails.config.Config</span>
<span class="keyword">import</span> <span class="include">grails.core.support.GrailsConfigurationAware</span>
<span class="keyword">import</span> <span class="include">groovy.transform.CompileStatic</span>

<span class="annotation">@SuppressWarnings</span>(<span class="string"><span class="delimiter">'</span><span class="content">GrailsStatelessService</span><span class="delimiter">'</span></span>)
<span class="annotation">@CompileStatic</span>
<span class="type">class</span> <span class="class">UploadPointOfInterestFeaturedImageService</span> <span class="directive">implements</span> GrailsConfigurationAware {

    PointOfInterestDataService pointOfInterestDataService

    <span class="predefined-type">String</span> cdnFolder
    <span class="predefined-type">String</span> cdnRootUrl

    <span class="annotation">@Override</span>
    <span class="type">void</span> setConfiguration(Config co) {
        cdnFolder = co.getRequiredProperty(<span class="string"><span class="delimiter">'</span><span class="content">grails.guides.cdnFolder</span><span class="delimiter">'</span></span>)
        cdnRootUrl = co.getRequiredProperty(<span class="string"><span class="delimiter">'</span><span class="content">grails.guides.cdnRootUrl</span><span class="delimiter">'</span></span>)
    }

    <span class="annotation">@SuppressWarnings</span>(<span class="string"><span class="delimiter">'</span><span class="content">JavaIoPackageAccess</span><span class="delimiter">'</span></span>)
    PointOfInterest uploadFeatureImage(FeaturedImageCommand cmd) {

        <span class="predefined-type">String</span> filename = cmd.featuredImageFile.originalFilename
        <span class="predefined-type">String</span> folderPath = <span class="string"><span class="delimiter">&quot;</span><span class="inline"><span class="inline-delimiter">${</span>cdnFolder<span class="inline-delimiter">}</span></span><span class="content">/pointOfInterest/</span><span class="inline"><span class="inline-delimiter">${</span>cmd.id<span class="inline-delimiter">}</span></span><span class="delimiter">&quot;</span></span>
        <span class="predefined-type">File</span> folder = <span class="keyword">new</span> <span class="predefined-type">File</span>(folderPath)
        <span class="keyword">if</span> ( !folder.exists() ) {
            folder.mkdirs()
        }
        <span class="predefined-type">String</span> path = <span class="string"><span class="delimiter">&quot;</span><span class="inline"><span class="inline-delimiter">${</span>folderPath<span class="inline-delimiter">}</span></span><span class="content">/</span><span class="inline"><span class="inline-delimiter">${</span>filename<span class="inline-delimiter">}</span></span><span class="delimiter">&quot;</span></span>
        cmd.featuredImageFile.transferTo(<span class="keyword">new</span> <span class="predefined-type">File</span>(path))

        <span class="predefined-type">String</span> featuredImageUrl = <span class="string"><span class="delimiter">&quot;</span><span class="inline"><span class="inline-delimiter">${</span>cdnRootUrl<span class="inline-delimiter">}</span></span><span class="content">//pointOfInterest/</span><span class="inline"><span class="inline-delimiter">${</span>cmd.id<span class="inline-delimiter">}</span></span><span class="content">/</span><span class="inline"><span class="inline-delimiter">${</span>filename<span class="inline-delimiter">}</span></span><span class="delimiter">&quot;</span></span>
        PointOfInterest poi = pointOfInterestDataService.updateFeaturedImageUrl(cmd.id, cmd.version, featuredImageUrl)

        <span class="keyword">if</span> ( !poi || poi.hasErrors() ) {
            <span class="predefined-type">File</span> f = <span class="keyword">new</span> <span class="predefined-type">File</span>(path)
            f.delete()
        }
        poi
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The service updates <code>featuredImageUrl</code> with the help of a GORM Data Service:</p>
</div>
<div class="listingblock">
<div class="title">/grails-app/services/example/grails/PointOfInterestDataService.groovy</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">package</span> example.grails

<span class="keyword">import</span> <span class="include">grails.gorm.services.Service</span>

<span class="annotation">@SuppressWarnings</span>([<span class="string"><span class="delimiter">'</span><span class="content">LineLength</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">UnusedVariable</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">SpaceAfterOpeningBrace</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">SpaceBeforeClosingBrace</span><span class="delimiter">'</span></span>])
<span class="annotation">@Service</span>(PointOfInterest)
<span class="type">interface</span> PointOfInterestDataService {

    PointOfInterest get(<span class="predefined-type">Long</span> id)

    <span class="predefined-type">List</span>&lt;PointOfInterest&gt; list(<span class="predefined-type">Map</span> args)

    <span class="predefined-type">Number</span> count()

    <span class="type">void</span> delete(<span class="predefined-type">Serializable</span> id)

    PointOfInterest save(<span class="predefined-type">String</span> name)

    PointOfInterest updateName(<span class="predefined-type">Serializable</span> id, <span class="predefined-type">Long</span> version, <span class="predefined-type">String</span> name)

    PointOfInterest updateFeaturedImageUrl(<span class="predefined-type">Serializable</span> id, <span class="predefined-type">Long</span> version, <span class="predefined-type">String</span> featuredImageUrl)
}</code></pre>
</div>
</div>


<h1 id="awsS3">6 Hotel - Upload to AWS S3</h1>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails-guides/grails-upload-file/edit/master/src/main/docs/guide/awsS3.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>For <code>Hotel</code> domain class we are going to upload the file to <a href="https://aws.amazon.com/s3/">Amazon AWS S3</a>.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../img/s3.png" alt="s3">
</div>
</div>
<div class="paragraph">
<p>First, Install <a href="https://github.com/agorapulse/grails-aws-sdk/tree/master/grails-aws-sdk-s3">Grails AWS SDK S3 Plugin</a></p>
</div>
<div class="paragraph">
<p>Modify you <code>build.grade</code> file</p>
</div>
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">repositories {
...
..
    maven { url <span class="string"><span class="delimiter">'</span><span class="content">http://dl.bintray.com/agorapulse/libs</span><span class="delimiter">'</span></span> }
}
dependencies {
...
..
.
    compile <span class="string"><span class="delimiter">&quot;</span><span class="content">org.grails.plugins:aws-sdk-s3:</span><span class="inline"><span class="inline-delimiter">$</span>awsSdkS3Version</span><span class="delimiter">&quot;</span></span>
    compile <span class="string"><span class="delimiter">&quot;</span><span class="content">com.amazonaws:aws-java-sdk-s3:1.11.375</span><span class="delimiter">&quot;</span></span>
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Define <code>awsSdkS3Version</code> in <code>gradle.properties</code></p>
</div>
<div class="listingblock">
<div class="title">gradle.properties</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">grailsVersion=<span class="float">4.0</span><span class="float">.1</span>
gormVersion=<span class="float">7.0</span><span class="float">.2</span>.RELEASE
hibernateCoreVersion=<span class="float">5.4</span><span class="float">.0</span>.Final
gebVersion=<span class="float">3.2</span>
htmlunitDriverVersion=<span class="float">2.47</span><span class="float">.1</span>
htmlunitVersion=<span class="float">2.35</span><span class="float">.0</span>
assetPipelineVersion=<span class="float">3.0</span><span class="float">.11</span>
awsSdkS3Version=<span class="float">2.2</span><span class="float">.4</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>We are going to upload our files to an already existing bucket.</p>
</div>
<div class="listingblock">
<div class="title">/grails-app/conf/application.yml</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="key">grails</span>:
    <span class="key">plugins</span>:
        <span class="key">awssdk</span>:
            <span class="key">s3</span>:
                <span class="key">region</span>: eu-west-<span class="integer">1</span>
                <span class="key">bucket</span>: grails-guides</code></pre>
</div>
</div>


<h2 id="hotelDomainClass">6.1 Hotel Domain Class</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails-guides/grails-upload-file/edit/master/src/main/docs/guide/hotelDomainClass.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Modify <code>Hotel</code> domain class. Add two properties <code>featuredImageKey</code> and <code>featuredImageUrl`</code></p>
</div>
<div class="listingblock">
<div class="title">/grails-app/domain/example/grails/Hotel.groovy</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">package</span> example.grails

<span class="type">class</span> <span class="class">Hotel</span> {

    <span class="predefined-type">String</span> name
    <span class="predefined-type">String</span> featuredImageUrl <i class="conum" data-value="1"></i><b>(1)</b>
    <span class="predefined-type">String</span> featuredImageKey <i class="conum" data-value="2"></i><b>(2)</b>

    <span class="directive">static</span> constraints = {
        featuredImageUrl <span class="key">nullable</span>: <span class="predefined-constant">true</span>
        featuredImageKey <span class="key">nullable</span>: <span class="predefined-constant">true</span>
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>We store the AWS S3 url of the featured image</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>We store the file path. Useful to delete the file if necessary.</td>
</tr>
</table>
</div>


<h2 id="hotelView">6.2 Hotel Views</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails-guides/grails-upload-file/edit/master/src/main/docs/guide/hotelView.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>We are going to modify the views slightly to include functionality which enables to upload a featured image.</p>
</div>
<div class="paragraph">
<p>In Hotel&#8217;s listing, display only the hotel&#8217;s name in the table. Checkout the <a href="http://grails3-plugins.github.io/fields/snapshot/ref/Tags/table.html">Fields Plugin f:table</a> documentation.</p>
</div>
<div class="listingblock">
<div class="title">/grails-app/views/hotel/index.gsp</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">&lt;<span class="key">f</span>:table collection=<span class="string"><span class="delimiter">&quot;</span><span class="inline"><span class="inline-delimiter">${</span>hotelList<span class="inline-delimiter">}</span></span><span class="delimiter">&quot;</span></span> properties=<span class="string"><span class="delimiter">&quot;</span><span class="content">['name']</span><span class="delimiter">&quot;</span></span>/&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Edit and create form will not allow users to set featured image&#8217;s url</p>
</div>
<div class="listingblock">
<div class="title">/grails-app/views/hotel/create.gsp</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">&lt;<span class="key">f</span>:all bean=<span class="string"><span class="delimiter">&quot;</span><span class="content">hotel</span><span class="delimiter">&quot;</span></span> except=<span class="string"><span class="delimiter">&quot;</span><span class="content">featuredImageUrl,featuredImageKey</span><span class="delimiter">&quot;</span></span>/&gt;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">/grails-app/views/hotel/edit.gsp</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">&lt;<span class="key">f</span>:all bean=<span class="string"><span class="delimiter">&quot;</span><span class="content">hotel</span><span class="delimiter">&quot;</span></span> except=<span class="string"><span class="delimiter">&quot;</span><span class="content">featuredImageUrl,featuredImageKey</span><span class="delimiter">&quot;</span></span>/&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Instead we add a button which takes the user to a featured image edit page.</p>
</div>
<div class="listingblock">
<div class="title">/grails-app/views/hotel/show.gsp</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">&lt;<span class="key">g</span>:link <span class="type">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">edit</span><span class="delimiter">&quot;</span></span> <span class="class">action</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">edit</span><span class="delimiter">&quot;</span></span> resource=<span class="string"><span class="delimiter">&quot;</span><span class="inline"><span class="inline-delimiter">${</span><span class="local-variable">this</span>.hotel<span class="inline-delimiter">}</span></span><span class="delimiter">&quot;</span></span>&gt;&lt;<span class="key">g</span>:message code=<span class="string"><span class="delimiter">&quot;</span><span class="content">default.button.edit.label</span><span class="delimiter">&quot;</span></span> <span class="keyword">default</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Edit</span><span class="delimiter">&quot;</span></span> /&gt;&lt;<span class="regexp"><span class="delimiter">/</span><span class="content">g:link&gt;</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Modify <code>HotelController</code>. Add a controller&#8217;s action named <code>editFeaturedImage</code>:</p>
</div>
<div class="listingblock">
<div class="title">/grails-app/controllers/example/grails/HotelController.groovy</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">def</span> <span class="function">editFeaturedImage</span>(<span class="predefined-type">Long</span> id) {
    Hotel hotel = hotelDataService.get(id)
    <span class="keyword">if</span> (!hotel) {
        notFound()
        <span class="keyword">return</span>
    }
    [<span class="key">hotel</span>: hotel]
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>editFeaturedImage</code> GSP is identical to <code>edit</code> GSP but it uses an <code>g:uploadForm</code> instead of a <code>g:form</code></p>
</div>
<div class="listingblock">
<div class="title">/grails-app/views/hotel/editFeaturedImage.gsp</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">&lt;<span class="key">g</span>:uploadForm name=<span class="string"><span class="delimiter">&quot;</span><span class="content">uploadFeaturedImage</span><span class="delimiter">&quot;</span></span> action=<span class="string"><span class="delimiter">&quot;</span><span class="content">uploadFeaturedImage</span><span class="delimiter">&quot;</span></span>&gt;
    &lt;<span class="key">g</span>:hiddenField name=<span class="string"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span> value=<span class="string"><span class="delimiter">&quot;</span><span class="inline"><span class="inline-delimiter">${</span><span class="local-variable">this</span>.hotel?.id<span class="inline-delimiter">}</span></span><span class="delimiter">&quot;</span></span> /&gt;
    &lt;<span class="key">g</span>:hiddenField name=<span class="string"><span class="delimiter">&quot;</span><span class="content">version</span><span class="delimiter">&quot;</span></span> value=<span class="string"><span class="delimiter">&quot;</span><span class="inline"><span class="inline-delimiter">${</span><span class="local-variable">this</span>.hotel?.version<span class="inline-delimiter">}</span></span><span class="delimiter">&quot;</span></span> /&gt;
    &lt;input type=<span class="string"><span class="delimiter">&quot;</span><span class="content">file</span><span class="delimiter">&quot;</span></span> name=<span class="string"><span class="delimiter">&quot;</span><span class="content">featuredImageFile</span><span class="delimiter">&quot;</span></span> /&gt;
    &lt;fieldset <span class="type">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">buttons</span><span class="delimiter">&quot;</span></span>&gt;
        &lt;<span class="class">input</span> <span class="type">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">save</span><span class="delimiter">&quot;</span></span> <span class="class">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">submit</span><span class="delimiter">&quot;</span></span> value=<span class="string"><span class="delimiter">&quot;</span><span class="inline"><span class="inline-delimiter">${</span>message(<span class="key">code</span>: <span class="string"><span class="delimiter">'</span><span class="content">hotel.featuredImage.upload.label</span><span class="delimiter">'</span></span>, <span class="keyword">default</span>: <span class="string"><span class="delimiter">'</span><span class="content">Upload</span><span class="delimiter">'</span></span>)<span class="inline-delimiter">}</span></span><span class="delimiter">&quot;</span></span> /&gt;
    &lt;<span class="regexp"><span class="delimiter">/</span><span class="content">fieldset&gt;</span></span><span class="error">
</span>&lt;<span class="regexp"><span class="delimiter">/</span><span class="content">g:uploadForm&gt;</span></span></code></pre>
</div>
</div>


<h2 id="hotelUploadFeaturedImageService">6.3 Upload image to S3</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails-guides/grails-upload-file/edit/master/src/main/docs/guide/hotelUploadFeaturedImageService.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>The <code>uploadFeatureImage</code> controller&#8217;s action uses the previously described command
object to validate the upload form submission. If it does not find validation errors, it invokes a service.</p>
</div>
<div class="listingblock">
<div class="title">/grails-app/controllers/example/grails/HotelController.groovy</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">def</span> <span class="function">uploadFeaturedImage</span>(FeaturedImageCommand cmd) {

    <span class="keyword">if</span> (cmd.hasErrors()) {
        respond(cmd.errors, <span class="key">model</span>: [<span class="key">hotel</span>: cmd], <span class="key">view</span>: <span class="string"><span class="delimiter">'</span><span class="content">editFeaturedImage</span><span class="delimiter">'</span></span>)
        <span class="keyword">return</span>
    }

    <span class="keyword">def</span> hotel = uploadHotelFeaturedImageService.uploadFeatureImage(cmd)
    <span class="keyword">if</span> (hotel == <span class="predefined-constant">null</span>) {
        notFound()
        <span class="keyword">return</span>
    }

    <span class="keyword">if</span> (hotel.hasErrors()) {
        respond(hotel.errors, <span class="key">model</span>: [<span class="key">hotel</span>: hotel], <span class="key">view</span>: <span class="string"><span class="delimiter">'</span><span class="content">editFeaturedImage</span><span class="delimiter">'</span></span>)
        <span class="keyword">return</span>
    }

    <span class="predefined-type">Locale</span> locale = request.locale
    flash.message = crudMessageService.message(CRUD.UPDATE, domainName(locale), hotel.id, locale)
    redirect hotel
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Service uses the <code>amazonS3Service</code> provided by the plugin to upload the
file to AWS S3. In case of error, the service deletes the file it has previously uploaded.</p>
</div>
<div class="listingblock">
<div class="title">/grails-app/services/example/grails/UploadHotelFeaturedImageService.groovy</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">package</span> example.grails

<span class="keyword">import</span> <span class="include">grails.gorm.transactions.Transactional</span>
<span class="keyword">import</span> <span class="include">grails.plugin.awssdk.s3.AmazonS3Service</span>
<span class="keyword">import</span> <span class="include">groovy.transform.CompileStatic</span>
<span class="keyword">import</span> <span class="include">groovy.util.logging.Slf4j</span>

<span class="annotation">@CompileStatic</span>
<span class="annotation">@Slf4j</span>
<span class="annotation">@Transactional</span>
<span class="type">class</span> <span class="class">UploadHotelFeaturedImageService</span> {

    AmazonS3Service amazonS3Service

    HotelDataService hotelDataService

    Hotel uploadFeatureImage(FeaturedImageCommand cmd) {
        <span class="predefined-type">String</span> path = <span class="string"><span class="delimiter">&quot;</span><span class="content">hotel/</span><span class="inline"><span class="inline-delimiter">${</span>cmd.id<span class="inline-delimiter">}</span></span><span class="content">/</span><span class="inline"><span class="inline-delimiter">${</span>cmd.featuredImageFile.originalFilename<span class="inline-delimiter">}</span></span><span class="delimiter">&quot;</span></span>
        <span class="predefined-type">String</span> s3FileUrl = amazonS3Service.storeMultipartFile(path, cmd.featuredImageFile)

        Hotel hotel = hotelDataService.update(cmd.id, cmd.version, path, s3FileUrl)
        <span class="keyword">if</span> ( !hotel || hotel.hasErrors() ) {
            deleteFileByPath(path)
        }
        hotel
    }

    <span class="type">boolean</span> deleteFileByPath(<span class="predefined-type">String</span> path) {
        <span class="type">boolean</span> result = amazonS3Service.deleteFile(path)
        <span class="keyword">if</span> (!result) {
            log.warn <span class="string"><span class="delimiter">'</span><span class="content">could not remove file {}</span><span class="delimiter">'</span></span>, path
        }
        result
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The domain class instance is updated with the help of GORM Data Service:</p>
</div>
<div class="listingblock">
<div class="title">/grails-app/services/example/grails/HotelDataService.groovy</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">package</span> example.grails

<span class="keyword">import</span> <span class="include">grails.gorm.services.Service</span>

<span class="annotation">@Service</span>(Hotel)
<span class="type">interface</span> HotelDataService {
    Hotel get(<span class="predefined-type">Long</span> id)
    <span class="predefined-type">List</span>&lt;Hotel&gt; list(<span class="predefined-type">Map</span> args)
    <span class="predefined-type">Number</span> count()
    <span class="type">void</span> delete(<span class="predefined-type">Serializable</span> id)
    Hotel save(<span class="predefined-type">String</span> name)
    Hotel update(<span class="predefined-type">Serializable</span> id, <span class="predefined-type">Long</span> version, <span class="predefined-type">String</span> name)
    Hotel update(<span class="predefined-type">Serializable</span> id, <span class="predefined-type">Long</span> version, <span class="predefined-type">String</span> featuredImageKey, <span class="predefined-type">String</span> featuredImageUrl)
}</code></pre>
</div>
</div>


<h2 id="awsAccessAndSecret">6.4 Run the App with AWS Access and Secret</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails-guides/grails-upload-file/edit/master/src/main/docs/guide/awsAccessAndSecret.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p><a href="https://github.com/agorapulse/grails-aws-sdk/tree/master/grails-aws-sdk-s3">AWS S3 Grails Plugin Documentation</a></p>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>If you do not provide credentials, a credentials provider chain will be used that searches for credentials in this order:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Environment Variables - AWS_ACCESS_KEY_ID and AWS_SECRET_KEY</p>
</li>
<li>
<p>Java System Properties - aws.accessKeyId andaws.secretKey`</p>
</li>
<li>
<p>Instance profile credentials delivered through the Amazon EC2 metadata service (IAM role)</p>
</li>
</ul>
</div>
</blockquote>
</div>
<div class="paragraph">
<p>Thus, we can run the app with:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">./gradlew bootRun -Daws.accessKeyId=XXXXX -Daws.secretKey=XXXXX</code></pre>
</div>
</div>


<h1 id="helpWithGrails">7 Do you need help with Grails?</h1>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails-guides/grails-upload-file/edit/master/src/main/docs/guide/helpWithGrails.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<h3 style="color: #333; margin-bottom:25px;"><a href="https://objectcomputing.com/" target="_blank">Object Computing, Inc.</a> (OCI) sponsored the creation of this Guide. A variety of consulting and support services are available.</h3>

<!-- BEGIN HubSpot Consultation Form -->

<!--[if lte IE 8]>
<script charset="utf-8" type="text/javascript" src="//js.hsforms.net/forms/v2-legacy.js"></script>
<![endif]-->
<script charset="utf-8" type="text/javascript" src="//js.hsforms.net/forms/v2.js"></script>
<script>
  hbspt.forms.create({
	portalId: "4547412",
	formId: "f8bc9b16-d5f6-4226-a24e-da0eb8b73363"
});
</script>

<!-- END HubSpot Consultation Form -->

<h3 style="color: #333;">OCI is Home to Grails</h3>

<p><a href="https://objectcomputing.com/products/2gm-team" target="_blank">Meet the Team</a></p>

</article></div><footer>
  <div class='content'>
    <div class='ocihometograils'>
      <span>Sponsored by</span>
      <a href='https://objectcomputing.com/products/grails/'><img class='' src='/images/oci_home_to_grails.svg' alt='Object Computing - Home to Grails' width='300px' /></a>
    </div>
    <nav class='socialmedianav'><ul>
  <li>
    <a href='https://slack.grails.org'><img class='' src='/images/slack.svg' alt='Slack Icon' /></a>
  </li>
  <li>
    <a href='https://www.youtube.com/watch?v=XnRNfDGkBVg&amp;list=PLI74De5M9T73uH3WilDCePP2qfSDpMaGu'><img class='' src='/images/youtube.svg' alt='Youtube Icon' /></a>
  </li>
  <li>
    <a href='https://www.linkedin.com/groups/39757'><img class='' src='/images/linkedin.svg' alt='LinkedIn Icon' /></a>
  </li>
  <li>
    <a href='https://github.com/grails/'><img class='' src='/images/github.svg' alt='Github Icon' /></a>
  </li>
  <li>
    <a href='https://twitter.com/grailsframework'><img class='' src='/images/twitter.svg' alt='Twitter Icon' /></a>
  </li>
</ul></nav>
    <nav class='partnersnav'><ul>
  <li>Grails' repositories are hosted by
    <a href='https://repo.grails.org/'>Artifactory</a>
  </li>
  <li>Website hosting provided by
    <a href='https://aws.amazon.com/'>AWS</a>
  </li>
  <li>JetBrains supports Grails with its 
    <a href='https://www.jetbrains.com/idea/'>IntelliJ IDEA IDE</a>
  </li>
  <li>YourKit supports Grails with its 
    <a href='https://www.yourkit.com/java/profiler/index.jsp'>Java Profiler</a>
  </li>
  <li>Grails is Open Source
    <a href='http://www.apache.org/licenses/LICENSE-2.0.html'>Apache 2 License</a>
  </li>
  <li>
    <a href='https://grails.org/buildstatus.html'>Build Status</a>
  </li>
</ul></nav>
  </div>
</footer><div>
  <script type='text/javascript'>
              (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
              (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
              m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
              })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

              ga('create', 'UA-82213539-2', 'auto');
              ga('send', 'pageview');
</script>
  <script type='text/javascript'>
adroll_adv_id = "HBWJH4CQCJGS5DJRSB4Z4D";
adroll_pix_id = "IVEQYFOZXZAPZMDVQH7BFE";
/* OPTIONAL: provide email to improve user identification */
/* adroll_email = "username@example.com"; */
(function () {
    var _onload = function(){
        if (document.readyState && !/loaded|complete/.test(document.readyState)){setTimeout(_onload, 10);return}
        if (!window.__adroll_loaded){__adroll_loaded=true;setTimeout(_onload, 50);return}
        var scr = document.createElement("script");
        var host = (("https:" == document.location.protocol) ? "https://s.adroll.com" : "http://a.adroll.com");
        scr.setAttribute('async', 'true');
        scr.type = "text/javascript";
        scr.src = host + "/j/roundtrip.js";
        ((document.getElementsByTagName('head') || [null])[0] ||
            document.getElementsByTagName('script')[0].parentNode).appendChild(scr);
    };
    if (window.addEventListener) {window.addEventListener('load', _onload, false);}
    else {window.attachEvent('onload', _onload)}
}());            
</script>
</div></body>
</html>
