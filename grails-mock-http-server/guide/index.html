<!DOCTYPE html>
<html>
  <head>
    <meta name='google-site-verification' content='REYQ1_I6HGowAE7LOLVqfQbnKaB4IfFpMlGzMbJj55Q' />
    <meta name='viewport' content='width=device-width, initial-scale=1' />
    <link rel='icon' href='/images/favicon.ico' />
    <link rel='mask-icon' href='//images/grails-pinned-icon.svg' color='feb672' />
    <meta charset='UTF-8' />
    <title>Consume and test a third-party REST API | Grails Guides | Grails Framework</title>
    <meta name='description' content='Consume and test a third-party REST API. Use Ersatz, a "mock" HTTP library, for testing code dealing with HTTP requests' />
    <link rel='stylesheet' href='../css/main.css' />
    <link rel='stylesheet' href='../css/screen.css' />
    <script src='https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/1.7.1/clipboard.min.js'></script>
  </head>
  <body class='guide'><header class='mainheader'>
  <div class='content'>
    <a href='https://grails.org/index.html'><img class='grailslogo' src='/images/grails_logo.svg' alt='Grails Logo' /></a>
    <a href='javascript:show(&apos;topmenus&apos;, &apos;showNavigationLink&apos;)' id='showNavigationLink' class='mobile align-center'>Show Navigation</a>
    <div id='topmenus'>
      <nav class='secondarymenu' id='secondarymenu'><ul>
  <li>
    <a href='https://grails.org/learning.html'>Learning</a>
  </li>
  <li>
    <a href='https://grails.org/community.html'>Community</a>
  </li>
  <li>
    <a href='https://grails.org/search.html'>Search</a>
  </li>
</ul></nav>
      <nav class='mainmenu' id='mainmenu'><ul>
  <li>
    <a href='https://grails.org/documentation.html'>Documentation</a>
  </li>
  <li>
    <a href='https://grails.org/download.html'>Download</a>
  </li>
  <li>
    <a href='https://plugins.grails.org'>Plugins</a>
  </li>
  <li>
    <a href='https://guides.grails.org/index.html'>Guides</a>
  </li>
  <li>
    <a href='https://grails.org/faq.html'>FAQ</a>
  </li>
  <li>
    <a href='https://grails.org/support.html'>Support</a>
  </li>
</ul></nav>
    </div>
  </div>
</header><div class='fullwidth'><article class="guide">
    <aside>
        <a href="https://travis-ci.org/grails-guides/grails-mock-http-server"><img src="https://travis-ci.org/grails-guides/grails-mock-http-server.svg?branch=master"></a>

        <button type="button" class="btn btn-large" onclick="window.location.href=&quot;https://github.com/grails-guides/grails-mock-http-server&quot;"><img height="15" src="../img/github_white.svg" alt="Github"/><span>&nbsp;Get the Code</span></button>


        <ul class="githublinks">
            <li><button type="button" class="btn btn-default" href="#" onclick="document.getElementById('github-url').value='git@github.com:grails-guides/grails-mock-http-server.git'" class="codeButton">SSH</button></li>
            <li><button type="button" class="btn btn-default" onclick="document.getElementById('github-url').value='https://github.com/grails-guides/grails-mock-http-server.git'" class="codeButton">HTTPS</button></li>
        </ul>
        <div class="input-group">
            <!-- Target -->
            <input id="github-url" value="git@github.com:grails-guides/grails-mock-http-server.git" type="text" />
            <!-- Trigger -->
            <button type="button" class="clippy btn btn-default" type="button" data-clipboard-target="#github-url">
                <img width="13" src="../img/clippy.svg" alt="Copy to clipboard">
            </button>
        </div>
        <script>var clipboard = new Clipboard('.clippy');</script>
        <button type="button" class="btn btn-large" onclick="window.location.href=&quot;https://github.com/grails-guides/grails-mock-http-server/archive/master.zip&quot;">Download ZIP</button>
        
        <div id="table-of-content">
            <h3>Table of Contents</h3>
            
            <div class="toc-item" style="margin-left:0px"><a href="#training"><strong>1</strong><span>Grails Training</span></a></div>
            
            <div class="toc-item" style="margin-left:0px"><a href="#gettingStarted"><strong>2</strong><span>Getting Started</span></a></div>
            
            <div class="toc-item" style="margin-left:10px"><a href="#requirements"><strong>2.1</strong><span>What you will need</span></a></div>
            
            <div class="toc-item" style="margin-left:10px"><a href="#howto"><strong>2.2</strong><span>How to complete the guide</span></a></div>
            
            <div class="toc-item" style="margin-left:0px"><a href="#writingTheApp"><strong>3</strong><span>Writing the Application</span></a></div>
            
            <div class="toc-item" style="margin-left:10px"><a href="#openweather"><strong>3.1</strong><span>Open Weather Map</span></a></div>
            
            <div class="toc-item" style="margin-left:10px"><a href="#pogos"><strong>3.2</strong><span>Parse Response into JAVA classes</span></a></div>
            
            <div class="toc-item" style="margin-left:10px"><a href="#service"><strong>3.3</strong><span>Open Weather Service</span></a></div>
            
            <div class="toc-item" style="margin-left:10px"><a href="#ersatz"><strong>3.4</strong><span>Ersatz</span></a></div>
            
            <div class="toc-item" style="margin-left:10px"><a href="#testapp"><strong>3.5</strong><span>Run Tests</span></a></div>
            
            <div class="toc-item" style="margin-left:10px"><a href="#controller"><strong>3.6</strong><span>Root Url to Weather Controller</span></a></div>
            
            <div class="toc-item" style="margin-left:10px"><a href="#taglib"><strong>3.7</strong><span>TagLib</span></a></div>
            
            <div class="toc-item" style="margin-left:10px"><a href="#view"><strong>3.8</strong><span>View</span></a></div>
            
            <div class="toc-item" style="margin-left:0px"><a href="#runningTheApp"><strong>4</strong><span>Running the Application</span></a></div>
            
            <div class="toc-item" style="margin-left:0px"><a href="#helpWithGrails"><strong>5</strong><span>Help with Grails</span></a></div>
            
            <div style="clear:both" ></div>
        </div>
        
    </aside>
    <header>
        <h1>Consume and test a third-party REST API</h1>
        <p>Use Ersatz, a &quot;mock&quot; HTTP library, for testing code dealing with HTTP requests</p>
        <p><strong>Authors:</strong> Sergio del Amo</p>
        <p><strong>Grails Version:</strong> 4.0.1</p>
    </header>
    

<h1 id="training">1 Grails Training</h1>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails-guides/grails-mock-http-server/edit/master/src/main/docs/guide/training.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p><strong>Grails Training</strong> - Developed and delivered by the folks who created and actively maintain the Grails framework!.</p>
</div>
<div id="ocitraining"></div>
<script type="text/javascript">
var getJSON = function(url, callback) {
    var xhr = new XMLHttpRequest();
    xhr.open('GET', url, true);
    xhr.responseType = 'json';
    xhr.onload = function() {
      var status = xhr.status;
      if (status == 200) {
        callback(null, xhr.response);
      } else {
        callback(status);
      }
    };
    xhr.send();
};
getJSON('https://training.grails.org/training', function(err, data) {
  var msg = '';
  if (err != null) {
      msg = 'Something went wrong while retrieving OCI training offerings';

  } else {
      if ( data.length == 0 ) {
         msg = '<p><b>Nothing scheduled at the moment - please check back again soon!</b></p>.';

      } else {
        msg += '<table>';
        msg += '<thead>';
        msg += '<tr><th>Course</th><th>Date(s)</th><th>Instructor(s)</th><th>Hour(s)</th></tr>';
        msg += '</thead>';
        msg += '<tbody>';

        var hrefs = new Array();
        for (var i = 0; i < data.length; i++) {
            var href = data[i].enrollmentLink;
            if (hrefs.indexOf(href) == -1) {
                msg += '<tr><td><a href="'+ href + '">'+ data[i].course + '</a></td><td>'+ data[i].dates + '</td><td>'+ data[i].instructors + '</td><td>'+ data[i].hours + '</td></tr>';
                hrefs.push(href);
            }

        }
        msg += '</tbody>';
        msg += '</table>';
      }
  }
  var ociTraining = document.getElementById("ocitraining");
  ociTraining.innerHTML = msg;
});
</script>


<h1 id="gettingStarted">2 Getting Started</h1>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails-guides/grails-mock-http-server/edit/master/src/main/docs/guide/gettingStarted.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>In this guide you are going to create a Grails app which consumes a third party REST API. Moreover, we will use a "mock" HTTP library to test the code which interacts with this external service.</p>
</div>


<h2 id="requirements">2.1 What you will need</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails-guides/grails-mock-http-server/edit/master/src/main/docs/guide/requirements.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>To complete this guide, you will need the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Some time on your hands</p>
</li>
<li>
<p>A decent text editor or IDE</p>
</li>
<li>
<p>JDK 1.8 or greater installed with <code>JAVA_HOME</code> configured appropriately</p>
</li>
</ul>
</div>


<h2 id="howto">2.2 How to complete the guide</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails-guides/grails-mock-http-server/edit/master/src/main/docs/guide/howto.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>To get started do the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://github.com/grails-guides/grails-mock-http-server/archive/master.zip">Download</a> and unzip the source</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>or</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Clone the <a href="https://git-scm.com/">Git</a> repository:<br>
<code>git clone <a href="https://github.com/grails-guides/grails-mock-http-server.git" class="bare">https://github.com/grails-guides/grails-mock-http-server.git</a></code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The Grails guides repositories contain two folders:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>initial</code>  Initial project. Often a simple Grails app with some additional code to give you a head-start.</p>
</li>
<li>
<p><code>complete</code> A completed example. It is the result of working through the steps presented by the guide and applying those changes to the <code>initial</code> folder.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>To complete the guide, go to the <code>initial</code> folder</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>cd</code> into <code>grails-guides/grails-mock-http-server/initial</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>and follow the instructions in the next sections.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
You can go right to the <strong>completed example</strong> if you <code>cd</code> into <code>grails-guides/grails-mock-http-server/complete</code>
</td>
</tr>
</table>
</div>


<h1 id="writingTheApp">3 Writing the Application</h1>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails-guides/grails-mock-http-server/edit/master/src/main/docs/guide/writingTheApp.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>The first step is to add the Micronaut HTTP client library to our project. Add the next dependency:</p>
</div>
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">    compile <span class="string"><span class="delimiter">&quot;</span><span class="content">io.micronaut:micronaut-http-client</span><span class="delimiter">&quot;</span></span></code></pre>
</div>
</div>


<h2 id="openweather">3.1 Open Weather Map</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails-guides/grails-mock-http-server/edit/master/src/main/docs/guide/openweather.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p><a href="https://openweathermap.org">OpenWeatherMap</a> is a web application which offers an API which allows you to:</p>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>Get current weather, daily forecast for 16 days, and 3-hourly forecast 5 days for your city. Helpful stats, graphics, and this day in history charts are available for your reference. Interactive maps show precipitation, clouds, pressure, wind around your location.</p>
</div>
</blockquote>
</div>
<div class="paragraph">
<p>They have a FREE plan which allows you to get the <a href="https://openweathermap.org/current">Current Weather Data</a> of a city.</p>
</div>
<div class="paragraph">
<p>After you register, you get an API Key. You will need an API key to interact with the Open Weather Map API.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../img/apiKey.png" alt="apiKey">
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
the API key may take several minutes to become active.
</td>
</tr>
</table>
</div>


<h2 id="pogos">3.2 Parse Response into JAVA classes</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails-guides/grails-mock-http-server/edit/master/src/main/docs/guide/pogos.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Create several JAVA POJOs (Plain Old Java Objects) to map the <code>OpenWeatherMap</code> JSON response to classes.</p>
</div>
<div class="listingblock">
<div class="title">src/main/java/org/openweathermap/CurrentWeather.java</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">package</span> org.openweathermap;

<span class="keyword">import</span> <span class="include">com.fasterxml.jackson.annotation.JsonProperty</span>;
<span class="keyword">import</span> <span class="include">io.micronaut.core.annotation.Introspected</span>;

<span class="keyword">import</span> <span class="include">java.util.List</span>;

<span class="annotation">@Introspected</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">CurrentWeather</span> {
    <span class="directive">private</span> Main main;

    <span class="annotation">@JsonProperty</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">coord</span><span class="delimiter">&quot;</span></span>)
    <span class="directive">private</span> Coordinate coordinate;

    <span class="directive">private</span> <span class="predefined-type">List</span>&lt;Weather&gt; weather;
    <span class="directive">private</span> Wind wind;
    <span class="directive">private</span> Sys sys;
    <span class="directive">private</span> Rain rain;
    <span class="directive">private</span> Clouds clouds;
    <span class="directive">private</span> <span class="predefined-type">String</span> base;
    <span class="directive">private</span> <span class="predefined-type">Integer</span> dt;

    <span class="annotation">@JsonProperty</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>)
    <span class="directive">private</span> <span class="predefined-type">Long</span> cityId;

    <span class="annotation">@JsonProperty</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>)
    <span class="directive">private</span> <span class="predefined-type">String</span> cityName;

    <span class="annotation">@JsonProperty</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">cod</span><span class="delimiter">&quot;</span></span>)
    <span class="directive">private</span> <span class="predefined-type">Integer</span> code;

    <span class="directive">private</span> <span class="predefined-type">Integer</span> visibility;

    <span class="directive">public</span> CurrentWeather() {
    }

<span class="comment">//getters and setters</span>
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">src/main/java/org/openweathermap/Clouds.java</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">package</span> org.openweathermap;

<span class="keyword">import</span> <span class="include">com.fasterxml.jackson.annotation.JsonProperty</span>;
<span class="keyword">import</span> <span class="include">io.micronaut.core.annotation.Introspected</span>;

<span class="annotation">@Introspected</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">Clouds</span> {
    <span class="annotation">@JsonProperty</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">all</span><span class="delimiter">&quot;</span></span>)
    <span class="directive">private</span> <span class="predefined-type">Integer</span> cloudiness;

    <span class="directive">public</span> Clouds() {
    }
<span class="comment">//getters and setters</span>
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">src/main/java/org/openweathermap/Coordinate.java</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">package</span> org.openweathermap;

<span class="keyword">import</span> <span class="include">com.fasterxml.jackson.annotation.JsonProperty</span>;
<span class="keyword">import</span> <span class="include">io.micronaut.core.annotation.Introspected</span>;

<span class="keyword">import</span> <span class="include">java.math.BigDecimal</span>;

<span class="annotation">@Introspected</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">Coordinate</span> {

    <span class="annotation">@JsonProperty</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">long</span><span class="delimiter">&quot;</span></span>)
    <span class="directive">private</span> <span class="predefined-type">BigDecimal</span> longitude;

    <span class="annotation">@JsonProperty</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">lat</span><span class="delimiter">&quot;</span></span>)
    <span class="directive">private</span> <span class="predefined-type">BigDecimal</span> latitude;

    <span class="directive">public</span> Coordinate() {
    }
<span class="comment">//getters and setters</span>
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">src/main/java/org/openweathermap/Rain.java</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">package</span> org.openweathermap;

<span class="keyword">import</span> <span class="include">io.micronaut.core.annotation.Introspected</span>;

<span class="annotation">@Introspected</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">Rain</span> {
    <span class="directive">private</span> <span class="predefined-type">Integer</span> lastThreeHours;

    <span class="directive">public</span> Rain() {
    }
<span class="comment">//getters and setters</span>
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">src/main/java/org/openweathermap/Unit.java</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">package</span> org.openweathermap;

<span class="directive">public</span> <span class="type">enum</span> Unit {
    Standard, Imperial, Metric;

    <span class="directive">public</span> <span class="directive">static</span> Unit unitWithString(<span class="predefined-type">String</span> str) {
        <span class="keyword">if</span> ( str != <span class="predefined-constant">null</span>) {
            <span class="keyword">if</span> ( str.toLowerCase().equals(<span class="string"><span class="delimiter">&quot;</span><span class="content">metric</span><span class="delimiter">&quot;</span></span>) ) {
                <span class="keyword">return</span> Unit.Metric;
            } <span class="keyword">else</span> <span class="keyword">if</span> ( str.toLowerCase().equals(<span class="string"><span class="delimiter">&quot;</span><span class="content">imperial</span><span class="delimiter">&quot;</span></span>) ) {
                <span class="keyword">return</span> Unit.Imperial;
            }
        }
        <span class="keyword">return</span> Unit.Standard;
    }

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="predefined-type">String</span> toString() {
        <span class="keyword">return</span> <span class="local-variable">this</span>.name().toLowerCase();
    }
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">src/main/java/org/openweathermap/Weather.java</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">package</span> org.openweathermap;

<span class="keyword">import</span> <span class="include">io.micronaut.core.annotation.Introspected</span>;

<span class="annotation">@Introspected</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">Weather</span> {
    <span class="directive">private</span> <span class="predefined-type">Long</span> id;
    <span class="directive">private</span> <span class="predefined-type">String</span> main;
    <span class="directive">private</span> <span class="predefined-type">String</span> description;
    <span class="directive">private</span> <span class="predefined-type">String</span> icon;

    <span class="directive">public</span> Weather() {
    }
<span class="comment">//getters and setters</span>
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">src/main/java/org/openweathermap/Sys.java</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">package</span> org.openweathermap;

<span class="keyword">import</span> <span class="include">io.micronaut.core.annotation.Introspected</span>;

<span class="annotation">@Introspected</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">Sys</span> {
    <span class="directive">private</span> <span class="predefined-type">Long</span> id;
    <span class="directive">private</span> <span class="predefined-type">String</span> type;
    <span class="directive">private</span> <span class="predefined-type">String</span> message;
    <span class="directive">private</span> <span class="predefined-type">String</span> country;
    <span class="directive">private</span> <span class="predefined-type">Integer</span> sunrise;
    <span class="directive">private</span> <span class="predefined-type">Integer</span> sunset;

    <span class="directive">public</span> Sys() {

    }
<span class="comment">//getters and setters</span>
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">src/main/java/org/openweathermap/Wind.java</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">package</span> org.openweathermap;

<span class="keyword">import</span> <span class="include">io.micronaut.core.annotation.Introspected</span>;

<span class="keyword">import</span> <span class="include">java.math.BigDecimal</span>;

<span class="annotation">@Introspected</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">Wind</span> {
    <span class="directive">private</span> <span class="predefined-type">BigDecimal</span> speed;
    <span class="directive">private</span> <span class="predefined-type">BigDecimal</span> deg;

    <span class="directive">public</span> Wind() {

    }
<span class="comment">//getters and setters</span>
}</code></pre>
</div>
</div>


<h2 id="service">3.3 Open Weather Service</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails-guides/grails-mock-http-server/edit/master/src/main/docs/guide/service.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Create the next service:</p>
</div>
<div class="listingblock">
<div class="title">grails-app/services/org/openweathermap/OpenweathermapService.groovy</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">package</span> org.openweathermap

<span class="keyword">import</span> <span class="include">grails.config.Config</span>
<span class="keyword">import</span> <span class="include">grails.core.support.GrailsConfigurationAware</span>
<span class="keyword">import</span> <span class="include">groovy.transform.CompileDynamic</span>
<span class="keyword">import</span> <span class="include">groovy.transform.CompileStatic</span>
<span class="keyword">import</span> <span class="include">io.micronaut.http.HttpStatus</span>
<span class="keyword">import</span> <span class="include">io.micronaut.http.client.BlockingHttpClient</span>
<span class="keyword">import</span> <span class="include">io.micronaut.http.client.HttpClient</span>
<span class="keyword">import</span> <span class="include">io.micronaut.http.HttpRequest</span>
<span class="keyword">import</span> <span class="include">io.micronaut.http.HttpResponse</span>
<span class="keyword">import</span> <span class="include">io.micronaut.http.client.exceptions.HttpClientResponseException</span>
<span class="keyword">import</span> <span class="include">io.micronaut.http.uri.UriBuilder</span>
<span class="keyword">import</span> <span class="include">org.grails.web.json.JSONObject</span>



<span class="annotation">@CompileStatic</span>
<span class="type">class</span> <span class="class">OpenweathermapService</span> <span class="directive">implements</span> GrailsConfigurationAware {
    <span class="predefined-type">String</span> appid
    <span class="predefined-type">String</span> cityName
    <span class="predefined-type">String</span> countryCode
    BlockingHttpClient client

    <span class="annotation">@Override</span>
    <span class="type">void</span> setConfiguration(Config co) {
        setupHttpClient(co.getProperty(<span class="string"><span class="delimiter">'</span><span class="content">openweather.url</span><span class="delimiter">'</span></span>, <span class="predefined-type">String</span>, <span class="string"><span class="delimiter">'</span><span class="content">http://api.openweathermap.org</span><span class="delimiter">'</span></span>))
        appid = co.getProperty(<span class="string"><span class="delimiter">'</span><span class="content">openweather.appid</span><span class="delimiter">'</span></span>, <span class="predefined-type">String</span>)
        cityName = co.getProperty(<span class="string"><span class="delimiter">'</span><span class="content">openweather.cityName</span><span class="delimiter">'</span></span>, <span class="predefined-type">String</span>)
        countryCode = co.getProperty(<span class="string"><span class="delimiter">'</span><span class="content">openweather.countryCode</span><span class="delimiter">'</span></span>, <span class="predefined-type">String</span>)
    }

    <span class="type">void</span> setupHttpClient(<span class="predefined-type">String</span> url) {
        <span class="local-variable">this</span>.client = HttpClient.create(url.toURL()).toBlocking()
    }
    CurrentWeather currentWeather(Unit units = Unit.Standard) {
        currentWeather(cityName, countryCode, units)
    }

    CurrentWeather currentWeather(<span class="predefined-type">String</span> cityName, <span class="predefined-type">String</span> countryCode, Unit unit = Unit.Standard) {
        <span class="keyword">try</span> {
            HttpRequest request = HttpRequest.GET(currentWeatherUri(cityName, countryCode, unit))
            <span class="keyword">return</span> client.retrieve(request, CurrentWeather)

        } <span class="keyword">catch</span> (HttpClientResponseException e) {
            <span class="keyword">return</span> <span class="predefined-constant">null</span> <i class="conum" data-value="3"></i><b>(3)</b>
        }
    }

    <span class="predefined-type">URI</span> currentWeatherUri(<span class="predefined-type">String</span> cityName, <span class="predefined-type">String</span> countryCode, Unit unit = Unit.Standard) {
        UriBuilder uriBuilder = UriBuilder.of(<span class="string"><span class="delimiter">'</span><span class="content">/data/2.5/weather</span><span class="delimiter">'</span></span>)
                .queryParam(<span class="string"><span class="delimiter">'</span><span class="content">q</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="inline"><span class="inline-delimiter">${</span>cityName<span class="inline-delimiter">}</span></span><span class="content">,</span><span class="inline"><span class="inline-delimiter">${</span>countryCode<span class="inline-delimiter">}</span></span><span class="delimiter">&quot;</span></span>.toString())
                .queryParam(<span class="string"><span class="delimiter">'</span><span class="content">appid</span><span class="delimiter">'</span></span>, appid)
        <span class="predefined-type">String</span> unitParam = unitParameter(unit)
        <span class="keyword">if</span> (unitParam) {
            uriBuilder = uriBuilder.queryParam(<span class="string"><span class="delimiter">'</span><span class="content">units</span><span class="delimiter">'</span></span>, unitParam)
        }
        uriBuilder.build()
    }

    <span class="predefined-type">String</span> unitParameter(Unit unit)  {
        unit == Unit.Standard ? <span class="predefined-constant">null</span> : unit?.toString()
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>To get the current weather, do a GET request providing the city name, country code and API Key as query parameters.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>In case of a 200 - OK - response, parse the JSON data into Groovy classes.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>if the answer is not 200. For example, 401; the method returns null.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The previous service uses several configuration parameters. Define them in <code>application.yml</code></p>
</div>
<div class="listingblock">
<div class="title">grails-app/conf/application.yml</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">openweather</span>:
    <span class="key">appid</span>: <span class="string"><span class="content">1f6c7d09a28f1ddccf70c06e2cb75ee4</span></span>
    <span class="key">cityName</span>: <span class="string"><span class="content">London</span></span>
    <span class="key">countryCode</span>: <span class="string"><span class="content">uk</span></span></code></pre>
</div>
</div>


<h2 id="ersatz">3.4 Ersatz</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails-guides/grails-mock-http-server/edit/master/src/main/docs/guide/ersatz.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>To test the networking code, add a dependency to <a href="http://stehno.com/ersatz/">Ersatz</a></p>
</div>
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">    testCompile <span class="string"><span class="delimiter">'</span><span class="content">com.stehno.ersatz:ersatz:2.0.0</span><span class="delimiter">'</span></span></code></pre>
</div>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>Ersatz Server is a "mock" HTTP server library for testing HTTP clients. It allows for server-side request/response expectations to be configured so that your client library can make real HTTP calls and get back real pre-configured responses rather than fake stubs.</p>
</div>
</blockquote>
</div>
<div class="paragraph">
<p>First, implement a test which verifies that the <code>OpenweathermapService.currentWeather</code> method returns
null when the REST API returns <code>401</code>. For example, when the API Key is invalid.</p>
</div>
<div class="listingblock">
<div class="title">src/test/groovy/org/openweathermap/OpenweathermapServiceSpec.groovy</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">package</span> org.openweathermap

<span class="keyword">import</span> <span class="include">com.stehno.ersatz.ErsatzServer</span>
<span class="keyword">import</span> <span class="include">com.stehno.ersatz.cfg.ContentType</span>
<span class="keyword">import</span> <span class="include">com.stehno.ersatz.encdec.Encoders</span>
<span class="keyword">import</span> <span class="include">grails.testing.services.ServiceUnitTest</span>
<span class="keyword">import</span> <span class="include">spock.lang.IgnoreIf</span>
<span class="keyword">import</span> <span class="include">spock.lang.Specification</span>

<span class="annotation">@IgnoreIf</span>( { <span class="predefined-type">System</span>.getenv(<span class="string"><span class="delimiter">'</span><span class="content">TRAVIS</span><span class="delimiter">'</span></span>) <span class="keyword">as</span> <span class="type">boolean</span> } )
<span class="type">class</span> <span class="class">OpenweathermapServiceSpec</span> <span class="directive">extends</span> Specification <span class="directive">implements</span> ServiceUnitTest&lt;OpenweathermapService&gt; {

    <span class="keyword">def</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">For an unauthorized key, null is return</span><span class="delimiter">&quot;</span></span>() {
        <span class="key">given</span>:
        ErsatzServer ersatz = <span class="keyword">new</span> ErsatzServer()
        <span class="predefined-type">String</span> city = <span class="string"><span class="delimiter">'</span><span class="content">London</span><span class="delimiter">'</span></span>
        <span class="predefined-type">String</span> countryCode = <span class="string"><span class="delimiter">'</span><span class="content">uk</span><span class="delimiter">'</span></span>
        <span class="predefined-type">String</span> appid = <span class="string"><span class="delimiter">'</span><span class="content">XXXXX</span><span class="delimiter">'</span></span>
        ersatz.expectations {
            GET(<span class="string"><span class="delimiter">'</span><span class="content">/data/2.5/weather</span><span class="delimiter">'</span></span>) { <i class="conum" data-value="1"></i><b>(1)</b>
                query(<span class="string"><span class="delimiter">'</span><span class="content">q</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="inline"><span class="inline-delimiter">${</span>city<span class="inline-delimiter">}</span></span><span class="content">,</span><span class="inline"><span class="inline-delimiter">${</span>countryCode<span class="inline-delimiter">}</span></span><span class="delimiter">&quot;</span></span>)
                query(<span class="string"><span class="delimiter">'</span><span class="content">appid</span><span class="delimiter">'</span></span>, appid)
                called(<span class="integer">1</span>) <i class="conum" data-value="2"></i><b>(2)</b>
                responder {
                    code(<span class="integer">401</span>) <i class="conum" data-value="3"></i><b>(3)</b>
                }
            }
        }
        service.setupHttpClient(ersatz.httpUrl) <i class="conum" data-value="4"></i><b>(4)</b>
        service.appid = appid

        <span class="key">when</span>:
        CurrentWeather currentWeather = service.currentWeather(city, countryCode)

        <span class="key">then</span>:
        !currentWeather

        <span class="key">and</span>:
        ersatz.verify() <i class="conum" data-value="5"></i><b>(5)</b>

        <span class="key">cleanup</span>:
        ersatz.stop() <i class="conum" data-value="6"></i><b>(6)</b>
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Declare expectations, a GET request to the <code>OpenWeather</code> path with query parameters.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Declare conditions to be verified, in this example we want to to verify the endpoint is hit only one time.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Tell the mock server to return 401 for this test.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Ersatz starts an embedded Undertow server, root the networking requests to this server instead of to the OpenWeather API server.</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Verify the ersatz servers conditions.</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>Rember to stop the server</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Next, test that when the server returns 200 and a JSON payload, the JSON payload is parsed correctly into Groovy classes.</p>
</div>
<div class="listingblock">
<div class="title">src/test/groovy/org/openweathermap/OpenweathermapServiceSpec.groovy</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">package</span> org.openweathermap

<span class="keyword">import</span> <span class="include">com.stehno.ersatz.ErsatzServer</span>
<span class="keyword">import</span> <span class="include">com.stehno.ersatz.cfg.ContentType</span>
<span class="keyword">import</span> <span class="include">com.stehno.ersatz.encdec.Encoders</span>
<span class="keyword">import</span> <span class="include">grails.testing.services.ServiceUnitTest</span>
<span class="keyword">import</span> <span class="include">spock.lang.IgnoreIf</span>
<span class="keyword">import</span> <span class="include">spock.lang.Specification</span>

<span class="annotation">@IgnoreIf</span>( { <span class="predefined-type">System</span>.getenv(<span class="string"><span class="delimiter">'</span><span class="content">TRAVIS</span><span class="delimiter">'</span></span>) <span class="keyword">as</span> <span class="type">boolean</span> } )
<span class="type">class</span> <span class="class">OpenweathermapServiceSpec</span> <span class="directive">extends</span> Specification <span class="directive">implements</span> ServiceUnitTest&lt;OpenweathermapService&gt; {

    <span class="keyword">def</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">A CurrentWeather object is built from JSON Payload</span><span class="delimiter">&quot;</span></span>() {
        <span class="key">given</span>:
        ErsatzServer ersatz = <span class="keyword">new</span> ErsatzServer()
        <span class="predefined-type">String</span> city = <span class="string"><span class="delimiter">'</span><span class="content">London</span><span class="delimiter">'</span></span>
        <span class="predefined-type">String</span> countryCode = <span class="string"><span class="delimiter">'</span><span class="content">uk</span><span class="delimiter">'</span></span>
        <span class="predefined-type">String</span> appid = <span class="string"><span class="delimiter">'</span><span class="content">XXXXX</span><span class="delimiter">'</span></span>
        ersatz.expectations {
            GET(<span class="string"><span class="delimiter">'</span><span class="content">/data/2.5/weather</span><span class="delimiter">'</span></span>) {
                query(<span class="string"><span class="delimiter">'</span><span class="content">q</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="inline"><span class="inline-delimiter">${</span>city<span class="inline-delimiter">}</span></span><span class="content">,</span><span class="inline"><span class="inline-delimiter">${</span>countryCode<span class="inline-delimiter">}</span></span><span class="delimiter">&quot;</span></span>)
                query(<span class="string"><span class="delimiter">'</span><span class="content">appid</span><span class="delimiter">'</span></span>, appid)
                called(<span class="integer">1</span>)
                responder {
                    encoder(ContentType.APPLICATION_JSON, <span class="predefined-type">Map</span>, Encoders.json) <i class="conum" data-value="1"></i><b>(1)</b>
                    code(<span class="integer">200</span>)
                    body([
                        coord     : [<span class="key">lon</span>: -<span class="float">0.13</span>, <span class="key">lat</span>: <span class="float">51.51</span>],
                        weather   : [[<span class="key">id</span>: <span class="integer">803</span>, <span class="key">main</span>: <span class="string"><span class="delimiter">'</span><span class="content">Clouds</span><span class="delimiter">'</span></span>, <span class="key">description</span>: <span class="string"><span class="delimiter">'</span><span class="content">broken clouds</span><span class="delimiter">'</span></span>, <span class="key">icon</span>: <span class="string"><span class="delimiter">'</span><span class="content">04d</span><span class="delimiter">'</span></span>]],
                        base      : <span class="string"><span class="delimiter">'</span><span class="content">stations</span><span class="delimiter">'</span></span>,
                        main      : [<span class="key">temp</span>: <span class="float">20.81</span>, <span class="key">pressure</span>: <span class="integer">1017</span>, <span class="key">humidity</span>: <span class="integer">53</span>, <span class="key">temp_min</span>: <span class="integer">19</span>, <span class="key">temp_max</span>: <span class="integer">22</span>],
                        <span class="key">visibility</span>: <span class="integer">10000</span>,
                        wind      : [<span class="key">speed</span>: <span class="float">3.6</span>, <span class="key">deg</span>: <span class="integer">180</span>, <span class="key">gust</span>: <span class="float">9.8</span>],
                        clouds    : [<span class="key">all</span>: <span class="integer">75</span>],
                        dt        : <span class="integer">1502707800</span>,
                        sys       : [<span class="key">type</span>: <span class="integer">1</span>, <span class="key">id</span>: <span class="integer">5091</span>, <span class="key">message</span>: <span class="float">0.0029</span>, <span class="key">country</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">GB</span><span class="delimiter">&quot;</span></span>, <span class="key">sunrise</span>: <span class="integer">1502685920</span>, <span class="key">sunset</span>: <span class="integer">1502738622</span>],
                        id        : <span class="integer">2643743</span>,
                        name      : <span class="string"><span class="delimiter">'</span><span class="content">London</span><span class="delimiter">'</span></span>,
                        cod       : <span class="integer">200</span>
                    ], ContentType.APPLICATION_JSON) <i class="conum" data-value="2"></i><b>(2)</b>
                }
            }
        }
        service.setupHttpClient(ersatz.httpUrl)
        service.appid = appid

        <span class="key">when</span>:
        CurrentWeather currentWeather = service.currentWeather(city, countryCode)

        <span class="key">then</span>:
        currentWeather

        currentWeather.cityName == <span class="string"><span class="delimiter">'</span><span class="content">London</span><span class="delimiter">'</span></span>
        currentWeather.code == <span class="integer">200</span>
        currentWeather.cityId == <span class="integer">2643743</span>
        currentWeather.main.temperature == <span class="float">20.81</span>
        currentWeather.main.pressure == <span class="integer">1017</span>
        currentWeather.main.humidity == <span class="integer">53</span>
        currentWeather.main.tempMin == <span class="integer">19</span>
        currentWeather.main.tempMax == <span class="integer">22</span>
        currentWeather.weather
        currentWeather.weather[<span class="integer">0</span>].main == <span class="string"><span class="delimiter">'</span><span class="content">Clouds</span><span class="delimiter">'</span></span>
        currentWeather.weather[<span class="integer">0</span>].id == <span class="integer">803</span>
        currentWeather.weather[<span class="integer">0</span>].main == <span class="string"><span class="delimiter">'</span><span class="content">Clouds</span><span class="delimiter">'</span></span>
        currentWeather.weather[<span class="integer">0</span>].description == <span class="string"><span class="delimiter">'</span><span class="content">broken clouds</span><span class="delimiter">'</span></span>
        currentWeather.weather[<span class="integer">0</span>].icon == <span class="string"><span class="delimiter">'</span><span class="content">04d</span><span class="delimiter">'</span></span>
        currentWeather.visibility == <span class="integer">10000</span>
        currentWeather.wind.speed == <span class="float">3.6</span>
        currentWeather.wind.deg == <span class="integer">180</span>
        currentWeather.clouds.cloudiness == <span class="integer">75</span>
        currentWeather.base == <span class="string"><span class="delimiter">'</span><span class="content">stations</span><span class="delimiter">'</span></span>
        currentWeather.dt == <span class="integer">1502707800</span>
        currentWeather.coordinate

        <span class="key">and</span>:
        ersatz.verify()

        <span class="key">cleanup</span>:
        ersatz.stop()
    }

}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Declare a response encoder to convert a <code>Map</code> into <code>application/json</code> content using an Ersatz-provided encoder.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Define the response content as a <code>Map</code> which will be converted to JSON by the defined encoder (above).</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><a href="http://stehno.com/ersatz/guide/#" class="bare">http://stehno.com/ersatz/guide/#</a><em>shadow_jar[Shadow Jar section of the Ersatz User Guide]:
<em></em>
The embedded version of Undertow used by Ersatz has caused issues with some server frameworks which also use Undertow (e.g. Grails, and Spring-boot). If you run into errors using the standard jar distribution, please try using the safe distribution, which is a shadowed jar which includes the Undertow library and its JBoss dependencies repackaged in the jar.
</em>_</p>
</div>


<h2 id="testapp">3.5 Run Tests</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails-guides/grails-mock-http-server/edit/master/src/main/docs/guide/testapp.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>To run the tests:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">./grailsw
grails&gt; test-app
grails&gt; open test-report</code></pre>
</div>
</div>
<div class="paragraph">
<p>or</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">./gradlew check
open build/reports/tests/index.html</code></pre>
</div>
</div>


<h2 id="controller">3.6 Root Url to Weather Controller</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails-guides/grails-mock-http-server/edit/master/src/main/docs/guide/controller.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Create a <code>HomeController</code> which uses the previous service:</p>
</div>
<div class="listingblock">
<div class="title">grails-app/controllers/demo/HomeController.groovy</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">package</span> demo

<span class="keyword">import</span> <span class="include">groovy.transform.CompileStatic</span>
<span class="keyword">import</span> <span class="include">org.openweathermap.CurrentWeather</span>
<span class="keyword">import</span> <span class="include">org.openweathermap.OpenweathermapService</span>
<span class="keyword">import</span> <span class="include">org.openweathermap.Unit</span>

<span class="annotation">@CompileStatic</span>
<span class="type">class</span> <span class="class">HomeController</span> {
    OpenweathermapService openweathermapService

    <span class="keyword">def</span> <span class="function">index</span>(<span class="predefined-type">String</span> unit) {
        Unit unitEnum = Unit.unitWithString(unit)
        CurrentWeather currentWeather = openweathermapService.currentWeather(unitEnum)
        [<span class="key">currentWeather</span>: currentWeather, <span class="key">unit</span>: unitEnum]
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In <code>UrlMapping.groovy</code> map the root URL to this controller:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="string"><span class="delimiter">&quot;</span><span class="content">/</span><span class="delimiter">&quot;</span></span>(<span class="key">controller</span>: <span class="string"><span class="delimiter">'</span><span class="content">home</span><span class="delimiter">'</span></span>)<span class="error">`</span></code></pre>
</div>
</div>


<h2 id="taglib">3.7 TagLib</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails-guides/grails-mock-http-server/edit/master/src/main/docs/guide/taglib.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Create a taglib to help you, to encapsulate some rendering aspects:</p>
</div>
<div class="listingblock">
<div class="title">grails-app/taglib/org/openweathermap/OpenweathermapTagLib.groovy</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">package</span> org.openweathermap

<span class="type">class</span> <span class="class">OpenweathermapTagLib</span> {
    <span class="directive">static</span> namespace = <span class="string"><span class="delimiter">&quot;</span><span class="content">openweather</span><span class="delimiter">&quot;</span></span>

    <span class="keyword">def</span> image = { attrs -&gt;
        out &lt;&lt; <span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;img src=</span><span class="char">\&quot;</span><span class="content">http://openweathermap.org/img/w/</span><span class="inline"><span class="inline-delimiter">${</span>attrs.icon<span class="inline-delimiter">}</span></span><span class="content">.png</span><span class="char">\&quot;</span><span class="content">/&gt;</span><span class="delimiter">&quot;</span></span>
    }

    <span class="keyword">def</span> temperatureSymbol = { attrs -&gt;
        <span class="keyword">if</span> ( attrs.unit == Unit.Imperial ) {
            out &lt;&lt; <span class="string"><span class="delimiter">'</span><span class="content">°F</span><span class="delimiter">'</span></span>
        } <span class="keyword">else</span> <span class="keyword">if</span> ( attrs.unit == Unit.Metric ) {
            out &lt;&lt; <span class="string"><span class="delimiter">'</span><span class="content">°C</span><span class="delimiter">'</span></span>
        }

    }
}</code></pre>
</div>
</div>


<h2 id="view">3.8 View</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails-guides/grails-mock-http-server/edit/master/src/main/docs/guide/view.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Create the next GSPs to render the gathered Weather information as an HTML page.</p>
</div>
<div class="listingblock">
<div class="title">grails-app/views/home/index.gsp</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">&lt;html&gt;
&lt;head&gt;
    &lt;title&gt;Current Weather&lt;<span class="regexp"><span class="delimiter">/</span><span class="content">title&gt;</span></span><span class="error">
</span>    &lt;meta name=<span class="string"><span class="delimiter">&quot;</span><span class="content">layout</span><span class="delimiter">&quot;</span></span> content=<span class="string"><span class="delimiter">&quot;</span><span class="content">main</span><span class="delimiter">&quot;</span></span> /&gt;
&lt;<span class="regexp"><span class="delimiter">/</span><span class="content">head&gt;</span></span><span class="error">
</span>&lt;body&gt;
    &lt;div id=<span class="string"><span class="delimiter">&quot;</span><span class="content">content</span><span class="delimiter">&quot;</span></span> role=<span class="string"><span class="delimiter">&quot;</span><span class="content">main</span><span class="delimiter">&quot;</span></span>&gt;
        &lt;section <span class="type">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">row colset-2-its</span><span class="delimiter">&quot;</span></span>&gt;
            &lt;<span class="class">g</span>:<span class="keyword">if</span> test=<span class="string"><span class="delimiter">&quot;</span><span class="inline"><span class="inline-delimiter">${</span>currentWeather<span class="inline-delimiter">}</span></span><span class="delimiter">&quot;</span></span>&gt;
                &lt;<span class="key">g</span>:render template=<span class="string"><span class="delimiter">&quot;</span><span class="content">/openweather/currentWeather</span><span class="delimiter">&quot;</span></span>
                          model=<span class="string"><span class="delimiter">&quot;</span><span class="content">[currentWeather: currentWeather, unit: unit]</span><span class="delimiter">&quot;</span></span>/&gt;
            &lt;<span class="regexp"><span class="delimiter">/</span><span class="content">g:if&gt;</span></span><span class="error">
</span>        &lt;<span class="regexp"><span class="delimiter">/</span><span class="content">section&gt;</span></span><span class="error">
</span>    &lt;<span class="regexp"><span class="delimiter">/</span><span class="content">div&gt;</span></span><span class="error">
</span>&lt;<span class="regexp"><span class="delimiter">/</span><span class="content">body&gt;</span></span><span class="error">
</span>&lt;<span class="regexp"><span class="delimiter">/</span><span class="content">html&gt;</span></span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">grails-app/views/openweather/_currentWeather.gsp</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">&lt;<span class="key">g</span>:<span class="keyword">if</span> test=<span class="string"><span class="delimiter">&quot;</span><span class="inline"><span class="inline-delimiter">${</span>currentWeather.weatherList<span class="inline-delimiter">}</span></span><span class="delimiter">&quot;</span></span>&gt;
    &lt;<span class="key">g</span>:each <span class="keyword">in</span>=<span class="string"><span class="delimiter">&quot;</span><span class="inline"><span class="inline-delimiter">${</span>currentWeather.weatherList<span class="inline-delimiter">}</span></span><span class="delimiter">&quot;</span></span> var=<span class="string"><span class="delimiter">&quot;</span><span class="content">weather</span><span class="delimiter">&quot;</span></span>&gt;
        &lt;div <span class="type">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">weatherBlock</span><span class="delimiter">&quot;</span></span>&gt;
            &lt;<span class="class">h2</span>&gt;&lt;b&gt;<span class="error">$</span>{currentWeather.cityName}&lt;<span class="regexp"><span class="delimiter">/</span><span class="content">b&gt;&lt;</span><span class="delimiter">/</span></span>h2&gt;
            &lt;h3&gt;<span class="error">$</span>{currentWeather.main?.temperature} &lt;<span class="key">openweather</span>:temperatureSymbol unit=<span class="string"><span class="delimiter">&quot;</span><span class="inline"><span class="inline-delimiter">${</span>unit<span class="inline-delimiter">}</span></span><span class="delimiter">&quot;</span></span>/&gt;&lt;<span class="regexp"><span class="delimiter">/</span><span class="content">h3&gt;</span></span><span class="error">
</span>            &lt;<span class="key">openweather</span>:image icon=<span class="string"><span class="delimiter">&quot;</span><span class="inline"><span class="inline-delimiter">${</span>weather.icon<span class="inline-delimiter">}</span></span><span class="delimiter">&quot;</span></span>/&gt;
            &lt;h4&gt;<span class="error">$</span>{weather.description}&lt;<span class="regexp"><span class="delimiter">/</span><span class="content">h4&gt;</span></span><span class="error">
</span>        &lt;<span class="regexp"><span class="delimiter">/</span><span class="content">div&gt;</span></span><span class="error">
</span>    &lt;<span class="regexp"><span class="delimiter">/</span><span class="content">g:each&gt;</span></span><span class="error">
</span>&lt;<span class="regexp"><span class="delimiter">/</span><span class="content">g:if&gt;</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Add the next CSS snippet to style the weather forecast.</p>
</div>
<div class="listingblock">
<div class="title">grails-app/assets/stylesheets/main.css</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="css"><span class="class">.weatherBlock</span> {
     <span class="key">width</span>: <span class="float">150px</span>;
     <span class="key">height</span>: <span class="float">200px</span>;
     <span class="key">margin</span>: <span class="float">10px</span> <span class="value">auto</span>;
     <span class="key">text-align</span>: <span class="value">center</span>;
     <span class="key">border</span>: <span class="float">1px</span> <span class="value">solid</span> <span class="color">#c0d3db</span>;
     <span class="key">float</span>: <span class="value">left</span>;
}</code></pre>
</div>
</div>


<h1 id="runningTheApp">4 Running the Application</h1>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails-guides/grails-mock-http-server/edit/master/src/main/docs/guide/runningTheApp.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>To run the application use the <code>./gradlew bootRun</code> command which will start the application on port 8080.</p>
</div>
<div class="paragraph">
<p>If you setup a valid API Key in <code>application.yml</code>, you will see the London weather prediction.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../img/homepage.png" alt="homepage">
</div>
</div>


<h1 id="helpWithGrails">5 Help with Grails</h1>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails-guides/grails-mock-http-server/edit/master/src/main/docs/guide/helpWithGrails.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<h3 style="color: #333; margin-bottom:25px;"><a href="https://objectcomputing.com/" target="_blank">Object Computing, Inc.</a> (OCI) sponsored the creation of this Guide. A variety of consulting and support services are available.</h3>

<!-- BEGIN HubSpot Consultation Form -->

<!--[if lte IE 8]>
<script charset="utf-8" type="text/javascript" src="//js.hsforms.net/forms/v2-legacy.js"></script>
<![endif]-->
<script charset="utf-8" type="text/javascript" src="//js.hsforms.net/forms/v2.js"></script>
<script>
  hbspt.forms.create({
	portalId: "4547412",
	formId: "f8bc9b16-d5f6-4226-a24e-da0eb8b73363"
});
</script>

<!-- END HubSpot Consultation Form -->

<h3 style="color: #333;">OCI is Home to Grails</h3>

<p><a href="https://objectcomputing.com/products/2gm-team" target="_blank">Meet the Team</a></p>

</article></div><footer>
  <div class='content'>
    <div class='ocihometograils'>
      <span>Sponsored by</span>
      <a href='https://objectcomputing.com/products/grails/'><img class='' src='/images/oci_home_to_grails.svg' alt='Object Computing - Home to Grails' width='300px' /></a>
    </div>
    <nav class='socialmedianav'><ul>
  <li>
    <a href='https://slack.grails.org'><img class='' src='/images/slack.svg' alt='Slack Icon' /></a>
  </li>
  <li>
    <a href='https://www.youtube.com/watch?v=XnRNfDGkBVg&amp;list=PLI74De5M9T73uH3WilDCePP2qfSDpMaGu'><img class='' src='/images/youtube.svg' alt='Youtube Icon' /></a>
  </li>
  <li>
    <a href='https://www.linkedin.com/groups/39757'><img class='' src='/images/linkedin.svg' alt='LinkedIn Icon' /></a>
  </li>
  <li>
    <a href='https://github.com/grails/'><img class='' src='/images/github.svg' alt='Github Icon' /></a>
  </li>
  <li>
    <a href='https://twitter.com/grailsframework'><img class='' src='/images/twitter.svg' alt='Twitter Icon' /></a>
  </li>
</ul></nav>
    <nav class='partnersnav'><ul>
  <li>Grails' repositories are hosted by
    <a href='https://repo.grails.org/'>Artifactory</a>
  </li>
  <li>Website hosting provided by
    <a href='https://aws.amazon.com/'>AWS</a>
  </li>
  <li>JetBrains supports Grails with its 
    <a href='https://www.jetbrains.com/idea/'>IntelliJ IDEA IDE</a>
  </li>
  <li>YourKit supports Grails with its 
    <a href='https://www.yourkit.com/java/profiler/index.jsp'>Java Profiler</a>
  </li>
  <li>Grails is Open Source
    <a href='http://www.apache.org/licenses/LICENSE-2.0.html'>Apache 2 License</a>
  </li>
  <li>
    <a href='https://grails.org/buildstatus.html'>Build Status</a>
  </li>
</ul></nav>
  </div>
</footer><div>
  <script type='text/javascript'>
              (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
              (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
              m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
              })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

              ga('create', 'UA-82213539-2', 'auto');
              ga('send', 'pageview');
</script>
  <script type='text/javascript'>
adroll_adv_id = "HBWJH4CQCJGS5DJRSB4Z4D";
adroll_pix_id = "IVEQYFOZXZAPZMDVQH7BFE";
/* OPTIONAL: provide email to improve user identification */
/* adroll_email = "username@example.com"; */
(function () {
    var _onload = function(){
        if (document.readyState && !/loaded|complete/.test(document.readyState)){setTimeout(_onload, 10);return}
        if (!window.__adroll_loaded){__adroll_loaded=true;setTimeout(_onload, 50);return}
        var scr = document.createElement("script");
        var host = (("https:" == document.location.protocol) ? "https://s.adroll.com" : "http://a.adroll.com");
        scr.setAttribute('async', 'true');
        scr.type = "text/javascript";
        scr.src = host + "/j/roundtrip.js";
        ((document.getElementsByTagName('head') || [null])[0] ||
            document.getElementsByTagName('script')[0].parentNode).appendChild(scr);
    };
    if (window.addEventListener) {window.addEventListener('load', _onload, false);}
    else {window.attachEvent('onload', _onload)}
}());            
</script>
</div></body>
</html>
