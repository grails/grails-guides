<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
                      "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
    <head>
        <title>Deploy a Grails app to Google Cloud</title>
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <link rel="stylesheet" href="../css/main.css" type="text/css" media="screen, print" title="Style" charset="utf-8" />
        <link rel="stylesheet" href="../css/guide.css" type="text/css" media="screen, print" title="Style" charset="utf-8" />        
        <link rel="stylesheet" href="../css/pdf.css" type="text/css" media="print" title="PDF" charset="utf-8" />

        <script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/1.5.13/clipboard.min.js"></script>
    <script type="text/javascript">
function addJsClass(el) {
    var classes = document.body.className.split(" ");
    classes.push("js");
    document.body.className = classes.join(" ");
}
    </script>

        <link rel="stylesheet" type="text/css" href="../css/font-awesome.min.css" />        
        <link rel="stylesheet" type="text/css" href="../css/navbar.css" />
        <link rel="stylesheet" type="text/css" href="../css/stMenu.css" />      

    </head>

    <body class="body" onload="addJsClass();">

    <a href="https://github.com/grails/grails-core" target="_blank">
      <div id="fork-me">
        <p>Fork me on Github</p>
      </div>
    </a>
    <div id="st-container" class="st-container st-effect-9">
      <nav class="st-menu st-effect-9" id="menu-12">
        <h2 class="icon icon-lab">Socialize</h2>
        <ul>
          <li><a href="http://grails.org/mailing-lists.html" class="icon"><span class="fa fa-envelope"></span> Discuss on the Mailing List</a></li>
          <li><a href="http://slack-signup.grails.org" class="icon"><span class="fa fa-slack"></span> Discuss on Slack</a></li>
          <li><a href="https://twitter.com/grailsframework" class="icon"><span class="fa fa-twitter"></span> Grails on Twitter</a></li>
          <li><a href="http://grails.org/events.html" class="icon"><span class="fa fa-calendar"></span> Events and conferences</a></li>
          <li><a href="https://github.com/grails/grails-core" class="icon"><span class="fa fa-github"></span> Source code on GitHub</a></li>
          <li><a href="http://grails.org/contribute.html#reporting-issues" class="icon"><span class="fa fa-bug"></span> Report issues on Github</a></li>
          <li><a href="http://stackoverflow.com/questions/tagged/grails" class="icon"><span class="fa fa-stack-overflow"></span> Stack Overflow questions</a></li>
        </ul>
      </nav>
      <div class="st-pusher">
        <div class="st-content">
          <div class="st-content">
            <div class="grailsnavbar grailsnavbar-default">
              <div class="grailsnavbar-container">
                <div class="grailsnavbar-header">
                  <a class="grailsnavbar-brand" href="index.html"><i class="fa grails-icon"><img src="../img/grails-cupsonly-logo-white.svg"></i> Grails</a>
                </div>
                <a id="nav-icon" href="javascript:toggleNavIcon();">
                  <span></span>
                  <span></span>
                  <span></span>
                </a>
                <div class="grailsnavbar-collapse collapse">
                  <ul id="grailsnavbar-nav" class="grailsnavbar-nav grailsnavbar-right closemobile">
                    <li><a href="http://grails.org/learn.html">Learn</a></li>
                    <li><a href="http://guides.grails.org">Guides</a></li>
                    <li><a href="http://grails.org/documentation.html">Documentation</a></li>
                    <li><a href="http://grails.org/download.html">Download</a></li>
                    <li><a href="http://plugins.grails.org">Plugins</a></li>
                    <li><a href="http://grails.org/community.html">Community</a></li>
                    <li><a href="http://grails.org/support.html">Support</a></li>
                    <li><a data-effect="st-effect-9" class="st-trigger" href="#">Socialize</a></li>
                    <li><a href="http://grails.org/search.html"><i class="fa fa-search"></i></a></li>
                  </ul>
                </div>
              </div>
            </div>
            <!-- CONTENT -->
<table id="colset" border="0" cellpadding="0" cellspacing="0">
                                <tr>
                                    <td id="col1">
                                        <div id="main" class="corner-all">

                                            <div class="project">
                                                <h1>Deploy a Grails app to Google Cloud</h1>
                                                <p></p>
                                                <p>Learn how to deploy a Grails 3 application to Google App Engine Java Flexible Environment, integrate with Google Cloud Storage and Google Cloud SQL</p>
                                                <p><strong>Authors:</strong> Sergio del Amo, Mathew Moss</p>
                                                <p><strong>Grails Version:</strong> 3.3.0</p>

                                            </div>

                                            

<h1 id="gettingStarted">1 Getting Started</h1>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails-guides/grails-google-cloud/edit/master/src/main/docs/guide/gettingStarted.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>In this guide, you are going to deploy a Grails 3 application
to <a href="https://cloud.google.com/appengine/docs/flexible/">Google App Engine Flexible Environment</a>, upload
images to <a href="https://cloud.google.com/storage/">Google Cloud Storage</a>
and use a MySQL database provided by <a href="https://cloud.google.com/sql/">Cloud SQL</a>.</p>
</div>


<h1 id="costs">2 Costs</h1>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails-guides/grails-google-cloud/edit/master/src/main/docs/guide/costs.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>This guide uses paid services; you may need to enable Billing in Google Cloud
to complete some steps in this guide.</p>
</div>


<h1 id="whatYouWillNeed">3 What you will need</h1>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails-guides/grails-google-cloud/edit/master/src/main/docs/guide/whatYouWillNeed.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>To complete this guide, you will need the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Some time on your hands</p>
</li>
<li>
<p>A decent text editor or IDE</p>
</li>
<li>
<p>JDK 1.7 or greater installed with JAVA_HOME configured appropriately</p>
</li>
</ul>
</div>


<h1 id="howToComplete">4 How to Complete</h1>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails-guides/grails-google-cloud/edit/master/src/main/docs/guide/howToComplete.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>To get started do the following:</p>
</div>
<div class="paragraph">
<p><a href="https://github.com/grails-guides/grails-google-cloud/archive/master.zip">Download</a>
and unzip the source or Clone the Git repository:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">git clone https://github.com/grails-guides/grails-google-cloud.git</code></pre>
</div>
</div>
<div class="paragraph">
<p>The Grails guides repositories contain two folders:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>initial</code> Initial project. A simple Grails app with additional some code to give you a head-start.</p>
</li>
<li>
<p><code>complete</code> A completed example. It is the result of working through the steps presented by the guide and applying those changes to the initial folder.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>To complete the guide, go to the initial folder</p>
</div>
<div class="paragraph">
<p><code>cd initial</code></p>
</div>
<div class="paragraph">
<p>and follow the instructions in the next sections.</p>
</div>
<div class="paragraph">
<p>or you can go right to the completed example:</p>
</div>
<div class="paragraph">
<p><code>cd complete</code></p>
</div>
<div class="paragraph">
<p>Although you can go right to the completed example, in order to deploy the app you
would need to complete several configuration steps in Google Cloud:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Signup for Cloud SDK and install Cloud SDK.</p>
</li>
<li>
<p>Initialize an App Engine application within the current Google Cloud project.</p>
</li>
<li>
<p>Create a Mysql Database in an instance of Cloud SQL.</p>
</li>
<li>
<p>Enable Cloud Datastore API for the project</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Moreover, You would need to modify your <code>application.yml</code> configuration to point
to the correct Cloud SQL database and Cloud Storage Bucket. Checkout the guide
steps for more details.</p>
</div>


<h1 id="writingTheApp">5 Writing the application</h1>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails-guides/grails-google-cloud/edit/master/src/main/docs/guide/writingTheApp.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>





<h2 id="domainClass">5.1 Domain Class</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails-guides/grails-google-cloud/edit/master/src/main/docs/guide/domainClass.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>We want to persist some test data in a Cloud SQL database. The initial project
includes a Grails Domain Class to map <code>Book</code> instances to a MySQL table.</p>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>A domain class fulfills the M in the Model View Controller (MVC) pattern and represents a persistent entity that is
mapped onto an underlying database table. In Grails a domain is a class that lives in the grails-app/domain directory.</p>
</div>
</blockquote>
</div>
<div class="listingblock">
<div class="title">grails-app/domain/demo/Book.groovy</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">package</span> demo

<span class="keyword">import</span> <span class="include">grails.compiler.GrailsCompileStatic</span>

<span class="annotation">@GrailsCompileStatic</span>
<span class="type">class</span> <span class="class">Book</span> {
    <span class="predefined-type">String</span> name
    <span class="predefined-type">String</span> featuredImageUrl
    <span class="predefined-type">String</span> fileName

    <span class="directive">static</span> constraints = {
        name <span class="key">unique</span>: <span class="predefined-constant">true</span>
        featuredImageUrl <span class="key">nullable</span>: <span class="predefined-constant">true</span>
        fileName <span class="key">nullable</span>: <span class="predefined-constant">true</span>
    }
}</code></pre>
</div>
</div>


<h2 id="seedData">5.2 Seed Data</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails-guides/grails-google-cloud/edit/master/src/main/docs/guide/seedData.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>When the application starts we are going to add some seed data. In particular, we persist a list of books.</p>
</div>
<div class="paragraph">
<p>Modify <em>BootStrap.groovy</em>.</p>
</div>
<div class="listingblock">
<div class="title">grails-app/init/demo/BootStrap.groovy</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">package</span> demo

<span class="keyword">import</span> <span class="include">groovy.transform.CompileStatic</span>

<span class="annotation">@CompileStatic</span>
<span class="type">class</span> <span class="class">BootStrap</span> {
    <span class="keyword">def</span> init = { servletContext -&gt;
        <span class="predefined-type">Book</span>.saveAll(
            <span class="keyword">new</span> <span class="predefined-type">Book</span>(<span class="key">name</span>: <span class="string"><span class="delimiter">'</span><span class="content">Grails 3: A Practical Guide to Application Development</span><span class="delimiter">'</span></span>),
            <span class="keyword">new</span> <span class="predefined-type">Book</span>(<span class="key">name</span>: <span class="string"><span class="delimiter">'</span><span class="content">Falando de Grails</span><span class="delimiter">'</span></span>,),
            <span class="keyword">new</span> <span class="predefined-type">Book</span>(<span class="key">name</span>: <span class="string"><span class="delimiter">'</span><span class="content">The Definitive Guide to Grails 2</span><span class="delimiter">'</span></span>),
            <span class="keyword">new</span> <span class="predefined-type">Book</span>(<span class="key">name</span>: <span class="string"><span class="delimiter">'</span><span class="content">Grails in Action</span><span class="delimiter">'</span></span>),
            <span class="keyword">new</span> <span class="predefined-type">Book</span>(<span class="key">name</span>: <span class="string"><span class="delimiter">'</span><span class="content">Grails 2: A Quick-Start Guide</span><span class="delimiter">'</span></span>),
            <span class="keyword">new</span> <span class="predefined-type">Book</span>(<span class="key">name</span>: <span class="string"><span class="delimiter">'</span><span class="content">Programming Grails</span><span class="delimiter">'</span></span>)
        )
    }
    <span class="keyword">def</span> destroy = {
    }
}</code></pre>
</div>
</div>


<h2 id="urlMappings">5.3 Display Books</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails-guides/grails-google-cloud/edit/master/src/main/docs/guide/urlMappings.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>As the home page of the application, we want to display the books persisted when the application starts;
those we saved in <em>BootStrap.groovy</em></p>
</div>
<div class="paragraph">
<p>We map the home page to be resolved by <code>BookController</code> by modifying <code>UrlMappings.groovy</code></p>
</div>
<div class="paragraph">
<p>Replace:</p>
</div>
<div class="paragraph">
<p><code>grails-app/controllers/demo/UrlMappings.groovy</code></p>
</div>
<div class="literalblock">
<div class="content">
<pre>"/"(view:"/index")</pre>
</div>
</div>
<div class="paragraph">
<p>with:</p>
</div>
<div class="paragraph">
<p><code>grails-app/controllers/demo/UrlMappings.groovy</code></p>
</div>
<div class="literalblock">
<div class="content">
<pre>'/'(controller: 'book')</pre>
</div>
</div>
<div class="paragraph">
<p>We have modified slightly the output of Grails static scaffolding command
<code>generate-all</code> to provide CRUD functionality for the domain class <code>Book</code>.</p>
</div>
<div class="paragraph">
<p>You can find the code: <code>BookController</code>, <code>BookGormService</code> and GSP views in
the initial project.</p>
</div>


<h1 id="cloudSDK">6 Cloud SDK</h1>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails-guides/grails-google-cloud/edit/master/src/main/docs/guide/cloudSDK.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Signup for <a href="https://console.cloud.google.com/">Google Cloud Platform</a> and create a new project:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../img/create-project.png" alt="create project">
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="../img/create-project-2.png" alt="create project 2">
</div>
</div>
<div class="paragraph">
<p>We named the project <code>grailsgooglecloud</code></p>
</div>
<div class="paragraph">
<p>Install <a href="https://cloud.google.com/sdk/downloads">Cloud SDK</a> for your operating system.</p>
</div>
<div class="paragraph">
<p>After you have installed the SDK, run the init command in your terminal:</p>
</div>
<div class="paragraph">
<p><code>$ gcloud init</code></p>
</div>
<div class="paragraph">
<p>It will prompt you to select the Google account and the project which you want to use.</p>
</div>


<h1 id="googleAppEngine">7 Google App Engine</h1>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails-guides/grails-google-cloud/edit/master/src/main/docs/guide/googleAppEngine.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>We are going to deploy the Grails application developed in this guide to the
<a href="https://cloud.google.com/appengine/docs/flexible/">Google App Engine Flexible Environment</a></p>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>App Engine allows developers to focus on doing what they do best: writing code. Based on Google Compute Engine, the App Engine flexible environment automatically scales your app up and down while balancing the load. Microservices, authorization, SQL and NoSQL databases, traffic splitting, logging, versioning, security scanning, and content delivery networks are all supported natively.</p>
</div>
</blockquote>
</div>
<div class="paragraph">
<p>Run the command:</p>
</div>
<div class="paragraph">
<p><code>gcloud app create</code></p>
</div>
<div class="paragraph">
<p>to initialize an App Engine application within the current Google Cloud project.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
You will need to choose the region where you want your App Engine Application located.
</td>
</tr>
</table>
</div>


<h2 id="googleAppEngineGradlePlugin">7.1 Google App Engine Gradle Plugin</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails-guides/grails-google-cloud/edit/master/src/main/docs/guide/googleAppEngineGradlePlugin.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>To deploy to App Engine, we are going to use the
<a href="https://github.com/GoogleCloudPlatform/app-gradle-plugin">Google App Engine Gradle Plugin</a>.</p>
</div>
<div class="paragraph">
<p>Add the plugin as a <code>buildscript</code> dependency:</p>
</div>
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">buildscript {
    repositories {
        mavenLocal()
        maven { url <span class="string"><span class="delimiter">&quot;</span><span class="content">https://repo.grails.org/grails/core</span><span class="delimiter">&quot;</span></span> }
    }
    dependencies {
        classpath <span class="string"><span class="delimiter">&quot;</span><span class="content">org.grails:grails-gradle-plugin:</span><span class="inline"><span class="inline-delimiter">$</span>grailsVersion</span><span class="delimiter">&quot;</span></span>
        classpath <span class="string"><span class="delimiter">&quot;</span><span class="content">com.bertramlabs.plugins:asset-pipeline-gradle:2.14.2</span><span class="delimiter">&quot;</span></span>
        classpath <span class="string"><span class="delimiter">&quot;</span><span class="content">org.grails.plugins:hibernate5:</span><span class="inline"><span class="inline-delimiter">${</span>gormVersion-<span class="string"><span class="delimiter">&quot;</span><span class="content">.RELEASE</span><span class="delimiter">&quot;</span></span><span class="inline-delimiter">}</span></span><span class="delimiter">&quot;</span></span>
        classpath <span class="string"><span class="delimiter">'</span><span class="content">com.google.cloud.tools:appengine-gradle-plugin:1.3.2</span><span class="delimiter">'</span></span>
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Apply the plugin:</p>
</div>
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">apply <span class="key">plugin</span>: <span class="string"><span class="delimiter">'</span><span class="content">com.google.cloud.tools.appengine</span><span class="delimiter">'</span></span></code></pre>
</div>
</div>


<h2 id="applicationDeploymentConfiguration">7.2 Application Deployment Configuration</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails-guides/grails-google-cloud/edit/master/src/main/docs/guide/applicationDeploymentConfiguration.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>To deploy to Google App Engine, we need to add the file <code>src/main/appengine/app.yaml</code></p>
</div>
<div class="paragraph">
<p>It describes the application&#8217;s deployment configuration:</p>
</div>
<div class="listingblock">
<div class="title">/src/main/appengine/app.yaml</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="key">runtime</span>: java
<span class="key">env</span>: flex

<span class="key">runtime_config</span>:
    <span class="key">jdk</span>: openjdk8
    <span class="key">server</span>: jetty9

<span class="key">health_check</span>:
    <span class="key">enable_health_check</span>: False

<span class="key">resources</span>:
    <span class="key">cpu</span>: <span class="integer">1</span>
    <span class="key">memory_gb</span>: <span class="float">2.3</span>

<span class="key">manual_scaling</span>:
    <span class="key">instances</span>: <span class="integer">1</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Here, <code>app.yaml</code> specifies the runtime used by the app, and sets <code>env: flex</code>,
specifying that the app uses the <a href="https://cloud.google.com/appengine/docs/flexible/">flexible environment</a>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The minimal <code>app.yaml</code> application configuration file shown above is sufficient for a simple Grails application.
Depending on the size, complexity, and features that your application uses, you may need to change and extend this basic
configuration file. For more information on what can be configured via <code>app.yaml</code>, please see the
<a href="https://cloud.google.com/appengine/docs/flexible/java/configuring-your-app-with-app-yaml">Configuring Your App with app.yaml</a>
guide.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>For more information on how the Java runtime works, see <a href="https://cloud.google.com/appengine/docs/flexible/java/dev-jetty9">Java 8 / Jetty 9.3 Runtime</a>.</p>
</div>


<h2 id="springBootJetty">7.3 SpringBoot Jetty</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails-guides/grails-google-cloud/edit/master/src/main/docs/guide/springBootJetty.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>As shown in the previous app engine configuration file, we are using Jetty.</p>
</div>
<div class="paragraph">
<p>Grails is built on top of SpringBoot. Following SpringBootâ€™s documentation, we need to do the following changes to [deploy to Jetty instead of Tomcat](<a href="https://docs.spring.io/spring-boot/docs/current/reference/html/howto-embedded-servlet-containers.html" class="bare">https://docs.spring.io/spring-boot/docs/current/reference/html/howto-embedded-servlet-containers.html</a>).</p>
</div>
<div class="paragraph">
<p>Replace:</p>
</div>
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">    compile <span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.boot:spring-boot-starter-tomcat</span><span class="delimiter">&quot;</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>with:</p>
</div>
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">provided <span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.boot:spring-boot-starter-jetty</span><span class="delimiter">&quot;</span></span></code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
it is important you set the <code>spring-boot-starter-jetty</code> dependency as <code>provided</code>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>We need to exclude several dependencies too:</p>
</div>
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">configurations {
    compile.exclude <span class="key">module</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">tomcat-juli</span><span class="delimiter">&quot;</span></span>
    compile.exclude <span class="key">module</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">spring-boot-starter-tomcat</span><span class="delimiter">&quot;</span></span>
    compile.exclude <span class="key">group</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">com.google.guava</span><span class="delimiter">&quot;</span></span>, <span class="key">module</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">guava-jdk5</span><span class="delimiter">&quot;</span></span>
}</code></pre>
</div>
</div>


<h1 id="cloudSQL">8 Cloud SQL</h1>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails-guides/grails-google-cloud/edit/master/src/main/docs/guide/cloudSQL.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>The Grails application developed during this guide is going to use a
MySQL database created with <a href="https://cloud.google.com/sql/">Cloud SQL</a></p>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>Cloud SQL is a fully-managed database service that makes it easy to set up, maintain, manage, and administer your relational PostgreSQL BETA and MySQL databases in the cloud. Cloud SQL offers high performance, scalability, and convenience. Hosted on Google Cloud Platform, Cloud SQL provides a database infrastructure for applications running anywhere.</p>
</div>
</blockquote>
</div>
<div class="sect1">
<h2 id="_enable_cloud_sql_api">Enable Cloud SQL API</h2>
<div class="sectionbody">
<div class="paragraph">
<p>If you have not enabled <strong>Cloud SQL</strong> and <strong>Cloud SQL API already</strong>, go to your project
dashboard and enable them.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../img/cloudsql-1.png" alt="cloudsql 1">
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="../img/cloudsql-2.png" alt="cloudsql 2">
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="../img/cloudsql-3.png" alt="cloudsql 3">
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="../img/cloudsql-4.png" alt="cloudsql 4">
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="../img/cloudsqlapi-1.png" alt="cloudsqlapi 1">
</div>
</div>
</div>
</div>


<h2 id="createCloudSQLInstance">8.1 Create Cloud SQL Instance</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails-guides/grails-google-cloud/edit/master/src/main/docs/guide/createCloudSQLInstance.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>We are going to <a href="https://console.cloud.google.com/sql">create a new instance of Cloud SQL</a>)
associated to the same project we created before.</p>
</div>
<div class="paragraph">
<p>Go to the Cloud SQL section of the console:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../img/cloudsql-5.png" alt="cloudsql 5">
</div>
</div>
<div class="paragraph">
<p>Next screenshots illustrate the process:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../img/cloudsql-6.png" alt="cloudsql 6">
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="../img/cloudsql-7.png" alt="cloudsql 7">
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="../img/cloudsql-8.png" alt="cloudsql 8">
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="../img/cloudsql-9.png" alt="cloudsql 9">
</div>
</div>
<div class="paragraph">
<p>Once the instance is ready, we create a database:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../img/cloudsql-10.png" alt="cloudsql 10">
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="../img/cloudsql-11.png" alt="cloudsql 11">
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="../img/cloudsql-12.png" alt="cloudsql 12">
</div>
</div>


<h2 id="datasourceUsingCloudSQL">8.2 Datasource using Cloud SQL</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails-guides/grails-google-cloud/edit/master/src/main/docs/guide/datasourceUsingCloudSQL.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>As described in Using <a href="https://cloud.google.com/appengine/docs/flexible/java/using-cloud-sql">Cloud SQL</a>
with a Flexible Environment documentation, we need to add several runtime dependencies and configure
the production url to use the Cloud SQL MySQL database we created before.</p>
</div>
<div class="paragraph">
<p>Add MySQL dependencies; JDBC library and Cloud SQL MySQL Socket Factory.</p>
</div>
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">    runtime <span class="string"><span class="delimiter">'</span><span class="content">mysql:mysql-connector-java:6.0.5</span><span class="delimiter">'</span></span>
    runtime <span class="string"><span class="delimiter">'</span><span class="content">com.google.cloud.sql:mysql-socket-factory-connector-j-6:1.0.3</span><span class="delimiter">'</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Replace the <code>production</code> environment <code>datasource</code> configuration to point to the
Cloud SQL MySQL database in <code>application.yml</code></p>
</div>
<div class="listingblock">
<div class="title">grails-app/conf/application.yml</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yml"><span class="key">environments</span>:
    <span class="key">production</span>:
        <span class="key">dataSource</span>:
            <span class="key">dialect</span>: <span class="string"><span class="content">org.hibernate.dialect.MySQL5InnoDBDialect</span></span>
            <span class="key">driverClassName</span>: <span class="string"><span class="content">com.mysql.cj.jdbc.Driver</span></span>
            <span class="key">dbCreate</span>: <span class="string"><span class="content">update</span></span>
            <span class="key">url</span>: <span class="string"><span class="content">jdbc:mysql://google/grailsgooglecloud?socketFactory=com.google.cloud.sql.mysql.SocketFactory&amp;cloudSqlInstance=grailsguide-176214:us-central1:grailsgooglecloud&amp;useSSL=true</span></span>
            <span class="key">username</span>: <span class="string"><span class="content">root</span></span>
            <span class="key">password</span>: <span class="string"><span class="content">grailsgooglecloud</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The production datasource url uses a custom url which is built with several components:</p>
</div>
<div class="paragraph">
<p><code>jdbc:mysql://google/{DATABASE_NAME}?socketFactory=com.google.cloud.sql.mysql.SocketFactory&amp;cloudSqlInstance={INSTANCE_NAME}&amp;useSSL=true</code></p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>DATABASE_NAME</strong> Use the database name you used when you created the database.</p>
</li>
<li>
<p><strong>INSTANCE_NAME</strong> You can find your instance name in your Cloud SQL instance details:</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="../img/cloudsql-13.png" alt="cloudsql 13">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>USERNAME / PASSWORD</strong> For this guide, we are using username: <code>root</code> and
the password we entered when we created the SQL instance; see previous sections.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><a href="https://github.com/GoogleCloudPlatform/cloud-sql-jdbc-socket-factory">Cloud SQL Socket Factory for JDBC drivers Github Repository</a>
contains a tool in <code>examples/getting-started</code> that can help generate the JDBC
URL and verify that connectivity can be established.</p>
</div>


<h1 id="cloudStorage">9 Cloud Storage</h1>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails-guides/grails-google-cloud/edit/master/src/main/docs/guide/cloudStorage.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>We allow our users to upload a book cover image. To store the images in the Cloud, we
use <a href="https://cloud.google.com/storage/">Google Cloud Storage</a></p>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>Google Cloud Storage is unified object storage for developers and enterprises, from live data serving to data analytics/ML to data archiving.</p>
</div>
</blockquote>
</div>
<div class="paragraph">
<p><a href="https://console.cloud.google.com/flows/enableapi?apiid=storage_api,logging,sqladmin.googleapis.com&amp;redirect=https://console.cloud.google.com&amp;_ga=1.20629880.1963584502.1488379440">Enable Cloud Storage API</a> for the project, if you have not enabled it already.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../img/cloudstorage-1.png" alt="cloudstorage 1">
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="../img/cloudstorage-2.png" alt="cloudstorage 2">
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="../img/cloudstorage-3.png" alt="cloudstorage 3">
</div>
</div>
<div class="paragraph">
<p>You can create a Cloud Storage Bucket as illustrated in the images below. We name the bucket <code>grailsbucket</code></p>
</div>
<div class="imageblock">
<div class="content">
<img src="../img/cloudstorage-4.png" alt="cloudstorage 4">
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="../img/cloudstorage-5.png" alt="cloudstorage 5">
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="../img/cloudstorage-6.png" alt="cloudstorage 6">
</div>
</div>
<div class="paragraph">
<p>Add Cloud Storage dependency to your project dependencies</p>
</div>
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">    compile <span class="string"><span class="delimiter">'</span><span class="content">com.google.cloud:google-cloud-storage:1.2.3</span><span class="delimiter">'</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>We need to exclude <em>com.google.guava:guava-jdk5</em> too:</p>
</div>
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">configurations {
    compile.exclude <span class="key">module</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">tomcat-juli</span><span class="delimiter">&quot;</span></span>
    compile.exclude <span class="key">module</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">spring-boot-starter-tomcat</span><span class="delimiter">&quot;</span></span>
    compile.exclude <span class="key">group</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">com.google.guava</span><span class="delimiter">&quot;</span></span>, <span class="key">module</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">guava-jdk5</span><span class="delimiter">&quot;</span></span>
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Append these configuration (Cloud Storage Bucket and Project id) parameters to <code>application.yml</code></p>
</div>
<div class="listingblock">
<div class="title">grails-app/conf/application.yml</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="key">googlecloud</span>:
    <span class="key">projectid</span>: grailsguide-<span class="integer">176214</span>
    <span class="key">cloudStorage</span>:
        <span class="key">bucket</span>: grailsguidebucket</code></pre>
</div>
</div>
<div class="paragraph">
<p>These configuration parameters are used by the services described below.</p>
</div>
<div class="paragraph">
<p>Create a Grails Command Object to manage file upload parameters.</p>
</div>
<div class="listingblock">
<div class="title">grails-app/controllers/demo/FeaturedImageCommand.groovy</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">package</span> demo

<span class="keyword">import</span> <span class="include">grails.validation.Validateable</span>
<span class="keyword">import</span> <span class="include">org.springframework.web.multipart.MultipartFile</span>

<span class="type">class</span> <span class="class">FeaturedImageCommand</span> <span class="directive">implements</span> Validateable {
    MultipartFile featuredImageFile
    <span class="predefined-type">Long</span> id
    <span class="predefined-type">Long</span> version

    <span class="directive">static</span> constraints = {
        id <span class="key">nullable</span>: <span class="predefined-constant">false</span>
        version <span class="key">nullable</span>: <span class="predefined-constant">false</span>
       featuredImageFile  <span class="key">validator</span>: { MultipartFile val, FeaturedImageCommand obj -&gt;
            <span class="keyword">if</span> ( val == <span class="predefined-constant">null</span> ) {
                <span class="keyword">return</span> <span class="predefined-constant">false</span>
            }
            <span class="keyword">if</span> ( val.empty ) {
                <span class="keyword">return</span> <span class="predefined-constant">false</span>
            }

            [<span class="string"><span class="delimiter">'</span><span class="content">jpeg</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">jpg</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">png</span><span class="delimiter">'</span></span>].any { <span class="predefined-type">String</span> extension -&gt;
                 val.originalFilename?.toLowerCase()?.endsWith(extension)
            }
        }
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Add two controller actions to <code>BookController</code>:</p>
</div>
<div class="listingblock">
<div class="title">grails-app/controllers/demo/BookController.groovy</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">UploadBookFeaturedImageService uploadBookFeaturedImageService

<span class="annotation">@Transactional</span>(readOnly = <span class="predefined-constant">true</span>)
<span class="keyword">def</span> <span class="function">editFeaturedImage</span>(<span class="predefined-type">Book</span> book) {
     respond book
}
<span class="annotation">@CompileDynamic</span>
<span class="keyword">def</span> <span class="function">uploadFeaturedImage</span>(FeaturedImageCommand cmd) {

    <span class="keyword">if</span> (cmd.hasErrors()) {
         respond(cmd.errors, <span class="key">model</span>: [<span class="key">book</span>: cmd], <span class="key">view</span>: <span class="string"><span class="delimiter">'</span><span class="content">editFeaturedImage</span><span class="delimiter">'</span></span>)
        <span class="keyword">return</span>
    }

    <span class="keyword">def</span> book = uploadBookFeaturedImageService.uploadFeaturedImage(cmd)
    <span class="keyword">if</span> (book == <span class="predefined-constant">null</span>) {
        notFound()
        <span class="keyword">return</span>
    }

    <span class="keyword">if</span> (book.hasErrors()) {
        respond(book.errors, <span class="key">model</span>: [<span class="key">book</span>: book], <span class="key">view</span>: <span class="string"><span class="delimiter">'</span><span class="content">editFeaturedImage</span><span class="delimiter">'</span></span>)
        <span class="keyword">return</span>
    }

    request.withFormat {
        form multipartForm {
            flash.message = message(<span class="key">code</span>: <span class="string"><span class="delimiter">'</span><span class="content">default.updated.message</span><span class="delimiter">'</span></span>, <span class="key">args</span>: [message(<span class="key">code</span>: <span class="string"><span class="delimiter">'</span><span class="content">book.label</span><span class="delimiter">'</span></span>, <span class="keyword">default</span>: <span class="string"><span class="delimiter">'</span><span class="content">Book</span><span class="delimiter">'</span></span>), book.id])
            redirect book
        }
        <span class="string"><span class="delimiter">'</span><span class="content">*</span><span class="delimiter">'</span></span> { respond book, [<span class="key">status</span>: OK] }
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The previous controller actions use a service to manage our business logic. Create <code><em>`UploadBookFeaturedImageService.groovy`</em></code>:</p>
</div>
<div class="listingblock">
<div class="title">grails-app/services/demo/UploadBookFeaturedImageService.groovy</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">package</span> demo

<span class="keyword">import</span> <span class="include">groovy.util.logging.Slf4j</span>
<span class="keyword">import</span> <span class="include">groovy.transform.CompileStatic</span>

<span class="annotation">@Slf4j</span>
<span class="annotation">@CompileStatic</span>
<span class="type">class</span> <span class="class">UploadBookFeaturedImageService</span> {

    BookGormService bookGormService

    GoogleCloudStorageService googleCloudStorageService

    <span class="directive">private</span> <span class="directive">static</span> <span class="predefined-type">String</span> fileSuffix() {
        <span class="keyword">new</span> <span class="predefined-type">Date</span>().format(<span class="string"><span class="delimiter">'</span><span class="content">-YYYY-MM-dd-HHmmssSSS</span><span class="delimiter">'</span></span>)
    }

    <span class="predefined-type">Book</span> uploadFeaturedImage(FeaturedImageCommand cmd) {
        <span class="predefined-type">String</span> fileName = <span class="string"><span class="delimiter">&quot;</span><span class="inline"><span class="inline-delimiter">${</span>cmd.featuredImageFile.originalFilename<span class="inline-delimiter">}</span></span><span class="inline"><span class="inline-delimiter">${</span>fileSuffix()<span class="inline-delimiter">}</span></span><span class="delimiter">&quot;</span></span>

        log.info <span class="string"><span class="delimiter">&quot;</span><span class="content">cloud storage file name </span><span class="inline"><span class="inline-delimiter">$</span>fileName</span><span class="delimiter">&quot;</span></span>

        <span class="predefined-type">String</span> fileUrl = googleCloudStorageService.storeMultipartFile(fileName, cmd.featuredImageFile)

        log.info <span class="string"><span class="delimiter">&quot;</span><span class="content">cloud storage media url </span><span class="inline"><span class="inline-delimiter">$</span>fileUrl</span><span class="delimiter">&quot;</span></span>

        <span class="keyword">def</span> book = bookGormService.updateFeaturedImageUrl(cmd.id, cmd.version, fileName, fileUrl)
        <span class="keyword">if</span> ( !book || book.hasErrors() ) {
            googleCloudStorageService.deleteFile(fileName)
        }
        book
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The code which interacts with Cloud Storage is encapsulated in a service:</p>
</div>
<div class="listingblock">
<div class="title">grails-app/services/demo/GoogleCloudStorageService.groovy</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">package</span> demo

<span class="keyword">import</span> <span class="include">com.google.cloud.storage.Acl</span>
<span class="keyword">import</span> <span class="include">com.google.cloud.storage.BlobId</span>
<span class="keyword">import</span> <span class="include">com.google.cloud.storage.BlobInfo</span>
<span class="keyword">import</span> <span class="include">com.google.cloud.storage.Storage</span>
<span class="keyword">import</span> <span class="include">com.google.cloud.storage.StorageOptions</span>
<span class="keyword">import</span> <span class="include">grails.config.Config</span>
<span class="keyword">import</span> <span class="include">grails.core.support.GrailsConfigurationAware</span>
<span class="keyword">import</span> <span class="include">org.springframework.web.multipart.MultipartFile</span>
<span class="keyword">import</span> <span class="include">groovy.transform.CompileStatic</span>

<span class="annotation">@SuppressWarnings</span>(<span class="string"><span class="delimiter">'</span><span class="content">GrailsStatelessService</span><span class="delimiter">'</span></span>)
<span class="annotation">@CompileStatic</span>
<span class="type">class</span> <span class="class">GoogleCloudStorageService</span> <span class="directive">implements</span> GrailsConfigurationAware {

    Storage storage = StorageOptions.defaultInstance.service

    <span class="comment">// Google Cloud Platform project ID.</span>
    <span class="predefined-type">String</span> projectId

    <span class="comment">// Cloud Storage Bucket</span>
    <span class="predefined-type">String</span> bucket

    <span class="annotation">@Override</span>
    <span class="type">void</span> setConfiguration(Config co) {
        projectId = co.getRequiredProperty(<span class="string"><span class="delimiter">'</span><span class="content">googlecloud.projectid</span><span class="delimiter">'</span></span>, <span class="predefined-type">String</span>)
        bucket = co.getProperty(<span class="string"><span class="delimiter">'</span><span class="content">googlecloud.cloudStorage.bucket</span><span class="delimiter">'</span></span>, <span class="predefined-type">String</span>, projectId)
    }

    <span class="predefined-type">String</span> storeMultipartFile(<span class="predefined-type">String</span> fileName, MultipartFile multipartFile) {
        storeInputStream(fileName, multipartFile.inputStream)
    }

    <span class="predefined-type">String</span> storeInputStream(<span class="predefined-type">String</span> fileName, <span class="predefined-type">InputStream</span> inputStream) {
        BlobInfo blobInfo = storage.create(readableBlobInfo(bucket, fileName), inputStream)
        blobInfo.mediaLink
    }

    <span class="predefined-type">String</span> storeBytes(<span class="predefined-type">String</span> fileName, <span class="type">byte</span><span class="type">[]</span> bytes) {
        BlobInfo blobInfo = storage.create(readableBlobInfo(bucket, fileName), bytes)
        blobInfo.mediaLink
    }

    <span class="directive">private</span> <span class="directive">static</span> BlobInfo readableBlobInfo(<span class="predefined-type">String</span> bucket, <span class="predefined-type">String</span> fileName) {
        BlobInfo.newBuilder(bucket, fileName)
                <span class="comment">// Modify access list to allow all users with link to read file</span>
                .setAcl([<span class="predefined-type">Acl</span>.of(<span class="predefined-type">Acl</span>.User.ofAllUsers(), <span class="predefined-type">Acl</span>.Role.READER)])
                .build()
   }

   <span class="type">boolean</span> deleteFile(<span class="predefined-type">String</span> fileName) {
       BlobId blobId = BlobId.of(bucket, fileName)
       storage.delete(blobId)
   }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>If the upload of an image to Google Cloud is successful, we save the reference to
the media url in our domain class.</p>
</div>
<div class="paragraph">
<p>Add this method to the <code>BookGormService</code> class</p>
</div>
<div class="listingblock">
<div class="title">grails-app/services/demo/BookGormService.groovy</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="annotation">@SuppressWarnings</span>(<span class="string"><span class="delimiter">'</span><span class="content">LineLength</span><span class="delimiter">'</span></span>)
<span class="predefined-type">Book</span> updateFeaturedImageUrl(<span class="predefined-type">Long</span> id, <span class="predefined-type">Long</span> version, <span class="predefined-type">String</span> fileName, <span class="predefined-type">String</span> featuredImageUrl, <span class="type">boolean</span> flush = <span class="predefined-constant">false</span>) {
    <span class="predefined-type">Book</span> book = <span class="predefined-type">Book</span>.get(id)
    <span class="keyword">if</span> ( !book ) {
        <span class="keyword">return</span> <span class="predefined-constant">null</span>
    }
    book.version = version
    book.fileName = fileName
    book.featuredImageUrl = featuredImageUrl
    book.save(<span class="key">flush</span>: flush)
    book
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>We need to add one GSP file to render the upload form:</p>
</div>
<div class="listingblock">
<div class="title">grails-app/views/book/editFeaturedImage.gsp</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">&lt;!DOCTYPE html&gt;
&lt;html&gt;
    &lt;head&gt;
        &lt;meta name=<span class="string"><span class="delimiter">&quot;</span><span class="content">layout</span><span class="delimiter">&quot;</span></span> content=<span class="string"><span class="delimiter">&quot;</span><span class="content">main</span><span class="delimiter">&quot;</span></span> /&gt;
        &lt;<span class="key">g</span>:set var=<span class="string"><span class="delimiter">&quot;</span><span class="content">entityName</span><span class="delimiter">&quot;</span></span> value=<span class="string"><span class="delimiter">&quot;</span><span class="inline"><span class="inline-delimiter">${</span>message(<span class="key">code</span>: <span class="string"><span class="delimiter">'</span><span class="content">book.label</span><span class="delimiter">'</span></span>, <span class="keyword">default</span>: <span class="string"><span class="delimiter">'</span><span class="content">Book</span><span class="delimiter">'</span></span>)<span class="inline-delimiter">}</span></span><span class="delimiter">&quot;</span></span> /&gt;
        &lt;title&gt;&lt;<span class="key">g</span>:message code=<span class="string"><span class="delimiter">&quot;</span><span class="content">default.edit.label</span><span class="delimiter">&quot;</span></span> args=<span class="string"><span class="delimiter">&quot;</span><span class="content">[entityName]</span><span class="delimiter">&quot;</span></span> /&gt;&lt;<span class="regexp"><span class="delimiter">/</span><span class="content">title&gt;</span></span><span class="error">
</span>   &lt;<span class="regexp"><span class="delimiter">/</span><span class="content">head&gt;</span></span><span class="error">
</span>   &lt;body&gt;
       &lt;a href=<span class="string"><span class="delimiter">&quot;</span><span class="content">#edit-book</span><span class="delimiter">&quot;</span></span> <span class="type">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">skip</span><span class="delimiter">&quot;</span></span> <span class="class">tabindex</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">-1</span><span class="delimiter">&quot;</span></span>&gt;&lt;<span class="key">g</span>:message code=<span class="string"><span class="delimiter">&quot;</span><span class="content">default.link.skip.label</span><span class="delimiter">&quot;</span></span> <span class="keyword">default</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Skip to content&amp;hellip;</span><span class="delimiter">&quot;</span></span>/&gt;&lt;<span class="regexp"><span class="delimiter">/</span><span class="content">a&gt;</span></span><span class="error">
</span>       &lt;div <span class="type">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">nav</span><span class="delimiter">&quot;</span></span> <span class="class">role</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">navigation</span><span class="delimiter">&quot;</span></span>&gt;
       &lt;ul&gt;
           &lt;li&gt;&lt;a <span class="type">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">home</span><span class="delimiter">&quot;</span></span> <span class="class">href</span>=<span class="string"><span class="delimiter">&quot;</span><span class="inline"><span class="inline-delimiter">${</span>createLink(<span class="key">uri</span>: <span class="string"><span class="delimiter">'</span><span class="content">/</span><span class="delimiter">'</span></span>)<span class="inline-delimiter">}</span></span><span class="delimiter">&quot;</span></span>&gt;&lt;<span class="key">g</span>:message code=<span class="string"><span class="delimiter">&quot;</span><span class="content">default.home.label</span><span class="delimiter">&quot;</span></span>/&gt;&lt;<span class="regexp"><span class="delimiter">/</span><span class="content">a&gt;&lt;</span><span class="delimiter">/</span></span>li&gt;
           &lt;li&gt;&lt;<span class="key">g</span>:link <span class="type">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">list</span><span class="delimiter">&quot;</span></span> <span class="class">action</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">index</span><span class="delimiter">&quot;</span></span>&gt;&lt;<span class="key">g</span>:message code=<span class="string"><span class="delimiter">&quot;</span><span class="content">default.list.label</span><span class="delimiter">&quot;</span></span> args=<span class="string"><span class="delimiter">&quot;</span><span class="content">[entityName]</span><span class="delimiter">&quot;</span></span> /&gt;&lt;<span class="regexp"><span class="delimiter">/</span><span class="content">g:link&gt;&lt;</span><span class="delimiter">/</span></span>li&gt;
          &lt;li&gt;&lt;<span class="key">g</span>:link <span class="type">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">create</span><span class="delimiter">&quot;</span></span> <span class="class">action</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">create</span><span class="delimiter">&quot;</span></span>&gt;&lt;<span class="key">g</span>:message code=<span class="string"><span class="delimiter">&quot;</span><span class="content">default.new.label</span><span class="delimiter">&quot;</span></span> args=<span class="string"><span class="delimiter">&quot;</span><span class="content">[entityName]</span><span class="delimiter">&quot;</span></span> /&gt;&lt;<span class="regexp"><span class="delimiter">/</span><span class="content">g:link&gt;&lt;</span><span class="delimiter">/</span></span>li&gt;
      &lt;<span class="regexp"><span class="delimiter">/</span><span class="content">ul&gt;</span></span><span class="error">
</span>     &lt;<span class="regexp"><span class="delimiter">/</span><span class="content">div&gt;</span></span><span class="error">
</span>     &lt;div id=<span class="string"><span class="delimiter">&quot;</span><span class="content">edit-book</span><span class="delimiter">&quot;</span></span> <span class="type">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">content scaffold-edit</span><span class="delimiter">&quot;</span></span> <span class="class">role</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">main</span><span class="delimiter">&quot;</span></span>&gt;
        &lt;h1&gt;&lt;<span class="key">g</span>:message code=<span class="string"><span class="delimiter">&quot;</span><span class="content">book.featuredImage.edit.label</span><span class="delimiter">&quot;</span></span> <span class="keyword">default</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Edit Featured Image</span><span class="delimiter">&quot;</span></span> /&gt;&lt;<span class="regexp"><span class="delimiter">/</span><span class="content">h1&gt;</span></span><span class="error">
</span>        &lt;<span class="key">g</span>:<span class="keyword">if</span> test=<span class="string"><span class="delimiter">&quot;</span><span class="inline"><span class="inline-delimiter">${</span>flash.message<span class="inline-delimiter">}</span></span><span class="delimiter">&quot;</span></span>&gt;
            &lt;div <span class="type">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">message</span><span class="delimiter">&quot;</span></span> <span class="class">role</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">status</span><span class="delimiter">&quot;</span></span>&gt;<span class="error">$</span>{flash.message}&lt;<span class="regexp"><span class="delimiter">/</span><span class="content">div&gt;</span></span><span class="error">
</span>        &lt;<span class="regexp"><span class="delimiter">/</span><span class="content">g:if&gt;</span></span><span class="error">
</span>       &lt;<span class="key">g</span>:hasErrors bean=<span class="string"><span class="delimiter">&quot;</span><span class="inline"><span class="inline-delimiter">${</span><span class="local-variable">this</span>.book<span class="inline-delimiter">}</span></span><span class="delimiter">&quot;</span></span>&gt;
           &lt;ul <span class="type">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">errors</span><span class="delimiter">&quot;</span></span> <span class="class">role</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">alert</span><span class="delimiter">&quot;</span></span>&gt;
               &lt;<span class="key">g</span>:eachError bean=<span class="string"><span class="delimiter">&quot;</span><span class="inline"><span class="inline-delimiter">${</span><span class="local-variable">this</span>.book<span class="inline-delimiter">}</span></span><span class="delimiter">&quot;</span></span> var=<span class="string"><span class="delimiter">&quot;</span><span class="content">error</span><span class="delimiter">&quot;</span></span>&gt;
                   &lt;li &lt;<span class="key">g</span>:<span class="keyword">if</span> test=<span class="string"><span class="delimiter">&quot;</span><span class="inline"><span class="inline-delimiter">${</span>error <span class="keyword">in</span> org.springframework.validation.FieldError<span class="inline-delimiter">}</span></span><span class="delimiter">&quot;</span></span>&gt;data-field-id=<span class="string"><span class="delimiter">&quot;</span><span class="inline"><span class="inline-delimiter">${</span>error.field<span class="inline-delimiter">}</span></span><span class="delimiter">&quot;</span></span>&lt;<span class="regexp"><span class="delimiter">/</span><span class="content">g:if&gt;&gt;&lt;g:message error=&quot;</span><span class="inline"><span class="inline-delimiter">${</span>error<span class="inline-delimiter">}</span></span><span class="content">&quot;</span><span class="delimiter">/</span></span>&gt;&lt;<span class="regexp"><span class="delimiter">/</span><span class="content">li&gt;</span></span><span class="error">
</span>              &lt;<span class="regexp"><span class="delimiter">/</span><span class="content">g:eachError&gt;</span></span><span class="error">
</span>          &lt;<span class="regexp"><span class="delimiter">/</span><span class="content">ul&gt;</span></span><span class="error">
</span>       &lt;<span class="regexp"><span class="delimiter">/</span><span class="content">g:hasErrors&gt;</span></span><span class="error">
</span>       &lt;<span class="key">g</span>:uploadForm name=<span class="string"><span class="delimiter">&quot;</span><span class="content">uploadFeaturedImage</span><span class="delimiter">&quot;</span></span> action=<span class="string"><span class="delimiter">&quot;</span><span class="content">uploadFeaturedImage</span><span class="delimiter">&quot;</span></span>&gt;
           &lt;<span class="key">g</span>:hiddenField name=<span class="string"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span> value=<span class="string"><span class="delimiter">&quot;</span><span class="inline"><span class="inline-delimiter">${</span><span class="local-variable">this</span>.book?.id<span class="inline-delimiter">}</span></span><span class="delimiter">&quot;</span></span> /&gt;
           &lt;<span class="key">g</span>:hiddenField name=<span class="string"><span class="delimiter">&quot;</span><span class="content">version</span><span class="delimiter">&quot;</span></span> value=<span class="string"><span class="delimiter">&quot;</span><span class="inline"><span class="inline-delimiter">${</span><span class="local-variable">this</span>.book?.version<span class="inline-delimiter">}</span></span><span class="delimiter">&quot;</span></span> /&gt;
           &lt;input type=<span class="string"><span class="delimiter">&quot;</span><span class="content">file</span><span class="delimiter">&quot;</span></span> name=<span class="string"><span class="delimiter">&quot;</span><span class="content">featuredImageFile</span><span class="delimiter">&quot;</span></span> /&gt;
           &lt;fieldset <span class="type">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">buttons</span><span class="delimiter">&quot;</span></span>&gt;
              &lt;<span class="class">input</span> <span class="type">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">save</span><span class="delimiter">&quot;</span></span> <span class="class">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">submit</span><span class="delimiter">&quot;</span></span> value=<span class="string"><span class="delimiter">&quot;</span><span class="inline"><span class="inline-delimiter">${</span>message(<span class="key">code</span>: <span class="string"><span class="delimiter">'</span><span class="content">book.featuredImage.upload.label</span><span class="delimiter">'</span></span>, <span class="keyword">default</span>: <span class="string"><span class="delimiter">'</span><span class="content">Upload</span><span class="delimiter">'</span></span>)<span class="inline-delimiter">}</span></span><span class="delimiter">&quot;</span></span> /&gt;
          &lt;<span class="regexp"><span class="delimiter">/</span><span class="content">fieldset&gt;</span></span><span class="error">
</span>      &lt;<span class="regexp"><span class="delimiter">/</span><span class="content">g:uploadForm&gt;</span></span><span class="error">
</span>    &lt;<span class="regexp"><span class="delimiter">/</span><span class="content">div&gt;</span></span><span class="error">
</span>&lt;<span class="regexp"><span class="delimiter">/</span><span class="content">body&gt;</span></span><span class="error">
</span>&lt;<span class="regexp"><span class="delimiter">/</span><span class="content">html&gt;</span></span></code></pre>
</div>
</div>


<h1 id="deployingTheApp">10 Deploying the app</h1>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails-guides/grails-google-cloud/edit/master/src/main/docs/guide/deployingTheApp.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>To deploy the app to Google App Engine run:</p>
</div>
<div class="paragraph">
<p><code>$ ./gradlew appengineDeploy</code></p>
</div>
<div class="paragraph">
<p>Initial deployment may take a while. When finished, you will be able to
access your app:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../img/welcometograils.png" alt="welcometograils">
</div>
</div>
<div class="paragraph">
<p>If you go to the <a href="https://console.cloud.google.com/appengine/versions">Versions</a> section
in the App Engine administration panel, you will see the deployed app.</p>
</div>


<h1 id="logging">11 Logging</h1>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails-guides/grails-google-cloud/edit/master/src/main/docs/guide/logging.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>For the version which you would like to inspect, select Logs in the diagnose dropdown:</p>
</div>
<div class="paragraph">
<p>Application log messages written to stdout and stderr are automatically collected and can be
viewed in the Logs Viewer.</p>
</div>
<div class="paragraph">
<p>We are going to create a controller and log with level INFO and verify the log statement is
visible in the Log Viewer.</p>
</div>
<div class="listingblock">
<div class="title">grails-app/controllers/demo/LegalController.groovy</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">package</span> demo

<span class="keyword">import</span> <span class="include">groovy.transform.CompileStatic</span>
<span class="keyword">import</span> <span class="include">groovy.util.logging.Slf4j</span>

<span class="annotation">@CompileStatic</span>
<span class="annotation">@Slf4j</span>
<span class="type">class</span> <span class="class">LegalController</span> {
    <span class="keyword">def</span> <span class="function">index</span>() {
        log.info <span class="string"><span class="delimiter">'</span><span class="content">inside legal controller</span><span class="delimiter">'</span></span>
        render <span class="string"><span class="delimiter">'</span><span class="content">Legal Terms</span><span class="delimiter">'</span></span>
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>We add the next line to <code>_`grails-app/conf/logback.groovy</code></p>
</div>
<div class="paragraph">
<p><code>logger 'demo', INFO, ['STDOUT'], false</code></p>
</div>
<div class="paragraph">
<p>to log <em>INFO</em> statements of classes under package <em>demo</em> to <em>STDOUT</em> appender with additivity <em>false</em></p>
</div>
<div class="paragraph">
<p>If you redeploy the app to App Engine and access the <em>/legal</em> end point, you will see the logging statements in Log Viewer.</p>
</div>
<div class="paragraph">
<p>Check <a href="https://cloud.google.com/appengine/docs/flexible/java/writing-application-logs">Writing Application Logs</a>
documentation to read more about logs in the Flexible Environment.</p>
</div>
<div class="paragraph">
<p><em>Write your application logs using stdout for output and stderr for errors. Note that this does not provide log levels that you can use for filtering in the Logs Viewer; however, the Logs Viewer does provide other filtering, such as text, timestamp, etc.</em></p>
</div>


<h1 id="cleaningUp">12 Cleaning Up</h1>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails-guides/grails-google-cloud/edit/master/src/main/docs/guide/cleaningUp.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>After you&#8217;ve finished this guide, you can clean up the resources you created on
Google Cloud Platform so you won&#8217;t be billed for them in the future. The following
sections describe how to delete or turn off these resources.</p>
</div>
<div class="sect1">
<h2 id="_deleting_the_project">Deleting the project</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The easiest way to eliminate billing is to delete the project you created for the tutorial.</p>
</div>
<div class="paragraph">
<p>To delete the project:</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
Deleting a project has the following consequences:
</td>
</tr>
</table>
</div>
<div class="ulist">
<ul>
<li>
<p>If you used an existing project, you&#8217;ll also delete any other work you&#8217;ve done in the project.</p>
</li>
<li>
<p>You can&#8217;t reuse the project ID of a deleted project. If you created a custom project ID that you plan to use in the future, you should delete the resources inside the project instead. This ensures that URLs that use the project ID, such as an appspot.com URL, remain available.</p>
</li>
<li>
<p>If you are exploring multiple tutorials and quickstarts, reusing projects instead of deleting them prevents you from exceeding project quota limits.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In the Cloud Platform Console, go to the Projects page.</p>
</div>
<div class="paragraph">
<p><a href="https://console.cloud.google.com/iam-admin/projects">GO TO THE PROJECTS PAGE</a></p>
</div>
<div class="paragraph">
<p>In the project list, select the project you want to delete and click Delete project. After selecting the checkbox next to the project name, click <code>Delete project</code></p>
</div>
<div class="paragraph">
<p>In the dialog, type the project ID, and then click Shut down to delete the project.</p>
</div>
<div class="paragraph">
<p>Deleting or turning off specific resources</p>
</div>
<div class="paragraph">
<p>You can individually delete or turn off some of the resources that you created during the tutorial.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_deleting_app_versions">Deleting app versions</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To delete an app version:</p>
</div>
<div class="paragraph">
<p>In the Cloud Platform Console, go to the App Engine Versions page.</p>
</div>
<div class="paragraph">
<p><a href="https://console.cloud.google.com/appengine/versions">GO TO THE VERSIONS PAGE</a></p>
</div>
<div class="paragraph">
<p>Click the checkbox next to the non-default app version you want to delete.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The only way you can delete the default version of your App Engine app is by deleting your project. However, you can stop the default version in the Cloud Platform Console. This action shuts down all instances associated with the version. You can restart these instances later if needed.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>In the App Engine standard environment, you can stop the default version only if your app has manual or basic scaling.</p>
</div>
<div class="paragraph">
<p>Click the Delete button at the top of the page to delete the app version.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_deleting_cloud_sql_instances">Deleting Cloud SQL instances</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To delete a Cloud SQL instance:</p>
</div>
<div class="paragraph">
<p>In the Cloud Platform Console, go to the SQL Instances page.</p>
</div>
<div class="paragraph">
<p><a href="https://console.cloud.google.com/sql/instances">GO TO THE SQL INSTANCES PAGE</a></p>
</div>
<div class="paragraph">
<p>Click the name of the SQL instance you want to delete.</p>
</div>
<div class="paragraph">
<p>Click the Delete button at the top of the page to delete the instance.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_deleting_cloud_storage_buckets">Deleting Cloud Storage buckets</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To delete a Cloud Storage bucket:</p>
</div>
<div class="paragraph">
<p>In the Cloud Platform Console, go to the Cloud Storage browser.</p>
</div>
<div class="paragraph">
<p><a href="https://console.cloud.google.com/storage/browser">GO TO THE CLOUD STORAGE BROWSER</a></p>
</div>
<div class="paragraph">
<p>Click the checkbox next to the bucket you want to delete.</p>
</div>
<div class="paragraph">
<p>Click the Delete button at the top of the page to delete the bucket.</p>
</div>
</div>
</div>


<h1 id="learnMore">13 Learn More</h1>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails-guides/grails-google-cloud/edit/master/src/main/docs/guide/learnMore.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>If you want to learn more about Google Cloud and Grails integration, checkout a more complete sample app.</p>
</div>
<div class="paragraph">
<p>The <a href="https://grails-samples.github.io/google-bookshelf/">Google Cloud Bookshelf with Grails</a>
application shows how to use a variety of Google Cloud Platform products, including some of
the services described in this guides and other services such as:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Google <a href="https://cloud.google.com/vision/">Cloud Vision API</a></p>
</li>
<li>
<p>Google <a href="https://cloud.google.com/translate">Cloud Translation API</a></p>
</li>
<li>
<p>Authentication using <a href="https://developers.google.com/identity/">Google Identity Platform</a></p>
</li>
</ul>
</div>


<h1 id="helpWithGrails">14 Help With Grails</h1>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails-guides/grails-google-cloud/edit/master/src/main/docs/guide/helpWithGrails.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<h3 style="color: #333;">OCI sponsored the creation of this Guide. OCI offers several <a href="https://objectcomputing.com/products/grails/consulting-support/">Grails services</a>:</h3>

<img src="../img/oci-grails-services.svg"/>

<h3>Free consultation </h3>

<!-- This is the code that is needed to run the form -->

<!--Copy and paste into the document's head or body.-->

<script type="text/javascript">

    /** This section is only needed once per page if manually copying **/
    if (typeof MauticSDKLoaded == 'undefined') {
        var MauticSDKLoaded = true;
        var head            = document.getElementsByTagName('head')[0];
        var script          = document.createElement('script');
        script.type         = 'text/javascript';
        script.src          = 'https://mautic.objectcomputing.com/media/js/mautic-form.js';
        script.onload       = function() {
            MauticSDK.onLoad();
        };
        head.appendChild(script);
        var MauticDomain = 'https://mautic.objectcomputing.com';
        var MauticLang   = {
            'submittingMessage': "Please wait..."
        }
    }
</script>

<!--Copy and paste into the document's body.-->

<style type="text/css" scoped>
    .mauticform_wrapper { max-width: 600px; margin: 10px auto; }
    .mauticform-innerform {}
    .mauticform-post-success {}
    .mauticform-name { font-weight: bold; font-size: 1.5em; margin-bottom: 3px; }
    .mauticform-description { margin-top: 2px; margin-bottom: 10px; }
    .mauticform-error { margin-bottom: 10px; color: red; }
    .mauticform-message { margin-bottom: 10px;color: green; }
    .mauticform-row { display: block; margin-bottom: 20px; }
    .mauticform-label { font-size: 1.1em; display: block; font-weight: bold; margin-bottom: 5px; }
    .mauticform-row.mauticform-required .mauticform-label:after { color: #e32; content: " *"; display: inline; }
    .mauticform-helpmessage { display: block; font-size: 0.9em; margin-bottom: 3px; }
    .mauticform-errormsg { display: block; color: red; margin-top: 2px; }
    .mauticform-selectbox, .mauticform-input, .mauticform-textarea { width: 100%; padding: 0.5em 0.5em; border: 1px solid #CCC; background: #fff; box-shadow: 0px 0px 0px #fff inset; border-radius: 4px; box-sizing: border-box; }
    .mauticform-checkboxgrp-row {}
    .mauticform-checkboxgrp-label { font-weight: normal; }
    .mauticform-checkboxgrp-checkbox {}
    .mauticform-radiogrp-row {}
    .mauticform-radiogrp-label { font-weight: normal; }
    .mauticform-radiogrp-radio {}
    .mauticform-button-wrapper .mauticform-button.btn-default, .mauticform-pagebreak-wrapper .mauticform-pagebreak.btn-default { font-size: 14px; color: #fff;background-color: #feb672 ;border-color: #dddddd; padding: 15px 30px;}
    .mauticform-button-wrapper .mauticform-button, .mauticform-pagebreak-wrapper .mauticform-pagebreak { display: inline-block;margin-bottom: 0;font-weight: 600;text-align: center;vertical-align: middle;cursor: pointer;background-image: none;border: 1px solid transparent;white-space: nowrap;padding: 6px 12px;font-size: 13px;line-height: 1.3856;border-radius: none;-webkit-user-select: none;-moz-user-select: none;-ms-user-select: none;user-select: none;}
    .mauticform-button-wrapper .mauticform-button.btn-default[disabled], .mauticform-pagebreak-wrapper .mauticform-pagebreak.btn-default[disabled] { background-color:#feb672; border-color: #dddddd; opacity: 0.75; cursor: not-allowed; font-size: 14px; color: #fff; padding: 15px 30px;}
    .mauticform-pagebreak-wrapper .mauticform-button-wrapper {  display: inline; }
</style>
<div id="mauticform_wrapper_grailsorgconsultationform" class="mauticform_wrapper">
    <form autocomplete="false" role="form" method="post" action="https://mautic.objectcomputing.com/form/submit?formId=3" id="mauticform_grailsorgconsultationform" data-mautic-form="grailsorgconsultationform">

        <div class="mauticform-innerform">

          <div class="mauticform-page-wrapper mauticform-page-1" data-mautic-form-page="1">

            <div id="mauticform_grailsorgconsultationform_first_name"  data-validate="first_name" data-validation-type="text" class="mauticform-row mauticform-text mauticform-field-1 mauticform-required col-lg-6 col-md-6 col-sm-12 col-xs-12">
                <input id="mauticform_input_grailsorgconsultationform_first_name" name="mauticform[first_name]" value="" placeholder="First Name *" class="mauticform-input" type="text" />
                <span class="mauticform-errormsg" style="display: none;">This is required.</span>
            </div>

            <div id="mauticform_grailsorgconsultationform_last_name"  data-validate="last_name" data-validation-type="text" class="mauticform-row mauticform-text mauticform-field-2 mauticform-required col-lg-6 col-md-6 col-sm-12 col-xs-12">
                <input id="mauticform_input_grailsorgconsultationform_last_name" name="mauticform[last_name]" value="" placeholder="Last Name *" class="mauticform-input" type="text" />
                <span class="mauticform-errormsg" style="display: none;">This is required.</span>
            </div>

            <div id="mauticform_grailsorgconsultationform_email"  data-validate="email" data-validation-type="email" class="mauticform-row mauticform-email mauticform-field-3 mauticform-required col-lg-12 col-md-12 col-sm-12 col-xs-12">
                <input id="mauticform_input_grailsorgconsultationform_email" name="mauticform[email]" value="" placeholder="Email *" class="mauticform-input" type="email" />
                <span class="mauticform-errormsg" style="display: none;">This is required.</span>
            </div>

            <div id="mauticform_grailsorgconsultationform_phone"  class="mauticform-row mauticform-tel mauticform-field-4 col-lg-12 col-md-12 col-sm-12 col-xs-12">
                <input id="mauticform_input_grailsorgconsultationform_phone" name="mauticform[phone]" value="" placeholder="Phone" class="mauticform-input" type="tel" />
                <span class="mauticform-errormsg" style="display: none;"></span>
            </div>

            <div id="mauticform_grailsorgconsultationform_company"  class="mauticform-row mauticform-text mauticform-field-5 col-lg-12 col-md-12 col-sm-12 col-xs-12">
                <input id="mauticform_input_grailsorgconsultationform_company" name="mauticform[company]" value="" placeholder="Company" class="mauticform-input" type="text" />
                <span class="mauticform-errormsg" style="display: none;"></span>
            </div>

            <div id="mauticform_grailsorgconsultationform_submit"  class="mauticform-row mauticform-button-wrapper mauticform-field-6" style="">
                <button type="submit" name="mauticform[submit]" id="mauticform_input_grailsorgconsultationform_submit" name="mauticform[submit]" value="" class="mauticform-button btn btn-default" value="1" style="border: none; margin-left: 14px;">SUBMIT</button>
            </div>
            </div>
        </div>

        <input type="hidden" name="mauticform[formId]" id="mauticform_grailsorgconsultationform_id" value="3"/>
        <input type="hidden" name="mauticform[return]" id="mauticform_grailsorgconsultationform_return" value=""/>
        <input type="hidden" name="mauticform[formName]" id="mauticform_grailsorgconsultationform_name" value="grailsorgconsultationform"/>
</form>
</div>

<!--The code below is the message that appears when someone hits submit. Feel free to style this how you see fit for Grails.org. All CSS is handled in the above code.-->

<div class="mauticform-error" id="mauticform_grailsorgconsultationform_error"></div>
<div class="mauticform-message" id="mauticform_grailsorgconsultationform_message"></div>

<h3 style="color: #333;">The <a href="https://objectcomputing.com/products/grails/consulting-support/">OCI Grails Team</a>
includes Grails co-founders, <b>Jeff Scott Brown and Graeme Rocher</b>.
Check our <a href="https://objectcomputing.com/training/catalog/grails/">Grails courses</a> and learn from the engineers who developed,
matured and maintain Grails.</h3>

<img src="../img/ocigrailsteam.png" style="max-width: 748px; width: 100%;" alt="Grails OCI Team">

                                        </div>
                                    </td>
                                    <td id="col2">
                                        <div class="local clearfix">
                                            <div class="local-title" style="text-align: right"><a href="https://travis-ci.org/grails-guides/grails-google-cloud"><img src="https://travis-ci.org/grails-guides/grails-google-cloud.svg?branch=master" /></a></div>            

                                            <div class="local-title">
                                                <a href="https://github.com/grails-guides/grails-google-cloud">
                                                    <svg height="35" class="octicon octicon-mark-github" viewBox="0 0 16 16" version="1.1" width="35" aria-hidden="true"><path fill-rule="evenodd" d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0 0 16 8c0-4.42-3.58-8-8-8z"/></svg></a> &nbsp;&nbsp;Get the Code
                                                </div>
                                                <div class="menu">
                                                    <div class="input-group">                        
                                                        <button href="#" onclick="document.getElementById('github-url').value='git@github.com:grails-guides/grails-google-cloud.git'" class="codeButton">SSH</button>
                                                        <button onclick="document.getElementById('github-url').value='https://github.com/grails-guides/grails-google-cloud.git'" class="codeButton">HTTPS</button>
                                                        <button onclick="document.getElementById('github-url').value='https://github.com/grails-guides/grails-google-cloud'" class="codeButton">Subversion</button>
                                                    </div>

                                                    <div class="input-group">                    
                                                        <!-- Target -->
                                                        <input id="github-url" value="git@github.com:grails-guides/grails-google-cloud.git" type="text" />

                                                        <!-- Trigger -->
                                                        <button class="clipbtn" type="button" data-clipboard-target="#github-url">

                                                            <img width="13" src="../img/clippy.svg" alt="Copy to clipboard">
                                                        </button>       

                                                    </div>
                                                    <div class="input-group">
                                                      <a href="https://github.com/grails-guides/grails-google-cloud/archive/master.zip" class="downloadButton">Download ZIP</a>
                                                  </div>
                                              </div>
                                              
                                              <div id="table-of-content">
                                                <h2>Table of Contents</h2>
                                                
                                                <div class="toc-item" style="margin-left:0px"><a href="#gettingStarted"><strong>1</strong><span>Getting Started</span></a></div>
                                                
                                                <div class="toc-item" style="margin-left:0px"><a href="#costs"><strong>2</strong><span>Costs</span></a></div>
                                                
                                                <div class="toc-item" style="margin-left:0px"><a href="#whatYouWillNeed"><strong>3</strong><span>What you will need</span></a></div>
                                                
                                                <div class="toc-item" style="margin-left:0px"><a href="#howToComplete"><strong>4</strong><span>How to Complete</span></a></div>
                                                
                                                <div class="toc-item" style="margin-left:0px"><a href="#writingTheApp"><strong>5</strong><span>Writing the application</span></a></div>
                                                
                                                <div class="toc-item" style="margin-left:10px"><a href="#domainClass"><strong>5.1</strong><span>Domain Class</span></a></div>
                                                
                                                <div class="toc-item" style="margin-left:10px"><a href="#seedData"><strong>5.2</strong><span>Seed Data</span></a></div>
                                                
                                                <div class="toc-item" style="margin-left:10px"><a href="#urlMappings"><strong>5.3</strong><span>Display Books</span></a></div>
                                                
                                                <div class="toc-item" style="margin-left:0px"><a href="#cloudSDK"><strong>6</strong><span>Cloud SDK</span></a></div>
                                                
                                                <div class="toc-item" style="margin-left:0px"><a href="#googleAppEngine"><strong>7</strong><span>Google App Engine</span></a></div>
                                                
                                                <div class="toc-item" style="margin-left:10px"><a href="#googleAppEngineGradlePlugin"><strong>7.1</strong><span>Google App Engine Gradle Plugin</span></a></div>
                                                
                                                <div class="toc-item" style="margin-left:10px"><a href="#applicationDeploymentConfiguration"><strong>7.2</strong><span>Application Deployment Configuration</span></a></div>
                                                
                                                <div class="toc-item" style="margin-left:10px"><a href="#springBootJetty"><strong>7.3</strong><span>SpringBoot Jetty</span></a></div>
                                                
                                                <div class="toc-item" style="margin-left:0px"><a href="#cloudSQL"><strong>8</strong><span>Cloud SQL</span></a></div>
                                                
                                                <div class="toc-item" style="margin-left:10px"><a href="#createCloudSQLInstance"><strong>8.1</strong><span>Create Cloud SQL Instance</span></a></div>
                                                
                                                <div class="toc-item" style="margin-left:10px"><a href="#datasourceUsingCloudSQL"><strong>8.2</strong><span>Datasource using Cloud SQL</span></a></div>
                                                
                                                <div class="toc-item" style="margin-left:0px"><a href="#cloudStorage"><strong>9</strong><span>Cloud Storage</span></a></div>
                                                
                                                <div class="toc-item" style="margin-left:0px"><a href="#deployingTheApp"><strong>10</strong><span>Deploying the app</span></a></div>
                                                
                                                <div class="toc-item" style="margin-left:0px"><a href="#logging"><strong>11</strong><span>Logging</span></a></div>
                                                
                                                <div class="toc-item" style="margin-left:0px"><a href="#cleaningUp"><strong>12</strong><span>Cleaning Up</span></a></div>
                                                
                                                <div class="toc-item" style="margin-left:0px"><a href="#learnMore"><strong>13</strong><span>Learn More</span></a></div>
                                                
                                                <div class="toc-item" style="margin-left:0px"><a href="#helpWithGrails"><strong>14</strong><span>Help With Grails</span></a></div>
                                                
                            <div style="clear:both" ></div>
                        </div>
                                            
                    </div>
                </td>
            </tr>
        </table>

        <div id="footer">
            Copies of this document may be made for your own use and for distribution to others, provided that you do not charge any fee for such copies and further provided that each copy contains this Copyright Notice, whether distributed in print or electronically. All guides are released with an ASLv2 license for the code, and Creative Commons license for the writing.
            
        </div>

            <!-- END CONTENT -->
          </div>
        </div>
      </div>
    </div>

<script type="text/javascript">
    new Clipboard('.clipbtn');
</script>
<script type="text/javascript" src="../js/docs.js"></script>
<script type="text/javascript" src="../js/classie.js"></script>        
<script type="text/javascript" src="../js/sidebarEffects.js"></script>
<script type="text/javascript" src="../js/navbar.js"></script> 
<style type="text/css">
    #colset {
        background-color: #f5f5f5;
    }
    .grailsnavbar {
        padding-right: 0;
    }
    #fork-me {
        display: none;
    }
</style>       
    </body>
</html>
