<!DOCTYPE html>
<html>
  <head>
    <meta name='google-site-verification' content='REYQ1_I6HGowAE7LOLVqfQbnKaB4IfFpMlGzMbJj55Q' />
    <meta name='viewport' content='width=device-width, initial-scale=1' />
    <link rel='icon' href='/images/favicon.ico' />
    <link rel='mask-icon' href='//images/grails-pinned-icon.svg' color='feb672' />
    <meta charset='UTF-8' />
    <title>Building a Objective-C iOS Client powered by a Grails backend | Grails Guides | Grails Framework</title>
    <meta name='description' content='Building a Objective-C iOS Client powered by a Grails backend. This guide demonstrates how you can use Grails as a backend for an iOS app built with Objective-C' />
    <link rel='stylesheet' href='../css/main.css' />
    <link rel='stylesheet' href='../css/screen.css' />
    <script src='https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/1.7.1/clipboard.min.js'></script>
  </head>
  <body class='guide'><header class='mainheader'>
  <div class='content'>
    <a href='https://grails.org/index.html'><img class='grailslogo' src='/images/grails_logo.svg' alt='Grails Logo' /></a>
    <a href='javascript:show(&apos;topmenus&apos;, &apos;showNavigationLink&apos;)' id='showNavigationLink' class='mobile align-center'>Show Navigation</a>
    <div id='topmenus'>
      <nav class='secondarymenu' id='secondarymenu'><ul>
  <li>
    <a href='https://grails.org/learning.html'>Learning</a>
  </li>
  <li>
    <a href='https://grails.org/community.html'>Community</a>
  </li>
  <li>
    <a href='https://grails.org/search.html'>Search</a>
  </li>
</ul></nav>
      <nav class='mainmenu' id='mainmenu'><ul>
  <li>
    <a href='https://grails.org/documentation.html'>Documentation</a>
  </li>
  <li>
    <a href='https://grails.org/download.html'>Download</a>
  </li>
  <li>
    <a href='https://plugins.grails.org'>Plugins</a>
  </li>
  <li>
    <a href='https://guides.grails.org/index.html'>Guides</a>
  </li>
  <li>
    <a href='https://grails.org/faq.html'>FAQ</a>
  </li>
  <li>
    <a href='https://grails.org/support.html'>Support</a>
  </li>
</ul></nav>
    </div>
  </div>
</header><div class='fullwidth'><article class="guide">
    <aside>
        <a href="https://travis-ci.org/grails-guides/building-an-ios-objectc-client-powered-by-a-grails-backend"><img src="https://travis-ci.org/grails-guides/building-an-ios-objectc-client-powered-by-a-grails-backend.svg?branch=master"></a>

        <button type="button" class="btn btn-large" onclick="window.location.href=&quot;https://github.com/grails-guides/building-an-ios-objectc-client-powered-by-a-grails-backend&quot;"><img height="15" src="../img/github_white.svg" alt="Github"/><span>&nbsp;Get the Code</span></button>


        <ul class="githublinks">
            <li><button type="button" class="btn btn-default" href="#" onclick="document.getElementById('github-url').value='git@github.com:grails-guides/building-an-ios-objectc-client-powered-by-a-grails-backend.git'" class="codeButton">SSH</button></li>
            <li><button type="button" class="btn btn-default" onclick="document.getElementById('github-url').value='https://github.com/grails-guides/building-an-ios-objectc-client-powered-by-a-grails-backend.git'" class="codeButton">HTTPS</button></li>
        </ul>
        <div class="input-group">
            <!-- Target -->
            <input id="github-url" value="git@github.com:grails-guides/building-an-ios-objectc-client-powered-by-a-grails-backend.git" type="text" />
            <!-- Trigger -->
            <button type="button" class="clippy btn btn-default" type="button" data-clipboard-target="#github-url">
                <img width="13" src="../img/clippy.svg" alt="Copy to clipboard">
            </button>
        </div>
        <script>var clipboard = new Clipboard('.clippy');</script>
        <button type="button" class="btn btn-large" onclick="window.location.href=&quot;https://github.com/grails-guides/building-an-ios-objectc-client-powered-by-a-grails-backend/archive/master.zip&quot;">Download ZIP</button>
        
        <div id="table-of-content">
            <h3>Table of Contents</h3>
            
            <div class="toc-item" style="margin-left:0px"><a href="#training"><strong>1</strong><span>Grails Training</span></a></div>
            
            <div class="toc-item" style="margin-left:0px"><a href="#gettingStarted"><strong>2</strong><span>Getting Started</span></a></div>
            
            <div class="toc-item" style="margin-left:10px"><a href="#requirements"><strong>2.1</strong><span>What you will need</span></a></div>
            
            <div class="toc-item" style="margin-left:10px"><a href="#howto"><strong>2.2</strong><span>How to complete the guide</span></a></div>
            
            <div class="toc-item" style="margin-left:0px"><a href="#overview"><strong>3</strong><span>Overview</span></a></div>
            
            <div class="toc-item" style="margin-left:0px"><a href="#writingTheGrailsApp"><strong>4</strong><span>Writing the Grails Application</span></a></div>
            
            <div class="toc-item" style="margin-left:10px"><a href="#domainClass"><strong>4.1</strong><span>Create a Domain Class - Persistent Entities</span></a></div>
            
            <div class="toc-item" style="margin-left:10px"><a href="#domainClassTest"><strong>4.2</strong><span>Domain Class Unit Testing</span></a></div>
            
            <div class="toc-item" style="margin-left:10px"><a href="#versioning"><strong>4.3</strong><span>Versioning</span></a></div>
            
            <div class="toc-item" style="margin-left:10px"><a href="#v1Controller"><strong>4.4</strong><span>Create a Controller</span></a></div>
            
            <div class="toc-item" style="margin-left:10px"><a href="#bootstrap"><strong>4.5</strong><span>Loading test data</span></a></div>
            
            <div class="toc-item" style="margin-left:10px"><a href="#v1FunctionalTests"><strong>4.6</strong><span>Functional tests</span></a></div>
            
            <div class="toc-item" style="margin-left:10px"><a href="#runningTheApp"><strong>4.7</strong><span>Running the Application</span></a></div>
            
            <div class="toc-item" style="margin-left:0px"><a href="#writingTheiOSApp"><strong>5</strong><span>Writing the iOS Application</span></a></div>
            
            <div class="toc-item" style="margin-left:10px"><a href="#ios-overview"><strong>5.1</strong><span>Fetching the Announcements</span></a></div>
            
            <div class="toc-item" style="margin-left:10px"><a href="#iosModel"><strong>5.2</strong><span>Model</span></a></div>
            
            <div class="toc-item" style="margin-left:10px"><a href="#iosJsonToModel"><strong>5.3</strong><span>Json to Model</span></a></div>
            
            <div class="toc-item" style="margin-left:10px"><a href="#appTransportSecurity"><strong>5.4</strong><span>App Transport Security</span></a></div>
            
            <div class="toc-item" style="margin-left:10px"><a href="#networkingCode"><strong>5.5</strong><span>Networking code</span></a></div>
            
            <div class="toc-item" style="margin-left:10px"><a href="#detailViewController"><strong>5.6</strong><span>Detail View Controller</span></a></div>
            
            <div class="toc-item" style="margin-left:0px"><a href="#version2"><strong>6</strong><span>API version 2.0</span></a></div>
            
            <div class="toc-item" style="margin-left:10px"><a href="#v2Controller"><strong>6.1</strong><span>Grails V2 Changes</span></a></div>
            
            <div class="toc-item" style="margin-left:10px"><a href="#v2FunctionalTests"><strong>6.2</strong><span>Api 2.0 Functional tests</span></a></div>
            
            <div class="toc-item" style="margin-left:10px"><a href="#v2iOS"><strong>6.3</strong><span>iOS V2 Changes</span></a></div>
            
            <div class="toc-item" style="margin-left:0px"><a href="#conclusion"><strong>7</strong><span>Conclusion</span></a></div>
            
            <div class="toc-item" style="margin-left:0px"><a href="#helpWithGrails"><strong>8</strong><span>Do you need help with Grails?</span></a></div>
            
            <div style="clear:both" ></div>
        </div>
        
    </aside>
    <header>
        <h1>Building a Objective-C iOS Client powered by a Grails backend</h1>
        <p>This guide demonstrates how you can use Grails as a backend for an iOS app built with Objective-C</p>
        <p><strong>Authors:</strong> Sergio del Amo</p>
        <p><strong>Grails Version:</strong> 3.3.1</p>
    </header>
    

<h1 id="training">1 Grails Training</h1>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails-guides/building-an-ios-objectc-client-powered-by-a-grails-backend/edit/master/src/main/docs/guide/training.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p><strong>Grails Training</strong> - Developed and delivered by the folks who created and actively maintain the Grails framework!.</p>
</div>
<div id="ocitraining"></div>
<script type="text/javascript">
var getJSON = function(url, callback) {
    var xhr = new XMLHttpRequest();
    xhr.open('GET', url, true);
    xhr.responseType = 'json';
    xhr.onload = function() {
      var status = xhr.status;
      if (status == 200) {
        callback(null, xhr.response);
      } else {
        callback(status);
      }
    };
    xhr.send();
};
getJSON('https://training.grails.org/training', function(err, data) {
  var msg = '';
  if (err != null) {
      msg = 'Something went wrong while retrieving OCI training offerings';

  } else {
      if ( data.length == 0 ) {
         msg = '<p><b>Nothing scheduled at the moment - please check back again soon!</b></p>.';

      } else {
        msg += '<table>';
        msg += '<thead>';
        msg += '<tr><th>Course</th><th>Date(s)</th><th>Instructor(s)</th><th>Hour(s)</th></tr>';
        msg += '</thead>';
        msg += '<tbody>';

        var hrefs = new Array();
        for (var i = 0; i < data.length; i++) {
            var href = data[i].enrollmentLink;
            if (hrefs.indexOf(href) == -1) {
                msg += '<tr><td><a href="'+ href + '">'+ data[i].course + '</a></td><td>'+ data[i].dates + '</td><td>'+ data[i].instructors + '</td><td>'+ data[i].hours + '</td></tr>';
                hrefs.push(href);
            }

        }
        msg += '</tbody>';
        msg += '</table>';
      }
  }
  var ociTraining = document.getElementById("ocitraining");
  ociTraining.innerHTML = msg;
});
</script>


<h1 id="gettingStarted">2 Getting Started</h1>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails-guides/building-an-ios-objectc-client-powered-by-a-grails-backend/edit/master/src/main/docs/guide/gettingStarted.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>In this guide you are going to build a <a href="http://grails.org">Grails application</a> which will serve as a company intranet backend.
It exposes a JSON API of company announcements.</p>
</div>
<div class="paragraph">
<p>Additionally, you are going to build an <a href="https://developer.apple.com/ios/">iOS App</a>, the intranet client, which
consumes the JSON API offered by the backend.</p>
</div>
<div class="paragraph">
<p>The guide explores the support of diffent API versions.</p>
</div>


<h2 id="requirements">2.1 What you will need</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails-guides/building-an-ios-objectc-client-powered-by-a-grails-backend/edit/master/src/main/docs/guide/requirements.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>To complete this guide you will need the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Some time on your hands</p>
</li>
<li>
<p>A decent text editor or IDE</p>
</li>
<li>
<p>JDK 1.7 or greater installed with <code>JAVA_HOME</code> configured appropriately</p>
</li>
<li>
<p>The latest stable version of <a href="https://developer.apple.com/xcode/">Xcode</a>.
This guide was written with Xcode 8.2.1</p>
</li>
</ul>
</div>


<h2 id="howto">2.2 How to complete the guide</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails-guides/building-an-ios-objectc-client-powered-by-a-grails-backend/edit/master/src/main/docs/guide/howto.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>To complete this guide, you will need to checkout the source from Github and work through the steps presented by the guide.</p>
</div>
<div class="paragraph">
<p>To get started do the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://github.com/grails-guides/building-an-ios-objectc-client-powered-by-a-grails-backend/archive/master.zip">Download</a> and unzip the source or if you already have <a href="https://git-scm.com/">Git</a>: <code>git clone <a href="https://github.com/grails-guides/building-an-ios-objectc-client-powered-by-a-grails-backend.git" class="bare">https://github.com/grails-guides/building-an-ios-objectc-client-powered-by-a-grails-backend.git</a></code></p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="_to_follow_the_grails_part">To follow the Grails part:</h3>
<div class="ulist">
<ul>
<li>
<p><code>cd</code> into <code>grails-guides/building-an-ios-objectc-client-powered-by-a-grails-backend/initial</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Alternatively, if you already have Grails installed then you can create a new application using the
following command in a Terminal window:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>$ grails create-app intranet.backend.grails-app --profile rest-api
$ cd grails-app</pre>
</div>
</div>
<div class="paragraph">
<p>When the create-app command completes, Grails will create a grails-app directory with an
application configured to create a REST application (due to the use of the parameter profile=rest-api )
and configured to use the hibernate feature with an H2 database.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
You can go right to the completed Grails example if you <code>cd</code> into <code>grails-guides/building-an-ios-objectc-client-powered-by-a-grails-backend/complete</code>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_to_follow_the_ios_part">To follow the iOS part:</h3>
<div class="ulist">
<ul>
<li>
<p><code>cd</code> into <code>grails-guides/building-an-ios-objectc-client-powered-by-a-grails-backend/initial-objectivec-ios</code></p>
</li>
<li>
<p>Head on over to the next section</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Alternatively, you can create an iOS app using the New Project Wizard of Xcode Studio as illustrated in the next screenshots.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../img/create_new_project.png" alt="create new project">
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="../img/choose_master-detail-application.png" alt="choose master detail application">
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="../img/choose_objective_c.png" alt="choose objective c">
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
You can go right to the completed version 1 of the iOS example if you <code>cd</code> into <code>grails-guides/building-an-ios-objectc-client-powered-by-a-grails-backend/complete-objectivec-ios-v1</code>
</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
You can go right to the completed version 2 of the iOS example if you <code>cd</code> into <code>grails-guides/building-an-ios-objectc-client-powered-by-a-grails-backend/complete-objectivec-ios-v2</code>
</td>
</tr>
</table>
</div>
</div>


<h1 id="overview">3 Overview</h1>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails-guides/building-an-ios-objectc-client-powered-by-a-grails-backend/edit/master/src/main/docs/guide/overview.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>The next image illustrates the behavior of iOS app version 1.
The iOS app is composed by two View Controllers.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>When the iOS application initial screen loads, it requests an announcements list.</p>
</li>
<li>
<p>The Grails app sends a JSON payload which includes a list of announcements. For each announcement a unique identifier, a title and a HTML body is included.</p>
</li>
<li>
<p>The iOS app renders the JSON Payload in a <em>UITableView</em></p>
</li>
<li>
<p>The user taps an announcement&#8217;s title and the app segues to a detail screen. The initial screen sends the
detail screen the announcement identiifer, title and HTML body.
The latter will be rendered in a <em>UIWebView</em></p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="../img/overview.jpeg" alt="overview">
</div>
</div>


<h1 id="writingTheGrailsApp">4 Writing the Grails Application</h1>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails-guides/building-an-ios-objectc-client-powered-by-a-grails-backend/edit/master/src/main/docs/guide/writingTheGrailsApp.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Now you are ready to start writing the Grails application.</p>
</div>


<h2 id="domainClass">4.1 Create a Domain Class - Persistent Entities</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails-guides/building-an-ios-objectc-client-powered-by-a-grails-backend/edit/master/src/main/docs/guide/domainClass.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>We need to create persistent entities to store company announcements. Grails handles persistence with the use of <a href="https://docs.grails.org/latest/ref/Domain%20Classes/Usage.html">Grails Domain Classes</a>:</p>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>A domain class fulfills the M in the Model View Controller (MVC) pattern and represents a persistent entity that is
mapped onto an underlying database table. In Grails a domain is a class that lives in the grails-app/domain directory.</p>
</div>
</blockquote>
</div>
<div class="paragraph">
<p>Grails simplifies the creation of domain classes with the <a href="http://docs.grails.org/latest/ref/Command%20Line/create-domain-class.html">create-domain-class command</a>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash"> ./grailsw create-domain-class Announcement
| Resolving Dependencies. Please wait...
CONFIGURE SUCCESSFUL
Total time: 4.53 secs
| Created grails-app/grails/company/intranet/Announcement.groovy
| Created src/test/groovy/grails/company/intranet/AnnouncementSpec.groovy</code></pre>
</div>
</div>
<div class="paragraph">
<p>Just to keep it simple, we assume the company announcements just contain a <em>title</em> and a <em>HTML body</em>.
We are going to modify the domain class generated in the previous step to store that information.</p>
</div>
<div class="listingblock">
<div class="title">grails-app/domain/intranet/backend/Announcement.groovy</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">package</span> intranet.backend

<span class="type">class</span> <span class="class">Announcement</span> {

    <span class="predefined-type">String</span> title
    <span class="predefined-type">String</span> body

    <span class="directive">static</span> constraints = {
        title <span class="key">size</span>: <span class="integer">0</span>..<span class="integer">255</span>
        body <span class="key">nullable</span>: <span class="predefined-constant">true</span>
    }

    <span class="directive">static</span> mapping = {
        body <span class="key">type</span>: <span class="string"><span class="delimiter">'</span><span class="content">text</span><span class="delimiter">'</span></span>  <i class="conum" data-value="1"></i><b>(1)</b>
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>it enables us to store strings with more than 255 characters in the <em>body</em>.</td>
</tr>
</table>
</div>


<h2 id="domainClassTest">4.2 Domain Class Unit Testing</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails-guides/building-an-ios-objectc-client-powered-by-a-grails-backend/edit/master/src/main/docs/guide/domainClassTest.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p><a href="http://docs.grails.org/latest/guide/testing.html">Grails makes testing easier</a> from low level unit testing to high
level functional tests.</p>
</div>
<div class="paragraph">
<p>We are going to test the constraints we defined in the Announcement domain Class in constraints property. In particular
nullability and length of both title and body properties.</p>
</div>
<div class="listingblock">
<div class="title">src/test/groovy/intranet/backend/AnnouncementSpec.groovy</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">package</span> intranet.backend

<span class="keyword">import</span> <span class="include">grails.testing.gorm.DomainUnitTest</span>
<span class="keyword">import</span> <span class="include">spock.lang.Specification</span>

<span class="type">class</span> <span class="class">AnnouncementSpec</span> <span class="directive">extends</span> Specification <span class="directive">implements</span> DomainUnitTest&lt;Announcement&gt; {

    <span class="type">void</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">test body can be null</span><span class="delimiter">&quot;</span></span>() {
        <span class="key">expect</span>:
        <span class="keyword">new</span> Announcement(<span class="key">body</span>: <span class="predefined-constant">null</span>).validate([<span class="string"><span class="delimiter">'</span><span class="content">body</span><span class="delimiter">'</span></span>])
    }

    <span class="type">void</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">test title can not be null</span><span class="delimiter">&quot;</span></span>() {
        <span class="key">expect</span>:
        !<span class="keyword">new</span> Announcement(<span class="key">title</span>: <span class="predefined-constant">null</span>).validate([<span class="string"><span class="delimiter">'</span><span class="content">title</span><span class="delimiter">'</span></span>])
    }

    <span class="type">void</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">test body can have a more than 255 characters</span><span class="delimiter">&quot;</span></span>() {

        <span class="key">when</span>: <span class="string"><span class="delimiter">'</span><span class="content">for a string of 256 characters</span><span class="delimiter">'</span></span>
        <span class="predefined-type">String</span> str = <span class="string"><span class="delimiter">'</span><span class="delimiter">'</span></span>
        <span class="integer">256</span>.times { str += <span class="string"><span class="delimiter">'</span><span class="content">a</span><span class="delimiter">'</span></span> }

        <span class="key">then</span>: <span class="string"><span class="delimiter">'</span><span class="content">body validation passes</span><span class="delimiter">'</span></span>
        <span class="keyword">new</span> Announcement(<span class="key">body</span>: str).validate([<span class="string"><span class="delimiter">'</span><span class="content">body</span><span class="delimiter">'</span></span>])
    }

    <span class="type">void</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">test title can have a maximum of 255 characters</span><span class="delimiter">&quot;</span></span>() {

        <span class="key">when</span>: <span class="string"><span class="delimiter">'</span><span class="content">for a string of 256 characters</span><span class="delimiter">'</span></span>
        <span class="predefined-type">String</span> str = <span class="string"><span class="delimiter">'</span><span class="delimiter">'</span></span>
        <span class="integer">256</span>.times { str += <span class="string"><span class="delimiter">'</span><span class="content">a</span><span class="delimiter">'</span></span> }

        <span class="key">then</span>: <span class="string"><span class="delimiter">'</span><span class="content">title validation fails</span><span class="delimiter">'</span></span>
        !<span class="keyword">new</span> Announcement(<span class="key">title</span>: str).validate([<span class="string"><span class="delimiter">'</span><span class="content">title</span><span class="delimiter">'</span></span>])

        <span class="key">when</span>: <span class="string"><span class="delimiter">'</span><span class="content">for a string of 256 characters</span><span class="delimiter">'</span></span>
        str = <span class="string"><span class="delimiter">'</span><span class="delimiter">'</span></span>
        <span class="integer">255</span>.times { str += <span class="string"><span class="delimiter">'</span><span class="content">a</span><span class="delimiter">'</span></span> }

        <span class="key">then</span>: <span class="string"><span class="delimiter">'</span><span class="content">title validation passes</span><span class="delimiter">'</span></span>
        <span class="keyword">new</span> Announcement(<span class="key">title</span>: str).validate([<span class="string"><span class="delimiter">'</span><span class="content">title</span><span class="delimiter">'</span></span>])
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>We can run the every test, including the one we just created, with the command test_app</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash"> ./grailsw test-app
 | Resolving Dependencies. Please wait...
 CONFIGURE SUCCESSFUL
 Total time: 2.534 secs
 :complete:compileJava UP-TO-DATE
 :complete:compileGroovy
 :complete:buildProperties
 :complete:processResources
 :complete:classes
 :complete:compileTestJava UP-TO-DATE
 :complete:compileTestGroovy
 :complete:processTestResources UP-TO-DATE
 :complete:testClasses
 :complete:test
 :complete:compileIntegrationTestJava UP-TO-DATE
 :complete:compileIntegrationTestGroovy UP-TO-DATE
 :complete:processIntegrationTestResources UP-TO-DATE
 :complete:integrationTestClasses UP-TO-DATE
 :complete:integrationTest UP-TO-DATE
 :complete:mergeTestReports

 BUILD SUCCESSFUL

 | Tests PASSED</code></pre>
</div>
</div>


<h2 id="versioning">4.3 Versioning</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails-guides/building-an-ios-objectc-client-powered-by-a-grails-backend/edit/master/src/main/docs/guide/versioning.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>It is important to think about API versioning from the beginning, especially when you create an API
consumed by mobile phone applications. Users will run different versions of the app, and you will need to version
your API to create advanced functionality but keep supporting legacy versions.</p>
</div>
<div class="paragraph">
<p>Grails allows multiple ways to <a href="http://docs.grails.org/latest/guide/webServices.html#versioningResources">Version REST Resources</a>.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Using the URI</p>
</li>
<li>
<p>Using the Accept-Version Header</p>
</li>
<li>
<p>Using Hypermedia/Mime Types</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In this guide we are going to version the API using the Accept-Version header.</p>
</div>
<div class="paragraph">
<p>Devices running version 1.0 will invoke the <em>announcements</em> enpoint passing the 1.0 in the <code>Accept Version</code> HTTP Header.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ curl -i -H &quot;Accept-Version: 1.0&quot; -X GET http://localhost:8080/announcements</code></pre>
</div>
</div>
<div class="paragraph">
<p>Devices running version 2.0 will invoke the <em>announcements</em> enpoint passing the 2.0 in the Accept Version Header.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ curl -i -H &quot;Accept-Version: 2.0&quot; -X GET http://localhost:8080/announcements</code></pre>
</div>
</div>


<h2 id="v1Controller">4.4 Create a Controller</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails-guides/building-an-ios-objectc-client-powered-by-a-grails-backend/edit/master/src/main/docs/guide/v1Controller.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>We create a <em>Controller</em> for the <em>Domain class</em> we previously created. Our Controller extends  <a href="http://docs.grails.org/latest/guide/webServices.html#restfulControllers">RestfulController</a>. This
will provide us RESTful functionality to list, create, update and delete <code>Announcement</code> resources using
different HTTP  Methods.</p>
</div>
<div class="listingblock">
<div class="title">grails-app/controllers/intranet/backend/v1/AnnouncementController.groovy</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">package</span> intranet.backend.v1

<span class="keyword">import</span> <span class="include">grails.rest.RestfulController</span>
<span class="keyword">import</span> <span class="include">intranet.backend.Announcement</span>

<span class="type">class</span> <span class="class">AnnouncementController</span> <span class="directive">extends</span> RestfulController&lt;Announcement&gt; {
    <span class="directive">static</span> namespace = <span class="string"><span class="delimiter">'</span><span class="content">v1</span><span class="delimiter">'</span></span> <i class="conum" data-value="1"></i><b>(1)</b>
    <span class="directive">static</span> responseFormats = [<span class="string"><span class="delimiter">'</span><span class="content">json</span><span class="delimiter">'</span></span>] <i class="conum" data-value="2"></i><b>(2)</b>

    AnnouncementController() {
        <span class="local-variable">super</span>(Announcement)
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>this controller will handle v1 of our api</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>we want to respond only JSON Payloads</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="_url_mapping">Url Mapping</h3>
<div class="paragraph">
<p>We want our endpoint to listen in /announcements instead of /announcement. Moreover, we want previous controller for
which we declared a namespace of v1 to handle the requests with the Accept-Version Http Header set to 1.0.</p>
</div>
<div class="paragraph">
<p>Grails enables powerful <a href="http://docs.grails.org/latest/guide/theWebLayer.html#urlmappingss">URL mapping</a> configuration to
do that. Add the next line to the mappings closure:</p>
</div>
<div class="listingblock">
<div class="title">/grails-app/controllers/intranet/backend/UrlMappings.groovy</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">        get <span class="string"><span class="delimiter">&quot;</span><span class="content">/announcements</span><span class="delimiter">&quot;</span></span>(<span class="key">version</span>:<span class="string"><span class="delimiter">'</span><span class="content">1.0</span><span class="delimiter">'</span></span>, <span class="key">controller</span>: <span class="string"><span class="delimiter">'</span><span class="content">announcement</span><span class="delimiter">'</span></span>, <span class="key">namespace</span>:<span class="string"><span class="delimiter">'</span><span class="content">v1</span><span class="delimiter">'</span></span>)</code></pre>
</div>
</div>
</div>


<h2 id="bootstrap">4.5 Loading test data</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails-guides/building-an-ios-objectc-client-powered-by-a-grails-backend/edit/master/src/main/docs/guide/bootstrap.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>We are going to populate the database with several announcements when the application startups.</p>
</div>
<div class="paragraph">
<p>In order to do that, we edit <em>grails-app/init/grails/company/intranet/BootStrap.groovy</em>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">package</span> grails.company.intranet

<span class="type">class</span> <span class="class">BootStrap</span> {

    <span class="keyword">def</span> init = { servletContext -&gt;
        announcements().each { <span class="local-variable">it</span>.save() }
    }
    <span class="keyword">def</span> destroy = {
    }

    <span class="directive">static</span> <span class="predefined-type">List</span>&lt;Announcement&gt; announcements() {
        [
                <span class="keyword">new</span> Announcement(<span class="key">title</span>: <span class="string"><span class="delimiter">'</span><span class="content">Grails Quickcast #1: Grails Interceptors</span><span class="delimiter">'</span></span>),
                <span class="keyword">new</span> Announcement(<span class="key">title</span>: <span class="string"><span class="delimiter">'</span><span class="content">Grails Quickcast #2: JSON Views</span><span class="delimiter">'</span></span>)
        ]
    }
}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Announcements in the previous code snippet don&#8217;t contain <em>body</em> content
to keep the code sample small. Checkout <code>grails-app/init/intranet/backend/BootStrap.groovy</code> to see the complete code.
</td>
</tr>
</table>
</div>


<h2 id="v1FunctionalTests">4.6 Functional tests</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails-guides/building-an-ios-objectc-client-powered-by-a-grails-backend/edit/master/src/main/docs/guide/v1FunctionalTests.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p><a href="http://docs.grails.org/latest/guide/testing.html#functionalTesting">Functional Tests</a> involve making HTTP
requests against the running application and verifying the resultant behavior.</p>
</div>
<div class="paragraph">
<p>We use the <a href="https://github.com/grails-plugins/grails-rest-client-builder">Rest Client Builder Grails Plugin</a> whose
dependency is added when we create an app with the <em>rest-api</em> profile.</p>
</div>
<div class="paragraph">
<p>/home/runner/work/building-an-ios-objectc-client-powered-by-a-grails-backend/building-an-ios-objectc-client-powered-by-a-grails-backend/complete</p>
</div>
<div class="listingblock">
<div class="title">/src/integration-test/groovy/intranet/backend/AnnouncementControllerSpec.groovy</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">package</span> intranet.backend

<span class="keyword">import</span> <span class="include">grails.plugins.rest.client.RestBuilder</span>
<span class="keyword">import</span> <span class="include">grails.testing.mixin.integration.Integration</span>
<span class="keyword">import</span> <span class="include">org.springframework.beans.factory.annotation.Value</span>
<span class="keyword">import</span> <span class="include">spock.lang.Specification</span>
<span class="keyword">import</span> <span class="include">javax.servlet.http.HttpServletResponse</span>


<span class="annotation">@Integration</span>
<span class="type">class</span> <span class="class">AnnouncementControllerSpec</span> <span class="directive">extends</span> Specification {

    <span class="keyword">def</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">test body is present in announcements json payload of Api 1.0</span><span class="delimiter">&quot;</span></span>() {
        <span class="key">given</span>:
        RestBuilder rest = <span class="keyword">new</span> RestBuilder()

        <span class="key">when</span>: <span class="string"><span class="delimiter">'</span><span class="content">Requesting announcements for version 1.0</span><span class="delimiter">'</span></span>
        <span class="keyword">def</span> resp = rest.get(<span class="string"><span class="delimiter">&quot;</span><span class="content">http://localhost:</span><span class="inline"><span class="inline-delimiter">${</span>serverPort<span class="inline-delimiter">}</span></span><span class="content">/announcements/</span><span class="delimiter">&quot;</span></span>) { <i class="conum" data-value="1"></i><b>(1)</b>
            header(<span class="string"><span class="delimiter">&quot;</span><span class="content">Accept-Version</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">1.0</span><span class="delimiter">&quot;</span></span>) <i class="conum" data-value="2"></i><b>(2)</b>
        }

        <span class="key">then</span>: <span class="string"><span class="delimiter">'</span><span class="content">the request was successful</span><span class="delimiter">'</span></span>
        resp.status == HttpServletResponse.SC_OK <i class="conum" data-value="3"></i><b>(3)</b>

        <span class="key">and</span>: <span class="string"><span class="delimiter">'</span><span class="content">the response is a JSON Payload</span><span class="delimiter">'</span></span>
        resp.headers.get(<span class="string"><span class="delimiter">'</span><span class="content">Content-Type</span><span class="delimiter">'</span></span>) == [<span class="string"><span class="delimiter">'</span><span class="content">application/json;charset=UTF-8</span><span class="delimiter">'</span></span>]

        <span class="key">and</span>: <span class="string"><span class="delimiter">'</span><span class="content">json payload contains an array of annoucements with id, title and body</span><span class="delimiter">'</span></span>
        resp.json.each {
            <span class="keyword">assert</span> <span class="local-variable">it</span>.id
            <span class="keyword">assert</span> <span class="local-variable">it</span>.title
            <span class="keyword">assert</span> <span class="local-variable">it</span>.body <i class="conum" data-value="4"></i><b>(4)</b>
        }
    }

    <span class="keyword">def</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">test body is NOT present in announcements json payload of Api 2.0</span><span class="delimiter">&quot;</span></span>() {
        <span class="key">given</span>:
        RestBuilder rest = <span class="keyword">new</span> RestBuilder()</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>serverPort property is automatically injected. It contains the random port where the Grails application runs during the functional test</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Pass the api version as an Http header</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Verify the response code is 200; OK</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Body is present in the JSON paylod</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Grails command <em>test-app</em> runs unit, integration and functional tests.</p>
</div>


<h2 id="runningTheApp">4.7 Running the Application</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails-guides/building-an-ios-objectc-client-powered-by-a-grails-backend/edit/master/src/main/docs/guide/runningTheApp.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>To run the application use the <code>./gradlew bootRun</code> command which will start the application on port 8080.</p>
</div>


<h1 id="writingTheiOSApp">5 Writing the iOS Application</h1>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails-guides/building-an-ios-objectc-client-powered-by-a-grails-backend/edit/master/src/main/docs/guide/writingTheiOSApp.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>





<h2 id="ios-overview">5.1 Fetching the Announcements</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails-guides/building-an-ios-objectc-client-powered-by-a-grails-backend/edit/master/src/main/docs/guide/ios-overview.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Next image illustrates the classes involved in the fetching and rendering of the
announcements exposed by the Grails application</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../img/ios-announcements-overview.jpeg" alt="ios announcements overview">
</div>
</div>


<h2 id="iosModel">5.2 Model</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails-guides/building-an-ios-objectc-client-powered-by-a-grails-backend/edit/master/src/main/docs/guide/iosModel.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>The announcements sent by the server are gonna be rendered into an object:</p>
</div>
<div class="listingblock">
<div class="title">/complete-objectivec-ios-v1/IntranetClient/Announcement.h</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="objectivec">#import &lt;Foundation/Foundation.h&gt;

@interface Announcement : NSObject

@property (nonatomic, copy)NSNumber *primaryKey;
@property (nonatomic, copy)NSString *title;
@property (nonatomic, copy)NSString *body;

@end</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">/complete-objectivec-ios-v1/IntranetClient/Announcement.m</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="objectivec">#import &quot;Announcement.h&quot;

@implementation Announcement

@end</code></pre>
</div>
</div>


<h2 id="iosJsonToModel">5.3 Json to Model</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails-guides/building-an-ios-objectc-client-powered-by-a-grails-backend/edit/master/src/main/docs/guide/iosJsonToModel.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>To build a Model object from a JSON String we use several builder classes.</p>
</div>
<div class="listingblock">
<div class="title">/complete-objectivec-ios-v1/IntranetClient/AnnouncementBuilder.h</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="objectivec">#import &lt;Foundation/Foundation.h&gt;

#import &quot;ElementBuilder.h&quot;

extern NSString *kAnnouncementBuilderErrorDomain;

enum {
    kAnnouncementBuilderInvalidJSONError,
    kAnnouncementBuilderMissingDataError,
};

@interface AnnouncementBuilder : ElementBuilder

- (NSArray *)announcementsFromJSON:(NSString *)objectNotation
                             error:(NSError **)error;

@end</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">/complete-objectivec-ios-v1/IntranetClient/AnnouncementBuilder.m</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="objectivec">#import &quot;AnnouncementBuilder.h&quot;
#import &quot;Announcement.h&quot;

static NSString *kJSONKeyId = @&quot;id&quot;;
static NSString *kJSONKeyTitle = @&quot;title&quot;;
static NSString *kJSONKeyBody = @&quot;body&quot;;

@implementation AnnouncementBuilder

- (NSArray *)announcementsFromJSON:(NSString *)objectNotation
                             error:(NSError **)error {

    return [super arrayFromJSON:objectNotation
                            key:nil
                          error:error
           invalidJSONErrorCode:kAnnouncementBuilderInvalidJSONError
          missingDataErrorCode:kAnnouncementBuilderMissingDataError
                   errorDomain:kAnnouncementBuilderErrorDomain];
}

- (id)newElementWithDictionary:(NSDictionary *)dict
                         error:(NSError **)error
          invalidJSONErrorCode:(NSInteger)invalidJSONErrorCode
          missingDataErrorCode:(NSInteger)missingDataErrorCode
                   errorDomain:(NSString *)errorDomain {

    Announcement *announcement = [[Announcement alloc] init];

    if([[dict objectForKey:kJSONKeyId] isKindOfClass:[NSNumber class]]) {
        announcement.primaryKey = (NSNumber *)[dict objectForKey:kJSONKeyId];
    } else {
        if(error != NULL) {
            *error = [self invalidJsonError];
        }
        return nil;
    }

    if([[dict objectForKey:kJSONKeyTitle] isKindOfClass:[NSString class]]) {
        announcement.title = (NSString *)[dict objectForKey:kJSONKeyTitle];
    } else {
        if(error != NULL) {
            *error = [self invalidJsonError];
        }
        return nil;
    }

    if([[dict objectForKey:kJSONKeyBody] isKindOfClass:[NSString class]]) {
        announcement.body = (NSString *)[dict objectForKey:kJSONKeyBody];
    }

    return announcement;

}

- ( NSError *)invalidJsonError {
    NSMutableDictionary *userInfo = [NSMutableDictionary dictionaryWithCapacity:1];
    return [NSError errorWithDomain:kAnnouncementBuilderErrorDomain
                               code:kAnnouncementBuilderInvalidJSONError
                           userInfo:userInfo];
}

@end

NSString *kAnnouncementBuilderErrorDomain = @&quot;kAnnouncementBuilderErrorDomain&quot;;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">/complete-objectivec-ios-v1/IntranetClient/ElementBuilder.h</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="objectivec">#import &lt;Foundation/Foundation.h&gt;

@interface ElementBuilder : NSObject

- (NSArray *)arrayFromJSON:(NSString *)objectNotation
                       key:(NSString *)key
                     error:(NSError **)error
      invalidJSONErrorCode:(NSInteger)invalidJSONErrorCode
      missingDataErrorCode:(NSInteger)missingDataErrorCode
               errorDomain:(NSString *)errorDomain;
@end</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">/complete-objectivec-ios-v1/IntranetClient/ElementBuilder.m</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="objectivec">#import &quot;ElementBuilder.h&quot;

@implementation ElementBuilder


- (NSArray *)arrayFromJSON:(NSString *)objectNotation
                       key:(NSString *)key
                     error:(NSError **)error
      invalidJSONErrorCode:(NSInteger)invalidJSONErrorCode
      missingDataErrorCode:(NSInteger)missingDataErrorCode
               errorDomain:(NSString *)errorDomain {

    id parsedObject = [self parseJSON:objectNotation
                                error:error
                 invalidJSONErrorCode:invalidJSONErrorCode
                          errorDomain:errorDomain];

    NSArray *elements = nil;
    if ( [parsedObject isKindOfClass:[NSDictionary class]]) {
        elements = [((NSDictionary *)parsedObject) objectForKey:key];

    } else if ( [parsedObject isKindOfClass:[NSArray class]] ) {
        elements = (NSArray *)parsedObject;
    }

    if (elements == nil) {
        if (error != NULL) {
            *error = [NSError errorWithDomain:errorDomain code:missingDataErrorCode userInfo:nil];
        }
        return nil;
    }

    NSMutableArray *results = [NSMutableArray arrayWithCapacity:[elements count]];
    for (NSDictionary *parsedEl in elements) {
        id el = [self newElementWithDictionary:parsedEl
                                         error:error
                          invalidJSONErrorCode:invalidJSONErrorCode
                          missingDataErrorCode:missingDataErrorCode
                                   errorDomain:errorDomain];
        // Return nil becuase there has been an error in the previous method call
        if(!el) {
            return nil;
        }

        if([self isElementValid:el]) {
            [results addObject:el];
        }
    }
    return [results copy];
}


- (BOOL)isElementValid:(id)el {
    // This may be overriden in a subclass
    return YES;
}

- (id)newElementWithDictionary:(NSDictionary *)dict
                         error:(NSError **)error
          invalidJSONErrorCode:(NSInteger)invalidJSONErrorCode
          missingDataErrorCode:(NSInteger)missingDataErrorCode
                   errorDomain:(NSString *)errorDomain {
    @throw [NSException exceptionWithName:NSInternalInconsistencyException
                                   reason:[NSString stringWithFormat:@&quot;You must override %@ in a subclass&quot;, NSStringFromSelector(_cmd)]
                                 userInfo:nil];
}


- (id)parseJSON:(NSString *)objectNotation
          error:(NSError **)error
invalidJSONErrorCode:(NSInteger)invalidJSONErrorCode
    errorDomain:(NSString *)errorDomain  {

    NSParameterAssert(objectNotation != nil);
    id jsonObject;

    NSError *localError = nil;
    if(objectNotation != nil) {
        NSData *unicodeNotation = [objectNotation dataUsingEncoding:NSUTF8StringEncoding];
        jsonObject = [NSJSONSerialization JSONObjectWithData:unicodeNotation
                                                     options:0
                                                       error:&amp;localError];
    }
    if (jsonObject == nil) {
        if (error != NULL) {
            NSMutableDictionary *userInfo = [NSMutableDictionary dictionaryWithCapacity:1];
            if (localError != nil) {
                [userInfo setObject:localError forKey:NSUnderlyingErrorKey];
            }
            *error = [NSError errorWithDomain:errorDomain code:invalidJSONErrorCode userInfo:userInfo];
        }
        return nil;
    }
    return jsonObject;
}

+ (id)objectOrNull:(id)object {
    if (!object || object == [NSNull null]) return nil;
    return object;
}

+ (BOOL)isNotNilAndNotArrayTheKey:(NSString *)key atDict:(NSDictionary *)dict {
    return [self isNotNilTheKey:key atDict:dict] &amp;&amp; ![self isArrayTheKey:key atDict:dict];
}

+ (BOOL)isNotNilAndNotNumberTheKey:(NSString *)key atDict:(NSDictionary *)dict {
    return [self isNotNilTheKey:key atDict:dict] &amp;&amp; ![self isNumberTheKey:key atDict:dict];
}

+ (BOOL)isNotNilAndNotStringTheKey:(NSString *)key atDict:(NSDictionary *)dict {

    return [self isNotNilTheKey:key atDict:dict] &amp;&amp; ![self isStringTheKey:key atDict:dict];
}

+ (BOOL)isNotNilTheKey:(NSString *)key atDict:(NSDictionary *)dict {
    if(dict[key] != (id)[NSNull null]  &amp;&amp; dict[key]) {
        return YES;
    }
    return NO;
}

+ (BOOL)isStringTheKey:(NSString *)key atDict:(NSDictionary *)dict {
    if(dict[key] != (id)[NSNull null]  &amp;&amp; dict[key] &amp;&amp; [dict[key] isKindOfClass:[NSString class]]) {
        return YES;
    }
    return NO;
}

+ (BOOL)isNumberTheKey:(NSString *)key atDict:(NSDictionary *)dict {
    if(dict[key] != (id)[NSNull null]  &amp;&amp; dict[key] &amp;&amp; [dict[key] isKindOfClass:[NSNumber class]]) {
        return YES;
    }
    return NO;
}
+ (BOOL)isArrayTheKey:(NSString *)key atDict:(NSDictionary *)dict {
    if(dict[key] != (id)[NSNull null]  &amp;&amp; dict[key] &amp;&amp; [dict[key] isKindOfClass:[NSArray class]]) {
        return YES;
    }
    return NO;
}

@end</code></pre>
</div>
</div>


<h2 id="appTransportSecurity">5.4 App Transport Security</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails-guides/building-an-ios-objectc-client-powered-by-a-grails-backend/edit/master/src/main/docs/guide/appTransportSecurity.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>We are going to connect to our local machine running a Grails server. We need to disable <a href="https://developer.apple.com/news/?id=12212016b">App Transport Security</a> as illustrated below:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../img/apptransportsecurity.png" alt="apptransportsecurity">
</div>
</div>


<h2 id="networkingCode">5.5 Networking code</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails-guides/building-an-ios-objectc-client-powered-by-a-grails-backend/edit/master/src/main/docs/guide/networkingCode.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>We use <em>NSURLSession</em> to connect to the Grails API. Several constants are set in <em>GrailsFetcher</em></p>
</div>
<div class="listingblock">
<div class="title">/complete-objectivec-ios-v1/IntranetClient/GrailsFetcher.h</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="objectivec">#import &lt;Foundation/Foundation.h&gt;

static NSString *kServerUrl = @&quot;http://192.168.1.40:8080&quot;;
static NSString *kApiVersion = @&quot;1.0&quot;;
static NSString *kAnnouncementsResourcePath = @&quot;announcements&quot;;
static NSInteger FAST_TIME_INTERVAL = 5.0;

@interface GrailsFetcher : NSObject

@property (nonatomic, strong) NSURLSession *session;

- (NSURLRequest *)getURLRequestWithUrlString:(NSString *)urlString
                                 cachePolicy:(NSURLRequestCachePolicy)cachePolicy
                             timeoutInterval:(NSTimeInterval)timeoutInterval;

@end</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Grails App server url</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The path we configured in the Grails app in <em>UrlMappings.groovy</em></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The version of the API</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
You may need to change the ip address to match your local machine.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">/complete-objectivec-ios-v1/IntranetClient/GrailsFetcher.m</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="objectivec">#import &quot;GrailsFetcher.h&quot;

@interface GrailsFetcher () &lt;NSURLSessionDelegate&gt;

@end

@implementation GrailsFetcher

#pragma mark - LifeCycle

- (id)init {
    if(self = [super init]) {
        NSURLSessionConfiguration* configuration = [NSURLSessionConfiguration defaultSessionConfiguration];
        self.session = [NSURLSession sessionWithConfiguration:configuration
                                                     delegate:self
                                                delegateQueue:[NSOperationQueue mainQueue]];
    }
    return self;
}


#pragma mark - Public


- (NSURLRequest *)getURLRequestWithUrlString:(NSString *)urlString
                                 cachePolicy:(NSURLRequestCachePolicy)cachePolicy
                             timeoutInterval:(NSTimeInterval)timeoutInterval {
    NSURL *url = [NSURL URLWithString:urlString];
    NSMutableURLRequest *urlRequest = [NSMutableURLRequest requestWithURL:url
                                                              cachePolicy:NSURLRequestReloadIgnoringLocalCacheData
                                                          timeoutInterval:FAST_TIME_INTERVAL];
    [urlRequest setHTTPMethod:@&quot;GET&quot;];

    [[self headers] enumerateKeysAndObjectsUsingBlock:^(id key, id obj, BOOL * stop) {
        [urlRequest setValue:obj forHTTPHeaderField:key];
    }];
    return urlRequest;
}

#pragma mark - Private

- (NSDictionary *)headers {
    return @{@&quot;Accept-Version&quot;: kApiVersion}; <i class="conum" data-value="1"></i><b>(1)</b>
}

@end</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>We set the <em>Accept-Version</em> Http header for every request.</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">/complete-objectivec-ios-v1/IntranetClient/AnnouncementsFetcher.h</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="objectivec">#import &lt;Foundation/Foundation.h&gt;
#import &quot;GrailsFetcher.h&quot;

@protocol AnnouncementsFetcherDelegate;

@interface AnnouncementsFetcher : GrailsFetcher

- (id)initWithDelegate:(id&lt;AnnouncementsFetcherDelegate&gt;)delegate;

- (void)fetchAnnouncements;

@end</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">/complete-objectivec-ios-v1/IntranetClient/AnnouncementsFetcher.m</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="objectivec">#import &quot;AnnouncementsFetcher.h&quot;
#import &quot;AnnouncementsFetcherDelegate.h&quot;
#import &quot;AnnouncementBuilder.h&quot;


@interface AnnouncementsFetcher ()

@property ( nonatomic, weak) id&lt;AnnouncementsFetcherDelegate&gt; delegate;

@property ( nonatomic, strong) AnnouncementBuilder *builder;

@end

@implementation AnnouncementsFetcher

- (id)initWithDelegate:(id&lt;AnnouncementsFetcherDelegate&gt;)delegate {
    if(self = [super init]) {
        self.delegate = delegate;
        self.builder = [[AnnouncementBuilder alloc] init];
    }
    return self;
}

- (void)fetchAnnouncements {

    [self fetchAnnouncementsWithCompletionHandler:^(NSData *data, NSURLResponse *response, NSError *error) {
        if(error) {
            if ( self.delegate ) {
                [self.delegate announcementsFetchingFailed];
            }
            return;
        }

        NSInteger statusCode = [((NSHTTPURLResponse*)response) statusCode];
        if(statusCode != 200) {
            if ( self.delegate ) {
                [self.delegate announcementsFetchingFailed];
            }
            return;
        }

        NSString *objectNotation = [[NSString alloc] initWithData:data encoding:NSUTF8StringEncoding];
        NSError *builderError;
        NSArray *announcements = [self.builder announcementsFromJSON:objectNotation error:&amp;builderError];
        if(builderError) {
            if ( self.delegate ) {
                [self.delegate announcementsFetchingFailed];
            }
            return;
        }
        if ( self.delegate ) {
            [self.delegate announcementsFetched:announcements];
        }

    }];
}

- (void)fetchAnnouncementsWithCompletionHandler:(void (^)(NSData * data, NSURLResponse * response, NSError * error))completionHandler {
    NSURLSessionDataTask *dataTask = [self.session dataTaskWithRequest:[self announcementsURLRequest] completionHandler:completionHandler];
    [dataTask resume];
}

- (NSURLRequest *)announcementsURLRequest {
    NSString *urlStr = [self announcementsURLString];
    return [super getURLRequestWithUrlString:urlStr
                                 cachePolicy:NSURLRequestReloadIgnoringLocalCacheData
                             timeoutInterval:FAST_TIME_INTERVAL];
}

- (NSString *)announcementsURLString {
    return [NSString stringWithFormat:@&quot;%@/%@&quot;, kServerUrl, kAnnouncementsResourcePath];
}

@end</code></pre>
</div>
</div>
<div class="paragraph">
<p>Once we get a list of announcements, we communicate the response to classes implementing the delegate</p>
</div>
<div class="listingblock">
<div class="title">/complete-objectivec-ios-v1/IntranetClient/AnnouncementsFetcherDelegate.h</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="objectivec">#import &lt;Foundation/Foundation.h&gt;

@protocol AnnouncementsFetcherDelegate &lt;NSObject&gt;

- (void)announcementsFetchingFailed;

- (void)announcementsFetched:(NSArray *)announcements;


@end</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <em>MasterViewController</em> implements fetcher delegate protocol, thus it receives the announcements</p>
</div>
<div class="listingblock">
<div class="title">/complete-objectivec-ios-v1/IntranetClient/MasterViewController.h</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="objectivec">#import &lt;UIKit/UIKit.h&gt;

@class DetailViewController;

@interface MasterViewController : UITableViewController

@property (strong, nonatomic) DetailViewController *detailViewController;


@end</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">/complete-objectivec-ios-v1/IntranetClient/MasterViewController.m</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="objectivec">#import &quot;MasterViewController.h&quot;
#import &quot;DetailViewController.h&quot;
#import &quot;AnnouncementsFetcherDelegate.h&quot;
#import &quot;AnnouncementsFetcher.h&quot;
#import &quot;AnnouncementsTableViewDataSource.h&quot;
#import &quot;AnnouncementsTableViewDelegate.h&quot;
#import &quot;Announcement.h&quot;

static NSString *kSegueShowDetail = @&quot;showDetail&quot;;

@interface MasterViewController () &lt;AnnouncementsFetcherDelegate&gt;

@property NSMutableArray *objects;

@property ( nonatomic, strong ) AnnouncementsFetcher *fetcher;

@property ( nonatomic, strong) id&lt;UITableViewDataSource&gt; tableViewDataSource;
@property ( nonatomic, strong) id&lt;UITableViewDelegate&gt; tableViewDelegate;

@end

@implementation MasterViewController

- (void)viewDidLoad {
    [super viewDidLoad];

    self.tableViewDataSource = [[AnnouncementsTableViewDataSource alloc] init];
    self.tableViewDelegate = [[AnnouncementsTableViewDelegate alloc] init];
    self.tableView.dataSource = self.tableViewDataSource;
    self.tableView.delegate = self.tableViewDelegate;
}

- (void)viewWillAppear:(BOOL)animated {
    self.clearsSelectionOnViewWillAppear = self.splitViewController.isCollapsed;
    [super viewWillAppear:animated];

    [self registerNotifications];
    [self fetchAnnouncements]; <i class="conum" data-value="1"></i><b>(1)</b>
}

- (void)viewWillDisappear:(BOOL)animated {
    [super viewWillDisappear:animated];
    [self unregisterNotifications];
}

#pragma mark - Notifications

-(void)registerNotifications {

    NSNotificationCenter *nc = [NSNotificationCenter defaultCenter];
    [nc addObserver:self selector:@selector(announcementTapped:) name:kAnnouncementTappedNotification object:nil];
}

- (void)unregisterNotifications {
    NSNotificationCenter *nc = [NSNotificationCenter defaultCenter];
    [nc removeObserver:self name:kAnnouncementTappedNotification object:nil];
}

#pragma mark - Segues

- (void)prepareForSegue:(UIStoryboardSegue *)segue sender:(id)sender {
    if ([[segue identifier] isEqualToString:kSegueShowDetail]) {
        DetailViewController *controller = (DetailViewController *)[[segue destinationViewController] topViewController];
        if([sender isKindOfClass:[Announcement class]]) {
            Announcement *announcement = (Announcement *)sender;
            controller.announcement = announcement;
        }
        controller.navigationItem.leftBarButtonItem = self.splitViewController.displayModeButtonItem;
        controller.navigationItem.leftItemsSupplementBackButton = YES;
    }
}

#pragma mark - Private Methods

- (void)announcementTapped:(NSNotification *)notification {
    if([[notification object] isKindOfClass:[Announcement class]]) {
        Announcement *announcement = (Announcement *)[notification object];
        [self performSegueWithIdentifier:kSegueShowDetail sender:announcement];
    }
}

- (void)setNetworkActivityIndicator:(BOOL)visible {
    [[UIApplication sharedApplication] setNetworkActivityIndicatorVisible:visible];
}

- (void)fetchAnnouncements {
    [self setNetworkActivityIndicator:YES];
    [self.fetcher fetchAnnouncements];
}

#pragma mark - AnnouncementsFetcherDelegate

- (void)announcementsFetchingFailed {
    [self setNetworkActivityIndicator:NO];
}

- (void)announcementsFetched:(NSArray *)announcements {
    [self setNetworkActivityIndicator:NO];

    if ( [self.tableViewDataSource isKindOfClass:[AnnouncementsTableViewDataSource class]]) {
        ((AnnouncementsTableViewDataSource *)self.tableViewDataSource).announcements = announcements;
    }
    if ( [self.tableViewDelegate isKindOfClass:[AnnouncementsTableViewDelegate class]]) {
        ((AnnouncementsTableViewDelegate *)self.tableViewDelegate).announcements = announcements;
    }
    [self.tableView reloadData];  <i class="conum" data-value="2"></i><b>(2)</b>
}

#pragma mark - Lazy

- (AnnouncementsFetcher *)fetcher {
    if(!_fetcher) {
        _fetcher = [[AnnouncementsFetcher alloc] initWithDelegate:self];
    }
    return _fetcher;
}

@end</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Triggers announcements fetching</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Refreshes the UI once we get a list of announcements</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>MasterViewController sets its UITableView&#8217;s data source and delegate to the next classes:</p>
</div>
<div class="listingblock">
<div class="title">/complete-objectivec-ios-v1/IntranetClient/AnnouncementsTableViewDataSource.h</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="objectivec">#import &lt;UIKit/UIKit.h&gt;

@interface AnnouncementsTableViewDataSource : NSObject &lt;UITableViewDataSource&gt;

@property (nonatomic, strong) NSArray *announcements;

@end</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">/complete-objectivec-ios-v1/IntranetClient/AnnouncementsTableViewDataSource.m</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="objectivec">#import &quot;AnnouncementsTableViewDataSource.h&quot;
#import &quot;Announcement.h&quot;

@implementation AnnouncementsTableViewDataSource

#pragma mark - UITableViewDataSource

- (NSInteger)tableView:(UITableView *)tableView numberOfRowsInSection:(NSInteger)section {
    return [self.announcements count];
}


- (UITableViewCell *)tableView:(UITableView *)tableView cellForRowAtIndexPath:(NSIndexPath *)indexPath {
    UITableViewCell *cell = [tableView dequeueReusableCellWithIdentifier:@&quot;Cell&quot; forIndexPath:indexPath];

    if ( [self.announcements count] &gt; indexPath.row ) {
        id obj = self.announcements[indexPath.row];
        if ( [obj isKindOfClass:[Announcement class]]) {
            Announcement *announcement = (Announcement *)obj;
            cell.textLabel.text = announcement.title;
        }
    }

    return cell;
}


@end</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">/complete-objectivec-ios-v1/IntranetClient/AnnouncementsTableViewDelegate.h</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="objectivec">#import &lt;UIKit/UIKit.h&gt;

static NSString *kAnnouncementTappedNotification = @&quot;AnnouncementTappedNotification&quot;;

@interface AnnouncementsTableViewDelegate : NSObject &lt;UITableViewDelegate&gt;

@property (nonatomic, strong) NSArray *announcements;

@end</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">/complete-objectivec-ios-v1/IntranetClient/AnnouncementsTableViewDelegate.m</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="objectivec">#import &quot;AnnouncementsTableViewDelegate.h&quot;
#import &quot;Announcement.h&quot;

@implementation AnnouncementsTableViewDelegate

#pragma mark - UITableViewDelegate

- (void)tableView:(UITableView *)tableView didSelectRowAtIndexPath:(NSIndexPath *)indexPath {

    if ( [self.announcements count] &gt; indexPath.row ) {
        id obj = self.announcements[indexPath.row];
        if ( [obj isKindOfClass:[Announcement class]]) {
            Announcement *announcement = (Announcement *)obj;
            [[NSNotificationCenter defaultCenter] postNotificationName:kAnnouncementTappedNotification <i class="conum" data-value="1"></i><b>(1)</b>
                                                                object:announcement
                                                              userInfo:nil];
        }
    }
}


@end</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>When the user taps an announcement a <em>NSNotification</em> is raised. It is captured in <em>MasterViewController</em> and
initiates the segue to the DetailViewController</td>
</tr>
</table>
</div>


<h2 id="detailViewController">5.6 Detail View Controller</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails-guides/building-an-ios-objectc-client-powered-by-a-grails-backend/edit/master/src/main/docs/guide/detailViewController.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>When the user taps an announcement, a <em>NSNotification</em> is posted which contains
the tapped announcement. In the method <em>prepareForSegue:sender</em> of <em>MasterViewController</em>
we set the announcement property of <em>DetailViewController</em></p>
</div>
<div class="listingblock">
<div class="title">/complete-objectivec-ios-v1/IntranetClient/MasterViewController.m</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="objectivec">- (void)prepareForSegue:(UIStoryboardSegue *)segue sender:(id)sender {
    if ([[segue identifier] isEqualToString:kSegueShowDetail]) {
        DetailViewController *controller = (DetailViewController *)[[segue destinationViewController] topViewController];
        if([sender isKindOfClass:[Announcement class]]) {
            Announcement *announcement = (Announcement *)sender;
            controller.announcement = announcement;
        }
        controller.navigationItem.leftBarButtonItem = self.splitViewController.displayModeButtonItem;
        controller.navigationItem.leftItemsSupplementBackButton = YES;
    }
}</code></pre>
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="../img/segue.jpeg" alt="segue">
</div>
</div>
<div class="paragraph">
<p>To render the announcement we use a UILabel and UIWebView which we wire up to IBOutlets in the StoryBoard as illustrated below:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../img/connect_detail_iboutlets.png" alt="connect detail iboutlets">
</div>
</div>
<div class="paragraph">
<p>This is the complete <em>DetailViewController</em> code. There is no networking code involved.</p>
</div>
<div class="listingblock">
<div class="title">/complete-objectivec-ios-v1/IntranetClient/DetailViewController.h</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="objectivec">#import &lt;UIKit/UIKit.h&gt;
#import &quot;Announcement.h&quot;

@interface DetailViewController : UIViewController

@property (nonatomic, strong) Announcement *announcement;

@end</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">/complete-objectivec-ios-v1/IntranetClient/DetailViewController.m</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="objectivec">#import &quot;DetailViewController.h&quot;
#import &quot;Announcement.h&quot;

@interface DetailViewController () &lt;UIWebViewDelegate&gt;

@property ( nonatomic, weak) IBOutlet UILabel *titleLabel;
@property ( nonatomic, weak) IBOutlet UIWebView *webView;
@property (weak, nonatomic) IBOutlet UIActivityIndicatorView *activityIndicatorView;

@end

@implementation DetailViewController

- (void)configureView {
    // Update the user interface for the detail item.
    if (self.announcement) {
        self.titleLabel.text = self.announcement.title;
        [[self activityIndicatorView] startAnimating];
        [self.webView loadHTMLString:self.announcement.body baseURL:nil];
    }
}

- (void)viewDidLoad {
    [super viewDidLoad];
    self.webView.delegate = self;
    // Do any additional setup after loading the view, typically from a nib.
    [self configureView];
}

#pragma mark - Managing the detail item

- (void)setAnnouncement:(Announcement *)announcement {
    if (_announcement != announcement) {
        _announcement = announcement;

        // Update the view.
        [self configureView];
    }
}

#pragma mark - UIWebViewDelegate
- (void)webViewDidFinishLoad:(UIWebView *)webView {
    [[self activityIndicatorView] stopAnimating];
}
- (void)webView:(UIWebView *)webView didFailLoadWithError:(NSError *)error {
    [[self activityIndicatorView] stopAnimating];
}

@end</code></pre>
</div>
</div>


<h1 id="version2">6 API version 2.0</h1>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails-guides/building-an-ios-objectc-client-powered-by-a-grails-backend/edit/master/src/main/docs/guide/version2.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>The problem with the first version of the API is that we include every announcement
body in the payload used to displayed the list. An announcement&#8217;s body can be a large block of HTML.
A user will probably just wants to check a couple of announcements. It will save bandwidth and
make the app faster if we don&#8217;t send the announcement body in the initial request. Instead, we will ask
the API for a complete announcement (including <code>body</code>) once the user taps the announcement.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../img/version2overview.jpeg" alt="version2overview">
</div>
</div>


<h2 id="v2Controller">6.1 Grails V2 Changes</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails-guides/building-an-ios-objectc-client-powered-by-a-grails-backend/edit/master/src/main/docs/guide/v2Controller.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>We are going to use create a new Controller to handle the version 2 of the API. We are going to use a Criteria
query with a projection to fetch only the id and title of the announcements.</p>
</div>
<div class="listingblock">
<div class="title">grails-app/controllers/intranet/backend/v2/AnnouncementController.groovy</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">package</span> intranet.backend.v2

<span class="keyword">import</span> <span class="include">grails.rest.RestfulController</span>
<span class="keyword">import</span> <span class="include">intranet.backend.Announcement</span>

<span class="type">class</span> <span class="class">AnnouncementController</span> <span class="directive">extends</span> RestfulController&lt;Announcement&gt; {
    <span class="directive">static</span> namespace = <span class="string"><span class="delimiter">'</span><span class="content">v2</span><span class="delimiter">'</span></span>
    <span class="directive">static</span> responseFormats = [<span class="string"><span class="delimiter">'</span><span class="content">json</span><span class="delimiter">'</span></span>]

    <span class="keyword">def</span> announcementService

    AnnouncementController() {
        <span class="local-variable">super</span>(Announcement)
    }

    <span class="keyword">def</span> <span class="function">index</span>(<span class="predefined-type">Integer</span> max) {
        params.max = <span class="predefined-type">Math</span>.min(max ?: <span class="integer">10</span>, <span class="integer">100</span>)
        <span class="keyword">def</span> announcements = announcementService.findAllIdAndTitleProjections(params)
        respond announcements, <span class="key">model</span>: [(<span class="string"><span class="delimiter">&quot;</span><span class="inline"><span class="inline-delimiter">${</span>resourceName<span class="inline-delimiter">}</span></span><span class="content">Count</span><span class="delimiter">&quot;</span></span>.toString()): countResources()]
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>We encapsulate the querying in a service</p>
</div>
<div class="listingblock">
<div class="title">grails-app/services/intranet/backend/AnnouncementService.groovy</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">package</span> intranet.backend

<span class="keyword">import</span> <span class="include">grails.transaction.Transactional</span>

<span class="annotation">@Transactional</span>(readOnly = <span class="predefined-constant">true</span>)
<span class="type">class</span> <span class="class">AnnouncementService</span> {

    <span class="predefined-type">List</span>&lt;<span class="predefined-type">Map</span>&gt; findAllIdAndTitleProjections(<span class="predefined-type">Map</span> params) {
        <span class="keyword">def</span> c = Announcement.createCriteria()
        <span class="keyword">def</span> announcements = c.list(params) {
            projections {
                property(<span class="string"><span class="delimiter">'</span><span class="content">id</span><span class="delimiter">'</span></span>)
                property(<span class="string"><span class="delimiter">'</span><span class="content">title</span><span class="delimiter">'</span></span>)
            }
        }.collect { [<span class="key">id</span>: <span class="local-variable">it</span>[<span class="integer">0</span>], <span class="key">title</span>: <span class="local-variable">it</span>[<span class="integer">1</span>]] } <span class="keyword">as</span> <span class="predefined-type">List</span>&lt;<span class="predefined-type">Map</span>&gt;
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>and we test it:</p>
</div>
<div class="listingblock">
<div class="title">/src/test/groovy/intranet/backend/AnnouncementServiceSpec.groovy</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">package</span> intranet.backend

<span class="keyword">import</span> <span class="include">grails.test.hibernate.HibernateSpec</span>
<span class="keyword">import</span> <span class="include">grails.testing.services.ServiceUnitTest</span>

<span class="type">class</span> <span class="class">AnnouncementServiceSpec</span> <span class="directive">extends</span> HibernateSpec <span class="directive">implements</span> ServiceUnitTest&lt;AnnouncementService&gt; {

    <span class="keyword">def</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">test criteria query with projection returns a list of maps</span><span class="delimiter">&quot;</span></span>() {

        <span class="key">when</span>: <span class="string"><span class="delimiter">'</span><span class="content">Save some announcements</span><span class="delimiter">'</span></span>
        [<span class="keyword">new</span> Announcement(<span class="key">title</span>: <span class="string"><span class="delimiter">'</span><span class="content">Grails Quickcast #1: Grails Interceptors</span><span class="delimiter">'</span></span>),
        <span class="keyword">new</span> Announcement(<span class="key">title</span>: <span class="string"><span class="delimiter">'</span><span class="content">Grails Quickcast #2: JSON Views</span><span class="delimiter">'</span></span>),
        <span class="keyword">new</span> Announcement(<span class="key">title</span>: <span class="string"><span class="delimiter">'</span><span class="content">Grails Quickcast #3: Multi-Project Builds</span><span class="delimiter">'</span></span>),
        <span class="keyword">new</span> Announcement(<span class="key">title</span>: <span class="string"><span class="delimiter">'</span><span class="content">Grails Quickcast #4: Angular Scaffolding</span><span class="delimiter">'</span></span>),
        <span class="keyword">new</span> Announcement(<span class="key">title</span>: <span class="string"><span class="delimiter">'</span><span class="content">Retrieving Runtime Config Values In Grails 3</span><span class="delimiter">'</span></span>),
        <span class="keyword">new</span> Announcement(<span class="key">title</span>: <span class="string"><span class="delimiter">'</span><span class="content">Developing Grails 3 Applications With IntelliJ IDEA</span><span class="delimiter">'</span></span>)].each {
            <span class="local-variable">it</span>.save()
        }

        <span class="key">then</span>: <span class="string"><span class="delimiter">'</span><span class="content">announcements are saved</span><span class="delimiter">'</span></span>
        Announcement.count() == <span class="integer">6</span>

        <span class="key">when</span>: <span class="string"><span class="delimiter">'</span><span class="content">fetching the projection</span><span class="delimiter">'</span></span>
        <span class="keyword">def</span> resp = service.findAllIdAndTitleProjections([:])

        <span class="key">then</span>: <span class="string"><span class="delimiter">'</span><span class="content">there are six maps in the response</span><span class="delimiter">'</span></span>
        resp
        resp.size() == <span class="integer">6</span>

        <span class="key">and</span>: <span class="string"><span class="delimiter">'</span><span class="content">the maps contain only id and title</span><span class="delimiter">'</span></span>
        resp.each {
            <span class="local-variable">it</span>.keySet() == [<span class="string"><span class="delimiter">'</span><span class="content">title</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">id</span><span class="delimiter">'</span></span>] <span class="keyword">as</span> <span class="predefined-type">Set</span>&lt;<span class="predefined-type">String</span>&gt;
         }

        <span class="key">and</span>: <span class="string"><span class="delimiter">'</span><span class="content">non empty values</span><span class="delimiter">'</span></span>
        resp.each {
            <span class="keyword">assert</span> <span class="local-variable">it</span>.title
            <span class="keyword">assert</span> <span class="local-variable">it</span>.id
        }

    }
}</code></pre>
</div>
</div>
<div class="sect2">
<h3 id="_url_mapping">Url Mapping</h3>
<div class="paragraph">
<p>We need to map the version <em>2.0</em> of the Accept-Header to the namespace <em>v2</em></p>
</div>
<div class="listingblock">
<div class="title">/grails-app/controllers/intranet/backend/UrlMappings.groovy</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">        get <span class="string"><span class="delimiter">&quot;</span><span class="content">/announcements</span><span class="delimiter">&quot;</span></span>(<span class="key">version</span>:<span class="string"><span class="delimiter">'</span><span class="content">2.0</span><span class="delimiter">'</span></span>, <span class="key">controller</span>: <span class="string"><span class="delimiter">'</span><span class="content">announcement</span><span class="delimiter">'</span></span>, <span class="key">namespace</span>:<span class="string"><span class="delimiter">'</span><span class="content">v2</span><span class="delimiter">'</span></span>)
        get <span class="string"><span class="delimiter">&quot;</span><span class="content">/announcements/</span><span class="inline"><span class="inline-delimiter">$</span>id</span><span class="content">(.</span><span class="inline"><span class="inline-delimiter">$</span>format</span><span class="content">)?</span><span class="delimiter">&quot;</span></span>(<span class="key">version</span>:<span class="string"><span class="delimiter">'</span><span class="content">2.0</span><span class="delimiter">'</span></span>, <span class="key">controller</span>: <span class="string"><span class="delimiter">'</span><span class="content">announcement</span><span class="delimiter">'</span></span>, <span class="key">action</span>: <span class="string"><span class="delimiter">'</span><span class="content">show</span><span class="delimiter">'</span></span>, <span class="key">namespace</span>:<span class="string"><span class="delimiter">'</span><span class="content">v2</span><span class="delimiter">'</span></span>)</code></pre>
</div>
</div>
</div>


<h2 id="v2FunctionalTests">6.2 Api 2.0 Functional tests</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails-guides/building-an-ios-objectc-client-powered-by-a-grails-backend/edit/master/src/main/docs/guide/v2FunctionalTests.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>We want to test the Api version 2.0 does not include the body property when receiving a GET request to the <em>announcements</em>
endpoint. The next functional test verifies that behaviour.</p>
</div>
<div class="paragraph">
<p>/home/runner/work/building-an-ios-objectc-client-powered-by-a-grails-backend/building-an-ios-objectc-client-powered-by-a-grails-backend/complete</p>
</div>
<div class="listingblock">
<div class="title">/src/integration-test/groovy/intranet/backend/AnnouncementControllerSpec.groovy</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">package</span> intranet.backend

<span class="keyword">import</span> <span class="include">grails.plugins.rest.client.RestBuilder</span>
<span class="keyword">import</span> <span class="include">grails.testing.mixin.integration.Integration</span>
<span class="keyword">import</span> <span class="include">org.springframework.beans.factory.annotation.Value</span>
<span class="keyword">import</span> <span class="include">spock.lang.Specification</span>
<span class="keyword">import</span> <span class="include">javax.servlet.http.HttpServletResponse</span>


<span class="annotation">@Integration</span>
<span class="type">class</span> <span class="class">AnnouncementControllerSpec</span> <span class="directive">extends</span> Specification {

    <span class="keyword">def</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">test body is present in announcements json payload of Api 1.0</span><span class="delimiter">&quot;</span></span>() {
        <span class="key">given</span>:
        RestBuilder rest = <span class="keyword">new</span> RestBuilder()

        <span class="key">when</span>: <span class="string"><span class="delimiter">'</span><span class="content">Requesting announcements for version 2.0</span><span class="delimiter">'</span></span>
        <span class="keyword">def</span> resp = rest.get(<span class="string"><span class="delimiter">&quot;</span><span class="content">http://localhost:</span><span class="inline"><span class="inline-delimiter">${</span>serverPort<span class="inline-delimiter">}</span></span><span class="content">/announcements/</span><span class="delimiter">&quot;</span></span>) {
            header(<span class="string"><span class="delimiter">&quot;</span><span class="content">Accept-Version</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">2.0</span><span class="delimiter">&quot;</span></span>)
        }

        <span class="key">then</span>: <span class="string"><span class="delimiter">'</span><span class="content">the request was successful</span><span class="delimiter">'</span></span>
        resp.status == HttpServletResponse.SC_OK

        <span class="key">and</span>: <span class="string"><span class="delimiter">'</span><span class="content">the response is a JSON Payload</span><span class="delimiter">'</span></span>
        resp.headers.get(<span class="string"><span class="delimiter">'</span><span class="content">Content-Type</span><span class="delimiter">'</span></span>) == [<span class="string"><span class="delimiter">'</span><span class="content">application/json;charset=UTF-8</span><span class="delimiter">'</span></span>]

        <span class="key">and</span>: <span class="string"><span class="delimiter">'</span><span class="content">json payload contains an array of annoucements with id, title</span><span class="delimiter">'</span></span>
        resp.json.each {
            <span class="keyword">assert</span> <span class="local-variable">it</span>.id
            <span class="keyword">assert</span> <span class="local-variable">it</span>.title
            <span class="keyword">assert</span> !<span class="local-variable">it</span>.body <i class="conum" data-value="2"></i><b>(2)</b>
        }
    }

    <span class="keyword">def</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">test detail of an announcement contains body in both version 1.0 and 2.0</span><span class="delimiter">&quot;</span></span>() {
        <span class="key">given</span>:</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>serverPort property is automatically injected. It contains the random port where the Grails application runs during the functional test</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Body is not present in the JSON paylod</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Grails command <em>test-app</em> runs unit, integration and functional tests.</p>
</div>


<h2 id="v2iOS">6.3 iOS V2 Changes</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails-guides/building-an-ios-objectc-client-powered-by-a-grails-backend/edit/master/src/main/docs/guide/v2iOS.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>First we need to change the Api version constant defined in <em>GrailsFetcher.h</em></p>
</div>
<div class="listingblock">
<div class="title">/complete-objectivec-ios-v2/IntranetClient/GrailsFetcher.h</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="objectivec">#import &lt;Foundation/Foundation.h&gt;

static NSString *kServerUrl = @&quot;http://192.168.1.40:8080&quot;;
static NSString *kApiVersion = @&quot;2.0&quot;; <i class="conum" data-value="1"></i><b>(1)</b>
static NSString *kAnnouncementsResourcePath = @&quot;announcements&quot;;
static NSInteger FAST_TIME_INTERVAL = 5.0;

@interface GrailsFetcher : NSObject

@property (nonatomic, strong) NSURLSession *session;

- (NSURLRequest *)getURLRequestWithUrlString:(NSString *)urlString
                                 cachePolicy:(NSURLRequestCachePolicy)cachePolicy
                             timeoutInterval:(NSTimeInterval)timeoutInterval;

@end</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>uses Api version 2.0</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>In version 2.0 the Api does not return the body of the announcements. Instead of setting
an announcement property we are going to set just the resource identifier(primary
key) in the <em>DetailViewController</em>. We have changed the <em>prepareForSegue:sender</em> method
in <em>MasterViewController</em> as illustrated below:</p>
</div>
<div class="listingblock">
<div class="title">/complete-objectivec-ios-v2/IntranetClient/MasterViewController.m</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="objectivec">- (void)prepareForSegue:(UIStoryboardSegue *)segue sender:(id)sender {
    if ([[segue identifier] isEqualToString:kSegueShowDetail]) {
        DetailViewController *controller = (DetailViewController *)[[segue destinationViewController] topViewController];
        if([sender isKindOfClass:[Announcement class]]) {
            Announcement *announcement = (Announcement *)sender;
            controller.announcementPrimaryKey = announcement.primaryKey; <i class="conum" data-value="1"></i><b>(1)</b>
        }
        controller.navigationItem.leftBarButtonItem = self.splitViewController.displayModeButtonItem;
        controller.navigationItem.leftItemsSupplementBackButton = YES;
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Instead of setting an object, we set an <em>NSNumber</em></td>
</tr>
</table>
</div>
<div class="paragraph">
<p><em>DetailViewController</em> asks the server for a complete announcement; body included.</p>
</div>
<div class="listingblock">
<div class="title">/complete-objectivec-ios-v2/IntranetClient/DetailViewController.h</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="objectivec">#import &lt;UIKit/UIKit.h&gt;
#import &quot;Announcement.h&quot;

@interface DetailViewController : UIViewController

@property (nonatomic, assign) NSNumber *announcementPrimaryKey;

@end</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">/complete-objectivec-ios-v2/IntranetClient/DetailViewController.m</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="objectivec">#import &quot;DetailViewController.h&quot;
#import &quot;Announcement.h&quot;
#import &quot;AnnouncementFetcher.h&quot;

@interface DetailViewController () &lt;UIWebViewDelegate, AnnouncementFetcherDelegate&gt;

@property ( nonatomic, weak) IBOutlet UILabel *titleLabel;
@property ( nonatomic, weak) IBOutlet UIWebView *webView;
@property (weak, nonatomic) IBOutlet UIActivityIndicatorView *activityIndicatorView;

@property ( nonatomic, strong ) AnnouncementFetcher *fetcher;

@property (nonatomic, strong) Announcement *announcement;

@end

@implementation DetailViewController

- (void)configureView {
    // Update the user interface for the detail item.
    if (self.announcement) {
        self.titleLabel.text = self.announcement.title;
        [[self activityIndicatorView] startAnimating];
        [self.webView loadHTMLString:self.announcement.body baseURL:nil];
    }
}


- (void)viewDidLoad {
    [super viewDidLoad];
    self.webView.delegate = self;
    // Do any additional setup after loading the view, typically from a nib.
    [self configureView];

    if ( self.announcementPrimaryKey ) {
        [self.fetcher fetchAnnouncement:self.announcementPrimaryKey];
    }
}

#pragma mark - Managing the detail item

- (void)setAnnouncement:(Announcement *)announcement {
    if (_announcement != announcement) {
        _announcement = announcement;

        // Update the view.
        [self configureView];
    }
}

#pragma mark - UIWebViewDelegate
- (void)webViewDidFinishLoad:(UIWebView *)webView {
    [[self activityIndicatorView] stopAnimating];
}
- (void)webView:(UIWebView *)webView didFailLoadWithError:(NSError *)error {
    [[self activityIndicatorView] stopAnimating];
}

#pragma mark - AnnouncementFetcherDelegate

- (void)announcementFetchingFailed {
    [[self activityIndicatorView] stopAnimating];
}

- (void)announcementFetched:(Announcement *)announcement {
    [[self activityIndicatorView] stopAnimating];
    self.announcement = announcement;
}


#pragma mark - Lazy

- (AnnouncementFetcher *)fetcher {
    if(!_fetcher) {
        _fetcher = [[AnnouncementFetcher alloc] initWithDelegate:self];
    }
    return _fetcher;
}

@end</code></pre>
</div>
</div>
<div class="paragraph">
<p>It uses a new fetcher:</p>
</div>
<div class="listingblock">
<div class="title">/complete-objectivec-ios-v2/IntranetClient/AnnouncementFetcher.h</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="objectivec">#import &lt;Foundation/Foundation.h&gt;
#import &quot;GrailsFetcher.h&quot;
#import &quot;AnnouncementFetcherDelegate.h&quot;

@interface AnnouncementFetcher : GrailsFetcher

- (id)initWithDelegate:(id&lt;AnnouncementFetcherDelegate&gt;)delegate;

- (void)fetchAnnouncement:(NSNumber *)primaryKey;

@end</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">/complete-objectivec-ios-v2/IntranetClient/AnnouncementFetcher.m</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="objectivec">#import &quot;AnnouncementFetcher.h&quot;
#import &quot;AnnouncementFetcherDelegate.h&quot;
#import &quot;AnnouncementBuilder.h&quot;

@interface AnnouncementFetcher ()

@property ( nonatomic, weak )id&lt;AnnouncementFetcherDelegate&gt; delegate;
@property ( nonatomic, strong )AnnouncementBuilder *builder;

@end

@implementation AnnouncementFetcher

#pragma mark - LifeCycle

- (id)initWithDelegate:(id&lt;AnnouncementFetcherDelegate&gt;)delegate {
    if(self = [super init]) {
        self.delegate = delegate;
        self.builder = [[AnnouncementBuilder alloc] init];
    }
    return self;
}

#pragma mark - Public Methods

- (void)fetchAnnouncement:(NSNumber *)primaryKey {

    [self fetchAnnouncement:primaryKey completionHandler:^(NSData *data, NSURLResponse *response, NSError *error) {
        if(error) {
            if ( self.delegate ) {
                [self.delegate announcementFetchingFailed];
            }
            return;
        }

        NSInteger statusCode = [((NSHTTPURLResponse*)response) statusCode];
        if(statusCode != 200) {
            if ( self.delegate ) {
                [self.delegate announcementFetchingFailed];
            }
            return;
        }

        NSString *objectNotation = [[NSString alloc] initWithData:data encoding:NSUTF8StringEncoding];
        NSError *builderError;
        Announcement *announcement = [self.builder announcementFromJSON:objectNotation error:&amp;builderError];
        if(builderError) {
            if ( self.delegate ) {
                [self.delegate announcementFetchingFailed];
            }
            return;
        }
        if ( self.delegate ) {
            [self.delegate announcementFetched:announcement];
        }
    }];

}

#pragma mark - Private Methods

- (void)fetchAnnouncement:(NSNumber *)primaryKey completionHandler:(void (^)(NSData * data, NSURLResponse * response, NSError * error))completionHandler {
    NSURLSessionDataTask *dataTask = [self.session dataTaskWithRequest:[self announcementURLRequest:primaryKey] completionHandler:completionHandler];
    [dataTask resume];
}

- (NSURLRequest *)announcementURLRequest:(NSNumber *)primaryKey {
    NSString *urlStr = [self announcementURLString:primaryKey];
    return [super getURLRequestWithUrlString:urlStr
                                 cachePolicy:NSURLRequestReloadIgnoringLocalCacheData
                             timeoutInterval:FAST_TIME_INTERVAL];
}

- (NSString *)announcementURLString:(NSNumber *)primaryKey {
    return [NSString stringWithFormat:@&quot;%@/%@/%@&quot;, kServerUrl, kAnnouncementsResourcePath, primaryKey];
}

@end</code></pre>
</div>
</div>
<div class="paragraph">
<p>And a delegate protocol to indicate if the announcement has been fetched</p>
</div>
<div class="listingblock">
<div class="title">/complete-objectivec-ios-v2/IntranetClient/AnnouncementFetcherDelegate.h</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="objectivec">#import &lt;Foundation/Foundation.h&gt;
@class Announcement;

@protocol AnnouncementFetcherDelegate &lt;NSObject&gt;

- (void)announcementFetchingFailed;

- (void)announcementFetched:(Announcement *)announcement;

@end</code></pre>
</div>
</div>


<h1 id="conclusion">7 Conclusion</h1>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails-guides/building-an-ios-objectc-client-powered-by-a-grails-backend/edit/master/src/main/docs/guide/conclusion.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Thanks to Grails ease of API versioning we can now support two iOS applications running different versions.</p>
</div>


<h1 id="helpWithGrails">8 Do you need help with Grails?</h1>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails-guides/building-an-ios-objectc-client-powered-by-a-grails-backend/edit/master/src/main/docs/guide/helpWithGrails.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<h3 style="color: #333; margin-bottom:25px;"><a href="https://objectcomputing.com/" target="_blank">Object Computing, Inc.</a> (OCI) sponsored the creation of this Guide. A variety of consulting and support services are available.</h3>

<!-- BEGIN HubSpot Consultation Form -->

<!--[if lte IE 8]>
<script charset="utf-8" type="text/javascript" src="//js.hsforms.net/forms/v2-legacy.js"></script>
<![endif]-->
<script charset="utf-8" type="text/javascript" src="//js.hsforms.net/forms/v2.js"></script>
<script>
  hbspt.forms.create({
	portalId: "4547412",
	formId: "f8bc9b16-d5f6-4226-a24e-da0eb8b73363"
});
</script>

<!-- END HubSpot Consultation Form -->

<h3 style="color: #333;">OCI is Home to Grails</h3>

<p><a href="https://objectcomputing.com/products/2gm-team" target="_blank">Meet the Team</a></p>

</article></div><footer>
  <div class='content'>
    <div class='ocihometograils'>
      <span>Sponsored by</span>
      <a href='https://objectcomputing.com/products/grails/'><img class='' src='/images/oci_home_to_grails.svg' alt='Object Computing - Home to Grails' width='300px' /></a>
    </div>
    <nav class='socialmedianav'><ul>
  <li>
    <a href='https://slack.grails.org'><img class='' src='/images/slack.svg' alt='Slack Icon' /></a>
  </li>
  <li>
    <a href='https://www.youtube.com/watch?v=XnRNfDGkBVg&amp;list=PLI74De5M9T73uH3WilDCePP2qfSDpMaGu'><img class='' src='/images/youtube.svg' alt='Youtube Icon' /></a>
  </li>
  <li>
    <a href='https://www.linkedin.com/groups/39757'><img class='' src='/images/linkedin.svg' alt='LinkedIn Icon' /></a>
  </li>
  <li>
    <a href='https://github.com/grails/'><img class='' src='/images/github.svg' alt='Github Icon' /></a>
  </li>
  <li>
    <a href='https://twitter.com/grailsframework'><img class='' src='/images/twitter.svg' alt='Twitter Icon' /></a>
  </li>
</ul></nav>
    <nav class='partnersnav'><ul>
  <li>Grails' repositories are hosted by
    <a href='https://repo.grails.org/'>Artifactory</a>
  </li>
  <li>Website hosting provided by
    <a href='https://aws.amazon.com/'>AWS</a>
  </li>
  <li>JetBrains supports Grails with its 
    <a href='https://www.jetbrains.com/idea/'>IntelliJ IDEA IDE</a>
  </li>
  <li>YourKit supports Grails with its 
    <a href='https://www.yourkit.com/java/profiler/index.jsp'>Java Profiler</a>
  </li>
  <li>Grails is Open Source
    <a href='http://www.apache.org/licenses/LICENSE-2.0.html'>Apache 2 License</a>
  </li>
  <li>
    <a href='https://grails.org/buildstatus.html'>Build Status</a>
  </li>
</ul></nav>
  </div>
</footer><div>
  <script type='text/javascript'>
              (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
              (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
              m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
              })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

              ga('create', 'UA-82213539-2', 'auto');
              ga('send', 'pageview');
</script>
  <script type='text/javascript'>
adroll_adv_id = "HBWJH4CQCJGS5DJRSB4Z4D";
adroll_pix_id = "IVEQYFOZXZAPZMDVQH7BFE";
/* OPTIONAL: provide email to improve user identification */
/* adroll_email = "username@example.com"; */
(function () {
    var _onload = function(){
        if (document.readyState && !/loaded|complete/.test(document.readyState)){setTimeout(_onload, 10);return}
        if (!window.__adroll_loaded){__adroll_loaded=true;setTimeout(_onload, 50);return}
        var scr = document.createElement("script");
        var host = (("https:" == document.location.protocol) ? "https://s.adroll.com" : "http://a.adroll.com");
        scr.setAttribute('async', 'true');
        scr.type = "text/javascript";
        scr.src = host + "/j/roundtrip.js";
        ((document.getElementsByTagName('head') || [null])[0] ||
            document.getElementsByTagName('script')[0].parentNode).appendChild(scr);
    };
    if (window.addEventListener) {window.addEventListener('load', _onload, false);}
    else {window.attachEvent('onload', _onload)}
}());            
</script>
</div></body>
</html>
