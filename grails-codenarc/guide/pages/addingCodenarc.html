<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
                      "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
    <title>2.3 Adding CodeNarc to our project</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <link rel="stylesheet" href="../css/main.css" type="text/css" media="screen, print" title="Style" charset="utf-8"/>
    <link rel="stylesheet" href="../css/guide.css" type="text/css" media="screen, print" title="Style" charset="utf-8" />            
    <link rel="stylesheet" href="../css/pdf.css" type="text/css" media="print" title="PDF" charset="utf-8"/>
    <script type="text/javascript">
function addJsClass() {
    var classes = document.body.className.split(" ");
    classes.push("js");
    document.body.className = classes.join(" ");
}
    </script>
</head>

<body class="body" onload="addJsClass();">
<div id="navigation">
    <div class="navTitle">
        
        Grails Framework Guide 
    </div>
    <div class="navLinks">
        <ul>
            <li>
                <div id="nav-summary" onmouseover="toggleNavSummary(false)" onmouseout="toggleNavSummary(true)">
                    <a href="../../guide/index.html" class="button">Table of contents</a>

                    <div id="nav-summary-childs" style="display:none;">
                        
                        <div class="toc-item" style="margin-left:0"><a href="../../guide/gettingStarted.html"><strong>1</strong><span>Getting Started</span></a>
                        </div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="../../guide/writingTheApp.html"><strong>2</strong><span>Writing the Application</span></a>
                        </div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="../../guide/writingCustomRule.html"><strong>3</strong><span>Writing a custom Rule</span></a>
                        </div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="../../guide/helpWithGrails.html"><strong>4</strong><span>Do you need help with Grails?</span></a>
                        </div>
                        
                    </div>
                </div>
            </li>
        </ul>
    </div>


</div>

<table id="colset" border="0" cellpadding="0" cellspacing="0">
    <tr>
        <td id="col1">
            <div id="main" class="corner-all">

                
                    <div class="toc-item prev-left"><a href="../../guide/gettingStarted.html">&lt;&lt; <strong>1</strong><span>Getting Started</span></a></div>
                

                
                    <div class="toc-item next-right"><a href="../../guide/writingCustomRule.html"><strong>3</strong><span>Writing a custom Rule</span> >></a></div>
                


                

                

<h2 id="addingCodenarc">2.3 Adding CodeNarc to our project</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails-guides/grails-codenarc/edit/master/src/main/docs/guide/addingCodenarc.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Adding CodeNarc to our project is a simple task because there&#8217;s a <a href="https://docs.gradle.org/current/userguide/codenarc_plugin.html">Gradle plugin</a>
 to do it.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s modify <code>build.gradle</code> and add the following:</p>
</div>
<div class="listingblock">
<div class="title">/app/build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">apply <span class="key">from</span>: <span class="string"><span class="delimiter">&quot;</span><span class="inline"><span class="inline-delimiter">${</span>rootProject.projectDir<span class="inline-delimiter">}</span></span><span class="content">/gradle/codenarc.gradle</span><span class="delimiter">&quot;</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>We encapsulate all the CodeNarc configuration in <code>gradle/codenarc.gradle</code>:</p>
</div>
<div class="listingblock">
<div class="title">/gradle/codenarc.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">apply <span class="key">plugin</span>: <span class="string"><span class="delimiter">'</span><span class="content">codenarc</span><span class="delimiter">'</span></span> <i class="conum" data-value="1"></i><b>(1)</b>

codenarc {
    toolVersion = <span class="string"><span class="delimiter">'</span><span class="content">0.27.0</span><span class="delimiter">'</span></span> <i class="conum" data-value="2"></i><b>(2)</b>
    configFile = file(<span class="string"><span class="delimiter">&quot;</span><span class="inline"><span class="inline-delimiter">${</span>rootProject.projectDir<span class="inline-delimiter">}</span></span><span class="content">/config/codenarc/rules.groovy</span><span class="delimiter">&quot;</span></span>) <i class="conum" data-value="3"></i><b>(3)</b>
    reportFormat = <span class="string"><span class="delimiter">'</span><span class="content">html</span><span class="delimiter">'</span></span> <i class="conum" data-value="4"></i><b>(4)</b>
    ignoreFailures = <span class="predefined-constant">true</span> <i class="conum" data-value="5"></i><b>(5)</b>
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Apply the <code>codenarc</code> plugin.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Set the CodeNarc version we want to use.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Define the main file with the rules. By default CodeNarc uses <code>config/codenarc/codenarc.xml</code> but we don&#8217;t want to
write XML files, don&#8217;t we?</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>The report format we want. For a human-readable format we use <code>html</code>. If we want to integrate CodeNarc with, for
example, Jenkins we need to change it to <code>xml</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>We don&#8217;t want that the build fails when there&#8217;s only one violation.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Then we need to create the rules file:</p>
</div>
<div class="listingblock">
<div class="title">/config/codenarc/rules.groovy</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">ruleset {
    description <span class="string"><span class="delimiter">'</span><span class="content">Grails-CodeNarc Project RuleSet</span><span class="delimiter">'</span></span>

    ruleset(<span class="string"><span class="delimiter">'</span><span class="content">rulesets/basic.xml</span><span class="delimiter">'</span></span>)
    ruleset(<span class="string"><span class="delimiter">'</span><span class="content">rulesets/braces.xml</span><span class="delimiter">'</span></span>)
    ruleset(<span class="string"><span class="delimiter">'</span><span class="content">rulesets/convention.xml</span><span class="delimiter">'</span></span>)
    ruleset(<span class="string"><span class="delimiter">'</span><span class="content">rulesets/design.xml</span><span class="delimiter">'</span></span>)
    ruleset(<span class="string"><span class="delimiter">'</span><span class="content">rulesets/dry.xml</span><span class="delimiter">'</span></span>)
    ruleset(<span class="string"><span class="delimiter">'</span><span class="content">rulesets/exceptions.xml</span><span class="delimiter">'</span></span>)
    ruleset(<span class="string"><span class="delimiter">'</span><span class="content">rulesets/formatting.xml</span><span class="delimiter">'</span></span>)
    ruleset(<span class="string"><span class="delimiter">'</span><span class="content">rulesets/generic.xml</span><span class="delimiter">'</span></span>)
    ruleset(<span class="string"><span class="delimiter">'</span><span class="content">rulesets/imports.xml</span><span class="delimiter">'</span></span>)
    ruleset(<span class="string"><span class="delimiter">'</span><span class="content">rulesets/naming.xml</span><span class="delimiter">'</span></span>)
    ruleset(<span class="string"><span class="delimiter">'</span><span class="content">rulesets/unnecessary.xml</span><span class="delimiter">'</span></span>)
    ruleset(<span class="string"><span class="delimiter">'</span><span class="content">rulesets/unused.xml</span><span class="delimiter">'</span></span>)
    ruleset(<span class="string"><span class="delimiter">'</span><span class="content">rulesets/grails.xml</span><span class="delimiter">'</span></span>)
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>With this configuration we can just run the <code>check</code> task.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ ./gradlew app:check

:check UP-TO-DATE
:complete:codenarcMain
CodeNarc rule violations were found. See the report at: file:///home/ivan/workspaces/oci/guides/grails-codenarc/complete/app/build/reports/codenarc/main.html
:complete:codenarcTest NO-SOURCE
:complete:compileJava NO-SOURCE
:complete:compileGroovy UP-TO-DATE
:complete:buildProperties UP-TO-DATE
:complete:processResources UP-TO-DATE
:complete:classes UP-TO-DATE
:complete:compileTestJava NO-SOURCE
:complete:compileTestGroovy NO-SOURCE
:complete:processTestResources NO-SOURCE
:complete:testClasses UP-TO-DATE
:complete:test NO-SOURCE
:complete:check

Total time: 1.953 secs</code></pre>
</div>
</div>
<div class="paragraph">
<p>And we can open the test report to check the violations:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../img/report1.png" alt="report1">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>First, we have a section with the execution date and the CodeNarc version used.</p>
</li>
<li>
<p>Then there&#8217;s another section with a Summary with the total of files with violations and also the number of violations with priority 1, 2 and 3.</p>
</li>
<li>
<p>After that, there&#8217;s a section for each file in which we can see all the violations in the file with the line of code and a small fragment of it. The rule name is a link to a more detailed explanation.</p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="_let_s_fix_the_violations">Let&#8217;s fix the violations</h3>
<div class="paragraph">
<p>There are different ways of fixing a CodeNarc violation:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Fixing the problem: As the name implies, just fix the violation.</p>
</li>
<li>
<p>Disabling the rule: Sometimes we don&#8217;t agree with that specific CodeNarc violation. We can disable it.</p>
</li>
<li>
<p>Ignoring the rule for that specific class or method: This case is when we don&#8217;t want to disable the rule but want to
skip it only in a particular class or method.</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="_fix_the_problem">Fix the problem</h4>
<div class="ulist">
<ul>
<li>
<p>To fix the violation <code>FileEndsWithoutNewline</code> add a new line at the end of <code>UrlMappings</code> file.</p>
</li>
<li>
<p>To fix the violation <code>SpaceBeforeOpeningBrace</code> add a space before the braces.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_disable_the_rule">Disable the rule</h4>
<div class="paragraph">
<p>For the case of <code>ClassJavadoc</code> and <code>NoDef</code> we can just disable the rules modifying the <code>rules.groovy</code> file:</p>
</div>
<div class="listingblock">
<div class="title">/app/src/codenarc/rules.groovy</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">ruleset {
    description <span class="string"><span class="delimiter">'</span><span class="content">Grails-CodeNarc Project RuleSet</span><span class="delimiter">'</span></span>

    ...
    ruleset(<span class="string"><span class="delimiter">'</span><span class="content">rulesets/convention.xml</span><span class="delimiter">'</span></span>) {
        <span class="string"><span class="delimiter">'</span><span class="content">NoDef</span><span class="delimiter">'</span></span> {
            enabled = <span class="predefined-constant">false</span>
        }
    }
    ...
    ruleset(<span class="string"><span class="delimiter">'</span><span class="content">rulesets/formatting.xml</span><span class="delimiter">'</span></span>) {
        <span class="string"><span class="delimiter">'</span><span class="content">ClassJavadoc</span><span class="delimiter">'</span></span> {
            enabled = <span class="predefined-constant">false</span>
        }
    }
    ...
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_ignoring_a_rule">Ignoring a rule</h4>
<div class="paragraph">
<p>Finally, we can ignore a rule for a particular class. In this case, we&#8217;re going to ignore the <code>UnnecessaryGString</code> rule
for <code>UrlMappings.groovy</code> using <code>@SuppressWarnings</code>:</p>
</div>
<div class="listingblock">
<div class="title">/app/grails-app/controllers/demo/UrlMappings.groovy</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="annotation">@SuppressWarnings</span>([<span class="string"><span class="delimiter">'</span><span class="content">UnnecessaryGString</span><span class="delimiter">'</span></span>])
<span class="type">class</span> <span class="class">UrlMappings</span> {

    <span class="directive">static</span> mappings = {
        <span class="string"><span class="delimiter">&quot;</span><span class="content">/</span><span class="inline"><span class="inline-delimiter">$</span>controller</span><span class="content">/</span><span class="inline"><span class="inline-delimiter">$</span>action</span><span class="content">?/</span><span class="inline"><span class="inline-delimiter">$</span>id</span><span class="content">?(.</span><span class="inline"><span class="inline-delimiter">$</span>format</span><span class="content">)?</span><span class="delimiter">&quot;</span></span> {
            constraints {
                <span class="comment">// apply constraints here</span>
            }
        }

        <span class="string"><span class="delimiter">&quot;</span><span class="content">/</span><span class="delimiter">&quot;</span></span>(<span class="key">view</span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">/index</span><span class="delimiter">&quot;</span></span>)
        <span class="string"><span class="delimiter">&quot;</span><span class="content">500</span><span class="delimiter">&quot;</span></span>(<span class="key">view</span>:<span class="string"><span class="delimiter">'</span><span class="content">/error</span><span class="delimiter">'</span></span>)
        <span class="string"><span class="delimiter">&quot;</span><span class="content">404</span><span class="delimiter">&quot;</span></span>(<span class="key">view</span>:<span class="string"><span class="delimiter">'</span><span class="content">/notFound</span><span class="delimiter">'</span></span>)
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_checking_the_result">Checking the result</h4>
<div class="paragraph">
<p>Just execute again the <code>check</code> task and open the report to see that all the violations are gone:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../img/report2.png" alt="report2">
</div>
</div>
</div>
</div>


                <div style="clear:both;margin-top:15px;"></div>
                
                    <div class="toc-item prev-left"><a href="../../guide/gettingStarted.html">&lt;&lt; <strong>1</strong><span>Getting Started</span></a></div>
                
                    <div class="toc-item next-right"><a href="../../guide/writingCustomRule.html"><strong>3</strong><span>Writing a custom Rule</span> >></a></div>
                
                <div style="clear:both"></div>
            </div>
        </td>
        <td id="col2">
            <div class="local clearfix">
                <div class="local-title" style="text-align: right"><a href="https://travis-ci.org/grails-guides/grails-codenarc"><img src="https://travis-ci.org/grails-guides/grails-codenarc.svg?branch=master" /></a></div>            
                 <div class="local-title">
                    <a href="https://github.com/grails-guides/grails-codenarc">
                    <svg height="35" class="octicon octicon-mark-github" viewBox="0 0 16 16" version="1.1" width="35" aria-hidden="true"><path fill-rule="evenodd" d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0 0 16 8c0-4.42-3.58-8-8-8z"/></svg></a> &nbsp;&nbsp;Get the Code
                </div>
                <div class="menu">
                    <div class="input-group">                        
                        <button href="#" onclick="document.getElementById('github-url').value='git@github.com:grails-guides/grails-codenarc.git'" class="codeButton">SSH</button>
                        <button onclick="document.getElementById('github-url').value='https://github.com/grails-guides/grails-codenarc.git'" class="codeButton">HTTPS</button>
                        <button onclick="document.getElementById('github-url').value='https://github.com/grails-guides/grails-codenarc'" class="codeButton">Subversion</button>
                    </div>
       
                    <div class="input-group">                    
                        <!-- Target -->
                        <input id="github-url" value="git@github.com:grails-guides/grails-codenarc.git" type="text" />

                        <!-- Trigger -->
                        <button class="clipbtn" type="button" data-clipboard-target="#github-url">

                            <img width="13" src="../img/clippy.svg" alt="Copy to clipboard">
                        </button>       

                    </div>
                    <div class="input-group">
                      <a href="https://github.com/grails-guides/grails-codenarc/archive/master.zip" class="downloadButton">Download ZIP</a>
                    </div>
                </div>
            </div>
        </td>
    </tr>
</table>

<div id="footer">
    Copies of this document may be made for your own use and for distribution to others, provided that you do not charge any fee for such copies and further provided that each copy contains this Copyright Notice, whether distributed in print or electronically. All guides are released with an ASLv2 license for the code, and Creative Commons license for the writing.
    
</div>

<script type="text/javascript" src="../js/docs.js"></script>

</body>
</html>
