<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
                      "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
    <title>2.3 Apply Domain Constraints</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <link rel="stylesheet" href="../css/main.css" type="text/css" media="screen, print" title="Style" charset="utf-8"/>
    <link rel="stylesheet" href="../css/guide.css" type="text/css" media="screen, print" title="Style" charset="utf-8" />            
    <link rel="stylesheet" href="../css/pdf.css" type="text/css" media="print" title="PDF" charset="utf-8"/>
    <script type="text/javascript">
function addJsClass() {
    var classes = document.body.className.split(" ");
    classes.push("js");
    document.body.className = classes.join(" ");
}
    </script>
</head>

<body class="body" onload="addJsClass();">
<div id="navigation">
    <div class="navTitle">
        
        Grails Framework Guide 
    </div>
    <div class="navLinks">
        <ul>
            <li>
                <div id="nav-summary" onmouseover="toggleNavSummary(false)" onmouseout="toggleNavSummary(true)">
                    <a href="../../guide/index.html" class="button">Table of contents</a>

                    <div id="nav-summary-childs" style="display:none;">
                        
                        <div class="toc-item" style="margin-left:0"><a href="../../guide/gettingStarted.html"><strong>1</strong><span>Getting Started</span></a>
                        </div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="../../guide/writingTheApp.html"><strong>2</strong><span>Writing the Application</span></a>
                        </div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="../../guide/runningTheApp.html"><strong>3</strong><span>Running the Application</span></a>
                        </div>
                        
                    </div>
                </div>
            </li>
        </ul>
    </div>


</div>

<table id="colset" border="0" cellpadding="0" cellspacing="0">
    <tr>
        <td id="col1">
            <div id="main" class="corner-all">

                
                    <div class="toc-item prev-left"><a href="../../guide/gettingStarted.html">&lt;&lt; <strong>1</strong><span>Getting Started</span></a></div>
                

                
                    <div class="toc-item next-right"><a href="../../guide/runningTheApp.html"><strong>3</strong><span>Running the Application</span> >></a></div>
                


                

                

<h2 id="applyConstraints">2.3 Apply Domain Constraints</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails-guides/rest-hibernate/edit/master/src/main/docs/guide/applyConstraints.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>If you wish to define <a href="http://gorm.grails.org/latest/hibernate/manual/index.html#constraints">validation constraints</a> on properties defined in a GORM domain class, you can do so using the <code>constraints</code> property:</p>
</div>
<div class="listingblock">
<div class="title">grails-app/domain/hibernate/example/Product.groovy</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="directive">static</span> constraints = {
    name <span class="key">blank</span>:<span class="predefined-constant">false</span>
    price <span class="key">range</span>:<span class="float">0.0</span>..<span class="float">1000.00</span>
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The above example applies two constraints:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The <code>name</code> property is constrained so that it cannot be a blank string.</p>
</li>
<li>
<p>The <code>price</code> property is constrained so that it must be greater than 0 and less than a thousand using the <code>range</code> constraint.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>To verify these constraints work to our expectation you can write a test. If you used the <code>create-domain-class</code> a test called <code>src/test/groovy/hibernate/example/ProductSpec.groovy</code> was generated for you already. Otherwise simply creating an appropriately named test in <code>src/test/groovy</code> using your IDE or text editor will suffice.</p>
</div>
<div class="paragraph">
<p>To effectively test interactions with Hibernate in a unit test it is recommended you use <code>grails.test.hibernate.HibernateSpec</code> which you can use combined with the H2 in-memory database.</p>
</div>
<div class="paragraph">
<p>To achieve this first modify the imports of the <code>ProductSpec</code> class as follows:</p>
</div>
<div class="listingblock">
<div class="title">src/test/groovy/hibernate/example/ProductSpec.groovy</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">import</span> <span class="include">grails.test.mixin.TestFor</span>
<span class="keyword">import</span> <span class="include">grails.test.hibernate.*</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Then ensure the <code>ProductSpec</code> extends the <code>HibernateSpec</code> base class:</p>
</div>
<div class="listingblock">
<div class="title">src/test/groovy/hibernate/example/ProductSpec.groovy</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="annotation">@TestFor</span>(Product)
<span class="type">class</span> <span class="class">ProductSpec</span> <span class="directive">extends</span> HibernateSpec {</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>HibernateSpec</code> super class will wrap each test method in a transaction that is rolled back at the end of the test ensuring cleanup between tests.</p>
</div>
<div class="paragraph">
<p>With the test prepared you are ready to write a test. Tests in Grails are written with <a href="http://spockframework.org">Spock Framework</a>, which allows you to define much more readable tests including having spaces in the name:</p>
</div>
<div class="listingblock">
<div class="title">src/test/groovy/hibernate/example/ProductSpec.groovy</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">void</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">test domain class validation</span><span class="delimiter">&quot;</span></span>() {
    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>First lets write a test for the invalid case. You can do so using Spock <code>when</code> and <code>then</code> blocks to make the test more readable:</p>
</div>
<div class="listingblock">
<div class="title">src/test/groovy/hibernate/example/ProductSpec.groovy</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="key">when</span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">A domain class is saved with invalid data</span><span class="delimiter">&quot;</span></span>
Product product = <span class="keyword">new</span> Product(<span class="key">name</span>: <span class="string"><span class="delimiter">&quot;</span><span class="delimiter">&quot;</span></span>, <span class="key">price</span>: -<span class="float">2.0d</span>)
product.save()

<span class="key">then</span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">There were errors and the data was not saved</span><span class="delimiter">&quot;</span></span>
product.hasErrors()
product.errors.getFieldError(<span class="string"><span class="delimiter">'</span><span class="content">price</span><span class="delimiter">'</span></span>)
product.errors.getFieldError(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>)
Product.count() == <span class="integer">0</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The above example sets the <code>name</code> to a blank value and the <code>price</code> to a negative value and attempts to save the instance using the <a href="{mongodbGormApi}/org/grails/datastore/gorm/GormEntity.html#save()">save()</a> method.</p>
</div>
<div class="paragraph">
<p>The <code>then</code> block asserts that the object is invalid and was not saved.</p>
</div>
<div class="paragraph">
<p>To write a test for the valid case populate some valid data and try and assert that the object was saved:</p>
</div>
<div class="listingblock">
<div class="title">src/test/groovy/hibernate/example/ProductSpec.groovy</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="key">when</span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">A valid domain is saved</span><span class="delimiter">&quot;</span></span>
product.name = <span class="string"><span class="delimiter">'</span><span class="content">Banana</span><span class="delimiter">'</span></span>
product.price = <span class="float">2.15d</span>
product.save()

<span class="key">then</span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">The product was saved successfully</span><span class="delimiter">&quot;</span></span>
Product.count() == <span class="integer">1</span>
Product.first().price == <span class="float">2.15d</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>All done! Now to run the test you can run <code>./gradlew check</code> from a terminal window or run the test within your IDE if the IDE supports it:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ ./gradlew check</code></pre>
</div>
</div>


                <div style="clear:both;margin-top:15px;"></div>
                
                    <div class="toc-item prev-left"><a href="../../guide/gettingStarted.html">&lt;&lt; <strong>1</strong><span>Getting Started</span></a></div>
                
                    <div class="toc-item next-right"><a href="../../guide/runningTheApp.html"><strong>3</strong><span>Running the Application</span> >></a></div>
                
                <div style="clear:both"></div>
            </div>
        </td>
        <td id="col2">
            <div class="local clearfix">
                <div class="local-title" style="text-align: right"><a href="https://travis-ci.org/grails-guides/rest-hibernate"><img src="https://travis-ci.org/grails-guides/rest-hibernate.svg?branch=master" /></a></div>            
                 <div class="local-title">
                    <a href="https://github.com/grails-guides/rest-hibernate">
                    <svg height="35" class="octicon octicon-mark-github" viewBox="0 0 16 16" version="1.1" width="35" aria-hidden="true"><path fill-rule="evenodd" d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0 0 16 8c0-4.42-3.58-8-8-8z"/></svg></a> &nbsp;&nbsp;Get the Code
                </div>
                <div class="menu">
                    <div class="input-group">                        
                        <button href="#" onclick="document.getElementById('github-url').value='git@github.com:grails-guides/rest-hibernate.git'" class="codeButton">SSH</button>
                        <button onclick="document.getElementById('github-url').value='https://github.com/grails-guides/rest-hibernate.git'" class="codeButton">HTTPS</button>
                        <button onclick="document.getElementById('github-url').value='https://github.com/grails-guides/rest-hibernate'" class="codeButton">Subversion</button>
                    </div>
       
                    <div class="input-group">                    
                        <!-- Target -->
                        <input id="github-url" value="git@github.com:grails-guides/rest-hibernate.git" type="text" />

                        <!-- Trigger -->
                        <button class="clipbtn" type="button" data-clipboard-target="#github-url">

                            <img width="13" src="../img/clippy.svg" alt="Copy to clipboard">
                        </button>       

                    </div>
                    <div class="input-group">
                      <a href="https://github.com/grails-guides/rest-hibernate/archive/master.zip" class="downloadButton">Download ZIP</a>
                    </div>
                </div>
            </div>
        </td>
    </tr>
</table>

<div id="footer">
    Copies of this document may be made for your own use and for distribution to others, provided that you do not charge any fee for such copies and further provided that each copy contains this Copyright Notice, whether distributed in print or electronically. All guides are released with an ASLv2 license for the code, and Creative Commons license for the writing. 
    
</div>

<script type="text/javascript" src="../js/docs.js"></script>

</body>
</html>
