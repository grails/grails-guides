<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
                      "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
    <title>3 Writing the Application</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <link rel="stylesheet" href="../css/main.css" type="text/css" media="screen, print" title="Style" charset="utf-8"/>
    <link rel="stylesheet" href="../css/guide.css" type="text/css" media="screen, print" title="Style" charset="utf-8" />            
    <link rel="stylesheet" href="../css/pdf.css" type="text/css" media="print" title="PDF" charset="utf-8"/>
    <script type="text/javascript">
function addJsClass() {
    var classes = document.body.className.split(" ");
    classes.push("js");
    document.body.className = classes.join(" ");
}
    </script>
</head>

<body class="body" onload="addJsClass();">
<div id="navigation">
    <div class="navTitle">
        
        Grails Framework Guide 
    </div>
    <div class="navLinks">
        <ul>
            <li>
                <div id="nav-summary" onmouseover="toggleNavSummary(false)" onmouseout="toggleNavSummary(true)">
                    <a href="../guide/index.html" class="button">Table of contents</a>

                    <div id="nav-summary-childs" style="display:none;">
                        
                        <div class="toc-item" style="margin-left:0"><a href="../guide/training.html"><strong>1</strong><span>Grails Training</span></a>
                        </div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="../guide/gettingStarted.html"><strong>2</strong><span>Getting Started</span></a>
                        </div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="../guide/writingTheApp.html"><strong>3</strong><span>Writing the Application</span></a>
                        </div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="../guide/mockLogging.html"><strong>4</strong><span>Mock Logging with Slf4j Test</span></a>
                        </div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="../guide/runningTheApp.html"><strong>5</strong><span>Running the Application</span></a>
                        </div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="../guide/helpWithGrails.html"><strong>6</strong><span>Help with Grails</span></a>
                        </div>
                        
                    </div>
                </div>
            </li>
        </ul>
    </div>


</div>

<table id="colset" border="0" cellpadding="0" cellspacing="0">
    <tr>
        <td id="col1">
            <div id="main" class="corner-all">

                
                    <div class="toc-item prev-left"><a href="../guide/gettingStarted.html">&lt;&lt; <strong>2</strong><span>Getting Started</span></a></div>
                

                
                    <div class="toc-item next-right"><a href="../guide/mockLogging.html"><strong>4</strong><span>Mock Logging with Slf4j Test</span> >></a></div>
                


                
                <div id="table-of-content">
                    <h2>Table of Contents</h2>
                    
                    <div class="toc-item" style="margin-left:0px"><a href="#personDomainAndDataService"><strong>3.1</strong><span>Person Domain and Data Service</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0px"><a href="#createPerson"><strong>3.2</strong><span>Create a Person</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0px"><a href="#offerAdvice"><strong>3.3</strong><span>Offer Advice to a Person</span></a>
                    </div>
                    
                </div>
                

                

<h1 id="writingTheApp">3 Writing the Application</h1>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails-guides/grails-mock-logging-slf4j-test/edit/master/src/main/docs/guide/writingTheApp.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>We are going to write a simple application with logging.  For a simple concept, we will create a <code>Person</code> domain object with a
<code>name</code> and <code>age</code>. The application will log "friendly" advice for the person based on age.  Through this contrived example, we will
develop tests that verify the correct logging events occur.</p>
</div>
<div class="paragraph">
<p>First, let&#8217;s configure the application to only log items pertinent to the exercise.  In <code>logback.groovy</code>, delete the line at the bottom
of the file: <code>root(ERROR, ['STDOUT'])</code>. Then add the below snippet. This will activate loggers in the package <code>example.grails</code>.</p>
</div>
<div class="listingblock">
<div class="title">grails-app/conf/logback.groovy</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">logger(<span class="string"><span class="delimiter">&quot;</span><span class="content">example.grails</span><span class="delimiter">&quot;</span></span>, DEBUG, [<span class="string"><span class="delimiter">'</span><span class="content">STDOUT</span><span class="delimiter">'</span></span>])</code></pre>
</div>
</div>


<h2 id="personDomainAndDataService">3.1 Person Domain and Data Service</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails-guides/grails-mock-logging-slf4j-test/edit/master/src/main/docs/guide/personDomainAndDataService.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>We will create a Domain class <code>Person</code> with properties <code>name</code> and <code>age</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">&gt; grails create-domain-class Person</code></pre>
</div>
</div>
<div class="paragraph">
<p>Edit the class to end up like this:</p>
</div>
<div class="listingblock">
<div class="title">grails-app/domain/example/grails/Person.groovy</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">package</span> example.grails

<span class="keyword">import</span> <span class="include">groovy.transform.CompileStatic</span>

<span class="annotation">@CompileStatic</span>
<span class="type">class</span> <span class="class">Person</span> {
    <span class="predefined-type">String</span> name
    <span class="predefined-type">Integer</span> age

    <span class="predefined-type">String</span> toString() {
        <span class="string"><span class="delimiter">&quot;</span><span class="content">name: </span><span class="inline"><span class="inline-delimiter">$</span>name</span><span class="content">, age: </span><span class="inline"><span class="inline-delimiter">$</span>age</span><span class="delimiter">&quot;</span></span>
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In order to create and find a student, we will use <a href="http://gorm.grails.org/6.1.x/hibernate/manual/#dataServices">GORM Data Services</a>, which
automatically implements an interface to provide data access logic. This can be injected into another Grails artefact such as a Controller.</p>
</div>
<div class="listingblock">
<div class="title">grails-app/services/example/grails/PersonDataService.groovy</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">package</span> example.grails

<span class="keyword">import</span> <span class="include">grails.gorm.services.Service</span>

<span class="annotation">@Service</span>(Person)
<span class="type">interface</span> PersonDataService {
    Person findPerson(<span class="predefined-type">String</span> name)
    Person savePerson(<span class="predefined-type">String</span> name, <span class="predefined-type">Integer</span> age)
}</code></pre>
</div>
</div>


<h2 id="createPerson">3.2 Create a Person</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails-guides/grails-mock-logging-slf4j-test/edit/master/src/main/docs/guide/createPerson.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Let&#8217;s implement functionality to create a <code>Person</code>. We can inject the <code>PersonDataService</code> into a <code>PersonController</code> to save a person.
Upon a successful save, log a message. On an unsuccessful save, catch the exception and log an error message.  We have added
<code>static scaffold = Person</code> to the controller for the convenience sake of a quick UI.</p>
</div>
<div class="listingblock">
<div class="title">grails-app/controllers/example/grails/PersonController.groovy</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">package</span> example.grails

<span class="keyword">import</span> <span class="include">grails.validation.ValidationException</span>
<span class="keyword">import</span> <span class="include">groovy.transform.CompileStatic</span>

<span class="annotation">@CompileStatic</span>
<span class="type">class</span> <span class="class">PersonController</span> {

    <span class="directive">static</span> scaffold = Person

    PersonDataService personDataService

    <span class="keyword">def</span> <span class="function">createPerson</span>(<span class="predefined-type">String</span> name, <span class="predefined-type">Integer</span> age) {
        <span class="keyword">try</span> {
            Person person = personDataService.savePerson(name, age)
            log.info <span class="string"><span class="delimiter">&quot;</span><span class="content">person saved successfully: </span><span class="inline"><span class="inline-delimiter">${</span>person<span class="inline-delimiter">}</span></span><span class="delimiter">&quot;</span></span>
            respond person, <span class="key">view</span>: <span class="string"><span class="delimiter">'</span><span class="content">show</span><span class="delimiter">'</span></span>
        } <span class="keyword">catch</span> (ValidationException e) {
            log.error <span class="string"><span class="delimiter">&quot;</span><span class="content">Error occurred on save!</span><span class="delimiter">&quot;</span></span>
            redirect <span class="key">action</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">index</span><span class="delimiter">&quot;</span></span>
        }
    }
}</code></pre>
</div>
</div>


<h2 id="offerAdvice">3.3 Offer Advice to a Person</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails-guides/grails-mock-logging-slf4j-test/edit/master/src/main/docs/guide/offerAdvice.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Implement another method in the <code>PersonController</code> which will offer advice based on the name passed in. This method will first
find a person by name, then use a POGO (Plain Old Groovy Object) called <code>AgeAdvisor</code>  for logging "friendly" advice.</p>
</div>
<div class="listingblock">
<div class="title">grails-app/controllers/example/grails/PersonController.groovy</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">    <span class="keyword">def</span> <span class="function">offerAdvice</span>(<span class="predefined-type">String</span> name) {
        AgeAdvisor ageAdvisor = <span class="keyword">new</span> AgeAdvisor()

        Person person = personDataService.findPerson(name)
        <span class="keyword">if</span> (person) {
            ageAdvisor.offerAgeAdvice(person.age)
        } <span class="keyword">else</span> {
            log.error <span class="string"><span class="delimiter">&quot;</span><span class="content">No person by name </span><span class="inline"><span class="inline-delimiter">${</span>name<span class="inline-delimiter">}</span></span><span class="content"> found.</span><span class="delimiter">&quot;</span></span>
        }
        redirect <span class="key">action</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">index</span><span class="delimiter">&quot;</span></span>
    }</code></pre>
</div>
</div>
<div class="paragraph">
<p>The POGO is simple and uses <code>@Slf4j</code> groovy annotation to establish the logger.</p>
</div>
<div class="listingblock">
<div class="title">src/main/groovy/example/grails/AgeAdvisor.groovy</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">package</span> example.grails

<span class="keyword">import</span> <span class="include">groovy.transform.CompileStatic</span>
<span class="keyword">import</span> <span class="include">groovy.util.logging.Slf4j</span>

<span class="annotation">@Slf4j</span> <i class="conum" data-value="1"></i><b>(1)</b>
<span class="annotation">@CompileStatic</span>
<span class="type">class</span> <span class="class">AgeAdvisor</span> {

    <span class="type">void</span> offerAgeAdvice(<span class="predefined-type">Integer</span> age) {
        <span class="keyword">if</span> (age <span class="keyword">in</span> <span class="integer">0</span>..&lt;<span class="integer">30</span> ) {
            log.info (<span class="string"><span class="delimiter">&quot;</span><span class="content">You are a young and vibrant!</span><span class="delimiter">&quot;</span></span>)
            log.info (<span class="string"><span class="delimiter">&quot;</span><span class="content">Live life to the fullest.</span><span class="delimiter">&quot;</span></span>)
        } <span class="keyword">else</span> <span class="keyword">if</span> (<span class="integer">30</span> &lt;= age) {
            log.warn (<span class="string"><span class="delimiter">&quot;</span><span class="content">It's all downhill from here, sorry.</span><span class="delimiter">&quot;</span></span>)
        }
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Note the <code>@Slf4j</code> annotation - This is needed for POGOs, as only Grails artefacts have loggers injected by the Grails Framework.</td>
</tr>
</table>
</div>


                <div style="clear:both;margin-top:15px;"></div>
                
                    <div class="toc-item prev-left"><a href="../guide/gettingStarted.html">&lt;&lt; <strong>2</strong><span>Getting Started</span></a></div>
                
                    <div class="toc-item next-right"><a href="../guide/mockLogging.html"><strong>4</strong><span>Mock Logging with Slf4j Test</span> >></a></div>
                
                <div style="clear:both"></div>
            </div>
        </td>
        <td id="col2">
            <div class="local clearfix">
                <div class="local-title" style="text-align: right"><a href="https://travis-ci.org/grails-guides/grails-mock-logging-slf4j-test"><img src="https://travis-ci.org/grails-guides/grails-mock-logging-slf4j-test.svg?branch=master" /></a></div>            
                 <div class="local-title">
                    <a href="https://github.com/grails-guides/grails-mock-logging-slf4j-test">
                    <svg height="35" class="octicon octicon-mark-github" viewBox="0 0 16 16" version="1.1" width="35" aria-hidden="true"><path fill-rule="evenodd" d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0 0 16 8c0-4.42-3.58-8-8-8z"/></svg></a> &nbsp;&nbsp;Get the Code
                </div>
                <div class="menu">
                    <div class="input-group">                        
                        <button href="#" onclick="document.getElementById('github-url').value='git@github.com:grails-guides/grails-mock-logging-slf4j-test.git'" class="codeButton">SSH</button>
                        <button onclick="document.getElementById('github-url').value='https://github.com/grails-guides/grails-mock-logging-slf4j-test.git'" class="codeButton">HTTPS</button>
                        <button onclick="document.getElementById('github-url').value='https://github.com/grails-guides/grails-mock-logging-slf4j-test'" class="codeButton">Subversion</button>
                    </div>
       
                    <div class="input-group">                    
                        <!-- Target -->
                        <input id="github-url" value="git@github.com:grails-guides/grails-mock-logging-slf4j-test.git" type="text" />

                        <!-- Trigger -->
                        <button class="clipbtn" type="button" data-clipboard-target="#github-url">

                            <img width="13" src="../img/clippy.svg" alt="Copy to clipboard">
                        </button>       

                    </div>
                    <div class="input-group">
                      <a href="https://github.com/grails-guides/grails-mock-logging-slf4j-test/archive/master.zip" class="downloadButton">Download ZIP</a>
                    </div>
                </div>
            </div>
        </td>
    </tr>
</table>

<div id="footer">
    Copies of this document may be made for your own use and for distribution to others, provided that you do not charge any fee for such copies and further provided that each copy contains this Copyright Notice, whether distributed in print or electronically. All guides are released with an ASLv2 license for the code, and Creative Commons license for the writing. 
    
</div>

<script type="text/javascript" src="../js/docs.js"></script>

</body>
</html>
