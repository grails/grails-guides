<!DOCTYPE html>
<html>
  <head>
    <meta name='google-site-verification' content='REYQ1_I6HGowAE7LOLVqfQbnKaB4IfFpMlGzMbJj55Q' />
    <meta name='viewport' content='width=device-width, initial-scale=1' />
    <link rel='icon' href='/images/favicon.ico' />
    <link rel='mask-icon' href='//images/grails-pinned-icon.svg' color='feb672' />
    <meta charset='UTF-8' />
    <title>Use docker to provide external services to your Grails app | Grails Guides | Grails Framework</title>
    <meta name='description' content='Use docker to provide external services to your Grails app. Learn how to use a Postgresql database in your Grails application with a Docker container' />
    <link rel='stylesheet' href='../css/main.css' />
    <link rel='stylesheet' href='../css/screen.css' />
    <script src='https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/1.7.1/clipboard.min.js'></script>
  </head>
  <body class='guide'><header class='mainheader'>
  <div class='content'>
    <a href='https://grails.org/index.html'><img class='grailslogo' src='/images/grails_logo.svg' alt='Grails Logo' /></a>
    <a href='javascript:show(&apos;topmenus&apos;, &apos;showNavigationLink&apos;)' id='showNavigationLink' class='mobile align-center'>Show Navigation</a>
    <div id='topmenus'>
      <nav class='secondarymenu' id='secondarymenu'><ul>
  <li>
    <a href='https://grails.org/learning.html'>Learning</a>
  </li>
  <li>
    <a href='https://grails.org/community.html'>Community</a>
  </li>
  <li>
    <a href='https://grails.org/search.html'>Search</a>
  </li>
</ul></nav>
      <nav class='mainmenu' id='mainmenu'><ul>
  <li>
    <a href='https://grails.org/documentation.html'>Documentation</a>
  </li>
  <li>
    <a href='https://grails.org/download.html'>Download</a>
  </li>
  <li>
    <a href='https://plugins.grails.org'>Plugins</a>
  </li>
  <li>
    <a href='https://guides.grails.org/index.html'>Guides</a>
  </li>
  <li>
    <a href='https://grails.org/faq.html'>FAQ</a>
  </li>
  <li>
    <a href='https://grails.org/support.html'>Support</a>
  </li>
</ul></nav>
    </div>
  </div>
</header><div class='fullwidth'><article class="guide">
    <aside>
        <a href="https://travis-ci.org/grails-guides/grails-docker-external-services"><img src="https://travis-ci.org/grails-guides/grails-docker-external-services.svg?branch=master"></a>

        <button type="button" class="btn btn-large" onclick="window.location.href=&quot;https://github.com/grails-guides/grails-docker-external-services&quot;"><img height="15" src="../img/github_white.svg" alt="Github"/><span>&nbsp;Get the Code</span></button>


        <ul class="githublinks">
            <li><button type="button" class="btn btn-default" href="#" onclick="document.getElementById('github-url').value='git@github.com:grails-guides/grails-docker-external-services.git'" class="codeButton">SSH</button></li>
            <li><button type="button" class="btn btn-default" onclick="document.getElementById('github-url').value='https://github.com/grails-guides/grails-docker-external-services.git'" class="codeButton">HTTPS</button></li>
        </ul>
        <div class="input-group">
            <!-- Target -->
            <input id="github-url" value="git@github.com:grails-guides/grails-docker-external-services.git" type="text" />
            <!-- Trigger -->
            <button type="button" class="clippy btn btn-default" type="button" data-clipboard-target="#github-url">
                <img width="13" src="../img/clippy.svg" alt="Copy to clipboard">
            </button>
        </div>
        <script>var clipboard = new Clipboard('.clippy');</script>
        <button type="button" class="btn btn-large" onclick="window.location.href=&quot;https://github.com/grails-guides/grails-docker-external-services/archive/master.zip&quot;">Download ZIP</button>
        
        <div id="table-of-content">
            <h3>Table of Contents</h3>
            
            <div class="toc-item" style="margin-left:0px"><a href="#training"><strong>1</strong><span>Training</span></a></div>
            
            <div class="toc-item" style="margin-left:0px"><a href="#gettingStarted"><strong>2</strong><span>Getting Started</span></a></div>
            
            <div class="toc-item" style="margin-left:10px"><a href="#howto"><strong>2.1</strong><span>How to complete the guide</span></a></div>
            
            <div class="toc-item" style="margin-left:0px"><a href="#writing"><strong>3</strong><span>Writing the Guide</span></a></div>
            
            <div class="toc-item" style="margin-left:10px"><a href="#docker"><strong>3.1</strong><span>Install and configure Docker</span></a></div>
            
            <div class="toc-item" style="margin-left:10px"><a href="#domainClass"><strong>3.2</strong><span>Domain Class</span></a></div>
            
            <div class="toc-item" style="margin-left:10px"><a href="#gradle"><strong>3.3</strong><span>Gradle Docker plugin</span></a></div>
            
            <div class="toc-item" style="margin-left:10px"><a href="#gradleDockerTasks"><strong>3.4</strong><span>Gradle Docker Tasks</span></a></div>
            
            <div class="toc-item" style="margin-left:10px"><a href="#postgresql"><strong>3.5</strong><span>Configure PostgreSQL</span></a></div>
            
            <div class="toc-item" style="margin-left:0px"><a href="#running"><strong>4</strong><span>Running the app</span></a></div>
            
            <div class="toc-item" style="margin-left:0px"><a href="#usingOnlyDocker"><strong>5</strong><span>Using only Docker</span></a></div>
            
            <div class="toc-item" style="margin-left:0px"><a href="#helpWithGrails"><strong>6</strong><span>Help with Grails</span></a></div>
            
            <div style="clear:both" ></div>
        </div>
        
    </aside>
    <header>
        <h1>Use docker to provide external services to your Grails app</h1>
        <p>Learn how to use a Postgresql database in your Grails application with a Docker container</p>
        <p><strong>Authors:</strong> Iv&aacute;n L&oacute;pez,Sergio del Amo</p>
        <p><strong>Grails Version:</strong> 3.3.2</p>
    </header>
    

<h1 id="training">1 Training</h1>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails-guides/grails-docker-external-services/edit/master/src/main/docs/guide/training.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p><strong>Grails Training</strong> - Developed and delivered by the folks who created and actively maintain the Grails framework!.</p>
</div>
<div id="ocitraining"></div>
<script type="text/javascript">
var getJSON = function(url, callback) {
    var xhr = new XMLHttpRequest();
    xhr.open('GET', url, true);
    xhr.responseType = 'json';
    xhr.onload = function() {
      var status = xhr.status;
      if (status == 200) {
        callback(null, xhr.response);
      } else {
        callback(status);
      }
    };
    xhr.send();
};
getJSON('https://training.grails.org/training', function(err, data) {
  var msg = '';
  if (err != null) {
      msg = 'Something went wrong while retrieving OCI training offerings';

  } else {
      if ( data.length == 0 ) {
         msg = '<p><b>Nothing scheduled at the moment - please check back again soon!</b></p>.';

      } else {
        msg += '<table>';
        msg += '<thead>';
        msg += '<tr><th>Course</th><th>Date(s)</th><th>Instructor(s)</th><th>Hour(s)</th></tr>';
        msg += '</thead>';
        msg += '<tbody>';

        var hrefs = new Array();
        for (var i = 0; i < data.length; i++) {
            var href = data[i].enrollmentLink;
            if (hrefs.indexOf(href) == -1) {
                msg += '<tr><td><a href="'+ href + '">'+ data[i].course + '</a></td><td>'+ data[i].dates + '</td><td>'+ data[i].instructors + '</td><td>'+ data[i].hours + '</td></tr>';
                hrefs.push(href);
            }

        }
        msg += '</tbody>';
        msg += '</table>';
      }
  }
  var ociTraining = document.getElementById("ocitraining");
  ociTraining.innerHTML = msg;
});
</script>


<h1 id="gettingStarted">2 Getting Started</h1>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails-guides/grails-docker-external-services/edit/master/src/main/docs/guide/gettingStarted.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>If you do any real Grails Development, you will need to connect to external services; Databases, services such as ElasticSearch, Redis etc.</p>
</div>
<div class="paragraph">
<p>Usually, you needed to install those services on your development machine to replicate production environments. You could
be in scenarios such as developing on MacOS a Grails application which connects to MSSQL database. Installing such external services could be difficult
or impossible in your development environment.</p>
</div>
<div class="paragraph">
<p>Among many other things, Docker can help us simplify such a scenario. In this Guide, you will write a Grails application which connects to a PostgreSQL database
running on a docker container. You will not install Postgres on your machine. Instead, you will pull a PostgreSQL image, create a container with that image and
start the container. You will modify your Grails application to connect to the PostgreSQL database which runs in the container.</p>
</div>


<h2 id="howto">2.1 How to complete the guide</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails-guides/grails-docker-external-services/edit/master/src/main/docs/guide/howto.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>To get started do the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://github.com/grails-guides/grails-docker-external-services/archive/master.zip">Download</a> and unzip the source</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>or</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Clone the <a href="https://git-scm.com/">Git</a> repository:<br>
<code>git clone <a href="https://github.com/grails-guides/grails-docker-external-services.git" class="bare">https://github.com/grails-guides/grails-docker-external-services.git</a></code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The Grails guides repositories contain two folders:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>initial</code>  Initial project. Often a simple Grails app with some additional code to give you a head-start.</p>
</li>
<li>
<p><code>complete</code> A completed example. It is the result of working through the steps presented by the guide and applying those changes to the <code>initial</code> folder.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>To complete the guide, go to the <code>initial</code> folder</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>cd</code> into <code>grails-guides/grails-docker-external-services/initial</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>and follow the instructions in the next sections.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
You can go right to the <strong>completed example</strong> if you <code>cd</code> into <code>grails-guides/grails-docker-external-services/complete</code>
</td>
</tr>
</table>
</div>


<h1 id="writing">3 Writing the Guide</h1>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails-guides/grails-docker-external-services/edit/master/src/main/docs/guide/writing.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>





<h2 id="docker">3.1 Install and configure Docker</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails-guides/grails-docker-external-services/edit/master/src/main/docs/guide/docker.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>If you do not already have Docker installed, you’ll need to <a href="https://docs.docker.com/engine/installation/">install it</a>.</p>
</div>
<div class="paragraph">
<p>Depending on your environment you may need to increase Docker’s available memory to 4GB or more.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../img/docker.png" alt="Docker Preferences">
</div>
</div>
<div class="sect1">
<h2 id="_tip_get_kitematic">Tip: Get Kitematic</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Kitematic is an excellent desktop application for managing Docker containers.
The first time you click Open Kitematic, it will prompt you to download and install it.
You can then use Kitematic to view the output of your containers, manage their settings, etc.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../img/kitematic.png" alt="Kitematic">
</div>
</div>
</div>
</div>


<h2 id="domainClass">3.2 Domain Class</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails-guides/grails-docker-external-services/edit/master/src/main/docs/guide/domainClass.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Create a Domain Class. It will help you verify that the database schema is created in the PostgreSQL database running
inside the docker container.</p>
</div>
<div class="listingblock">
<div class="title">grails-app/domain/demo/Book.groovy</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">package</span> demo

<span class="keyword">import</span> <span class="include">groovy.transform.CompileStatic</span>

<span class="annotation">@CompileStatic</span>
<span class="type">class</span> <span class="class">Book</span> {
    <span class="predefined-type">String</span> title
}</code></pre>
</div>
</div>


<h2 id="gradle">3.3 Gradle Docker plugin</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails-guides/grails-docker-external-services/edit/master/src/main/docs/guide/gradle.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>In this guide, we use the <a href="https://github.com/bmuschko/gradle-docker-plugin">Gradle Docker Plugin</a>; a
Gradle plugin for managing Docker images and containers.</p>
</div>
<div class="paragraph">
<p>To install the Gradle plugin, modify <code>build.gradle</code>:</p>
</div>
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">buildscript {
    repositories {
        mavenLocal()
        maven { url <span class="string"><span class="delimiter">&quot;</span><span class="content">https://repo.grails.org/grails/core</span><span class="delimiter">&quot;</span></span> }
    }
    dependencies {
        classpath <span class="string"><span class="delimiter">&quot;</span><span class="content">org.grails:grails-gradle-plugin:</span><span class="inline"><span class="inline-delimiter">$</span>grailsVersion</span><span class="delimiter">&quot;</span></span>
        classpath <span class="string"><span class="delimiter">&quot;</span><span class="content">gradle.plugin.com.energizedwork.webdriver-binaries:webdriver-binaries-gradle-plugin:1.1</span><span class="delimiter">&quot;</span></span>
        classpath <span class="string"><span class="delimiter">&quot;</span><span class="content">gradle.plugin.com.energizedwork:idea-gradle-plugins:1.4</span><span class="delimiter">&quot;</span></span>
        classpath <span class="string"><span class="delimiter">&quot;</span><span class="content">org.grails.plugins:hibernate5:</span><span class="inline"><span class="inline-delimiter">${</span>gormVersion-<span class="string"><span class="delimiter">&quot;</span><span class="content">.RELEASE</span><span class="delimiter">&quot;</span></span><span class="inline-delimiter">}</span></span><span class="delimiter">&quot;</span></span>
        classpath <span class="string"><span class="delimiter">&quot;</span><span class="content">com.bertramlabs.plugins:asset-pipeline-gradle:2.14.6</span><span class="delimiter">&quot;</span></span>
        classpath <span class="string"><span class="delimiter">&quot;</span><span class="content">com.bmuschko:gradle-docker-plugin:3.2.1</span><span class="delimiter">&quot;</span></span> <i class="conum" data-value="1"></i><b>(1)</b>
    }
}
apply <span class="key">plugin</span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">eclipse</span><span class="delimiter">&quot;</span></span>
apply <span class="key">plugin</span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">idea</span><span class="delimiter">&quot;</span></span>
apply <span class="key">plugin</span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">war</span><span class="delimiter">&quot;</span></span>
apply <span class="key">plugin</span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">org.grails.grails-web</span><span class="delimiter">&quot;</span></span>
apply <span class="key">plugin</span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">com.energizedwork.webdriver-binaries</span><span class="delimiter">&quot;</span></span>
apply <span class="key">plugin</span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">com.energizedwork.idea-project-components</span><span class="delimiter">&quot;</span></span>
apply <span class="key">plugin</span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">asset-pipeline</span><span class="delimiter">&quot;</span></span>
apply <span class="key">plugin</span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">org.grails.grails-gsp</span><span class="delimiter">&quot;</span></span>
apply <span class="key">plugin</span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">com.bmuschko.docker-remote-api</span><span class="delimiter">&quot;</span></span> <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Gradle Docker Plugin</td>
</tr>
</table>
</div>


<h2 id="gradleDockerTasks">3.4 Gradle Docker Tasks</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails-guides/grails-docker-external-services/edit/master/src/main/docs/guide/gradleDockerTasks.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Configure several Gradle tasks which allow us to pull a Docker image and create/start/stop a PostgreSQL container with Gradle</p>
</div>
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">import</span> <span class="include">com.bmuschko.gradle.docker.tasks.container.DockerCreateContainer</span>
<span class="keyword">import</span> <span class="include">com.bmuschko.gradle.docker.tasks.container.DockerStartContainer</span>
<span class="keyword">import</span> <span class="include">com.bmuschko.gradle.docker.tasks.container.DockerStopContainer</span>
<span class="keyword">import</span> <span class="include">com.bmuschko.gradle.docker.tasks.image.DockerPullImage</span>
...
..
.
task pullPostgresImage(<span class="key">type</span>: DockerPullImage) {
    group = <span class="string"><span class="delimiter">'</span><span class="content">docker</span><span class="delimiter">'</span></span> <i class="conum" data-value="1"></i><b>(1)</b>
    ext {
        imageName = <span class="string"><span class="delimiter">'</span><span class="content">postgres</span><span class="delimiter">'</span></span> <i class="conum" data-value="2"></i><b>(2)</b>
        imageTag = <span class="string"><span class="delimiter">'</span><span class="content">9.6.6</span><span class="delimiter">'</span></span>  <i class="conum" data-value="3"></i><b>(3)</b>
    }
    description = <span class="string"><span class="delimiter">'</span><span class="content">Pull PostgreSQL image</span><span class="delimiter">'</span></span>
    repository = imageName
    tag = imageTag
}
task createPostgresContainer(<span class="key">type</span>: DockerCreateContainer, <span class="key">dependsOn</span>: pullPostgresImage) {
    group = <span class="string"><span class="delimiter">'</span><span class="content">docker</span><span class="delimiter">'</span></span>  <i class="conum" data-value="1"></i><b>(1)</b>
    ext {
        pgContainerName = <span class="string"><span class="delimiter">&quot;</span><span class="content">demo-postgres</span><span class="delimiter">&quot;</span></span> <i class="conum" data-value="4"></i><b>(4)</b>
        dbName = <span class="string"><span class="delimiter">&quot;</span><span class="content">demo_db</span><span class="delimiter">&quot;</span></span> <i class="conum" data-value="5"></i><b>(5)</b>
        dbPort = <span class="integer">5432</span> <i class="conum" data-value="6"></i><b>(6)</b>
        dbPassword = <span class="string"><span class="delimiter">'</span><span class="content">dev_password</span><span class="delimiter">'</span></span>  <i class="conum" data-value="7"></i><b>(7)</b>
    }
    description = <span class="string"><span class="delimiter">'</span><span class="content">Creates PostgreSQL container</span><span class="delimiter">'</span></span>
    containerName = pgContainerName
    imageId = <span class="string"><span class="delimiter">&quot;</span><span class="inline"><span class="inline-delimiter">${</span>pullPostgresImage.imageName<span class="inline-delimiter">}</span></span><span class="content">:</span><span class="inline"><span class="inline-delimiter">${</span>pullPostgresImage.tag<span class="inline-delimiter">}</span></span><span class="delimiter">&quot;</span></span>
    portBindings = [<span class="string"><span class="delimiter">&quot;</span><span class="inline"><span class="inline-delimiter">${</span>dbPort<span class="inline-delimiter">}</span></span><span class="content">:5432</span><span class="delimiter">&quot;</span></span>]
    env = [
        <span class="string"><span class="delimiter">&quot;</span><span class="content">POSTGRES_PASSWORD=</span><span class="inline"><span class="inline-delimiter">${</span>dbPassword<span class="inline-delimiter">}</span></span><span class="delimiter">&quot;</span></span>,
        <span class="string"><span class="delimiter">&quot;</span><span class="content">POSTGRES_DB=</span><span class="inline"><span class="inline-delimiter">${</span>dbName<span class="inline-delimiter">}</span></span><span class="delimiter">&quot;</span></span>,
    ] <span class="keyword">as</span> <span class="predefined-type">String</span><span class="type">[]</span>

    onError { e -&gt;
        <span class="keyword">if</span> (e.class.simpleName <span class="keyword">in</span> [<span class="string"><span class="delimiter">'</span><span class="content">BadRequestException</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">ConflictException</span><span class="delimiter">'</span></span>]) {
            logger.warn <span class="string"><span class="delimiter">'</span><span class="content">Container already exists</span><span class="delimiter">'</span></span> <i class="conum" data-value="8"></i><b>(8)</b>
        } <span class="keyword">else</span> {
            <span class="keyword">throw</span> e
        }
    }
}
task startPostgresContainer(<span class="key">type</span>: DockerStartContainer, <span class="key">dependsOn</span>: createPostgresContainer) {
    group = <span class="string"><span class="delimiter">'</span><span class="content">docker</span><span class="delimiter">'</span></span> <i class="conum" data-value="1"></i><b>(1)</b>
    description = <span class="string"><span class="delimiter">'</span><span class="content">Starts Postgres container</span><span class="delimiter">'</span></span>
    containerId = createPostgresContainer.pgContainerName
    onError { e -&gt;
        <span class="keyword">if</span> (e.class.simpleName == <span class="string"><span class="delimiter">'</span><span class="content">NotModifiedException</span><span class="delimiter">'</span></span>) {
            logger.warn <span class="string"><span class="delimiter">'</span><span class="content">Container already started</span><span class="delimiter">'</span></span>  <i class="conum" data-value="8"></i><b>(8)</b>
        } <span class="keyword">else</span> {
            <span class="keyword">throw</span> e
        }
    }
    onComplete {
        logger.info <span class="string"><span class="delimiter">&quot;</span><span class="content">Postgres is listening on port </span><span class="inline"><span class="inline-delimiter">${</span>createPostgresContainer.dbPort<span class="inline-delimiter">}</span></span><span class="delimiter">&quot;</span></span>
    }
}
task stopPostgresContainer(<span class="key">type</span>: DockerStopContainer) {
    group = <span class="string"><span class="delimiter">'</span><span class="content">docker</span><span class="delimiter">'</span></span> <i class="conum" data-value="1"></i><b>(1)</b>
    description = <span class="string"><span class="delimiter">'</span><span class="content">Stops Postgres container</span><span class="delimiter">'</span></span>
    containerId = createPostgresContainer.pgContainerName
    onError { e -&gt;
        <span class="keyword">if</span> (e.class.simpleName == <span class="string"><span class="delimiter">'</span><span class="content">NotModifiedException</span><span class="delimiter">'</span></span>) {
            logger.warn <span class="string"><span class="delimiter">'</span><span class="content">Container already stopped</span><span class="delimiter">'</span></span> <i class="conum" data-value="8"></i><b>(8)</b>
        } <span class="keyword">else</span> {
            <span class="keyword">throw</span> e
        }
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Group related tasks in a group. It helps to visualize Gradle tasks when you run <code>gradlew tasks --all</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Docker Image Name</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Docker Image Tag</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Docker container name</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Database name</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>Database port</td>
</tr>
<tr>
<td><i class="conum" data-value="7"></i><b>7</b></td>
<td>Database user&#8217;s password. By default, username is <code>postgres</code></td>
</tr>
<tr>
<td><i class="conum" data-value="8"></i><b>8</b></td>
<td>Don&#8217;t fail if the container is already created, started or stopped and the Gradle task is invoked</td>
</tr>
</table>
</div>


<h2 id="postgresql">3.5 Configure PostgreSQL</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails-guides/grails-docker-external-services/edit/master/src/main/docs/guide/postgresql.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Modify <code>build.gradle</code> and add PostgreSQL dependency:</p>
</div>
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">provided <span class="string"><span class="delimiter">&quot;</span><span class="content">org.postgresql:postgresql:9.4.1211.jre7</span><span class="delimiter">&quot;</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Configure the <code>dataSource</code> of the development environment to use the PostgreSQL database running inside Docker.</p>
</div>
<div class="listingblock">
<div class="title">grails-app/conf/application.yml</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">dataSource</span>:
    <span class="key">dialect</span>: <span class="string"><span class="content">org.hibernate.dialect.PostgreSQLDialect</span></span>
    <span class="key">driverClassName</span>: <span class="string"><span class="content">org.postgresql.Driver</span></span>
    <span class="key">username</span>: <span class="string"><span class="content">postgres</span></span>
    <span class="key">password</span>: <span class="string"><span class="content">dev_password</span></span>
    <span class="key">dbCreate</span>: <span class="string"><span class="content">update</span></span>
    <span class="key">url</span>: <span class="string"><span class="content">jdbc:postgresql://localhost:5432/demo_db</span></span></code></pre>
</div>
</div>


<h1 id="running">4 Running the app</h1>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails-guides/grails-docker-external-services/edit/master/src/main/docs/guide/running.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Before running the application, first start PostgreSQL:</p>
</div>
<div class="paragraph">
<p><code>./gradlew startPostgresContainer</code></p>
</div>
<div class="paragraph">
<p>and then start the Grails App:</p>
</div>
<div class="paragraph">
<p><code>./gradlew bootRun</code></p>
</div>
<div class="paragraph">
<p>If you connect to the database, you will see the expected database schema.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../img/db.png" alt="Database created">
</div>
</div>
<div class="sect1">
<h2 id="_bootrun_depends_on_postgresql">bootRun depends on PostgreSQL</h2>
<div class="sectionbody">
<div class="paragraph">
<p>You could configure the <code>bootRun</code> task to depends on the <code>startPostgresContainer</code> task adding the following to <code>build.gradle</code>:</p>
</div>
<div class="paragraph">
<p><code>bootRun.dependsOn startPostgresContainer</code></p>
</div>
<div class="paragraph">
<p>This will create the next dependency path:</p>
</div>
<div class="paragraph">
<p><code>bootRun &#8594; startPostgresContainer &#8594; createPostgresContainer &#8594; pullPostgresImage</code></p>
</div>
<div class="paragraph">
<p>Such a path may be of interest for a continuous integration environment.</p>
</div>
</div>
</div>


<h1 id="usingOnlyDocker">5 Using only Docker</h1>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails-guides/grails-docker-external-services/edit/master/src/main/docs/guide/usingOnlyDocker.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>There is another option that does not requires the usage of a Gradle plugin. With this approach we can just use <em>plain Docker</em>
to build a Docker image and start a container.</p>
</div>
<div class="sect1">
<h2 id="_defining_the_docker_file">Defining the Docker file</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Create the following <code>Dockerfile</code>:</p>
</div>
<div class="listingblock">
<div class="title">src/main/docker/Dockerfile</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="Dockerfile">FROM postgres:9.6.6 <i class="conum" data-value="1"></i><b>(1)</b>

VOLUME /var/lib/postgresql/data <i class="conum" data-value="2"></i><b>(2)</b>

COPY [&quot;setup.sh&quot;, &quot;/docker-entrypoint-initdb.d/&quot;] <i class="conum" data-value="3"></i><b>(3)</b>

EXPOSE 5432 <i class="conum" data-value="4"></i><b>(4)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Use the same PostgreSQL image and version as before</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Define a volume to store the data</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Copy a script to the entrypoint directory. Any <code>.sh</code> or <code>.sql</code> file in this directory will be executing when starting the container</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Expose the port</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Also create the file <code>setup.sh</code>:</p>
</div>
<div class="listingblock">
<div class="title">src/main/docker/setup.sh</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">#!/bin/bash
echo &quot;######### CREATING DATABASE ##########&quot;

# Perform all actions as user 'postgres'
export PGUSER=postgres

# Create specific users for the application and also the databases for dev and test
psql &lt;&lt;EOSQL
    <i class="conum" data-value="1"></i><b>(1)</b>
    CREATE DATABASE dev_demo_db;
    CREATE ROLE dev_user WITH LOGIN PASSWORD 'dev_password';
    GRANT ALL PRIVILEGES ON DATABASE dev_demo_db TO dev_user;

    <i class="conum" data-value="2"></i><b>(2)</b>
    CREATE DATABASE test_demo_db;
    CREATE ROLE test_user WITH LOGIN PASSWORD 'test_password';
    GRANT ALL PRIVILEGES ON DATABASE test_demo_db TO test_user;
EOSQL

echo &quot;&quot;
echo &quot;######### DATABASE CREATED ##########&quot;</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Create the database, user and password for development environment</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Define another database, user and password for the test environment</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_building_the_image">Building the image</h2>
<div class="sectionbody">
<div class="paragraph">
<p>With those files created, let&#8217;s build the docker image:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ docker build -t postgres-custom src/main/docker/</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_start_a_container">Start a container</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To create and start a container for the first time based on the image we have just created:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ docker run -d -p 5432:5432 --name demo-postgres postgres-custom</code></pre>
</div>
</div>
<div class="paragraph">
<p>From now on, every time we want to start/stop the container, we only need to execute:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ docker start demo-postgres

$ docker stop demo-postgres</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Keep in mind that you also need to change <code>application.yml</code> to use the new credentials defined in <code>setup.sh</code> file.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Replace the database development environment configuration with:</p>
</div>
<div class="listingblock">
<div class="title">grails-app/conf/application.yml</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">environments</span>:
    <span class="key">development</span>:
        <span class="key">dataSource</span>:
            <span class="key">dialect</span>: <span class="string"><span class="content">org.hibernate.dialect.PostgreSQLDialect</span></span>
            <span class="key">driverClassName</span>: <span class="string"><span class="content">org.postgresql.Driver</span></span>
            <span class="key">username</span>: <span class="string"><span class="content">dev_user</span></span>
            <span class="key">password</span>: <span class="string"><span class="content">dev_password</span></span>
            <span class="key">dbCreate</span>: <span class="string"><span class="content">update</span></span>
            <span class="key">url</span>: <span class="string"><span class="content">jdbc:postgresql://localhost:5432/dev_demo_db</span></span></code></pre>
</div>
</div>
</div>
</div>


<h1 id="helpWithGrails">6 Help with Grails</h1>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails-guides/grails-docker-external-services/edit/master/src/main/docs/guide/helpWithGrails.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<h3 style="color: #333; margin-bottom:25px;"><a href="https://objectcomputing.com/" target="_blank">Object Computing, Inc.</a> (OCI) sponsored the creation of this Guide. A variety of consulting and support services are available.</h3>

<!-- BEGIN HubSpot Consultation Form -->

<!--[if lte IE 8]>
<script charset="utf-8" type="text/javascript" src="//js.hsforms.net/forms/v2-legacy.js"></script>
<![endif]-->
<script charset="utf-8" type="text/javascript" src="//js.hsforms.net/forms/v2.js"></script>
<script>
  hbspt.forms.create({
	portalId: "4547412",
	formId: "f8bc9b16-d5f6-4226-a24e-da0eb8b73363"
});
</script>

<!-- END HubSpot Consultation Form -->

<h3 style="color: #333;">OCI is Home to Grails</h3>

<p><a href="https://objectcomputing.com/products/2gm-team" target="_blank">Meet the Team</a></p>

</article></div><footer>
  <div class='content'>
    <div class='ocihometograils'>
      <span>Sponsored by</span>
      <a href='https://objectcomputing.com/products/grails/'><img class='' src='/images/oci_home_to_grails.svg' alt='Object Computing - Home to Grails' width='300px' /></a>
    </div>
    <nav class='socialmedianav'><ul>
  <li>
    <a href='https://slack.grails.org'><img class='' src='/images/slack.svg' alt='Slack Icon' /></a>
  </li>
  <li>
    <a href='https://www.youtube.com/watch?v=XnRNfDGkBVg&amp;list=PLI74De5M9T73uH3WilDCePP2qfSDpMaGu'><img class='' src='/images/youtube.svg' alt='Youtube Icon' /></a>
  </li>
  <li>
    <a href='https://www.linkedin.com/groups/39757'><img class='' src='/images/linkedin.svg' alt='LinkedIn Icon' /></a>
  </li>
  <li>
    <a href='https://github.com/grails/'><img class='' src='/images/github.svg' alt='Github Icon' /></a>
  </li>
  <li>
    <a href='https://twitter.com/grailsframework'><img class='' src='/images/twitter.svg' alt='Twitter Icon' /></a>
  </li>
</ul></nav>
    <nav class='partnersnav'><ul>
  <li>Grails' repositories are hosted by
    <a href='https://repo.grails.org/'>Artifactory</a>
  </li>
  <li>Website hosting provided by
    <a href='https://aws.amazon.com/'>AWS</a>
  </li>
  <li>JetBrains supports Grails with its 
    <a href='https://www.jetbrains.com/idea/'>IntelliJ IDEA IDE</a>
  </li>
  <li>YourKit supports Grails with its 
    <a href='https://www.yourkit.com/java/profiler/index.jsp'>Java Profiler</a>
  </li>
  <li>Grails is Open Source
    <a href='http://www.apache.org/licenses/LICENSE-2.0.html'>Apache 2 License</a>
  </li>
  <li>
    <a href='https://grails.org/buildstatus.html'>Build Status</a>
  </li>
</ul></nav>
  </div>
</footer><div>
  <script type='text/javascript'>
              (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
              (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
              m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
              })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

              ga('create', 'UA-82213539-2', 'auto');
              ga('send', 'pageview');
</script>
  <script type='text/javascript'>
adroll_adv_id = "HBWJH4CQCJGS5DJRSB4Z4D";
adroll_pix_id = "IVEQYFOZXZAPZMDVQH7BFE";
/* OPTIONAL: provide email to improve user identification */
/* adroll_email = "username@example.com"; */
(function () {
    var _onload = function(){
        if (document.readyState && !/loaded|complete/.test(document.readyState)){setTimeout(_onload, 10);return}
        if (!window.__adroll_loaded){__adroll_loaded=true;setTimeout(_onload, 50);return}
        var scr = document.createElement("script");
        var host = (("https:" == document.location.protocol) ? "https://s.adroll.com" : "http://a.adroll.com");
        scr.setAttribute('async', 'true');
        scr.type = "text/javascript";
        scr.src = host + "/j/roundtrip.js";
        ((document.getElementsByTagName('head') || [null])[0] ||
            document.getElementsByTagName('script')[0].parentNode).appendChild(scr);
    };
    if (window.addEventListener) {window.addEventListener('load', _onload, false);}
    else {window.attachEvent('onload', _onload)}
}());            
</script>
</div></body>
</html>
