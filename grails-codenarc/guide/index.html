<!DOCTYPE html>
<html>
  <head>
    <meta name='google-site-verification' content='REYQ1_I6HGowAE7LOLVqfQbnKaB4IfFpMlGzMbJj55Q' />
    <meta name='viewport' content='width=device-width, initial-scale=1' />
    <link rel='icon' href='/images/favicon.ico' />
    <link rel='mask-icon' href='//images/grails-pinned-icon.svg' color='feb672' />
    <meta charset='UTF-8' />
    <title>Static code analysis in a Grails app with CodeNarc | Grails Guides | Grails Framework</title>
    <meta name='description' content='Static code analysis in a Grails app with CodeNarc. In this guide, you'll learn how to improve your code with static analysis using CodeNarc.' />
    <link rel='stylesheet' href='../css/main.css' />
    <link rel='stylesheet' href='../css/screen.css' />
    <script src='https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/1.7.1/clipboard.min.js'></script>
  </head>
  <body class='guide'><header class='mainheader'>
  <div class='content'>
    <a href='https://grails.org/index.html'><img class='grailslogo' src='/images/grails_logo.svg' alt='Grails Logo' /></a>
    <a href='javascript:show(&apos;topmenus&apos;, &apos;showNavigationLink&apos;)' id='showNavigationLink' class='mobile align-center'>Show Navigation</a>
    <div id='topmenus'>
      <nav class='secondarymenu' id='secondarymenu'><ul>
  <li>
    <a href='https://grails.org/learning.html'>Learning</a>
  </li>
  <li>
    <a href='https://grails.org/community.html'>Community</a>
  </li>
  <li>
    <a href='https://grails.org/search.html'>Search</a>
  </li>
</ul></nav>
      <nav class='mainmenu' id='mainmenu'><ul>
  <li>
    <a href='https://grails.org/documentation.html'>Documentation</a>
  </li>
  <li>
    <a href='https://grails.org/download.html'>Download</a>
  </li>
  <li>
    <a href='https://plugins.grails.org'>Plugins</a>
  </li>
  <li>
    <a href='https://guides.grails.org/index.html'>Guides</a>
  </li>
  <li>
    <a href='https://grails.org/faq.html'>FAQ</a>
  </li>
  <li>
    <a href='https://grails.org/support.html'>Support</a>
  </li>
</ul></nav>
    </div>
  </div>
</header><div class='fullwidth'><article class="guide">
    <aside>
        <a href="https://travis-ci.org/grails-guides/grails-codenarc"><img src="https://travis-ci.org/grails-guides/grails-codenarc.svg?branch=master"></a>

        <button type="button" class="btn btn-large" onclick="window.location.href=&quot;https://github.com/grails-guides/grails-codenarc&quot;"><img height="15" src="../img/github_white.svg" alt="Github"/><span>&nbsp;Get the Code</span></button>


        <ul class="githublinks">
            <li><button type="button" class="btn btn-default" href="#" onclick="document.getElementById('github-url').value='git@github.com:grails-guides/grails-codenarc.git'" class="codeButton">SSH</button></li>
            <li><button type="button" class="btn btn-default" onclick="document.getElementById('github-url').value='https://github.com/grails-guides/grails-codenarc.git'" class="codeButton">HTTPS</button></li>
        </ul>
        <div class="input-group">
            <!-- Target -->
            <input id="github-url" value="git@github.com:grails-guides/grails-codenarc.git" type="text" />
            <!-- Trigger -->
            <button type="button" class="clippy btn btn-default" type="button" data-clipboard-target="#github-url">
                <img width="13" src="../img/clippy.svg" alt="Copy to clipboard">
            </button>
        </div>
        <script>var clipboard = new Clipboard('.clippy');</script>
        <button type="button" class="btn btn-large" onclick="window.location.href=&quot;https://github.com/grails-guides/grails-codenarc/archive/master.zip&quot;">Download ZIP</button>
        
        <div id="table-of-content">
            <h3>Table of Contents</h3>
            
            <div class="toc-item" style="margin-left:0px"><a href="#training"><strong>1</strong><span>Grails Training</span></a></div>
            
            <div class="toc-item" style="margin-left:0px"><a href="#gettingStarted"><strong>2</strong><span>Getting Started</span></a></div>
            
            <div class="toc-item" style="margin-left:10px"><a href="#requirements"><strong>2.1</strong><span>What you will need</span></a></div>
            
            <div class="toc-item" style="margin-left:10px"><a href="#howto"><strong>2.2</strong><span>How to complete the guide</span></a></div>
            
            <div class="toc-item" style="margin-left:0px"><a href="#writingTheApp"><strong>3</strong><span>Writing the Application</span></a></div>
            
            <div class="toc-item" style="margin-left:10px"><a href="#multiproject"><strong>3.1</strong><span>Multi-Project Build</span></a></div>
            
            <div class="toc-item" style="margin-left:10px"><a href="#ruleTypes"><strong>3.2</strong><span>Rule Types</span></a></div>
            
            <div class="toc-item" style="margin-left:10px"><a href="#addingCodenarc"><strong>3.3</strong><span>Adding CodeNarc to our project</span></a></div>
            
            <div class="toc-item" style="margin-left:10px"><a href="#finalConfiguration"><strong>3.4</strong><span>Final configuration</span></a></div>
            
            <div class="toc-item" style="margin-left:0px"><a href="#writingCustomRule"><strong>4</strong><span>Writing a custom Rule</span></a></div>
            
            <div class="toc-item" style="margin-left:10px"><a href="#customRule"><strong>4.1</strong><span>Creating the Rule</span></a></div>
            
            <div class="toc-item" style="margin-left:10px"><a href="#checkingRule"><strong>4.2</strong><span>Checking the Rule in the Grails application</span></a></div>
            
            <div class="toc-item" style="margin-left:0px"><a href="#helpWithGrails"><strong>5</strong><span>Do you need help with Grails?</span></a></div>
            
            <div style="clear:both" ></div>
        </div>
        
    </aside>
    <header>
        <h1>Static code analysis in a Grails app with CodeNarc</h1>
        <p>In this guide, you'll learn how to improve your code with static analysis using CodeNarc.</p>
        <p><strong>Authors:</strong> Iv&aacute;n L&oacute;pez</p>
        <p><strong>Grails Version:</strong> 4.0.1</p>
    </header>
    

<h1 id="training">1 Grails Training</h1>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails-guides/grails-codenarc/edit/master/src/main/docs/guide/training.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p><strong>Grails Training</strong> - Developed and delivered by the folks who created and actively maintain the Grails framework!.</p>
</div>
<div id="ocitraining"></div>
<script type="text/javascript">
var getJSON = function(url, callback) {
    var xhr = new XMLHttpRequest();
    xhr.open('GET', url, true);
    xhr.responseType = 'json';
    xhr.onload = function() {
      var status = xhr.status;
      if (status == 200) {
        callback(null, xhr.response);
      } else {
        callback(status);
      }
    };
    xhr.send();
};
getJSON('https://training.grails.org/training', function(err, data) {
  var msg = '';
  if (err != null) {
      msg = 'Something went wrong while retrieving OCI training offerings';

  } else {
      if ( data.length == 0 ) {
         msg = '<p><b>Nothing scheduled at the moment - please check back again soon!</b></p>.';

      } else {
        msg += '<table>';
        msg += '<thead>';
        msg += '<tr><th>Course</th><th>Date(s)</th><th>Instructor(s)</th><th>Hour(s)</th></tr>';
        msg += '</thead>';
        msg += '<tbody>';

        var hrefs = new Array();
        for (var i = 0; i < data.length; i++) {
            var href = data[i].enrollmentLink;
            if (hrefs.indexOf(href) == -1) {
                msg += '<tr><td><a href="'+ href + '">'+ data[i].course + '</a></td><td>'+ data[i].dates + '</td><td>'+ data[i].instructors + '</td><td>'+ data[i].hours + '</td></tr>';
                hrefs.push(href);
            }

        }
        msg += '</tbody>';
        msg += '</table>';
      }
  }
  var ociTraining = document.getElementById("ocitraining");
  ociTraining.innerHTML = msg;
});
</script>


<h1 id="gettingStarted">2 Getting Started</h1>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails-guides/grails-codenarc/edit/master/src/main/docs/guide/gettingStarted.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>When we write code, it&#8217;s important to follow some rules, right practices, style rules, etc. However, sometimes it is not that
simple. It is even more important when we work in a team, in which every member has his preferences. One way of
improving this is adding a static analysis tool for the code.</p>
</div>
<div class="paragraph">
<p>In this guide, you are going to install and configure <a href="http://codenarc.sourceforge.net/">Codenarc</a> to help you improve the
 quality of your Grails code, and you are also going to learn how to create a custom CodeNarc rule.
 CodeNarc analyzes the Groovy code and reports potential bugs and code problems.</p>
</div>


<h2 id="requirements">2.1 What you will need</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails-guides/grails-codenarc/edit/master/src/main/docs/guide/requirements.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>To complete this guide, you will need the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Some time on your hands</p>
</li>
<li>
<p>A decent text editor or IDE</p>
</li>
<li>
<p>JDK 1.8 or greater installed with <code>JAVA_HOME</code> configured appropriately</p>
</li>
</ul>
</div>


<h2 id="howto">2.2 How to complete the guide</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails-guides/grails-codenarc/edit/master/src/main/docs/guide/howto.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>To get started do the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://github.com/grails-guides/grails-codenarc/archive/master.zip">Download</a> and unzip the source</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>or</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Clone the <a href="https://git-scm.com/">Git</a> repository:<br>
<code>git clone <a href="https://github.com/grails-guides/grails-codenarc.git" class="bare">https://github.com/grails-guides/grails-codenarc.git</a></code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The Grails guides repositories contain two folders:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>initial</code>  Initial project. Often a simple Grails app with some additional code to give you a head-start.</p>
</li>
<li>
<p><code>complete</code> A completed example. It is the result of working through the steps presented by the guide and applying those changes to the <code>initial</code> folder.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>To complete the guide, go to the <code>initial</code> folder</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>cd</code> into <code>grails-guides/grails-codenarc/initial</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>and follow the instructions in the next sections.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
You can go right to the <strong>completed example</strong> if you <code>cd</code> into <code>grails-guides/grails-codenarc/complete</code>
</td>
</tr>
</table>
</div>


<h1 id="writingTheApp">3 Writing the Application</h1>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails-guides/grails-codenarc/edit/master/src/main/docs/guide/writingTheApp.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>





<h2 id="multiproject">3.1 Multi-Project Build</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails-guides/grails-codenarc/edit/master/src/main/docs/guide/multiproject.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>We are going to setup a multi-project build with a Grails application and a custom
CodeNarc Rule as shown in the next image:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../img/multiproject.png" alt="multiproject">
</div>
</div>
<div class="paragraph">
<p>Check our <a href="http://guides.grails.org/grails-multi-project-build/guide/index.html">Grails Multi-Project Build</a> Guide, to learn more.</p>
</div>


<h2 id="ruleTypes">3.2 Rule Types</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails-guides/grails-codenarc/edit/master/src/main/docs/guide/ruleTypes.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Current CodeNarc version (0.27.0) includes <a href="http://codenarc.sourceforge.net/codenarc-rule-index.html">348 rules</a> divided
in 22 categories:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Basic</strong>: For example to check that there are no empty <code>else</code> or <code>finally</code> blocks.</p>
</li>
<li>
<p><strong>Braces</strong>: How many times have you seen an <code>if</code> or <code>else</code> with only one statement without the curly-braces? I personally
don&#8217;t like code without curly-braces because it&#8217;s a source of bugs in the future. We can add the rules in this category to perform these checks.</p>
</li>
<li>
<p><strong>Convention</strong>: There are rules to check for some conventions: when we write an "inverted" <code>if</code>, an <code>if</code> that can be
converted to an elvis operator,&#8230;&#8203;</p>
</li>
<li>
<p><strong>Exceptions</strong>: Rules that will fail if, for example, we throw a <code>NullPointerException</code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>And there are many more categories to check for duplicated imports, unused variables, unnecessary ifs,&#8230;&#8203; And of course there&#8217;s a specific category for Grails rules.</p>
</div>


<h2 id="addingCodenarc">3.3 Adding CodeNarc to our project</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails-guides/grails-codenarc/edit/master/src/main/docs/guide/addingCodenarc.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Adding CodeNarc to our project is a simple task because there&#8217;s a <a href="https://docs.gradle.org/current/userguide/codenarc_plugin.html">Gradle plugin</a>
 to do it.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s modify <code>build.gradle</code> and add the following:</p>
</div>
<div class="listingblock">
<div class="title">/app/build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">apply <span class="key">from</span>: <span class="string"><span class="delimiter">&quot;</span><span class="inline"><span class="inline-delimiter">${</span>rootProject.projectDir<span class="inline-delimiter">}</span></span><span class="content">/gradle/codenarc.gradle</span><span class="delimiter">&quot;</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>We encapsulate all the CodeNarc configuration in <code>gradle/codenarc.gradle</code>:</p>
</div>
<div class="listingblock">
<div class="title">/gradle/codenarc.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">apply <span class="key">plugin</span>: <span class="string"><span class="delimiter">'</span><span class="content">codenarc</span><span class="delimiter">'</span></span> <i class="conum" data-value="1"></i><b>(1)</b>

codenarc {
    toolVersion = <span class="string"><span class="delimiter">'</span><span class="content">1.4</span><span class="delimiter">'</span></span> <i class="conum" data-value="2"></i><b>(2)</b>
    configFile = file(<span class="string"><span class="delimiter">&quot;</span><span class="inline"><span class="inline-delimiter">${</span>rootProject.projectDir<span class="inline-delimiter">}</span></span><span class="content">/config/codenarc/rules.groovy</span><span class="delimiter">&quot;</span></span>) <i class="conum" data-value="3"></i><b>(3)</b>
    reportFormat = <span class="string"><span class="delimiter">'</span><span class="content">html</span><span class="delimiter">'</span></span> <i class="conum" data-value="4"></i><b>(4)</b>
    ignoreFailures = <span class="predefined-constant">true</span> <i class="conum" data-value="5"></i><b>(5)</b>
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Apply the <code>codenarc</code> plugin.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Set the CodeNarc version we want to use.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Define the main file with the rules. By default CodeNarc uses <code>config/codenarc/codenarc.xml</code> but we don&#8217;t want to
write XML files, don&#8217;t we?</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>The report format we want. For a human-readable format we use <code>html</code>. If we want to integrate CodeNarc with, for
example, Jenkins we need to change it to <code>xml</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>We don&#8217;t want that the build fails when there&#8217;s only one violation.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Then we need to create the rules file:</p>
</div>
<div class="listingblock">
<div class="title">/config/codenarc/rules.groovy</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">ruleset {
    description <span class="string"><span class="delimiter">'</span><span class="content">Grails-CodeNarc Project RuleSet</span><span class="delimiter">'</span></span>

    ruleset(<span class="string"><span class="delimiter">'</span><span class="content">rulesets/basic.xml</span><span class="delimiter">'</span></span>)
    ruleset(<span class="string"><span class="delimiter">'</span><span class="content">rulesets/braces.xml</span><span class="delimiter">'</span></span>)
    ruleset(<span class="string"><span class="delimiter">'</span><span class="content">rulesets/convention.xml</span><span class="delimiter">'</span></span>)
    ruleset(<span class="string"><span class="delimiter">'</span><span class="content">rulesets/design.xml</span><span class="delimiter">'</span></span>)
    ruleset(<span class="string"><span class="delimiter">'</span><span class="content">rulesets/dry.xml</span><span class="delimiter">'</span></span>)
    ruleset(<span class="string"><span class="delimiter">'</span><span class="content">rulesets/exceptions.xml</span><span class="delimiter">'</span></span>)
    ruleset(<span class="string"><span class="delimiter">'</span><span class="content">rulesets/formatting.xml</span><span class="delimiter">'</span></span>)
    ruleset(<span class="string"><span class="delimiter">'</span><span class="content">rulesets/generic.xml</span><span class="delimiter">'</span></span>)
    ruleset(<span class="string"><span class="delimiter">'</span><span class="content">rulesets/imports.xml</span><span class="delimiter">'</span></span>)
    ruleset(<span class="string"><span class="delimiter">'</span><span class="content">rulesets/naming.xml</span><span class="delimiter">'</span></span>)
    ruleset(<span class="string"><span class="delimiter">'</span><span class="content">rulesets/unnecessary.xml</span><span class="delimiter">'</span></span>)
    ruleset(<span class="string"><span class="delimiter">'</span><span class="content">rulesets/unused.xml</span><span class="delimiter">'</span></span>)
    ruleset(<span class="string"><span class="delimiter">'</span><span class="content">rulesets/grails.xml</span><span class="delimiter">'</span></span>)
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>With this configuration we can just run the <code>check</code> task.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ ./gradlew app:check

:check UP-TO-DATE
:complete:codenarcMain
CodeNarc rule violations were found. See the report at: file:///home/ivan/workspaces/oci/guides/grails-codenarc/complete/app/build/reports/codenarc/main.html
:complete:codenarcTest NO-SOURCE
:complete:compileJava NO-SOURCE
:complete:compileGroovy UP-TO-DATE
:complete:buildProperties UP-TO-DATE
:complete:processResources UP-TO-DATE
:complete:classes UP-TO-DATE
:complete:compileTestJava NO-SOURCE
:complete:compileTestGroovy NO-SOURCE
:complete:processTestResources NO-SOURCE
:complete:testClasses UP-TO-DATE
:complete:test NO-SOURCE
:complete:check

Total time: 1.953 secs</code></pre>
</div>
</div>
<div class="paragraph">
<p>And we can open the test report to check the violations:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../img/report1.png" alt="report1">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>First, we have a section with the execution date and the CodeNarc version used.</p>
</li>
<li>
<p>Then there&#8217;s another section with a Summary with the total of files with violations and also the number of violations with priority 1, 2 and 3.</p>
</li>
<li>
<p>After that, there&#8217;s a section for each file in which we can see all the violations in the file with the line of code and a small fragment of it. The rule name is a link to a more detailed explanation.</p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="_let_s_fix_the_violations">Let&#8217;s fix the violations</h3>
<div class="paragraph">
<p>There are different ways of fixing a CodeNarc violation:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Fixing the problem: As the name implies, just fix the violation.</p>
</li>
<li>
<p>Disabling the rule: Sometimes we don&#8217;t agree with that specific CodeNarc violation. We can disable it.</p>
</li>
<li>
<p>Ignoring the rule for that specific class or method: This case is when we don&#8217;t want to disable the rule but want to
skip it only in a particular class or method.</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="_fix_the_problem">Fix the problem</h4>
<div class="ulist">
<ul>
<li>
<p>To fix the violation <code>FileEndsWithoutNewline</code> add a new line at the end of <code>UrlMappings</code> file.</p>
</li>
<li>
<p>To fix the violation <code>SpaceBeforeOpeningBrace</code> add a space before the braces.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_disable_the_rule">Disable the rule</h4>
<div class="paragraph">
<p>For the case of <code>ClassJavadoc</code> and <code>NoDef</code> we can just disable the rules modifying the <code>rules.groovy</code> file:</p>
</div>
<div class="listingblock">
<div class="title">/app/src/codenarc/rules.groovy</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">ruleset {
    description <span class="string"><span class="delimiter">'</span><span class="content">Grails-CodeNarc Project RuleSet</span><span class="delimiter">'</span></span>

    ...
    ruleset(<span class="string"><span class="delimiter">'</span><span class="content">rulesets/convention.xml</span><span class="delimiter">'</span></span>) {
        <span class="string"><span class="delimiter">'</span><span class="content">NoDef</span><span class="delimiter">'</span></span> {
            enabled = <span class="predefined-constant">false</span>
        }
    }
    ...
    ruleset(<span class="string"><span class="delimiter">'</span><span class="content">rulesets/formatting.xml</span><span class="delimiter">'</span></span>) {
        <span class="string"><span class="delimiter">'</span><span class="content">ClassJavadoc</span><span class="delimiter">'</span></span> {
            enabled = <span class="predefined-constant">false</span>
        }
    }
    ...
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_ignoring_a_rule">Ignoring a rule</h4>
<div class="paragraph">
<p>Finally, we can ignore a rule for a particular class. In this case, we&#8217;re going to ignore the <code>UnnecessaryGString</code> rule
for <code>UrlMappings.groovy</code> using <code>@SuppressWarnings</code>:</p>
</div>
<div class="listingblock">
<div class="title">/app/grails-app/controllers/demo/UrlMappings.groovy</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="annotation">@SuppressWarnings</span>([<span class="string"><span class="delimiter">'</span><span class="content">UnnecessaryGString</span><span class="delimiter">'</span></span>])
<span class="type">class</span> <span class="class">UrlMappings</span> {

    <span class="directive">static</span> mappings = {
        <span class="string"><span class="delimiter">&quot;</span><span class="content">/</span><span class="inline"><span class="inline-delimiter">$</span>controller</span><span class="content">/</span><span class="inline"><span class="inline-delimiter">$</span>action</span><span class="content">?/</span><span class="inline"><span class="inline-delimiter">$</span>id</span><span class="content">?(.</span><span class="inline"><span class="inline-delimiter">$</span>format</span><span class="content">)?</span><span class="delimiter">&quot;</span></span> {
            constraints {
                <span class="comment">// apply constraints here</span>
            }
        }

        <span class="string"><span class="delimiter">&quot;</span><span class="content">/</span><span class="delimiter">&quot;</span></span>(<span class="key">view</span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">/index</span><span class="delimiter">&quot;</span></span>)
        <span class="string"><span class="delimiter">&quot;</span><span class="content">500</span><span class="delimiter">&quot;</span></span>(<span class="key">view</span>:<span class="string"><span class="delimiter">'</span><span class="content">/error</span><span class="delimiter">'</span></span>)
        <span class="string"><span class="delimiter">&quot;</span><span class="content">404</span><span class="delimiter">&quot;</span></span>(<span class="key">view</span>:<span class="string"><span class="delimiter">'</span><span class="content">/notFound</span><span class="delimiter">'</span></span>)
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_checking_the_result">Checking the result</h4>
<div class="paragraph">
<p>Just execute again the <code>check</code> task and open the report to see that all the violations are gone:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../img/report2.png" alt="report2">
</div>
</div>
</div>
</div>


<h2 id="finalConfiguration">3.4 Final configuration</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails-guides/grails-codenarc/edit/master/src/main/docs/guide/finalConfiguration.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>If you install CodeNarc in a medium-big size project, which has not use any static analysis tool before, you may have hundreds or event thousands of violations. It is possible that your team has not been careful enough while writing code. Moreover, it is likely that CodeNarc default configuration contains some rules you don&#8217;t agree with. Rules which might not be a good fit for the team.</p>
</div>
<div class="paragraph">
<p>My advice is to review all the violations, read their documentation and then decide if you want to disable them,
configure with another option and finally fix and respect them.</p>
</div>
<div class="paragraph">
<p>Once the team decides the rules and the configuration the next step is to choose the thresholds to make the build fail.
These thresholds allow having successful builds with some violations but, once we reach these levels, the build will fail.</p>
</div>
<div class="paragraph">
<p>To do that, just edit the <code>build.gradle</code> file:</p>
</div>
<div class="listingblock">
<div class="title">/app/build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">codenarc {
    ...
    <span class="comment">// We need to remove the following line</span>
    <span class="comment">//ignoreFailures = true</span>

    maxPriority1Violations = <span class="integer">0</span>
    maxPriority2Violations = <span class="integer">5</span>
    maxPriority3Violations = <span class="integer">9</span>
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>With this configuration the build will fail once we reach these thresholds.</p>
</div>


<h1 id="writingCustomRule">4 Writing a custom Rule</h1>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails-guides/grails-codenarc/edit/master/src/main/docs/guide/writingCustomRule.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Although CodeNarc provides some <a href="http://codenarc.sourceforge.net/codenarc-rules-grails.html">rules</a> specific for Grails,
some times we may want to create our own rules.</p>
</div>
<div class="paragraph">
<p>In this example we&#8217;re going to create a rule to check that we use <br>
<code>grails.gorm.transactions.Transactional</code> instead of
<code>@org.springframework.transaction.annotation.Transactional</code>.<br>
As you probably know the Grails <code>@Transactional</code> annotation is better because it doesn&#8217;t create a runtime proxy. It&#8217;s an AST Transformation that it&#8217;s applied during compilation time, so there&#8217;s no runtime overhead. There&#8217;s also other features that the Grails annotation provides and
the Spring one don&#8217;t.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<code>grails.gorm.transactions.Transactional</code> is only available for the latest versions of GORM (this guide uses GORM 7.0.2.RELEASE), for previous versions you should use <code>@grails.transaction.Transactional</code>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The rule checks our code. If we use the Spring annotation, it adds a new violation to the report.</p>
</div>


<h2 id="customRule">4.1 Creating the Rule</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails-guides/grails-codenarc/edit/master/src/main/docs/guide/customRule.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="sect2">
<h3 id="_create_the_project">Create the project</h3>
<div class="paragraph">
<p>We need to create a new Groovy project because we want to package the rule in its own jar file using Gradle.</p>
</div>
<div class="listingblock">
<div class="title">/codenarc-rule/build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">plugins {
    id <span class="string"><span class="delimiter">'</span><span class="content">groovy</span><span class="delimiter">'</span></span>
}

repositories {
    jcenter()
}

dependencies {
    implementation <span class="string"><span class="delimiter">'</span><span class="content">org.codenarc:CodeNarc:1.4</span><span class="delimiter">'</span></span> <i class="conum" data-value="1"></i><b>(1)</b>
    testCompile <span class="string"><span class="delimiter">'</span><span class="content">junit:junit:4.12</span><span class="delimiter">'</span></span>
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Only need CodeNarc dependency</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>In order to be able to user this new CodeNarc rule in our Grails application we need to make sure that the jar file
is available in the classpath during the <code>codenarcMain</code> taks:</p>
</div>
<div class="listingblock">
<div class="title">/gradle/codenarc.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">codenarcMain.dependsOn <span class="string"><span class="delimiter">'</span><span class="content">:codenarc-rule:jar</span><span class="delimiter">'</span></span> <i class="conum" data-value="1"></i><b>(1)</b>

tasks.withType(CodeNarc) { <i class="conum" data-value="2"></i><b>(2)</b>
    codenarcClasspath += files(<span class="string"><span class="delimiter">&quot;</span><span class="inline"><span class="inline-delimiter">${</span>rootProject.projectDir<span class="inline-delimiter">}</span></span><span class="content">/codenarc-rule/build/libs/codenarc-rule.jar</span><span class="delimiter">&quot;</span></span>)
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>CodeNarc tasks depend on the jar being generated</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Add the jar to the <code>codenarcClasspath</code></td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="_define_the_rule">Define the rule</h4>
<div class="paragraph">
<p>The first step is create a meta-information file with the information about the rule we want to create:</p>
</div>
<div class="listingblock">
<div class="title">/codenarc-rule/src/main/resources/rulesets/grails-extra.xml</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;ruleset</span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://codenarc.org/ruleset/1.0</span><span class="delimiter">&quot;</span></span>
        <span class="attribute-name">xmlns:xsi</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.w3.org/2001/XMLSchema-instance</span><span class="delimiter">&quot;</span></span>
        <span class="attribute-name">xsi:schemaLocation</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://codenarc.org/ruleset/1.0 http://codenarc.org/ruleset-schema.xsd</span><span class="delimiter">&quot;</span></span>
        <span class="attribute-name">xsi:noNamespaceSchemaLocation</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://codenarc.org/ruleset-schema.xsd</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;description&gt;</span>Extra Grails rules<span class="tag">&lt;/description&gt;</span> <i class="conum" data-value="1"></i><b>(1)</b>
    <span class="tag">&lt;rule</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">'</span><span class="content">org.codenarc.rule.grails.GrailsTransactionalRule</span><span class="delimiter">'</span></span><span class="tag">/&gt;</span> <i class="conum" data-value="2"></i><b>(2)</b>
<span class="tag">&lt;/ruleset&gt;</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The description of the group of rules.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>One <code>rule</code> element per rule we create.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Second we create a properties file with the description of the rule in both plain text and html. The messages will be
used in the html report:</p>
</div>
<div class="listingblock">
<div class="title">/codenarc-rule/src/main/resources/codenarc-messages.properties</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="properties">GrailsTransactional.description=Check that @org.springframework.transaction.annotation.Transactional is used instead of org.springframework.transaction.annotation.Transactional.
GrailsTransactional.description.html=Check that &lt;em&gt;@grails.gorm.transactions.Transactional&lt;/em&gt; is used instead of &lt;em&gt;org.springframework.transaction.annotation.Transactional&lt;/em&gt;.</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_implement_the_rule">Implement the rule</h3>
<div class="paragraph">
<p>Finally, we implement the rule:</p>
</div>
<div class="listingblock">
<div class="title">/codenarc-rule/src/main/groovy/org/codenarc/rule/grails/GrailsTransactionalRule.groovy</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">package</span> org.codenarc.rule.grails

<span class="keyword">import</span> <span class="include">groovy.transform.CompileStatic</span>
<span class="keyword">import</span> <span class="include">org.codehaus.groovy.ast.AnnotatedNode</span>
<span class="keyword">import</span> <span class="include">org.codehaus.groovy.ast.AnnotationNode</span>
<span class="keyword">import</span> <span class="include">org.codehaus.groovy.ast.ImportNode</span>
<span class="keyword">import</span> <span class="include">org.codehaus.groovy.ast.ModuleNode</span>
<span class="keyword">import</span> <span class="include">org.codenarc.rule.AbstractAstVisitor</span>
<span class="keyword">import</span> <span class="include">org.codenarc.rule.AbstractAstVisitorRule</span>

<span class="annotation">@CompileStatic</span>
<span class="type">class</span> <span class="class">GrailsTransactionalRule</span> <span class="directive">extends</span> AbstractAstVisitorRule { <i class="conum" data-value="1"></i><b>(1)</b>
    <span class="type">int</span> priority = <span class="integer">2</span> <i class="conum" data-value="2"></i><b>(2)</b>
    <span class="predefined-type">String</span> name = <span class="string"><span class="delimiter">'</span><span class="content">GrailsTransactional</span><span class="delimiter">'</span></span> <i class="conum" data-value="3"></i><b>(3)</b>
    <span class="predefined-type">Class</span> astVisitorClass = GrailsTransactionalVisitor <i class="conum" data-value="4"></i><b>(4)</b>
}

<span class="annotation">@CompileStatic</span>
<span class="type">class</span> <span class="class">GrailsTransactionalVisitor</span> <span class="directive">extends</span> AbstractAstVisitor { <i class="conum" data-value="5"></i><b>(5)</b>

    <span class="directive">private</span> <span class="directive">static</span> <span class="directive">final</span> <span class="predefined-type">String</span> SPRING_TRANSACTIONAL = <span class="string"><span class="delimiter">'</span><span class="content">org.springframework.transaction.annotation.Transactional</span><span class="delimiter">'</span></span>
    <span class="directive">private</span> <span class="directive">static</span> <span class="directive">final</span> <span class="predefined-type">String</span> ERROR_MSG = <span class="string"><span class="delimiter">'</span><span class="content">Do not use Spring @Transactional, use @grails.gorm.transactions.Transactional instead</span><span class="delimiter">'</span></span>

    <span class="annotation">@Override</span>
    <span class="type">void</span> visitAnnotations(AnnotatedNode node) { <i class="conum" data-value="6"></i><b>(6)</b>
        node.annotations.each { AnnotationNode annotationNode -&gt;
            <span class="predefined-type">String</span> annotation = annotationNode.classNode.text
            <span class="keyword">if</span> (annotation == SPRING_TRANSACTIONAL) {
                addViolation(node, ERROR_MSG)
            }
        }

        <span class="local-variable">super</span>.visitAnnotations(node)
    }

    <span class="annotation">@Override</span>
    <span class="type">void</span> visitImports(ModuleNode node) { <i class="conum" data-value="7"></i><b>(7)</b>
        node.imports.each { ImportNode importNode -&gt;
            <span class="predefined-type">String</span> importClass = importNode.className

            <span class="keyword">if</span> (importClass == SPRING_TRANSACTIONAL) {
                node.lineNumber = importNode.lineNumber <i class="conum" data-value="8"></i><b>(8)</b>
                addViolation(node, ERROR_MSG)
            }
        }

        <span class="local-variable">super</span>.visitImports(node)
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The rule needs to extend from <code>AbstractAstVisitorRule</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Define the violation priority</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The name of the rule. It needs to be the same as defined previously in the meta-information file</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>The class that implements the rule</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>The visitor class needs to extend from <code>AbstractAstVisitor</code></td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>Check the annotations of the class and methods and in case that Spring <code>@Transactional</code> is used, add a new violation</td>
</tr>
<tr>
<td><i class="conum" data-value="7"></i><b>7</b></td>
<td>Check the imports of the class and is case of Spring <code>@Transactional</code> is imported, add a new violation</td>
</tr>
<tr>
<td><i class="conum" data-value="8"></i><b>8</b></td>
<td>It&#8217;s important to set the <code>lineNumber</code> of the node because if not, the violation won&#8217;t be added</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_testing">Testing</h3>
<div class="paragraph">
<p>And of course we need to write tests to make sure that everything is working as expected:</p>
</div>
<div class="listingblock">
<div class="title">/codenarc-rule/src/test/groovy/org/codenarc/rule/grails/GrailsTransactionalRuleTest.groovy</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">package</span> org.codenarc.rule.grails

<span class="keyword">import</span> <span class="include">org.codenarc.rule.AbstractRuleTestCase</span>
<span class="keyword">import</span> <span class="include">org.codenarc.rule.Rule</span>
<span class="keyword">import</span> <span class="include">org.codenarc.rule.Violation</span>
<span class="keyword">import</span> <span class="include">org.junit.Test</span>

<span class="type">class</span> <span class="class">GrailsTransactionalRuleTest</span> <span class="directive">extends</span> AbstractRuleTestCase { <i class="conum" data-value="1"></i><b>(1)</b>

    <span class="annotation">@Override</span>
    <span class="directive">protected</span> Rule createRule() { <i class="conum" data-value="2"></i><b>(2)</b>
        <span class="keyword">return</span> <span class="keyword">new</span> GrailsTransactionalRule()
    }

    <span class="annotation">@Test</span>
    <span class="type">void</span> testGrailsTransactionalIsAllowedOnClassWithImport() {
        <span class="directive">final</span> SOURCE = <span class="string"><span class="delimiter">'''</span><span class="content"> <i class="conum" data-value="3"></i><b>(3)</b>
            import grails.gorm.transactions.Transactional

            @Transactional
            class TestService {
            }
        </span><span class="delimiter">'''</span></span>

        assertNoViolations(SOURCE) <i class="conum" data-value="4"></i><b>(4)</b>
    }

    <span class="annotation">@Test</span>
    <span class="type">void</span> testGrailsTransactionalIsAllowedOnClassWithFullpackageAnnotation() {
        <span class="directive">final</span> SOURCE = <span class="string"><span class="delimiter">'''</span><span class="content">
            @grails.gorm.transactions.Transactional
            class TestService {
            }
        </span><span class="delimiter">'''</span></span>

        assertNoViolations(SOURCE)
    }

    <span class="annotation">@Test</span>
    <span class="type">void</span> testGrailsTransactionalIsAllowedOnMethodWithImport() {
        <span class="directive">final</span> SOURCE = <span class="string"><span class="delimiter">'''</span><span class="content">
            import grails.gorm.transactions.Transactional

            class TestService {
                @Transactional
                void foo() {
                }
            }
        </span><span class="delimiter">'''</span></span>

        assertNoViolations(SOURCE)
    }

    <span class="annotation">@Test</span>
    <span class="type">void</span> testGrailsTransactionalIsAllowedOnMethodWithFullpackageAnnotation() {
        <span class="directive">final</span> SOURCE = <span class="string"><span class="delimiter">'''</span><span class="content">
            class TestService {
                @grails.gorm.transactions.Transactional
                void foo() {
                }
            }
        </span><span class="delimiter">'''</span></span>

        assertNoViolations(SOURCE)
    }

    <span class="annotation">@Test</span>
    <span class="type">void</span> testSpringTransactionalIsNotAllowedOnClassWithImport() {
        <span class="directive">final</span> SOURCE = <span class="string"><span class="delimiter">'''</span><span class="content">
            import org.springframework.transaction.annotation.Transactional

            @Transactional
            class TestService {
            }
        </span><span class="delimiter">'''</span></span>

        <i class="conum" data-value="5"></i><b>(5)</b>
        assertSingleViolation(SOURCE) { Violation violation -&gt;
            violation.rule.priority == <span class="integer">2</span> &amp;&amp;
            violation.rule.name == <span class="string"><span class="delimiter">'</span><span class="content">GrailsTransactional</span><span class="delimiter">'</span></span>
        }
    }

    <span class="annotation">@Test</span>
    <span class="type">void</span> testSpringTransactionalIsNotAllowedOnClassWithFullpackageAnnotation() {
        <span class="directive">final</span> SOURCE = <span class="string"><span class="delimiter">'''</span><span class="content">
            @org.springframework.transaction.annotation.Transactional
            class TestService {
            }
        </span><span class="delimiter">'''</span></span>

        assertSingleViolation(SOURCE) { Violation violation -&gt;
            violation.rule.priority == <span class="integer">2</span> &amp;&amp;
            violation.rule.name == <span class="string"><span class="delimiter">'</span><span class="content">GrailsTransactional</span><span class="delimiter">'</span></span>
        }
    }

    <span class="annotation">@Test</span>
    <span class="type">void</span> testSpringTransactionalIsNotAllowedOnMethodWithImport() {
        <span class="directive">final</span> SOURCE = <span class="string"><span class="delimiter">'''</span><span class="content">
            import org.springframework.transaction.annotation.Transactional

            class TestService {
                @Transactional
                void foo() {
                }
            }
        </span><span class="delimiter">'''</span></span>

        assertSingleViolation(SOURCE) { Violation violation -&gt;
            violation.rule.priority == <span class="integer">2</span> &amp;&amp;
                violation.rule.name == <span class="string"><span class="delimiter">'</span><span class="content">GrailsTransactional</span><span class="delimiter">'</span></span>
        }
    }

    <span class="annotation">@Test</span>
    <span class="type">void</span> testSpringTransactionalIsNotAllowedOnMethodWithFullpackageAnnotation() {
        <span class="directive">final</span> SOURCE = <span class="string"><span class="delimiter">'''</span><span class="content">
            class TestService {
                @org.springframework.transaction.annotation.Transactional
                void foo() {
                }
            }
        </span><span class="delimiter">'''</span></span>

        assertSingleViolation(SOURCE) { Violation violation -&gt;
            violation.rule.priority == <span class="integer">2</span> &amp;&amp;
                violation.rule.name == <span class="string"><span class="delimiter">'</span><span class="content">GrailsTransactional</span><span class="delimiter">'</span></span>
        }
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The test class needs to extend from <code>AbstractRuleTestCase</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Instantiate the rule we want to test</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Write the source code we want to test as a String</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>In this case, as we use Grails <code>@Transactional</code> we expect no violations</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>As we use Spring <code>@Transactional</code> we expect to have one violation</td>
</tr>
</table>
</div>
</div>


<h2 id="checkingRule">4.2 Checking the Rule in the Grails application</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails-guides/grails-codenarc/edit/master/src/main/docs/guide/checkingRule.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Once we have created the rule and it&#8217;s available on the classpath, it&#8217;s time to add it to the Grails application.</p>
</div>
<div class="listingblock">
<div class="title">/app/src/codenarc/rules.groovy</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">ruleset {
    description <span class="string"><span class="delimiter">'</span><span class="content">Grails-CodeNarc Project RuleSet</span><span class="delimiter">'</span></span>

    ...
    ruleset(<span class="string"><span class="delimiter">'</span><span class="content">rulesets/grails-extra.xml</span><span class="delimiter">'</span></span>)
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now we can create a service and use Spring <code>@Transactional</code> on it:</p>
</div>
<div class="listingblock">
<div class="title">/app/build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">package</span> demo

<span class="keyword">import</span> <span class="include">org.springframework.transaction.annotation.Transactional</span>

<span class="type">class</span> <span class="class">DemoService</span> {

    <span class="annotation">@Transactional</span>
    <span class="type">void</span> myMethod() {
        println <span class="string"><span class="delimiter">'</span><span class="content">Some business logic</span><span class="delimiter">'</span></span>
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>And the final step is generating the CodeNarc report:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../img/report3.png" alt="report3">
</div>
</div>
<div class="paragraph">
<p>As we can see we have a new violation because the rule we created as been applied.</p>
</div>


<h1 id="helpWithGrails">5 Do you need help with Grails?</h1>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails-guides/grails-codenarc/edit/master/src/main/docs/guide/helpWithGrails.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<h3 style="color: #333; margin-bottom:25px;"><a href="https://objectcomputing.com/" target="_blank">Object Computing, Inc.</a> (OCI) sponsored the creation of this Guide. A variety of consulting and support services are available.</h3>

<!-- BEGIN HubSpot Consultation Form -->

<!--[if lte IE 8]>
<script charset="utf-8" type="text/javascript" src="//js.hsforms.net/forms/v2-legacy.js"></script>
<![endif]-->
<script charset="utf-8" type="text/javascript" src="//js.hsforms.net/forms/v2.js"></script>
<script>
  hbspt.forms.create({
	portalId: "4547412",
	formId: "f8bc9b16-d5f6-4226-a24e-da0eb8b73363"
});
</script>

<!-- END HubSpot Consultation Form -->

<h3 style="color: #333;">OCI is Home to Grails</h3>

<p><a href="https://objectcomputing.com/products/2gm-team" target="_blank">Meet the Team</a></p>

</article></div><footer>
  <div class='content'>
    <div class='ocihometograils'>
      <span>Sponsored by</span>
      <a href='https://objectcomputing.com/products/grails/'><img class='' src='/images/oci_home_to_grails.svg' alt='Object Computing - Home to Grails' width='300px' /></a>
    </div>
    <nav class='socialmedianav'><ul>
  <li>
    <a href='https://slack.grails.org'><img class='' src='/images/slack.svg' alt='Slack Icon' /></a>
  </li>
  <li>
    <a href='https://www.youtube.com/watch?v=XnRNfDGkBVg&amp;list=PLI74De5M9T73uH3WilDCePP2qfSDpMaGu'><img class='' src='/images/youtube.svg' alt='Youtube Icon' /></a>
  </li>
  <li>
    <a href='https://www.linkedin.com/groups/39757'><img class='' src='/images/linkedin.svg' alt='LinkedIn Icon' /></a>
  </li>
  <li>
    <a href='https://github.com/grails/'><img class='' src='/images/github.svg' alt='Github Icon' /></a>
  </li>
  <li>
    <a href='https://twitter.com/grailsframework'><img class='' src='/images/twitter.svg' alt='Twitter Icon' /></a>
  </li>
</ul></nav>
    <nav class='partnersnav'><ul>
  <li>Grails' repositories are hosted by
    <a href='https://repo.grails.org/'>Artifactory</a>
  </li>
  <li>Website hosting provided by
    <a href='https://aws.amazon.com/'>AWS</a>
  </li>
  <li>JetBrains supports Grails with its 
    <a href='https://www.jetbrains.com/idea/'>IntelliJ IDEA IDE</a>
  </li>
  <li>YourKit supports Grails with its 
    <a href='https://www.yourkit.com/java/profiler/index.jsp'>Java Profiler</a>
  </li>
  <li>Grails is Open Source
    <a href='http://www.apache.org/licenses/LICENSE-2.0.html'>Apache 2 License</a>
  </li>
  <li>
    <a href='https://grails.org/buildstatus.html'>Build Status</a>
  </li>
</ul></nav>
  </div>
</footer><div>
  <script type='text/javascript'>
              (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
              (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
              m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
              })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

              ga('create', 'UA-82213539-2', 'auto');
              ga('send', 'pageview');
</script>
  <script type='text/javascript'>
adroll_adv_id = "HBWJH4CQCJGS5DJRSB4Z4D";
adroll_pix_id = "IVEQYFOZXZAPZMDVQH7BFE";
/* OPTIONAL: provide email to improve user identification */
/* adroll_email = "username@example.com"; */
(function () {
    var _onload = function(){
        if (document.readyState && !/loaded|complete/.test(document.readyState)){setTimeout(_onload, 10);return}
        if (!window.__adroll_loaded){__adroll_loaded=true;setTimeout(_onload, 50);return}
        var scr = document.createElement("script");
        var host = (("https:" == document.location.protocol) ? "https://s.adroll.com" : "http://a.adroll.com");
        scr.setAttribute('async', 'true');
        scr.type = "text/javascript";
        scr.src = host + "/j/roundtrip.js";
        ((document.getElementsByTagName('head') || [null])[0] ||
            document.getElementsByTagName('script')[0].parentNode).appendChild(scr);
    };
    if (window.addEventListener) {window.addEventListener('load', _onload, false);}
    else {window.attachEvent('onload', _onload)}
}());            
</script>
</div></body>
</html>
